<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ìƒ ì‹¤í—˜ì‹¤: ë¬¼ì§ˆì˜ ìƒíƒœ ë³€í™”ì™€ ì—´ì—ë„ˆì§€</title>
    <style>
        :root {
            --primary: #4A90E2;
            --secondary: #50E3C2;
            --accent: #FF6B6B;
            --bg: #F5F7FA;
            --text: #2C3E50;
        }
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 { margin-bottom: 10px; color: var(--primary); }
        .container {
            display: flex;
            gap: 20px;
            max-width: 1200px;
            width: 100%;
            flex-wrap: wrap;
            justify-content: center;
        }
        .panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }
        /* ì™¼ìª½ ì œì–´ íŒ¨ë„ ë° ì…ì ë·° */
        .left-panel { flex: 1; min-width: 300px; }
        .control-group { margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .control-group label { display: block; margin-bottom: 8px; font-weight: bold; }
        select, input[type="range"] { width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ddd; }
        button {
            background: var(--primary); color: white; border: none; padding: 10px 20px;
            border-radius: 8px; cursor: pointer; font-size: 16px; transition: 0.2s; width: 100%; margin-top: 10px;
        }
        button:hover { background: #357ABD; }
        button.reset { background: var(--accent); margin-top: 5px; }
        
        /* ì…ì ìº”ë²„ìŠ¤ */
        #particleCanvas {
            background: #222; border-radius: 10px; width: 100%; height: 300px; margin-top: 10px;
        }
        
        /* ì˜¤ë¥¸ìª½ ê·¸ë˜í”„ íŒ¨ë„ */
        .right-panel { flex: 2; min-width: 400px; position: relative; }
        #graphCanvas {
            background: white; border: 1px solid #ddd; border-radius: 10px; width: 100%; height: 400px;
        }
        
        /* ìƒíƒœ í‘œì‹œ ë° í”¼ë“œë°± */
        .status-display {
            display: flex; justify-content: space-between; margin-top: 10px; font-weight: bold; font-size: 1.1em;
        }
        .feedback-box {
            margin-top: 15px; padding: 15px; background: #e8f4fd; border-left: 5px solid var(--primary);
            border-radius: 5px; min-height: 60px;
        }
        .heat-indicator {
            height: 10px; background: linear-gradient(to right, #ddd, var(--accent));
            width: 0%; border-radius: 5px; transition: width 0.5s; margin-top: 5px;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .container { flex-direction: column; }
            #graphCanvas { height: 300px; }
        }
    </style>
</head>
<body>

    <h1>âš—ï¸ ë¬¼ì§ˆì˜ ìƒíƒœ ë³€í™”ì™€ ì—´ì—ë„ˆì§€</h1>
    <p>ê°€ì—´ ì¥ì¹˜ë¥¼ ì¡°ì ˆí•˜ì—¬ ë¬¼ì§ˆì˜ ì˜¨ë„ë¥¼ ë†’ì´ê³ , ì…ìì˜ ì›€ì§ì„ê³¼ ì˜¨ë„ ê·¸ë˜í”„ë¥¼ ê´€ì°°í•´ë³´ì„¸ìš”.</p>

    <div class="container">
        <div class="panel left-panel">
            <div class="control-group">
                <label for="substance">ğŸ§ª ë¬¼ì§ˆ ì„ íƒ</label>
                <select id="substance">
                    <option value="water">ë¬¼ (ì–¼ìŒ â†’ ë¬¼ â†’ ìˆ˜ì¦ê¸°)</option>
                    <option value="lauric">ë¡œë¥´ì‚° (ê³ ì²´ â†’ ì•¡ì²´)</option>
                    <option value="dryice">ë“œë¼ì´ì•„ì´ìŠ¤ (ê³ ì²´ â†’ ê¸°ì²´ : ìŠ¹í™”)</option>
                </select>
            </div>

            <div class="control-group">
                <label for="heatPower">ğŸ”¥ ê°€ì—´ ì¥ì¹˜ ì„¸ê¸° (ì—´ì—ë„ˆì§€ ê³µê¸‰ëŸ‰)</label>
                <input type="range" id="heatPower" min="1" max="10" value="5">
                <div class="heat-indicator" id="heatBar"></div>
            </div>

            <button id="startBtn">ì‹¤í—˜ ì‹œì‘</button>
            <button id="resetBtn" class="reset">ì´ˆê¸°í™”</button>

            <canvas id="particleCanvas"></canvas>
            <div style="text-align: center; font-size: 0.9em; color: #666; margin-top:5px;">â–² ì…ì ëª¨í˜• (í™•ëŒ€)</div>
        </div>

        <div class="panel right-panel">
            <div class="status-display">
                <span id="tempDisplay">í˜„ì¬ ì˜¨ë„: -20Â°C</span>
                <span id="stateDisplay">ìƒíƒœ: ê³ ì²´</span>
            </div>
            <canvas id="graphCanvas"></canvas>
            <div class="feedback-box" id="feedback">
                ì‹¤í—˜ì„ ì‹œì‘í•˜ë ¤ë©´ 'ì‹¤í—˜ ì‹œì‘' ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.
            </div>
        </div>
    </div>

<script>
    // --- 1. ì„¤ì • ë° ë³€ìˆ˜ ---
    const canvasP = document.getElementById('particleCanvas');
    const ctxP = canvasP.getContext('2d');
    const canvasG = document.getElementById('graphCanvas');
    const ctxG = canvasG.getContext('2d');
    
    // ìº”ë²„ìŠ¤ í¬ê¸° ì¡°ì •
    function resizeCanvas() {
        canvasP.width = canvasP.offsetWidth;
        canvasP.height = canvasP.offsetHeight;
        canvasG.width = canvasG.offsetWidth;
        canvasG.height = canvasG.offsetHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // ìƒíƒœ ë³€ìˆ˜
    let isRunning = false;
    let time = 0;
    let temperature = -20;
    let particles = [];
    let graphData = [];
    let animationId;
    let currentState = "solid"; // solid, melting, liquid, boiling, gas
    
    // ë¬¼ì§ˆ ë°ì´í„°ë² ì´ìŠ¤
    const substances = {
        water: { name: "ë¬¼", mp: 0, bp: 100, heatFusion: 300, heatVap: 600, color: "#4A90E2", type: "normal" },
        lauric: { name: "ë¡œë¥´ì‚°", mp: 44, bp: 298, heatFusion: 200, heatVap: 500, color: "#F5A623", type: "normal" }, // ë“ëŠ”ì ì€ ì‹¤í—˜ìƒ ë„ë‹¬ ì–´ë µê²Œ ì„¤ì •
        dryice: { name: "ë“œë¼ì´ì•„ì´ìŠ¤", mp: -78.5, bp: -78.5, heatFusion: 0, heatVap: 400, color: "#BDC3C7", type: "sublimation" } // ìŠ¹í™” ë¬¼ì§ˆ
    };
    
    let currentSubstance = substances.water;
    let latentHeatCounter = 0; // ìƒíƒœ ë³€í™” êµ¬ê°„ ì¹´ìš´í„°

    // --- 2. ì…ì í´ë˜ìŠ¤ ---
    class Particle {
        constructor() {
            this.x = Math.random() * canvasP.width;
            this.y = Math.random() * canvasP.height;
            this.baseX = this.x; // ê³ ì²´ì¼ ë•Œ ê¸°ì¤€ì 
            this.baseY = this.y;
            this.vx = (Math.random() - 0.5) * 2;
            this.vy = (Math.random() - 0.5) * 2;
            this.radius = 6;
        }

        update(temp, state) {
            // ì˜¨ë„ì— ë”°ë¥¸ ì†ë„ ê³„ìˆ˜
            let speed = (temp + 273) / 100; 

            if (state === "solid" || (state === "melting" && Math.random() > 0.5)) {
                // ê³ ì²´: ì œìë¦¬ ì§„ë™
                this.x = this.baseX + (Math.random() - 0.5) * speed * 2;
                this.y = this.baseY + (Math.random() - 0.5) * speed * 2;
            } else if (state === "liquid" || state === "melting" || (state === "boiling" && Math.random() > 0.5)) {
                // ì•¡ì²´: ì•½ê°„ì˜ ìœ ë™ì„± + ë°”ë‹¥ ìª½ìœ¼ë¡œ ì ë¦¼ (ì¤‘ë ¥ í‰ë‚´) -> ì—¬ê¸°ì„  ììœ  ìš´ë™í•˜ë˜ ëŠë¦¬ê²Œ
                this.x += this.vx * speed * 0.5;
                this.y += this.vy * speed * 0.5;
                
                // ë²½ íŠ•ê¸°ê¸°
                if(this.x < 0 || this.x > canvasP.width) this.vx *= -1;
                if(this.y < 0 || this.y > canvasP.height) this.vy *= -1;
            } else {
                // ê¸°ì²´: ë§¤ìš° í™œë°œ, ì „ì²´ ê³µê°„
                this.x += this.vx * speed * 2;
                this.y += this.vy * speed * 2;

                if(this.x < 0 || this.x > canvasP.width) this.vx *= -1;
                if(this.y < 0 || this.y > canvasP.height) this.vy *= -1;
            }
        }

        draw() {
            ctxP.beginPath();
            ctxP.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
            ctxP.fillStyle = currentSubstance.color;
            ctxP.fill();
            ctxP.closePath();
        }
    }

    // ì…ì ì´ˆê¸°í™”
    function initParticles() {
        particles = [];
        // ê·œì¹™ì ì¸ ë°°ì—´ (ê³ ì²´ ì‹œì‘)
        const cols = 10;
        const rows = 10;
        const spacingX = canvasP.width / (cols + 1);
        const spacingY = canvasP.height / (rows + 1);

        for(let i=0; i<cols; i++) {
            for(let j=0; j<rows; j++) {
                let p = new Particle();
                p.x = spacingX * (i+1);
                p.y = spacingY * (j+1);
                p.baseX = p.x;
                p.baseY = p.y;
                particles.push(p);
            }
        }
    }

    // --- 3. ë©”ì¸ ë¡œì§ ---
    function updatePhysics() {
        const heatPower = parseInt(document.getElementById('heatPower').value);
        document.getElementById('heatBar').style.width = (heatPower * 10) + "%";
        
        // 1í”„ë ˆì„ë‹¹ ì˜¨ë„ ìƒìŠ¹ëŸ‰ (ê°€ìƒ)
        let tempRise = heatPower * 0.05; 

        // ë“œë¼ì´ì•„ì´ìŠ¤(ìŠ¹í™”ì„±) ì˜ˆì™¸ ì²˜ë¦¬
        if (currentSubstance.type === "sublimation") {
            if (temperature < currentSubstance.bp) {
                currentState = "solid";
                temperature += tempRise;
            } else if (temperature >= currentSubstance.bp && latentHeatCounter < currentSubstance.heatVap) {
                currentState = "sublimating"; // ìŠ¹í™” ì¤‘
                temperature = currentSubstance.bp; // ì˜¨ë„ ìœ ì§€
                latentHeatCounter += heatPower;
            } else {
                currentState = "gas";
                temperature += tempRise;
            }
        } 
        // ì¼ë°˜ ë¬¼ì§ˆ (ê³ ì²´-ì•¡ì²´-ê¸°ì²´)
        else {
            if (temperature < currentSubstance.mp) {
                currentState = "solid";
                temperature += tempRise;
            } else if (Math.abs(temperature - currentSubstance.mp) < 1 && latentHeatCounter < currentSubstance.heatFusion) {
                currentState = "melting"; // ìœµí•´ ì¤‘
                temperature = currentSubstance.mp; // ì˜¨ë„ ì •ì²´
                latentHeatCounter += heatPower;
            } else if (latentHeatCounter >= currentSubstance.heatFusion && temperature < currentSubstance.bp) {
                currentState = "liquid";
                temperature += tempRise;
            } else if (Math.abs(temperature - currentSubstance.bp) < 1 && latentHeatCounter < (currentSubstance.heatFusion + currentSubstance.heatVap)) {
                currentState = "boiling"; // ê¸°í™” ì¤‘
                temperature = currentSubstance.bp; // ì˜¨ë„ ì •ì²´
                latentHeatCounter += heatPower;
            } else {
                currentState = "gas";
                temperature += tempRise;
            }
        }

        // ê·¸ë˜í”„ ë°ì´í„° ì €ì¥
        time++;
        if(time % 5 === 0) { // ë°ì´í„° ê³¼ì  ë°©ì§€ (ë‹¤ìš´ìƒ˜í”Œë§)
            graphData.push({t: time, temp: temperature});
        }
    }

    function updateFeedback() {
        const tempEl = document.getElementById('tempDisplay');
        const stateEl = document.getElementById('stateDisplay');
        const fbEl = document.getElementById('feedback');

        tempEl.innerText = `í˜„ì¬ ì˜¨ë„: ${Math.round(temperature)}Â°C`;
        
        let stateText = "";
        let feedbackText = "";

        if (currentState === "solid") {
            stateText = "ìƒíƒœ: ê³ ì²´ (Solid)";
            feedbackText = "ì…ìë“¤ì´ ê·œì¹™ì ìœ¼ë¡œ ë°°ì—´ë˜ì–´ ì œìë¦¬ì—ì„œ ì§„ë™í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì˜¨ë„ê°€ ì˜¬ë¼ê°‘ë‹ˆë‹¤.";
        } else if (currentState === "melting") {
            stateText = "ìƒíƒœ: ìœµí•´ ì¤‘ (ê³ ì²´ â†’ ì•¡ì²´)";
            feedbackText = `ğŸš¨ <strong>êµ¬ê°„ ë°œê²¬!</strong> ì˜¨ë„ê°€ ë³€í•˜ì§€ ì•Šê³  ìˆìŠµë‹ˆë‹¤.<br>ê°€í•´ì¤€ ì—´ì—ë„ˆì§€ê°€ ì…ì ì‚¬ì´ì˜ ê²°í•©ì„ ëŠì–´ ìƒíƒœë¥¼ ë³€í™”ì‹œí‚¤ëŠ” ë° ì“°ì´ê³  ìˆìŠµë‹ˆë‹¤.`;
        } else if (currentState === "liquid") {
            stateText = "ìƒíƒœ: ì•¡ì²´ (Liquid)";
            feedbackText = "ì…ì ë°°ì—´ì´ ë¶ˆê·œì¹™í•´ì§€ê³  ë¹„êµì  ììœ ë¡­ê²Œ ì›€ì§ì…ë‹ˆë‹¤. ì˜¨ë„ê°€ ë‹¤ì‹œ ì˜¬ë¼ê°‘ë‹ˆë‹¤.";
        } else if (currentState === "boiling") {
            stateText = "ìƒíƒœ: ê¸°í™” ì¤‘ (ì•¡ì²´ â†’ ê¸°ì²´)";
            feedbackText = `ğŸš¨ <strong>êµ¬ê°„ ë°œê²¬!</strong> ì•¡ì²´ê°€ ë“ê³  ìˆìŠµë‹ˆë‹¤.<br>ì—´ì—ë„ˆì§€ê°€ ì…ìë¥¼ ì™„ì „íˆ ë–¼ì–´ë†“ëŠ” ë° ì‚¬ìš©ë˜ì–´ ì˜¨ë„ê°€ ì¼ì •í•˜ê²Œ ìœ ì§€ë©ë‹ˆë‹¤.`;
        } else if (currentState === "sublimating") {
             stateText = "ìƒíƒœ: ìŠ¹í™” ì¤‘ (ê³ ì²´ â†’ ê¸°ì²´)";
             feedbackText = "ë“œë¼ì´ì•„ì´ìŠ¤ëŠ” ì•¡ì²´ë¥¼ ê±°ì¹˜ì§€ ì•Šê³  ë°”ë¡œ ê¸°ì²´ë¡œ ë³€í•©ë‹ˆë‹¤! ì—´ì—ë„ˆì§€ê°€ ëª¨ë‘ ìƒíƒœ ë³€í™”ì— ì“°ì´ê³  ìˆìŠµë‹ˆë‹¤.";
        } else if (currentState === "gas") {
            stateText = "ìƒíƒœ: ê¸°ì²´ (Gas)";
            feedbackText = "ì…ìë“¤ì´ ë§¤ìš° ë¹ ë¥´ê³  ììœ ë¡­ê²Œ ê³µê°„ ì „ì²´ë¥¼ ë‚ ì•„ë‹¤ë‹™ë‹ˆë‹¤.";
        }

        stateEl.innerText = stateText;
        fbEl.innerHTML = feedbackText;
    }

    function drawGraph() {
        ctxG.clearRect(0, 0, canvasG.width, canvasG.height);
        
        // ì¶• ê·¸ë¦¬ê¸°
        ctxG.strokeStyle = "#888";
        ctxG.beginPath();
        ctxG.moveTo(40, 20); ctxG.lineTo(40, canvasG.height - 30); // Yì¶•
        ctxG.lineTo(canvasG.width - 20, canvasG.height - 30); // Xì¶•
        ctxG.stroke();

        // ë¼ë²¨
        ctxG.fillStyle = "#666";
        ctxG.font = "12px Arial";
        ctxG.fillText("ì˜¨ë„(Â°C)", 10, 15);
        ctxG.fillText("ì‹œê°„", canvasG.width - 40, canvasG.height - 10);

        // ë°ì´í„° ê·¸ë¦¬ê¸°
        if (graphData.length < 2) return;

        ctxG.beginPath();
        ctxG.strokeStyle = "#FF6B6B";
        ctxG.lineWidth = 3;
        
        // ê·¸ë˜í”„ ìŠ¤ì¼€ì¼ë§
        const maxTime = Math.max(1000, time); // xì¶• ìŠ¤ì¼€ì¼
        const minTemp = -30;
        const maxTemp = 120; // yì¶• ìŠ¤ì¼€ì¼
        
        graphData.forEach((d, i) => {
            const x = 40 + (d.t / maxTime) * (canvasG.width - 60);
            const y = (canvasG.height - 30) - ((d.temp - minTemp) / (maxTemp - minTemp)) * (canvasG.height - 50);
            if(i === 0) ctxG.moveTo(x, y);
            else ctxG.lineTo(x, y);
        });
        ctxG.stroke();
    }

    function loop() {
        if (!isRunning) return;

        // í™”ë©´ ì§€ìš°ê¸°
        ctxP.fillStyle = 'rgba(34, 34, 34, 0.3)'; // ì”ìƒ íš¨ê³¼
        ctxP.fillRect(0, 0, canvasP.width, canvasP.height);

        // ë¡œì§ ì—…ë°ì´íŠ¸
        updatePhysics();
        updateFeedback();
        drawGraph();

        // ì…ì ê·¸ë¦¬ê¸°
        particles.forEach(p => {
            p.update(temperature, currentState);
            p.draw();
        });

        animationId = requestAnimationFrame(loop);
    }

    // --- 4. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
    document.getElementById('startBtn').addEventListener('click', () => {
        if (isRunning) return;
        isRunning = true;
        
        // ë¬¼ì§ˆ ì„¤ì • ì ìš©
        const type = document.getElementById('substance').value;
        currentSubstance = substances[type];
        
        // ì´ˆê¸° ì˜¨ë„ ì„¤ì •
        if (type === 'dryice') temperature = -90;
        else if (type === 'water') temperature = -20;
        else temperature = 20;

        loop();
    });

    document.getElementById('resetBtn').addEventListener('click', () => {
        isRunning = false;
        cancelAnimationFrame(animationId);
        time = 0;
        latentHeatCounter = 0;
        graphData = [];
        ctxP.clearRect(0, 0, canvasP.width, canvasP.height);
        ctxG.clearRect(0, 0, canvasG.width, canvasG.height);
        initParticles();
        document.getElementById('feedback').innerHTML = "ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ë¬¼ì§ˆì„ ì„ íƒí•˜ê³  ì‹¤í—˜ì„ ì‹œì‘í•˜ì„¸ìš”.";
        document.getElementById('tempDisplay').innerText = "í˜„ì¬ ì˜¨ë„: --";
        document.getElementById('stateDisplay').innerText = "ìƒíƒœ: --";
        document.getElementById('heatBar').style.width = "0%";
    });

    // ì´ˆê¸°í™” ì‹¤í–‰
    initParticles();

</script>
</body>
</html>