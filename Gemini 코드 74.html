<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ìƒ ì‹¤í—˜: ì¼ì • ì„±ë¶„ë¹„ ë²•ì¹™</title>
    <style>
        :root {
            --primary: #4a90e2;
            --success: #2ecc71;
            --warning: #f1c40f;
            --danger: #e74c3c;
            --text: #333;
            --bg: #f4f7f6;
        }
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1, h2 { text-align: center; color: #2c3e50; }
        .container {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            max-width: 1200px;
            width: 100%;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        /* Control Panel */
        .controls {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
        }
        .control-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; }
        select, button {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #bdc3c7;
            border-radius: 5px;
            font-size: 1rem;
        }
        button {
            background-color: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            transition: background 0.3s;
            font-weight: bold;
        }
        button:hover { background-color: #357abd; }
        button.reset { background-color: var(--danger); }
        button.print { background-color: #34495e; margin-top: 10px;}

        input[type="range"] { width: 100%; }
        .value-display { font-size: 0.9rem; color: #666; text-align: right; }

        /* Visualization Area */
        .visualization {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        canvas {
            background: #fff;
            border: 2px dashed #bdc3c7;
            border-radius: 10px;
            width: 100%;
            height: 400px;
            cursor: crosshair;
        }

        /* Results Panel */
        .results {
            margin-top: 20px;
            padding: 15px;
            background: #e8f6f3;
            border-left: 5px solid var(--success);
            border-radius: 5px;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 0.9rem;
        }
        .data-table th, .data-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        .data-table th { background-color: #f2f2f2; }
        
        .feedback-box {
            margin-top: 15px;
            padding: 10px;
            background: #fff3cd;
            border-radius: 5px;
            font-weight: bold;
        }

        /* Print Style */
        @media print {
            body { background: white; padding: 0; }
            .container { box-shadow: none; grid-template-columns: 1fr; }
            .controls { display: none; } /* Hide interactive controls for print */
            canvas { border: 2px solid black; }
            button { display: none; }
        }
    </style>
</head>
<body>

    <h1>âš—ï¸ ê°€ìƒ ì‹¤í—˜ì‹¤: ì¼ì • ì„±ë¶„ë¹„ ë²•ì¹™</h1>
    <p style="text-align: center; max-width: 800px;">
        ì›ìë“¤ì„ ê²°í•©ì‹œì¼œ í™”í•©ë¬¼ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”. ë‚¨ëŠ” ì›ìë¥¼ ê´€ì°°í•˜ë©° ì§ˆëŸ‰ë¹„ì˜ ê·œì¹™ì„ ì°¾ì•„ë´…ì‹œë‹¤.
    </p>

    <div class="container">
        <aside class="controls">
            <h3>ğŸ”¬ ì‹¤í—˜ ì„¤ì •</h3>
            
            <div class="control-group">
                <label for="experimentType">ì‹¤í—˜ ì£¼ì œ ì„ íƒ</label>
                <select id="experimentType" onchange="resetExperiment()">
                    <option value="water">ë¬¼ ìƒì„± ë°˜ì‘ (ìˆ˜ì†Œ + ì‚°ì†Œ)</option>
                    <option value="lead">ì•„ì´ì˜¤ë”˜í™” ë‚© ìƒì„± (ë‚© + ì•„ì´ì˜¤ë”˜)</option>
                </select>
            </div>

            <div class="control-group">
                <label id="labelAtom1">ìˆ˜ì†Œ ì›ì (H) ìˆ˜: <span id="valAtom1">10</span>ê°œ</label>
                <input type="range" id="sliderAtom1" min="1" max="30" value="10" oninput="updateLabels()">
                <div class="value-display">ì›ìëŸ‰: <span id="massAtom1">1</span></div>
            </div>

            <div class="control-group">
                <label id="labelAtom2">ì‚°ì†Œ ì›ì (O) ìˆ˜: <span id="valAtom2">5</span>ê°œ</label>
                <input type="range" id="sliderAtom2" min="1" max="30" value="5" oninput="updateLabels()">
                <div class="value-display">ì›ìëŸ‰: <span id="massAtom2">16</span></div>
            </div>

            <button onclick="runReaction()">â–¶ ë°˜ì‘ ì‹œí‚¤ê¸°</button>
            <button class="reset" onclick="resetExperiment()">â†º ì´ˆê¸°í™”</button>
            <button class="print" onclick="window.print()">ğŸ–¨ï¸ ê²°ê³¼ ë³´ê³ ì„œ ì¸ì‡„(PDF)</button>
        </aside>

        <main class="visualization">
            <canvas id="simCanvas"></canvas>
            
            <div class="results" id="resultPanel" style="display: none;">
                <h3>ğŸ“Š ì‹¤í—˜ ë¶„ì„ ê²°ê³¼</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>êµ¬ë¶„</th>
                            <th id="thAtom1">ìˆ˜ì†Œ(H)</th>
                            <th id="thAtom2">ì‚°ì†Œ(O)</th>
                            <th>ë¹„ê³ </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>ë°˜ì‘ ì „ ê°œìˆ˜</td>
                            <td id="resCount1">0</td>
                            <td id="resCount2">0</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>ë°˜ì‘í•œ ê°œìˆ˜</td>
                            <td id="resReacted1" style="color: blue; font-weight: bold;">0</td>
                            <td id="resReacted2" style="color: blue; font-weight: bold;">0</td>
                            <td id="ratioCount">ê°œìˆ˜ë¹„ 2 : 1</td>
                        </tr>
                        <tr>
                            <td>ë‚¨ì€ ê°œìˆ˜</td>
                            <td id="resLeft1" style="color: red;">0</td>
                            <td id="resLeft2" style="color: red;">0</td>
                            <td>ë‚¨ëŠ” ë¬¼ì§ˆ ë°œìƒ!</td>
                        </tr>
                        <tr>
                            <td>ë°˜ì‘ ì§ˆëŸ‰(g)</td>
                            <td id="resMass1">0</td>
                            <td id="resMass2">0</td>
                            <td>(ê°€ìƒ ë‹¨ìœ„)</td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="feedback-box" id="massRatioResult">
                    </div>
            </div>
        </main>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        let atoms = [];
        let molecules = [];
        let isReacted = false;

        // ì›ì ë°ì´í„°ë² ì´ìŠ¤
        const ATOM_DATA = {
            water: {
                atom1: { name: 'ìˆ˜ì†Œ', symbol: 'H', mass: 1, color: '#bdc3c7', radius: 8 },
                atom2: { name: 'ì‚°ì†Œ', symbol: 'O', mass: 16, color: '#e74c3c', radius: 15 },
                product: { name: 'ë¬¼', symbol: 'Hâ‚‚O', ratio1: 2, ratio2: 1 }
            },
            lead: {
                atom1: { name: 'ë‚©', symbol: 'Pb', mass: 207, color: '#7f8c8d', radius: 18 },
                atom2: { name: 'ì•„ì´ì˜¤ë”˜', symbol: 'I', mass: 127, color: '#8e44ad', radius: 14 },
                product: { name: 'ì•„ì´ì˜¤ë”˜í™” ë‚©', symbol: 'PbIâ‚‚', ratio1: 1, ratio2: 2 }
            }
        };

        // ì´ˆê¸°í™” ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        window.onload = () => {
            resizeCanvas();
            resetExperiment();
        };

        function resizeCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        }

        // ë¼ë²¨ ë° ë°ì´í„° ì—…ë°ì´íŠ¸
        function updateLabels() {
            const type = document.getElementById('experimentType').value;
            const data = ATOM_DATA[type];
            
            // ë¼ë²¨ ì—…ë°ì´íŠ¸
            document.getElementById('labelAtom1').innerHTML = `${data.atom1.name} (${data.atom1.symbol}) ìˆ˜: <span id="valAtom1">${document.getElementById('sliderAtom1').value}</span>ê°œ`;
            document.getElementById('labelAtom2').innerHTML = `${data.atom2.name} (${data.atom2.symbol}) ìˆ˜: <span id="valAtom2">${document.getElementById('sliderAtom2').value}</span>ê°œ`;
            
            document.getElementById('massAtom1').innerText = data.atom1.mass;
            document.getElementById('massAtom2').innerText = data.atom2.mass;
            
            // í…Œì´ë¸” í—¤ë”
            document.getElementById('thAtom1').innerText = `${data.atom1.name}(${data.atom1.symbol})`;
            document.getElementById('thAtom2').innerText = `${data.atom2.name}(${data.atom2.symbol})`;

            if(!isReacted) drawPreview();
        }

        // ì‹¤í—˜ ë¦¬ì…‹
        function resetExperiment() {
            isReacted = false;
            document.getElementById('resultPanel').style.display = 'none';
            atoms = [];
            molecules = [];
            updateLabels();
            drawPreview();
        }

        // ë°˜ì‘ ì „ ë¯¸ë¦¬ë³´ê¸° (ì›ìë“¤ì´ í©ì–´ì ¸ ìˆëŠ” ìƒíƒœ)
        function drawPreview() {
            const type = document.getElementById('experimentType').value;
            const data = ATOM_DATA[type];
            const count1 = parseInt(document.getElementById('sliderAtom1').value);
            const count2 = parseInt(document.getElementById('sliderAtom2').value);
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ë¬´ì‘ìœ„ ìœ„ì¹˜ì— ê·¸ë¦¬ê¸° (ë‹¨ìˆœí™”)
            drawRandomAtoms(count1, data.atom1.color, data.atom1.radius, data.atom1.symbol);
            drawRandomAtoms(count2, data.atom2.color, data.atom2.radius, data.atom2.symbol);
        }

        function drawRandomAtoms(count, color, radius, text) {
            for(let i=0; i<count; i++) {
                const x = Math.random() * (canvas.width - 40) + 20;
                const y = Math.random() * (canvas.height - 40) + 20;
                
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                ctx.fillStyle = color;
                ctx.fill();
                ctx.strokeStyle = '#333';
                ctx.stroke();
                
                ctx.fillStyle = 'white';
                ctx.font = '10px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(text, x, y);
            }
        }

        // í•µì‹¬: ë°˜ì‘ ë¡œì§ ìˆ˜í–‰
        function runReaction() {
            if(isReacted) return;
            isReacted = true;

            const type = document.getElementById('experimentType').value;
            const data = ATOM_DATA[type];
            
            const count1 = parseInt(document.getElementById('sliderAtom1').value);
            const count2 = parseInt(document.getElementById('sliderAtom2').value);
            
            // í•œê³„ ë°˜ì‘ë¬¼ ê³„ì‚° (ëª‡ ê°œì˜ ë¶„ìê°€ ë§Œë“¤ì–´ì§€ëŠ”ê°€?)
            // ì˜ˆ: ë¬¼(2:1) -> Hê°€ 10ê°œë©´ 5ë²ˆ ê°€ëŠ¥, Oê°€ 5ê°œë©´ 5ë²ˆ ê°€ëŠ¥ -> min(5, 5) = 5ê°œ ìƒì„±
            const possibleFrom1 = Math.floor(count1 / data.product.ratio1);
            const possibleFrom2 = Math.floor(count2 / data.product.ratio2);
            
            const productCount = Math.min(possibleFrom1, possibleFrom2);
            
            // ì‹¤ì œ ë°˜ì‘í•œ ì›ì ìˆ˜
            const reacted1 = productCount * data.product.ratio1;
            const reacted2 = productCount * data.product.ratio2;
            
            // ë‚¨ì€ ì›ì ìˆ˜
            const left1 = count1 - reacted1;
            const left2 = count2 - reacted2;

            // ì‹œê°í™” ì—…ë°ì´íŠ¸ (ì •ë ¬ëœ í˜•íƒœë¡œ ê·¸ë¦¬ê¸°)
            drawResult(productCount, left1, left2, data);
            
            // ê²°ê³¼í‘œ ì—…ë°ì´íŠ¸
            updateResultsTable(count1, count2, reacted1, reacted2, left1, left2, data);
        }

        // ê²°ê³¼ ê·¸ë¦¬ê¸° (ë¶„ìì™€ ë‚¨ì€ ì›ì êµ¬ë¶„)
        function drawResult(productCount, left1, left2, data) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            let currentX = 50;
            let currentY = 50;
            
            // 1. ìƒì„±ëœ ë¶„ì ê·¸ë¦¬ê¸°
            ctx.font = '16px Pretendard';
            ctx.fillStyle = '#333';
            ctx.fillText(`ìƒì„±ëœ ${data.product.name} ë¶„ì: ${productCount}ê°œ`, 20, 30);

            for(let i=0; i<productCount; i++) {
                // ë¶„ì ê·¸ë¦¬ê¸° (ë‹¨ìˆœ ëª¨í˜•)
                drawMolecule(currentX, currentY + 30, data);
                currentX += 80;
                if(currentX > canvas.width - 50) {
                    currentX = 50;
                    currentY += 80;
                }
            }
            
            // 2. ë‚¨ì€ ì›ì ê·¸ë¦¬ê¸° ì˜ì—­
            currentY += 100;
            ctx.fillStyle = '#e74c3c';
            ctx.fillText("ë°˜ì‘í•˜ì§€ ì•Šê³  ë‚¨ì€ ì›ìë“¤ (ì‰ì—¬ ë°˜ì‘ë¬¼)", 20, currentY);
            currentY += 30;
            currentX = 50;

            // ë‚¨ì€ ì›ì 1
            for(let i=0; i<left1; i++) {
                drawAtom(currentX, currentY, data.atom1);
                currentX += 40;
                if(currentX > canvas.width - 40) { currentX = 50; currentY += 40; }
            }
            // ë‚¨ì€ ì›ì 2
            for(let i=0; i<left2; i++) {
                drawAtom(currentX, currentY, data.atom2);
                currentX += 40;
                if(currentX > canvas.width - 40) { currentX = 50; currentY += 40; }
            }
        }

        function drawMolecule(x, y, data) {
            // ì¤‘ì‹¬ ì›ì (ë³´í†µ ratioê°€ 1ì¸ ê²ƒ, ì‹œê°ì  í¸ì˜ìƒ atom2ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ê°€ì •í•˜ê±°ë‚˜ ì¡°ì •)
            // ë¬¼(H2O): Oê°€ ì¤‘ì‹¬, Hê°€ ê·€ì²˜ëŸ¼ ë¶™ìŒ
            // ë‚©(PbI2): Pbê°€ ì¤‘ì‹¬, Iê°€ ë¶™ìŒ
            
            if(data.product.symbol === 'Hâ‚‚O') {
                // ì‚°ì†Œ ì¤‘ì‹¬
                drawAtom(x, y, data.atom2); 
                // ìˆ˜ì†Œ 2ê°œ
                drawAtom(x - 12, y - 12, data.atom1);
                drawAtom(x + 12, y - 12, data.atom1);
            } else { // PbI2
                // ë‚© ì¤‘ì‹¬
                drawAtom(x, y, data.atom1);
                // ì•„ì´ì˜¤ë”˜ 2ê°œ
                drawAtom(x - 20, y, data.atom2);
                drawAtom(x + 20, y, data.atom2);
            }
        }

        function drawAtom(x, y, atomInfo) {
            ctx.beginPath();
            ctx.arc(x, y, atomInfo.radius, 0, Math.PI * 2);
            ctx.fillStyle = atomInfo.color;
            ctx.fill();
            ctx.strokeStyle = '#333';
            ctx.stroke();
            ctx.fillStyle = 'white';
            ctx.font = '10px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(atomInfo.symbol, x, y);
        }

        function updateResultsTable(c1, c2, r1, r2, l1, l2, data) {
            document.getElementById('resultPanel').style.display = 'block';
            
            document.getElementById('resCount1').innerText = c1;
            document.getElementById('resCount2').innerText = c2;
            
            document.getElementById('resReacted1').innerText = r1;
            document.getElementById('resReacted2').innerText = r2;
            
            document.getElementById('resLeft1').innerText = l1 > 0 ? `${l1} (ë‚¨ìŒ)` : 0;
            document.getElementById('resLeft2').innerText = l2 > 0 ? `${l2} (ë‚¨ìŒ)` : 0;
            
            // ì§ˆëŸ‰ ê³„ì‚°
            const mass1 = r1 * data.atom1.mass;
            const mass2 = r2 * data.atom2.mass;
            
            document.getElementById('resMass1').innerText = mass1;
            document.getElementById('resMass2').innerText = mass2;

            document.getElementById('ratioCount').innerText = `ê°œìˆ˜ë¹„ ${data.product.ratio1} : ${data.product.ratio2}`;

            // í”¼ë“œë°± ë©”ì‹œì§€ ìƒì„±
            let massRatioText = "";
            let simplifiedRatio = "";
            
            if(data.product.symbol === 'Hâ‚‚O') {
                // H : O = 1*2 : 16*1 = 2 : 16 = 1 : 8
                simplifiedRatio = "1 : 8";
            } else {
                // Pb : I = 207 : 127*2 = 207 : 254 (ì•½ 1:1.2)
                simplifiedRatio = "207 : 254";
            }

            const feedback = document.getElementById('massRatioResult');
            if(r1 === 0 && r2 === 0) {
                feedback.innerHTML = "âš ï¸ ë°˜ì‘ì´ ì¼ì–´ë‚˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì›ì ìˆ˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.";
            } else {
                feedback.innerHTML = `
                    âœ… <strong>ê²°ë¡ : ì¼ì • ì„±ë¶„ë¹„ ë²•ì¹™ ì„±ë¦½</strong><br>
                    ë°˜ì‘í•œ ì§ˆëŸ‰ë¹„ = ${data.atom1.symbol} : ${data.atom2.symbol} = ${mass1} : ${mass2}<br>
                    ê°€ì¥ ê°„ë‹¨í•œ ì •ìˆ˜ë¹„ë¡œ ì•½ë¶„í•˜ë©´ <strong>${simplifiedRatio}</strong> ì…ë‹ˆë‹¤.<br>
                    <span style="font-size:0.9em; color:#555;">(ë‚¨ì€ ì›ìëŠ” ì§ˆëŸ‰ë¹„ ê³„ì‚°ì— í¬í•¨ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ê²ƒì´ ë²•ì¹™ì˜ í•µì‹¬ì…ë‹ˆë‹¤!)</span>
                `;
            }
        }
    </script>
</body>
</html>