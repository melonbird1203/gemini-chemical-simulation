<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ìƒ í™”í•™ ì‹¤í—˜ì‹¤: ë°˜ì‘ì‹ ê· í˜• ë§ì¶”ê¸°</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --success-color: #2ecc71;
            --warning-color: #e74c3c;
            --bg-color: #f5f7fa;
            --panel-bg: #ffffff;
        }
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 { color: #2c3e50; margin-bottom: 10px; }
        .description { text-align: center; color: #555; max-width: 600px; margin-bottom: 20px; line-height: 1.5; }
        
        /* Main Container */
        .lab-container {
            background: var(--panel-bg);
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            padding: 30px;
            width: 100%;
            max-width: 900px;
        }

        /* Controls Area */
        .controls {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #ecf0f1;
            border-radius: 10px;
        }
        .molecule-control {
            text-align: center;
        }
        .molecule-display {
            font-size: 1.5em;
            font-weight: bold;
            margin: 10px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        .btn-control {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            width: 30px;
            height: 30px;
            font-size: 1.2em;
            cursor: pointer;
            transition: transform 0.1s;
        }
        .btn-control:hover { transform: scale(1.1); }
        .btn-control:active { transform: scale(0.95); }
        .count-display { font-size: 1.5em; margin: 0 15px; width: 30px; display: inline-block; }

        /* Visualization Area */
        .visual-stage {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            min-height: 200px;
            position: relative;
        }
        .reaction-side {
            width: 45%;
            border: 2px dashed #bdc3c7;
            border-radius: 10px;
            padding: 10px;
            min-height: 200px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-content: flex-start;
            gap: 10px;
            position: relative;
        }
        .reaction-arrow {
            font-size: 3em;
            color: #7f8c8d;
            align-self: center;
        }
        .side-label {
            position: absolute;
            top: -12px;
            left: 10px;
            background: var(--panel-bg);
            padding: 0 10px;
            font-weight: bold;
            color: #7f8c8d;
        }

        /* Particle Styles */
        .molecule-visual {
            display: flex;
            align-items: center;
            padding: 5px;
            border: 1px solid #eee;
            border-radius: 5px;
            background: #fff;
            animation: popIn 0.3s ease-out;
        }
        @keyframes popIn { from { transform: scale(0); } to { transform: scale(1); } }
        
        .atom {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 0.7em;
            font-weight: bold;
            margin: 1px;
            box-shadow: inset -2px -2px 5px rgba(0,0,0,0.2);
        }
        .atom.H { background-color: #bdc3c7; color: #333; } /* White/Grey */
        .atom.C { background-color: #2c3e50; } /* Black */
        .atom.N { background-color: #3498db; } /* Blue */
        .atom.O { background-color: #e74c3c; } /* Red */

        /* Feedback Area */
        .feedback-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }
        .status-bar {
            font-size: 1.2em;
            font-weight: bold;
            text-align: center;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        .status-unbalanced { background: #fadbd8; color: #c0392b; }
        .status-balanced { background: #d4efdf; color: #27ae60; animation: pulse 1s infinite alternate; }
        
        @keyframes pulse { from { box-shadow: 0 0 5px #2ecc71; } to { box-shadow: 0 0 15px #2ecc71; } }

        .atom-counts {
            display: flex;
            justify-content: center;
            gap: 20px;
            font-size: 0.9em;
        }
        .count-item {
            padding: 5px 15px;
            background: white;
            border-radius: 15px;
            border: 1px solid #ddd;
        }

        /* Selection */
        .reaction-selector {
            margin-bottom: 20px;
            text-align: center;
        }
        select {
            padding: 10px;
            font-size: 1em;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>

    <h1>âš—ï¸ ê°€ìƒ í™”í•™ ì‹¤í—˜ì‹¤</h1>
    <p class="description">
        í™”í•™ ë°˜ì‘ì‹ì˜ ê³„ìˆ˜ë¥¼ ì¡°ì ˆí•˜ì—¬ ì§ˆëŸ‰ ë³´ì¡´ ë²•ì¹™ì„ ë§Œì¡±ì‹œì¼œë³´ì„¸ìš”.<br>
        ì¢Œë³€(ë°˜ì‘ë¬¼)ê³¼ ìš°ë³€(ìƒì„±ë¬¼)ì˜ ì›ì ê°œìˆ˜ê°€ ê°™ì•„ì•¼ í•©ë‹ˆë‹¤.
    </p>

    <div class="lab-container">
        <div class="reaction-selector">
            <label for="reaction-select">ì‹¤í—˜ ì£¼ì œ ì„ íƒ: </label>
            <select id="reaction-select" onchange="changeReaction()">
                <option value="ammonia">1. ì•”ëª¨ë‹ˆì•„ í•©ì„± (Nâ‚‚ + Hâ‚‚ â†’ NHâ‚ƒ)</option>
                <option value="water">2. ë¬¼ì˜ í•©ì„± (Hâ‚‚ + Oâ‚‚ â†’ Hâ‚‚O)</option>
                <option value="methane">3. ë©”í…Œì¸ ì—°ì†Œ (CHâ‚„ + Oâ‚‚ â†’ COâ‚‚ + Hâ‚‚O)</option>
            </select>
        </div>

        <div class="visual-stage">
            <div class="reaction-side" id="reactants-visual">
                <span class="side-label">ë°˜ì‘ë¬¼ (Reactants)</span>
                </div>
            <div class="reaction-arrow">â</div>
            <div class="reaction-side" id="products-visual">
                <span class="side-label">ìƒì„±ë¬¼ (Products)</span>
                </div>
        </div>

        <div class="controls" id="controls-area">
            </div>

        <div class="feedback-panel">
            <div id="status-bar" class="status-bar status-unbalanced">
                ìƒíƒœ: ê· í˜•ì´ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤ âš ï¸
            </div>
            <div class="atom-counts" id="atom-counts-display">
                </div>
        </div>
    </div>

    <script>
        // Simulation Data
        const reactions = {
            ammonia: {
                reactants: [
                    { formula: 'N2', name: 'ì§ˆì†Œ', atoms: { N: 2 }, count: 1 },
                    { formula: 'H2', name: 'ìˆ˜ì†Œ', atoms: { H: 2 }, count: 1 }
                ],
                products: [
                    { formula: 'NH3', name: 'ì•”ëª¨ë‹ˆì•„', atoms: { N: 1, H: 3 }, count: 1 }
                ]
            },
            water: {
                reactants: [
                    { formula: 'H2', name: 'ìˆ˜ì†Œ', atoms: { H: 2 }, count: 1 },
                    { formula: 'O2', name: 'ì‚°ì†Œ', atoms: { O: 2 }, count: 1 }
                ],
                products: [
                    { formula: 'H2O', name: 'ë¬¼', atoms: { H: 2, O: 1 }, count: 1 }
                ]
            },
            methane: {
                reactants: [
                    { formula: 'CH4', name: 'ë©”í…Œì¸', atoms: { C: 1, H: 4 }, count: 1 },
                    { formula: 'O2', name: 'ì‚°ì†Œ', atoms: { O: 2 }, count: 1 }
                ],
                products: [
                    { formula: 'CO2', name: 'ì´ì‚°í™”íƒ„ì†Œ', atoms: { C: 1, O: 2 }, count: 1 },
                    { formula: 'H2O', name: 'ë¬¼', atoms: { H: 2, O: 1 }, count: 1 }
                ]
            }
        };

        let currentReactionKey = 'ammonia';
        let currentReaction = null;

        // Initialize
        function init() {
            // Deep copy to reset counts
            currentReaction = JSON.parse(JSON.stringify(reactions[currentReactionKey]));
            renderControls();
            updateState();
        }

        function changeReaction() {
            currentReactionKey = document.getElementById('reaction-select').value;
            init();
        }

        // Logic: Update Counts
        function updateCount(type, index, change) {
            const target = type === 'reactant' ? currentReaction.reactants[index] : currentReaction.products[index];
            if (target.count + change >= 1 && target.count + change <= 10) {
                target.count += change;
                updateState();
            }
        }

        // Logic: Calculate Total Atoms & Check Balance
        function updateState() {
            renderParticles();
            
            const leftAtoms = {};
            const rightAtoms = {};
            let allElements = new Set();

            // Calc Reactants
            currentReaction.reactants.forEach(mol => {
                for (let [atom, num] of Object.entries(mol.atoms)) {
                    leftAtoms[atom] = (leftAtoms[atom] || 0) + (num * mol.count);
                    allElements.add(atom);
                }
            });

            // Calc Products
            currentReaction.products.forEach(mol => {
                for (let [atom, num] of Object.entries(mol.atoms)) {
                    rightAtoms[atom] = (rightAtoms[atom] || 0) + (num * mol.count);
                    allElements.add(atom);
                }
            });

            // Check Balance
            let isBalanced = true;
            let statusHTML = '';
            
            allElements.forEach(atom => {
                const l = leftAtoms[atom] || 0;
                const r = rightAtoms[atom] || 0;
                const match = l === r;
                if (!match) isBalanced = false;
                
                statusHTML += `<div class="count-item" style="border-color: ${match ? '#2ecc71' : '#e74c3c'}">
                    <span class="atom ${atom}">${atom}</span> : ì¢Œ ${l} / ìš° ${r}
                </div>`;
            });

            document.getElementById('atom-counts-display').innerHTML = statusHTML;
            
            const statusBar = document.getElementById('status-bar');
            if (isBalanced) {
                statusBar.className = 'status-bar status-balanced';
                statusBar.innerHTML = 'ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! í™”í•™ ë°˜ì‘ì‹ì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤! (ì§ˆëŸ‰ ë³´ì¡´ ì„±ë¦½)';
            } else {
                statusBar.className = 'status-bar status-unbalanced';
                statusBar.innerHTML = 'ì•„ì§ ê· í˜•ì´ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤. ì›ì ê°œìˆ˜ë¥¼ ë¹„êµí•´ë³´ì„¸ìš”. ğŸ¤”';
            }

            // Update Control Displays (Numbers)
            updateControlNumbers();
        }

        // Render: Controls
        function renderControls() {
            const container = document.getElementById('controls-area');
            container.innerHTML = '';

            // Reactants Controls
            currentReaction.reactants.forEach((mol, idx) => {
                container.appendChild(createControlElement(mol, 'reactant', idx));
            });
            
            const divider = document.createElement('div');
            divider.style.fontSize = '2em';
            divider.innerHTML = 'â';
            container.appendChild(divider);

            // Products Controls
            currentReaction.products.forEach((mol, idx) => {
                container.appendChild(createControlElement(mol, 'product', idx));
            });
        }

        function createControlElement(mol, type, idx) {
            const div = document.createElement('div');
            div.className = 'molecule-control';
            
            // Format chemical formula (subscripts)
            const formattedFormula = mol.formula.replace(/\d+/g, '<sub>$&</sub>');

            div.innerHTML = `
                <div class="molecule-display" id="${type}-display-${idx}">
                    <span style="font-size:1.2em; color:#4a90e2">${mol.count}</span> ${formattedFormula}
                </div>
                <div>
                    <button class="btn-control" onclick="updateCount('${type}', ${idx}, -1)">-</button>
                    <span class="count-display" id="${type}-count-${idx}">${mol.count}</span>
                    <button class="btn-control" onclick="updateCount('${type}', ${idx}, 1)">+</button>
                </div>
            `;
            return div;
        }

        function updateControlNumbers() {
            currentReaction.reactants.forEach((mol, idx) => {
                document.getElementById(`reactant-count-${idx}`).innerText = mol.count;
                const display = document.getElementById(`reactant-display-${idx}`);
                display.querySelector('span').innerText = mol.count;
            });
            currentReaction.products.forEach((mol, idx) => {
                document.getElementById(`product-count-${idx}`).innerText = mol.count;
                const display = document.getElementById(`product-display-${idx}`);
                display.querySelector('span').innerText = mol.count;
            });
        }

        // Render: Particles
        function renderParticles() {
            const leftZone = document.getElementById('reactants-visual');
            const rightZone = document.getElementById('products-visual');
            leftZone.innerHTML = '<span class="side-label">ë°˜ì‘ë¬¼</span>';
            rightZone.innerHTML = '<span class="side-label">ìƒì„±ë¬¼</span>';

            currentReaction.reactants.forEach(mol => {
                for(let i=0; i<mol.count; i++) {
                    leftZone.appendChild(createMoleculeVisual(mol));
                }
            });
            currentReaction.products.forEach(mol => {
                for(let i=0; i<mol.count; i++) {
                    rightZone.appendChild(createMoleculeVisual(mol));
                }
            });
        }

        function createMoleculeVisual(mol) {
            const wrapper = document.createElement('div');
            wrapper.className = 'molecule-visual';
            
            // Draw atoms based on structure (simplified visual)
            for (let [atomType, num] of Object.entries(mol.atoms)) {
                for(let i=0; i<num; i++) {
                    const atomDiv = document.createElement('div');
                    atomDiv.className = `atom ${atomType}`;
                    atomDiv.innerText = atomType;
                    wrapper.appendChild(atomDiv);
                }
            }
            return wrapper;
        }

        // Start
        init();
    </script>
</body>
</html>