<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¬¼ê³¼ ì—íƒ„ì˜¬ì˜ í˜¼í•© ê°€ìƒì‹¤í—˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; }
        .cylinder-glass {
            background: rgba(255, 255, 255, 0.3);
            border: 2px solid #cbd5e1;
            border-top: none;
            box-shadow: inset 10px 0 20px rgba(255, 255, 255, 0.5), 5px 5px 15px rgba(0,0,0,0.1);
        }
        .liquid { transition: height 1s ease-in-out, background-color 1s; }
        .particle-box { background-color: #0f172a; border-radius: 50%; overflow: hidden; border: 4px solid #94a3b8; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen flex flex-col items-center p-4">

    <header class="w-full max-w-4xl text-center mb-6">
        <span class="bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded">ì¤‘2 ê³¼í•™ - ë¬¼ì§ˆì˜ êµ¬ì„±</span>
        <h1 class="text-3xl font-bold mt-2">ë¬¼ì§ˆì€ ë¬´ì—‡ìœ¼ë¡œ ì´ë£¨ì–´ì ¸ ìˆì„ê¹Œ?</h1>
        <p class="text-slate-600 mt-1">ë¬¼ê³¼ ì—íƒ„ì˜¬ í˜¼í•© ì‹¤í—˜ì„ í†µí•´ ì…ì ëª¨í˜•ì„ ì´í•´í•´ ë´…ì‹œë‹¤.</p>
    </header>

    <main class="w-full max-w-5xl bg-white rounded-2xl shadow-xl p-6 grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <div class="space-y-6">
            <h2 class="text-xl font-bold border-b pb-2">1. ì‹¤í—˜ ì„¤ì •</h2>
            
            <div class="bg-blue-50 p-4 rounded-lg">
                <label class="block text-sm font-medium text-slate-700 mb-2">ë¬¼ ë¶€í”¼ ($V_{water}$)</label>
                <input type="range" id="waterRange" min="30" max="70" value="50" class="w-full accent-blue-500" oninput="updateValues()">
                <div class="text-right font-bold text-blue-600"><span id="waterVal">50</span> mL</div>
            </div>

            <div class="bg-red-50 p-4 rounded-lg">
                <label class="block text-sm font-medium text-slate-700 mb-2">ì—íƒ„ì˜¬ ë¶€í”¼ ($V_{ethanol}$)</label>
                <input type="range" id="ethanolRange" min="30" max="70" value="50" class="w-full accent-red-500" oninput="updateValues()">
                <div class="text-right font-bold text-red-600"><span id="ethanolVal">50</span> mL</div>
            </div>

            <div class="bg-yellow-50 p-3 rounded-lg text-sm text-yellow-800">
                <strong class="block mb-1">ğŸ’¡ ì˜ˆìƒí•´ë³´ì„¸ìš”!</strong>
                ë‘ ì•¡ì²´ë¥¼ ì„ìœ¼ë©´ ì´ ë¶€í”¼ëŠ” ì–¼ë§ˆê°€ ë ê¹Œìš”?
                <div class="mt-2 font-mono text-center text-lg">
                    <span id="predictVal">100</span> mL ?
                </div>
            </div>

            <button onclick="runExperiment()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-lg shadow transition transform active:scale-95">
                ğŸ§ª ì„ì–´ì„œ ê´€ì°°í•˜ê¸°
            </button>
            <button onclick="resetExperiment()" class="w-full bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-2 rounded-lg mt-2 transition">
                ì´ˆê¸°í™”
            </button>
        </div>

        <div class="flex flex-col items-center justify-end relative h-[400px] border-b-4 border-slate-300 pb-2">
            <h2 class="absolute top-0 left-0 text-xl font-bold text-slate-400">2. ê´€ì°°</h2>
            
            <div class="flex items-end gap-4">
                <div id="cyl-water" class="w-16 relative flex flex-col justify-end items-center transition-all duration-500">
                    <div class="text-xs mb-1 font-bold text-blue-500">ë¬¼</div>
                    <div class="cylinder-glass w-full h-[200px] relative rounded-b-lg overflow-hidden bg-white">
                        <div id="water-liquid" class="liquid bg-blue-400 opacity-80 w-full absolute bottom-0" style="height: 50%;"></div>
                        <div class="absolute right-0 top-0 bottom-0 w-full border-r border-slate-400 opacity-30" style="background-image: repeating-linear-gradient(to top, black 0, black 1px, transparent 1px, transparent 10px);"></div>
                    </div>
                </div>

                <div id="cyl-ethanol" class="w-16 relative flex flex-col justify-end items-center transition-all duration-500">
                    <div class="text-xs mb-1 font-bold text-red-500">ì—íƒ„ì˜¬</div>
                    <div class="cylinder-glass w-full h-[200px] relative rounded-b-lg overflow-hidden bg-white">
                        <div id="ethanol-liquid" class="liquid bg-red-400 opacity-80 w-full absolute bottom-0" style="height: 50%;"></div>
                        <div class="absolute right-0 top-0 bottom-0 w-full border-r border-slate-400 opacity-30" style="background-image: repeating-linear-gradient(to top, black 0, black 1px, transparent 1px, transparent 10px);"></div>
                    </div>
                </div>

                <div id="cyl-mix" class="w-24 relative flex flex-col justify-end items-center hidden">
                    <div class="text-xs mb-1 font-bold text-purple-600">í˜¼í•© ìš©ì•¡</div>
                    <div class="cylinder-glass w-full h-[250px] relative rounded-b-lg overflow-hidden bg-white">
                        <div id="mix-liquid" class="liquid bg-purple-500 opacity-90 w-full absolute bottom-0 flex items-center justify-center text-white font-bold" style="height: 0%;"></div>
                        <div class="absolute right-0 top-0 bottom-0 w-full border-r border-slate-400 opacity-30" style="background-image: repeating-linear-gradient(to top, black 0, black 1px, transparent 1px, transparent 10px);"></div>
                    </div>
                    <div id="result-bubble" class="absolute -top-12 bg-indigo-600 text-white px-3 py-1 rounded-full text-sm font-bold shadow-lg animate-bounce hidden">
                        ê²°ê³¼: <span id="finalResult"></span>mL
                    </div>
                </div>
            </div>
        </div>

        <div class="space-y-4">
            <h2 class="text-xl font-bold border-b pb-2">3. ì…ì ëª¨í˜• (Micro View)</h2>
            
            <div class="relative w-full h-48 particle-box flex items-center justify-center">
                <canvas id="particleCanvas" width="300" height="192"></canvas>
                <div id="micro-label" class="absolute bottom-2 text-white text-xs bg-black bg-opacity-50 px-2 rounded">ì‹¤í—˜ ì‹œì‘ ì „</div>
            </div>

            <div class="bg-slate-100 p-4 rounded-lg text-sm">
                <h3 class="font-bold text-slate-700 mb-2">ğŸ“Š ê²°ê³¼ ë¶„ì„</h3>
                <div id="feedback" class="text-slate-600">
                    ì™¼ìª½ì˜ ìŠ¬ë¼ì´ë”ë¥¼ ì¡°ì ˆí•˜ê³  [ì„ì–´ì„œ ê´€ì°°í•˜ê¸°] ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”.
                </div>
            </div>
        </div>
    </main>

    <script>
        // State
        let wVol = 50;
        let eVol = 50;
        let isMixed = false;
        const canvas = document.getElementById('particleCanvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        let animationId;

        // Particle Class
        class Particle {
            constructor(type, x, y) {
                this.type = type; // 'water' (small) or 'ethanol' (large)
                this.x = x;
                this.y = y;
                // Visual representation: Water is small (blue), Ethanol is large (red)
                // Note for students: Actually ethanol molecules are larger than water molecules.
                // Water fits into the hydrogen bond network of ethanol.
                this.radius = type === 'water' ? 3 : 6; 
                this.color = type === 'water' ? '#60A5FA' : '#F87171';
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = (Math.random() - 0.5) * 2;
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.closePath();
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;

                // Bounce off walls
                if (this.x + this.radius > canvas.width || this.x - this.radius < 0) this.vx = -this.vx;
                if (this.y + this.radius > canvas.height || this.y - this.radius < 0) this.vy = -this.vy;

                this.draw();
            }
        }

        function initParticles(mode) {
            particles = [];
            // Mode: 'separate' or 'mixed'
            const wCount = Math.floor(wVol * 0.8);
            const eCount = Math.floor(eVol * 0.5);

            if (mode === 'separate') {
                // Left half water, Right half ethanol
                for(let i=0; i<wCount; i++) {
                    particles.push(new Particle('water', Math.random() * (canvas.width/2), Math.random() * canvas.height));
                }
                for(let i=0; i<eCount; i++) {
                    particles.push(new Particle('ethanol', (canvas.width/2) + Math.random() * (canvas.width/2), Math.random() * canvas.height));
                }
            } else {
                // Mixed randomly
                for(let i=0; i<wCount; i++) {
                    particles.push(new Particle('water', Math.random() * canvas.width, Math.random() * canvas.height));
                }
                for(let i=0; i<eCount; i++) {
                    particles.push(new Particle('ethanol', Math.random() * canvas.width, Math.random() * canvas.height));
                }
            }
        }

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach(p => p.update());
            animationId = requestAnimationFrame(animate);
        }

        function updateValues() {
            if (isMixed) return;
            wVol = parseInt(document.getElementById('waterRange').value);
            eVol = parseInt(document.getElementById('ethanolRange').value);
            
            document.getElementById('waterVal').innerText = wVol;
            document.getElementById('ethanolVal').innerText = eVol;
            document.getElementById('predictVal').innerText = wVol + eVol;

            // Update cylinder visuals (scale factor approx 2px per mL)
            document.getElementById('water-liquid').style.height = `${wVol}%`;
            document.getElementById('ethanol-liquid').style.height = `${eVol}%`;
            
            initParticles('separate');
        }

        function runExperiment() {
            if (isMixed) return;
            isMixed = true;

            // Hide inputs to prevent changing during anim
            document.getElementById('waterRange').disabled = true;
            document.getElementById('ethanolRange').disabled = true;

            // 1. Pour animation (Simplified: hide separate, show mix)
            document.getElementById('cyl-water').style.opacity = '0';
            document.getElementById('cyl-ethanol').style.opacity = '0';
            
            setTimeout(() => {
                document.getElementById('cyl-water').style.display = 'none';
                document.getElementById('cyl-ethanol').style.display = 'none';
                document.getElementById('cyl-mix').classList.remove('hidden');
                
                // Calculate mixed volume (approx 3-4% loss)
                const theoreticalSum = wVol + eVol;
                const loss = theoreticalSum * 0.04; 
                const finalVol = (theoreticalSum - loss).toFixed(1);
                
                // Height calculation for visual
                // Max height of separate cyls was 100% = 100mL roughly. 
                // Mix cyl is taller/wider, let's just map volume to height % for the mix cyl.
                // Assuming max mix volume is 140ml.
                const heightPercent = (finalVol / 140) * 100;

                setTimeout(() => {
                    const mixLiquid = document.getElementById('mix-liquid');
                    mixLiquid.style.height = `${heightPercent}%`;
                    mixLiquid.innerText = "í˜¼í•© ì¤‘...";

                    // Micro View Mix
                    initParticles('mixed');
                    document.getElementById('micro-label').innerText = "ì…ìë¼ë¦¬ ì„ì´ëŠ” ì¤‘ (í™•ëŒ€)";

                    setTimeout(() => {
                        mixLiquid.innerText = "";
                        document.getElementById('result-bubble').classList.remove('hidden');
                        document.getElementById('finalResult').innerText = finalVol;
                        
                        // Feedback
                        const diff = (theoreticalSum - finalVol).toFixed(1);
                        document.getElementById('feedback').innerHTML = `
                            <p class="text-red-600 font-bold">ğŸ“¢ ì‹¤í—˜ ê²°ê³¼:</p>
                            <p>ì˜ˆìƒ ë¶€í”¼: ${theoreticalSum}mL <br> ì‹¤ì œ ë¶€í”¼: <strong>${finalVol}mL</strong></p>
                            <p class="mt-2 text-sm bg-yellow-100 p-2 rounded border border-yellow-300">
                                ğŸ’¡ <strong>${diff}mLê°€ ì¤„ì–´ë“¤ì—ˆìŠµë‹ˆë‹¤!</strong><br>
                                í° ì½© ì‚¬ì´ì— ì¢ìŒ€ì´ ë¼ì–´ë“¤ ë“¯, ì—íƒ„ì˜¬ ì…ì ì‚¬ì´ì˜ ë¹ˆ ê³µê°„ìœ¼ë¡œ ë¬¼ ì…ìê°€ ë“¤ì–´ê°”ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
                            </p>
                        `;
                    }, 1000);
                }, 100);
            }, 500);
        }

        function resetExperiment() {
            isMixed = false;
            document.getElementById('waterRange').disabled = false;
            document.getElementById('ethanolRange').disabled = false;
            
            document.getElementById('cyl-mix').classList.add('hidden');
            document.getElementById('result-bubble').classList.add('hidden');
            document.getElementById('mix-liquid').style.height = '0%';
            
            document.getElementById('cyl-water').style.display = 'flex';
            document.getElementById('cyl-ethanol').style.display = 'flex';
            
            setTimeout(() => {
                document.getElementById('cyl-water').style.opacity = '1';
                document.getElementById('cyl-ethanol').style.opacity = '1';
            }, 50);

            document.getElementById('feedback').innerText = "ì™¼ìª½ì˜ ìŠ¬ë¼ì´ë”ë¥¼ ì¡°ì ˆí•˜ê³  [ì„ì–´ì„œ ê´€ì°°í•˜ê¸°] ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”.";
            document.getElementById('micro-label').innerText = "ì‹¤í—˜ ì‹œì‘ ì „";
            
            updateValues();
        }

        // Initialize
        updateValues();
        animate();

    </script>
</body>
</html>