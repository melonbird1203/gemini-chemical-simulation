<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ìƒ ì‹¤í—˜ì‹¤: í†°ìŠ¨ì˜ ìŒê·¹ì„  ì‹¤í—˜</title>
    <style>
        :root {
            --primary-color: #4CAF50;
            --bg-color: #1a1a1a;
            --panel-bg: #2d2d2d;
            --text-color: #e0e0e0;
            --beam-color: #00ff00;
        }

        body {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            width: 100%;
            max-width: 1000px;
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            max-width: 1200px;
            width: 100%;
        }

        /* Canvas Area */
        .lab-view {
            position: relative;
            background: #000;
            border: 4px solid #555;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.1);
        }

        canvas {
            display: block;
            background: radial-gradient(circle at center, #222 0%, #000 100%);
        }

        /* UI overlay for labels */
        .label {
            position: absolute;
            color: white;
            font-size: 12px;
            pointer-events: none;
            background: rgba(0,0,0,0.7);
            padding: 2px 5px;
            border-radius: 4px;
        }

        /* Controls */
        .controls {
            flex: 1;
            min-width: 300px;
            background-color: var(--panel-bg);
            padding: 20px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        h2, h3 { margin-top: 0; color: var(--primary-color); }

        .control-group {
            background: rgba(0,0,0,0.2);
            padding: 10px;
            border-radius: 8px;
        }

        label { display: block; margin-bottom: 5px; font-weight: bold; }
        
        input[type="range"] {
            width: 100%;
            cursor: pointer;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        input[type="checkbox"] {
            width: 20px;
            height: 20px;
        }

        /* Feedback & Quiz */
        .feedback-panel, .quiz-panel {
            width: 100%;
            max-width: 1000px;
            background-color: var(--panel-bg);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 5px solid var(--primary-color);
        }

        .feedback-text { font-size: 1.1em; line-height: 1.5; }
        .highlight { color: var(--primary-color); font-weight: bold; }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.3s;
        }

        button:hover { background-color: #388E3C; }

        .quiz-options button {
            display: block;
            width: 100%;
            margin: 5px 0;
            text-align: left;
            background-color: #444;
        }
        .quiz-options button:hover { background-color: #555; }
        
        /* Report Modal */
        #reportModal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            color: black;
            padding: 30px;
            border-radius: 10px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
    </style>
</head>
<body>

<header>
    <h1>ğŸ§ª í†°ìŠ¨ì˜ ìŒê·¹ì„  ì‹¤í—˜ì‹¤</h1>
    <p>í•™ìŠµ ëª©í‘œ: ìŒê·¹ì„ ì˜ ì „ê¸°ì Â·ìê¸°ì  ì„±ì§ˆì„ ê´€ì°°í•˜ì—¬ ì „ìì˜ íŠ¹ì§•ì„ ë°í˜€ë´…ì‹œë‹¤.</p>
</header>

<div class="container">
    <div class="lab-view">
        <canvas id="simCanvas" width="600" height="400"></canvas>
        <div id="labels"></div>
    </div>

    <div class="controls">
        <h3>ğŸ›ï¸ ì‹¤í—˜ ì¥ì¹˜ ì¡°ì‘</h3>
        
        <div class="control-group">
            <label>âš¡ ì „ì•• ì„¸ê¸° (ìŒê·¹ì„  ë°©ì¶œëŸ‰)</label>
            <input type="range" id="intensitySlider" min="0" max="100" value="80">
        </div>

        <div class="control-group">
            <label>ğŸ”‹ ì „ê¸°ì¥ (ì „ì•• ì¡°ì ˆ)</label>
            <small>ìœ„ìª½ì´ (+), ì•„ë˜ìª½ì´ (-)</small>
            <input type="range" id="electricSlider" min="-100" max="100" value="0">
            <div id="electricValue">0 V</div>
        </div>

        <div class="control-group">
            <label>ğŸ§² ìê¸°ì¥ (ìì„ ì„¸ê¸°)</label>
            <small>ìì„ì˜ ìœ„ì¹˜ ì¡°ì ˆ</small>
            <input type="range" id="magneticSlider" min="-100" max="100" value="0">
            <div id="magneticValue">0 T</div>
        </div>

        <div class="control-group checkbox-group">
            <input type="checkbox" id="paddleCheck">
            <label for="paddleCheck">âš™ï¸ ë°”ëŒê°œë¹„ ì„¤ì¹˜ (ì§ˆëŸ‰ í™•ì¸)</label>
        </div>

        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button onclick="resetExperiment()">ğŸ”„ ì´ˆê¸°í™”</button>
            <button onclick="generateReport()">ğŸ“„ ê²°ê³¼ ë¦¬í¬íŠ¸ ì €ì¥</button>
        </div>
    </div>
</div>

<div class="feedback-panel">
    <h3>ğŸ“¢ ê´€ì°° ê²°ê³¼ ë° AI ë¶„ì„</h3>
    <p id="feedbackText" class="feedback-text">ì‹¤í—˜ì„ ì‹œì‘í•´ ë³´ì„¸ìš”! ì „ì••ì„ ë†’ì—¬ ìŒê·¹ì„ ì„ ë°œìƒì‹œí‚¤ê³ , ì „ê¸°ì¥ì´ë‚˜ ìê¸°ì¥ì„ ì¡°ì‘í•˜ì—¬ ê¶¤ì ì„ ê´€ì°°í•˜ì„¸ìš”.</p>
</div>

<div class="quiz-panel">
    <h3>ğŸ“ ê°œë… í™•ì¸ í€´ì¦ˆ</h3>
    <div id="quizContainer">
        <p id="quizQuestion">ì§ˆë¬¸ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
        <div class="quiz-options" id="quizOptions"></div>
        <p id="quizResult" style="margin-top: 10px; font-weight: bold;"></p>
    </div>
    <button onclick="nextQuiz()" style="margin-top: 10px;">ë‹¤ìŒ ë¬¸ì œ</button>
</div>

<div id="reportModal">
    <div class="modal-content">
        <h2>ğŸ”¬ ì‹¤í—˜ ê²°ê³¼ ë¦¬í¬íŠ¸</h2>
        <div id="reportContent"></div>
        <button onclick="closeReport()" style="margin-top: 20px;">ë‹«ê¸°</button>
        <button onclick="window.print()" style="margin-top: 20px; background-color: #333;">ì¸ì‡„ / PDF ì €ì¥</button>
    </div>
</div>

<script>
    // --- Simulation Constants & State ---
    const canvas = document.getElementById('simCanvas');
    const ctx = canvas.getContext('2d');
    
    let state = {
        intensity: 80,      // Beam visibility/strength
        electricField: 0,   // -100 to 100 (Up is positive plate)
        magneticField: 0,   // -100 to 100
        hasPaddle: false,
        paddleAngle: 0,
        time: 0
    };

    // --- Drawing Functions ---
    function drawTube() {
        ctx.strokeStyle = '#555';
        ctx.lineWidth = 4;
        
        // Glass Bulb Outline
        ctx.beginPath();
        ctx.moveTo(50, 150);
        ctx.lineTo(150, 150); // Neck
        ctx.bezierCurveTo(300, 50, 500, 50, 550, 100); // Top curve
        ctx.lineTo(550, 300); // Screen
        ctx.bezierCurveTo(500, 350, 300, 350, 150, 250); // Bottom curve
        ctx.lineTo(50, 250); // Neck
        ctx.closePath();
        ctx.stroke();

        // Cathode (-)
        ctx.fillStyle = '#888';
        ctx.fillRect(40, 180, 20, 40);
        ctx.fillStyle = '#fff';
        ctx.font = '14px Arial';
        ctx.fillText('(-)', 45, 175);

        // Anode (+)
        ctx.fillStyle = '#888';
        ctx.fillRect(120, 150, 10, 100); // Slit
        ctx.clearRect(120, 195, 10, 10); // Hole for beam
        ctx.fillText('(+)', 115, 145);
    }

    function drawPlates() {
        // Electric Plates
        const alpha = Math.abs(state.electricField) / 100;
        const color = state.electricField > 0 ? `rgba(255, 100, 100, ${alpha + 0.2})` : `rgba(100, 100, 255, ${alpha + 0.2})`;
        
        // Top Plate
        ctx.fillStyle = state.electricField > 0 ? '#ffcccc' : '#ccccff'; // + or - color
        ctx.fillRect(180, 140, 150, 10);
        if(state.electricField !== 0) {
            ctx.fillStyle = '#fff';
            ctx.fillText(state.electricField > 0 ? '+' : '-', 250, 135);
        }

        // Bottom Plate
        ctx.fillStyle = state.electricField < 0 ? '#ffcccc' : '#ccccff';
        ctx.fillRect(180, 250, 150, 10);
        if(state.electricField !== 0) {
            ctx.fillStyle = '#fff';
            ctx.fillText(state.electricField < 0 ? '+' : '-', 250, 275);
        }
    }

    function drawMagnet() {
        if (state.magneticField === 0) return;
        
        // Simple visual representation of Magnet
        ctx.save();
        ctx.globalAlpha = Math.abs(state.magneticField) / 120;
        // Draw a magnet graphic overlay
        ctx.fillStyle = state.magneticField > 0 ? 'red' : 'blue';
        ctx.font = '40px Arial';
        // Position changes slightly to simulate N/S switching
        ctx.fillText(state.magneticField > 0 ? 'N' : 'S', 240, 320); 
        ctx.restore();
    }

    function drawPaddle() {
        if (!state.hasPaddle) return;
        
        const px = 400;
        const py = 200;
        
        ctx.save();
        ctx.translate(px, py);
        ctx.rotate(state.paddleAngle);
        
        ctx.fillStyle = '#DAA520'; // Gold color
        ctx.beginPath();
        // Draw blades
        for(let i=0; i<4; i++) {
            ctx.fillRect(-2, -25, 4, 50);
            ctx.rotate(Math.PI/2);
        }
        ctx.beginPath();
        ctx.arc(0,0, 5, 0, Math.PI*2);
        ctx.fill();
        
        ctx.restore();
        
        // Stand
        ctx.strokeStyle = '#888';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(px, py+5);
        ctx.lineTo(px, 340); // Bottom of glass
        ctx.stroke();
    }

    function drawBeam() {
        if (state.intensity < 10) return; // Beam off

        ctx.strokeStyle = `rgba(0, 255, 0, ${state.intensity/100})`;
        ctx.lineWidth = 3;
        ctx.shadowBlur = 10;
        ctx.shadowColor = '#0f0';

        ctx.beginPath();
        ctx.moveTo(60, 200); // Cathode
        ctx.lineTo(130, 200); // Anode hole

        // Physics Simulation for Beam Path
        // F = qE + qv x B
        // Electron is negative (-).
        // Electric Field (Up is +): Electron attracted to +, so goes UP if Field > 0.
        // Magnetic Field: Simplified. Let's say Slider > 0 means force DOWN.
        
        const startX = 130;
        const startY = 200;
        const endX = 550;
        
        // Net vertical force factor
        // Electric: +Slider -> Pulls Up (because top plate becomes +)
        const forceE = -state.electricField * 1.5; // Negative because Y grows downward in Canvas
        
        // Magnetic: +Slider -> Pulls Down (Simplified Lorentz)
        const forceB = state.magneticField * 1.5; 
        
        const netForceY = forceE + forceB; 
        
        // Quadratic Curve Control Point
        // If force is 0, control point y is 200 (straight line)
        const controlX = (startX + endX) / 2;
        const controlY = startY + netForceY;

        ctx.quadraticCurveTo(controlX, controlY, endX, startY + (netForceY * 1.8));
        ctx.stroke();
        ctx.shadowBlur = 0; // Reset

        // Paddle Collision Logic
        // If beam is roughly straight (low force) and paddle exists
        if (state.hasPaddle && Math.abs(netForceY) < 30) {
            state.paddleAngle += 0.1; // Spin!
        }

        // Spot on Screen
        ctx.fillStyle = '#0f0';
        ctx.shadowBlur = 15;
        ctx.beginPath();
        ctx.arc(endX, startY + (netForceY * 1.8), 5 + (state.intensity/20), 0, Math.PI*2);
        ctx.fill();
        ctx.shadowBlur = 0;
    }

    function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        drawTube();
        drawPlates();
        drawPaddle();
        drawBeam();
        drawMagnet();
        
        updateFeedback();
        
        requestAnimationFrame(animate);
    }

    // --- Logic & Interaction ---
    const iSlider = document.getElementById('intensitySlider');
    const eSlider = document.getElementById('electricSlider');
    const mSlider = document.getElementById('magneticSlider');
    const pCheck = document.getElementById('paddleCheck');
    const eVal = document.getElementById('electricValue');
    const mVal = document.getElementById('magneticValue');
    const feedbackText = document.getElementById('feedbackText');

    function updateState() {
        state.intensity = parseInt(iSlider.value);
        state.electricField = parseInt(eSlider.value);
        state.magneticField = parseInt(mSlider.value);
        state.hasPaddle = pCheck.checked;

        eVal.innerText = state.electricField + " V";
        mVal.innerText = state.magneticField + " (ìƒëŒ€ê°’)";
    }

    [iSlider, eSlider, mSlider, pCheck].forEach(el => {
        el.addEventListener('input', updateState);
    });

    function updateFeedback() {
        let msg = "";
        
        if (state.intensity < 10) {
            msg = "ì „ì••ì´ ë„ˆë¬´ ë‚®ì•„ ìŒê·¹ì„ ì´ ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤. ì „ì•• ì„¸ê¸°ë¥¼ ë†’ì—¬ë³´ì„¸ìš”.";
        } else {
            const e = state.electricField;
            const b = state.magneticField;
            
            if (state.hasPaddle) {
                if (Math.abs(e) < 20 && Math.abs(b) < 20) {
                    msg = "<span class='highlight'>ë°œê²¬!</span> ìŒê·¹ì„ ì´ ë°”ëŒê°œë¹„ë¥¼ ë•Œë ¤ íšŒì „ì‹œí‚¤ê³  ìˆìŠµë‹ˆë‹¤. <br>â†’ <strong>ê²°ë¡ : ìŒê·¹ì„ ì€ ì§ˆëŸ‰ì„ ê°€ì§„ ì…ìë‹¤.</strong>";
                } else {
                    msg = "ìŒê·¹ì„ ì´ íœ˜ì–´ì ¸ ë°”ëŒê°œë¹„ë¥¼ ë§ì¶”ì§€ ëª»í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì „ê¸°ì¥/ìê¸°ì¥ì„ 0ìœ¼ë¡œ ë§ì¶°ë³´ì„¸ìš”.";
                }
            } else if (Math.abs(e) > 10) {
                const dir = e > 0 ? "ìœ„ìª½(+)ê·¹" : "ì•„ë˜ìª½(+)ê·¹";
                msg = `ìŒê·¹ì„ ì´ <strong>${dir}</strong>ìœ¼ë¡œ íœ˜ì–´ì§€ê³  ìˆìŠµë‹ˆë‹¤.<br>â†’ <strong>ê²°ë¡ : ìŒê·¹ì„ ì€ (-)ì „í•˜ë¥¼ ë¤ë‹¤.</strong> (ë‹¤ë¥¸ ì „í•˜ë¼ë¦¬ëŠ” ì¸ë ¥ ì‘ìš©)`;
            } else if (Math.abs(b) > 10) {
                msg = "ìê¸°ì¥ì— ì˜í•´ ìŒê·¹ì„ ì´ íœ˜ì–´ì§€ê³  ìˆìŠµë‹ˆë‹¤. <br>â†’ <strong>ê²°ë¡ : ì „í•˜ë¥¼ ë¤ ì…ìê°€ ì›€ì§ì´ë©´ ìê¸°ì¥ì˜ í˜ì„ ë°›ëŠ”ë‹¤.</strong>";
            } else {
                msg = "ìŒê·¹ì„ ì´ ì§ì§„í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì „ê¸°ì¥ì´ë‚˜ ìê¸°ì¥ì„ ê±¸ì–´ë³´ê±°ë‚˜ ë°”ëŒê°œë¹„ë¥¼ ì„¤ì¹˜í•´ë³´ì„¸ìš”.";
            }
        }
        feedbackText.innerHTML = msg;
    }

    function resetExperiment() {
        iSlider.value = 80;
        eSlider.value = 0;
        mSlider.value = 0;
        pCheck.checked = false;
        updateState();
    }

    // --- Assessment Logic ---
    const quizzes = [
        {
            q: "1. ìŒê·¹ì„ ì´ (+)ê·¹ ìª½ìœ¼ë¡œ íœ˜ì–´ì§€ëŠ” í˜„ìƒì„ í†µí•´ ì•Œ ìˆ˜ ìˆëŠ” ì‚¬ì‹¤ì€?",
            options: ["ìŒê·¹ì„ ì€ (+)ì „í•˜ë¥¼ ë¤ë‹¤", "ìŒê·¹ì„ ì€ (-)ì „í•˜ë¥¼ ë¤ë‹¤", "ìŒê·¹ì„ ì€ ì¤‘ì„±ì´ë‹¤"],
            a: 1
        },
        {
            q: "2. ë°”ëŒê°œë¹„ê°€ íšŒì „í•˜ëŠ” í˜„ìƒì€ ìŒê·¹ì„ ì˜ ì–´ë–¤ ì„±ì§ˆ ë•Œë¬¸ì¸ê°€?",
            options: ["ì§ˆëŸ‰ì„ ê°€ì§„ ì…ìë‹¤", "ë¹›ê³¼ ê°™ì€ íŒŒë™ì´ë‹¤", "ë§¤ìš° ëœ¨ê±°ìš´ ì—´ì„ ê°€ì§€ê³  ìˆë‹¤"],
            a: 0
        },
        {
            q: "3. í†°ìŠ¨ì€ ì´ ì‹¤í—˜ì„ í†µí•´ ì›ì ë‚´ë¶€ì— ë¬´ì—‡ì´ ì¡´ì¬í•¨ì„ ë°í˜”ëŠ”ê°€?",
            options: ["ì›ìí•µ", "ì „ì", "ì¤‘ì„±ì"],
            a: 1
        }
    ];
    let currentQuiz = 0;

    function loadQuiz() {
        const qData = quizzes[currentQuiz];
        document.getElementById('quizQuestion').innerText = qData.q;
        const optsDiv = document.getElementById('quizOptions');
        optsDiv.innerHTML = "";
        document.getElementById('quizResult').innerText = "";
        
        qData.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(idx);
            optsDiv.appendChild(btn);
        });
    }

    function checkAnswer(idx) {
        const res = document.getElementById('quizResult');
        if (idx === quizzes[currentQuiz].a) {
            res.innerText = "âœ… ì •ë‹µì…ë‹ˆë‹¤! ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°€ë³´ì„¸ìš”.";
            res.style.color = "#4CAF50";
        } else {
            res.innerText = "âŒ ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”. ì‹œë®¬ë ˆì´ì…˜ì„ ë‹¤ì‹œ ì¡°ì‘í•´ë³´ëŠ” ê±´ ì–´ë–¨ê¹Œìš”?";
            res.style.color = "#ff6b6b";
        }
    }

    function nextQuiz() {
        currentQuiz = (currentQuiz + 1) % quizzes.length;
        loadQuiz();
    }

    // --- Reporting ---
    function generateReport() {
        const modal = document.getElementById('reportModal');
        const content = document.getElementById('reportContent');
        const date = new Date().toLocaleString();
        
        let observation = feedbackText.innerText.replace(/<[^>]*>/g, '');
        
        content.innerHTML = `
            <p><strong>ì¼ì‹œ:</strong> ${date}</p>
            <p><strong>ì‹¤í—˜ ì£¼ì œ:</strong> í†°ìŠ¨ì˜ ìŒê·¹ì„  ì‹¤í—˜ (ì „ìì˜ ë°œê²¬)</p>
            <hr>
            <h3>[ì‹¤í—˜ ì„¤ì • ê°’]</h3>
            <ul>
                <li>ìŒê·¹ì„  ì„¸ê¸°: ${state.intensity}</li>
                <li>ì¸ê°€ ì „ì••(ì „ê¸°ì¥): ${state.electricField} V</li>
                <li>ìê¸°ì¥ ì„¸ê¸°: ${state.magneticField}</li>
                <li>ë°”ëŒê°œë¹„ ì„¤ì¹˜: ${state.hasPaddle ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤'}</li>
            </ul>
            <h3>[ê´€ì°° ê²°ê³¼ ë° í•´ì„]</h3>
            <p>${observation}</p>
            <h3>[í•™ìŠµ í•µì‹¬]</h3>
            <p>ë³¸ ì‹¤í—˜ì„ í†µí•´ ìŒê·¹ì„ ì€ ì§ˆëŸ‰ì„ ê°€ì§€ê³  (-)ì „í•˜ë¥¼ ë¤ ì…ì(ì „ì)ì˜ íë¦„ì„ì„ í™•ì¸í•˜ì˜€ìŠµë‹ˆë‹¤.</p>
        `;
        modal.style.display = 'flex';
    }

    function closeReport() {
        document.getElementById('reportModal').style.display = 'none';
    }

    // Initialize
    updateState();
    animate();
    loadQuiz();

</script>
</body>
</html>