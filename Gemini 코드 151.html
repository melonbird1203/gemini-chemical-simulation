<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ìƒ ì‹¤í—˜ì‹¤: ìˆ˜ì†Œ ì—°ë£Œ ì „ì§€ (Chemical Energy)</title>
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #10b981;
            --danger: #ef4444;
            --bg: #f8fafc;
            --panel: #ffffff;
            --text: #1e293b;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 20px;
        }

        /* Header */
        header {
            grid-column: 1 / -1;
            background: var(--primary);
            color: white;
            padding: 20px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 { margin: 0; font-size: 1.5rem; }
        .subtitle { font-size: 0.9rem; opacity: 0.9; }

        /* Panels */
        .panel {
            background: var(--panel);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        h2 { font-size: 1.1rem; border-bottom: 2px solid #e2e8f0; padding-bottom: 10px; margin-top: 0; }

        /* Controls */
        .control-group { margin-bottom: 20px; }
        label { display: block; font-weight: bold; margin-bottom: 8px; font-size: 0.9rem; }
        select, button {
            width: 100%;
            padding: 10px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 1rem;
        }
        button.action-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.2s;
        }
        button.action-btn:hover { background-color: #1d4ed8; }
        
        .app-selector { display: flex; gap: 5px; margin-bottom: 15px; }
        .app-btn {
            flex: 1;
            padding: 8px;
            font-size: 0.8rem;
            background: #e2e8f0;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        .app-btn.active { background: var(--secondary); color: white; }

        /* Canvas Area */
        .simulation-area {
            position: relative;
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        canvas {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: #f1f5f9;
        }

        /* Results & Feedback */
        .metric {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 10px;
            background: #f8fafc;
            border-radius: 6px;
        }
        .metric-value { font-weight: bold; color: var(--primary); }
        
        .feedback-box {
            margin-top: 15px;
            padding: 10px;
            background-color: #ecfdf5;
            border-left: 4px solid var(--secondary);
            font-size: 0.9rem;
        }
        .feedback-box.error {
            background-color: #fef2f2;
            border-left-color: var(--danger);
        }

        .formula-box {
            background: #1e293b;
            color: #fbbf24;
            padding: 10px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            margin-top: 10px;
        }

        /* Quiz Section */
        .quiz-section { grid-column: 1 / -1; margin-top: 20px; }
        .quiz-options { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px; }
        .quiz-btn { background: white; border: 1px solid var(--primary); color: var(--primary); }
        .quiz-btn:hover { background: #eff6ff; }

        @media (max-width: 900px) {
            .container { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<header>
    <div>
        <h1>ğŸ§ª í™”í•™ ê°€ìƒì‹¤í—˜ì‹¤: ìˆ˜ì†Œ ì—°ë£Œ ì „ì§€</h1>
        <div class="subtitle">ê³ ë“±í•™êµ í™”í•™ II - IV. í™”í•™ ì—ë„ˆì§€ì˜ ì´ìš©</div>
    </div>
    <div style="text-align: right; font-size: 0.9rem;">
        ë‹¨ì› ì„±ì·¨ë„: <span id="progress">0</span>%
    </div>
</header>

<div class="container">
    
    <div class="panel">
        <h2>ğŸ›ï¸ ì‹¤í—˜ ì„¤ì •</h2>
        
        <div class="control-group">
            <label>1. í™œìš© ë¶„ì•¼ ì„ íƒ (Load)</label>
            <div class="app-selector">
                <button class="app-btn active" onclick="setApp('lab')">ì‹¤í—˜ì‹¤</button>
                <button class="app-btn" onclick="setApp('car')">ìˆ˜ì†Œì°¨</button>
                <button class="app-btn" onclick="setApp('space')">ìš°ì£¼ì„ </button>
            </div>
            <p id="app-desc" style="font-size: 0.85rem; color: #64748b;">
                ê¸°ë³¸ ì‹¤í—˜ì‹¤ í™˜ê²½ì…ë‹ˆë‹¤. ì „êµ¬ì˜ ë°ê¸°ë¥¼ ê´€ì°°í•˜ì„¸ìš”.
            </p>
        </div>

        <div class="control-group">
            <label>2. (-)ê·¹ (ì‚°í™” ì „ê·¹) ì£¼ì… ê¸°ì²´</label>
            <select id="anode-gas">
                <option value="none">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="H2">ìˆ˜ì†Œ (Hâ‚‚)</option>
                <option value="CH4">ë©”íƒ„ (CHâ‚„)</option>
                <option value="O2">ì‚°ì†Œ (Oâ‚‚)</option>
            </select>
        </div>

        <div class="control-group">
            <label>3. (+)ê·¹ (í™˜ì› ì „ê·¹) ì£¼ì… ê¸°ì²´</label>
            <select id="cathode-gas">
                <option value="none">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="H2">ìˆ˜ì†Œ (Hâ‚‚)</option>
                <option value="O2">ì‚°ì†Œ (Oâ‚‚)</option>
                <option value="N2">ì§ˆì†Œ (Nâ‚‚)</option>
            </select>
        </div>

        <button class="action-btn" onclick="toggleSimulation()">ì‹¤í—˜ ì‹œì‘ / ì¤‘ì§€</button>
        <div style="font-size: 0.8rem; color: #64748b; margin-top:10px; text-align: center;">
            âš ï¸ ì•ˆì „: ì‹¤ì œ ìˆ˜ì†Œ ì‹¤í—˜ì€ í™”ì¬ ìœ„í—˜ì´ ìˆìœ¼ë‚˜, ì´ ì‹œë®¬ë ˆì´ì…˜ì€ ì•ˆì „í•©ë‹ˆë‹¤.
        </div>
    </div>

    <div class="simulation-area panel">
        <h2>âš¡ ì—°ë£Œ ì „ì§€ ë‚´ë¶€ ì‘ë™ ëª¨í˜•</h2>
        <canvas id="simCanvas" width="500" height="400"></canvas>
        <div id="reaction-display" class="formula-box">
            ì¤€ë¹„ ìƒíƒœ: ê¸°ì²´ë¥¼ ì£¼ì…í•˜ê³  ì‹¤í—˜ì„ ì‹œì‘í•˜ì„¸ìš”.
        </div>
    </div>

    <div class="panel">
        <h2>ğŸ“Š ì‹¤í—˜ ê²°ê³¼ & ë¶„ì„</h2>
        
        <div class="metric">
            <span>ì „ì•• (Voltage)</span>
            <span id="volt-val" class="metric-value">0.00 V</span>
        </div>
        <div class="metric">
            <span>íš¨ìœ¨ (Efficiency)</span>
            <span id="eff-val" class="metric-value">0 %</span>
        </div>
        <div class="metric">
            <span>ë¶€ì‚°ë¬¼ (Byproduct)</span>
            <span id="byproduct-val" class="metric-value">-</span>
        </div>

        <div id="ai-feedback" class="feedback-box">
            ğŸ‘©â€ğŸ« <b>ì„ ìƒë‹˜ ì¡°ì–¸:</b><br>
            ì—°ë£Œ ì „ì§€ëŠ” í™”í•™ ì—ë„ˆì§€ë¥¼ ì „ê¸° ì—ë„ˆì§€ë¡œ ì§ì ‘ ë³€í™˜í•©ë‹ˆë‹¤. (-)ê·¹ì— ì—°ë£Œë¥¼, (+)ê·¹ì— ì‚°í™”ì œë¥¼ ê³µê¸‰í•´ ë³´ì„¸ìš”.
        </div>

        <div style="margin-top: 20px;">
            <label>ğŸ“ í•µì‹¬ ê°œë… ë©”ëª¨</label>
            <ul style="font-size: 0.85rem; padding-left: 20px; color: #475569;">
                <li>ì‚°í™” ì „ê·¹(-): ìˆ˜ì†Œê°€ ì „ìë¥¼ ìƒìŒ</li>
                <li>í™˜ì› ì „ê·¹(+): ì‚°ì†Œê°€ ì „ìì™€ ê²°í•©</li>
                <li>ì „í•´ì§ˆ ë§‰: $H^+$ ì´ì˜¨ë§Œ í†µê³¼</li>
            </ul>
        </div>
    </div>

    <div class="panel quiz-section">
        <h2>ğŸ§  í˜•ì„± í‰ê°€ (ê°œë… í™•ì¸)</h2>
        <div id="quiz-container">
            <p id="quiz-question">Q. ìˆ˜ì†Œ ì—°ë£Œ ì „ì§€ì—ì„œ ë¬¼($H_2O$)ì´ ìƒì„±ë˜ëŠ” ê³³ì€ ì–´ë””ì¸ê°€ìš”?</p>
            <div class="quiz-options">
                <button class="quiz-btn" onclick="checkAnswer(1)">(-)ê·¹ (ì‚°í™” ì „ê·¹)</button>
                <button class="quiz-btn" onclick="checkAnswer(2)">(+)ê·¹ (í™˜ì› ì „ê·¹)</button>
                <button class="quiz-btn" onclick="checkAnswer(3)">ì „í•´ì§ˆ ë§‰ ë‚´ë¶€</button>
                <button class="quiz-btn" onclick="checkAnswer(4)">ì™¸ë¶€ ë„ì„ </button>
            </div>
            <p id="quiz-result" style="margin-top: 10px; font-weight: bold;"></p>
        </div>
    </div>

</div>

<script>
    const canvas = document.getElementById('simCanvas');
    const ctx = canvas.getContext('2d');
    
    // State Variables
    let isRunning = false;
    let particles = [];
    let electrons = [];
    let ions = [];
    let currentApp = 'lab'; // lab, car, space
    let voltage = 0;
    let reactionStatus = 'idle'; // idle, running, error, inefficient

    // Elements
    const anodeSelect = document.getElementById('anode-gas');
    const cathodeSelect = document.getElementById('cathode-gas');
    const voltDisplay = document.getElementById('volt-val');
    const effDisplay = document.getElementById('eff-val');
    const byproductDisplay = document.getElementById('byproduct-val');
    const feedbackBox = document.getElementById('ai-feedback');
    const reactionText = document.getElementById('reaction-display');
    const appDesc = document.getElementById('app-desc');

    // App Descriptions
    const appData = {
        lab: { desc: "ê¸°ë³¸ ì‹¤í—˜ì‹¤ í™˜ê²½ì…ë‹ˆë‹¤. ì „êµ¬ì˜ ë°ê¸°ë¥¼ ê´€ì°°í•˜ì„¸ìš”.", loadName: "ì „êµ¬" },
        car: { desc: "ìˆ˜ì†Œ ìë™ì°¨ì…ë‹ˆë‹¤. ë§¤ì—° ëŒ€ì‹  ë¬¼ë§Œ ë°°ì¶œë˜ëŠ” ì¹œí™˜ê²½ ì°¨ì…ë‹ˆë‹¤.", loadName: "ëª¨í„°" },
        space: { desc: "ìš°ì£¼ì„ (ì•„í´ë¡œ)ì…ë‹ˆë‹¤. ìƒì„±ëœ ë¬¼ì€ ì‹ìˆ˜ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.", loadName: "ìš°ì£¼ì„  ì „ë ¥" }
    };

    function setApp(app) {
        currentApp = app;
        document.querySelectorAll('.app-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        appDesc.innerText = appData[app].desc;
        drawFuelCell();
    }

    function toggleSimulation() {
        if (isRunning) {
            stopSimulation();
        } else {
            startSimulation();
        }
    }

    function startSimulation() {
        const anode = anodeSelect.value;
        const cathode = cathodeSelect.value;

        if (anode === 'none' || cathode === 'none') {
            feedbackBox.innerHTML = "âš ï¸ <b>ê²½ê³ :</b> ë‘ ì „ê·¹ì— ê¸°ì²´ë¥¼ ëª¨ë‘ ì£¼ì…í•´ì•¼ í•©ë‹ˆë‹¤.";
            feedbackBox.className = "feedback-box error";
            return;
        }

        isRunning = true;
        document.querySelector('.action-btn').innerText = "ì‹¤í—˜ ì¤‘ì§€";
        
        // Check Logic
        if (anode === 'H2' && cathode === 'O2') {
            reactionStatus = 'running';
            voltage = 1.23; // Theoretical max ideal
            feedbackBox.innerHTML = "âœ… <b>ì„±ê³µ!</b> ìˆ˜ì†Œì™€ ì‚°ì†Œê°€ ë°˜ì‘í•˜ì—¬ ì „ê¸°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. <br>(-)ê·¹: ì‚°í™”, (+)ê·¹: í™˜ì›";
            feedbackBox.className = "feedback-box";
            reactionText.innerHTML = "(-) $2H_2 \\rightarrow 4H^+ + 4e^-$ <br> (+) $O_2 + 4H^+ + 4e^- \\rightarrow 2H_2O$";
        } else if (anode === 'CH4' && cathode === 'O2') {
            reactionStatus = 'inefficient';
            voltage = 0.7; // Lower efficiency due to reforming
            feedbackBox.innerHTML = "âš ï¸ <b>ì°¸ê³ :</b> ë©”íƒ„(CHâ‚„) ì‚¬ìš© ì‹œ ì´ì‚°í™”íƒ„ì†Œê°€ ë°°ì¶œë˜ë©°, ê°œì§ˆ(Reforming) ê³¼ì •ì´ í•„ìš”í•´ íš¨ìœ¨ì´ ë‚®ìŠµë‹ˆë‹¤.";
            feedbackBox.className = "feedback-box";
            reactionText.innerHTML = "$CH_4 + 2H_2O \\rightarrow 4H_2 + CO_2$ (ê°œì§ˆ ë°˜ì‘ í•„ìš”)";
        } else {
            reactionStatus = 'error';
            voltage = 0;
            feedbackBox.innerHTML = "âŒ <b>ë°˜ì‘ ì—†ìŒ:</b> ì˜¬ë°”ë¥¸ ì—°ë£Œì™€ ì‚°í™”ì œ ì¡°í•©ì´ ì•„ë‹™ë‹ˆë‹¤. <br>Tip: (-)ê·¹ì—” ìˆ˜ì†Œ ê³„ì—´, (+)ê·¹ì—” ì‚°ì†Œê°€ í•„ìš”í•©ë‹ˆë‹¤.";
            feedbackBox.className = "feedback-box error";
            reactionText.innerHTML = "ë°˜ì‘ì´ ì¼ì–´ë‚˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
        }

        updateMetrics();
        animate();
    }

    function stopSimulation() {
        isRunning = false;
        document.querySelector('.action-btn').innerText = "ì‹¤í—˜ ì‹œì‘";
        particles = [];
        electrons = [];
        ions = [];
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawFuelCell();
        voltage = 0;
        updateMetrics();
    }

    function updateMetrics() {
        voltDisplay.innerText = voltage.toFixed(2) + " V";
        
        if (reactionStatus === 'running') {
            effDisplay.innerText = "85 % (High)";
            byproductDisplay.innerText = "ìˆœìˆ˜í•œ ë¬¼ (Hâ‚‚O)";
        } else if (reactionStatus === 'inefficient') {
            effDisplay.innerText = "40 % (Low)";
            byproductDisplay.innerText = "ë¬¼ + ì´ì‚°í™”íƒ„ì†Œ(COâ‚‚)";
        } else {
            effDisplay.innerText = "0 %";
            byproductDisplay.innerText = "-";
        }
        
        // Render Latex manually for simple display (simulated)
        // In a real app, MathJax would parse reactionText content
    }

    // --- Visualization Logic ---
    
    function drawFuelCell() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Background
        ctx.fillStyle = '#f1f5f9';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Structure
        // Anode (Left)
        ctx.fillStyle = '#94a3b8';
        ctx.fillRect(100, 100, 40, 200);
        ctx.fillStyle = '#000';
        ctx.font = "14px Arial";
        ctx.fillText("(-) Anode", 85, 320);

        // Cathode (Right)
        ctx.fillStyle = '#94a3b8';
        ctx.fillRect(360, 100, 40, 200);
        ctx.fillText("(+) Cathode", 350, 320);

        // Electrolyte / Membrane (Center)
        ctx.fillStyle = '#fcd34d'; // Yellowish for membrane
        ctx.fillRect(140, 100, 220, 200);
        ctx.fillStyle = '#78350f';
        ctx.fillText("ì „í•´ì§ˆ ë§‰ (PEM)", 200, 320);
        ctx.font = "12px Arial";
        ctx.fillText("H+ ì´ì˜¨ë§Œ í†µê³¼", 210, 340);

        // Wire & Load
        ctx.beginPath();
        ctx.strokeStyle = '#334155';
        ctx.lineWidth = 4;
        ctx.moveTo(120, 100);
        ctx.lineTo(120, 50);
        ctx.lineTo(250, 50); // Load position
        ctx.lineTo(380, 50);
        ctx.lineTo(380, 100);
        ctx.stroke();

        // Load Indicator (Bulb/Motor/Space)
        ctx.fillStyle = (voltage > 0) ? '#fbbf24' : '#cbd5e1';
        ctx.beginPath();
        ctx.arc(250, 50, 20, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = '#000';
        ctx.font = "12px Arial";
        ctx.textAlign = "center";
        ctx.fillText(appData[currentApp].loadName, 250, 85);

        // Inputs
        ctx.fillStyle = '#3b82f6'; // H2 input color
        ctx.font = "bold 16px Arial";
        ctx.fillText("IN: " + (anodeSelect.value !== 'none' ? anodeSelect.value : ""), 30, 200);
        
        ctx.fillStyle = '#ef4444'; // O2 input color
        ctx.fillText("IN: " + (cathodeSelect.value !== 'none' ? cathodeSelect.value : ""), 420, 200);
    }

    function animate() {
        if (!isRunning) return;

        drawFuelCell();

        // 1. Gas Injection Animation
        if (Math.random() < 0.1) {
            // H2 particle entering Anode
            particles.push({ x: 0, y: 150 + Math.random() * 100, type: 'H2', stage: 0 });
            // O2 particle entering Cathode
            particles.push({ x: 500, y: 150 + Math.random() * 100, type: 'O2', stage: 0 });
        }

        particles.forEach((p, index) => {
            // Draw Particle
            ctx.beginPath();
            ctx.arc(p.x, p.y, 6, 0, Math.PI * 2);
            ctx.fillStyle = (p.type === 'H2' || p.type === 'H+') ? '#3b82f6' : '#ef4444';
            ctx.fill();

            // Logic Movement
            if (p.type === 'H2') {
                if (p.x < 120) p.x += 2; // Move to Anode
                else {
                    // Split at Anode
                    p.type = 'H+'; 
                    // Create electron
                    electrons.push({ x: 120, y: 100, path: 0 });
                }
            } else if (p.type === 'H+') {
                // Move through membrane
                if (p.x < 380) p.x += 1;
                else p.type = 'dead'; // Reached Cathode to form water
            } else if (p.type === 'O2') {
                if (p.x > 380) p.x -= 2;
                else p.type = 'waiting';
            }
            
            // Cleanup
            if (p.x > 450 || p.type === 'dead') particles.splice(index, 1);
        });

        // 2. Electron Flow Animation (Through Wire)
        electrons.forEach((e, index) => {
            ctx.beginPath();
            ctx.arc(e.x, e.y, 3, 0, Math.PI * 2);
            ctx.fillStyle = '#fbbf24'; // Electron yellow
            ctx.fill();

            // Path logic: Up -> Right -> Down
            if (e.x === 120 && e.y > 50) e.y -= 4; // Up
            else if (e.y <= 50 && e.x < 380) e.x += 6; // Across (Fast)
            else if (e.x >= 380 && e.y < 150) e.y += 4; // Down
            else {
                electrons.splice(index, 1); // Reached Cathode
                // Create Water Visual
                particles.push({x: 380, y: e.y, type: 'H2O', stage: 1}); 
            }
        });
        
        // 3. Water Output (Only if running correctly)
        if (reactionStatus === 'running' || reactionStatus === 'inefficient') {
             ctx.fillStyle = '#0ea5e9';
             ctx.font = "bold 14px Arial";
             if(Math.random() < 0.05) {
                 ctx.fillText("Hâ‚‚O Drop", 420, 250 + Math.random()*20);
             }
        }

        requestAnimationFrame(animate);
    }

    // Initial Draw
    drawFuelCell();

    // Quiz Logic
    function checkAnswer(option) {
        const result = document.getElementById('quiz-result');
        const progress = document.getElementById('progress');
        
        if (option === 2) {
            result.innerText = "âœ… ì •ë‹µì…ë‹ˆë‹¤! (+)ê·¹ì—ì„œ ì‚°ì†Œ, ìˆ˜ì†Œì´ì˜¨, ì „ìê°€ ë§Œë‚˜ ë¬¼ì´ ìƒì„±ë©ë‹ˆë‹¤.";
            result.style.color = "var(--secondary)";
            progress.innerText = "100";
        } else {
            result.innerText = "âŒ ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”. ë¬¼ì€ ì‚°ì†Œê°€ ìˆëŠ” ìª½ì—ì„œ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤.";
            result.style.color = "var(--danger)";
        }
    }
</script>

</body>
</html>