<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ìƒ ì‹¤í—˜ì‹¤: ì´ì˜¨ì˜ í˜•ì„± ê³¼ì •</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #f5a623;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --bg-color: #f7f9fc;
            --text-color: #2c3e50;
        }

        body {
            font-family: 'Nanum Gothic', 'Malgun Gothic', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            max-width: 1000px;
            width: 100%;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 30px;
            box-sizing: border-box;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #eee;
            padding-bottom: 20px;
        }

        h1 { margin: 0 0 10px 0; color: var(--primary-color); }
        .subtitle { color: #7f8c8d; font-size: 0.95em; }

        .lab-bench {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
            align-items: flex-start;
        }

        /* ì™¼ìª½ ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .controls {
            flex: 1;
            min-width: 300px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e1e4e8;
        }

        .control-group { margin-bottom: 20px; }
        label { display: block; font-weight: bold; margin-bottom: 8px; }
        
        select, button {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        button.action-btn {
            margin-top: 10px;
            font-weight: bold;
            color: white;
            border: none;
        }

        .btn-lose { background-color: var(--danger-color); }
        .btn-gain { background-color: var(--primary-color); }
        .btn-reset { background-color: #95a5a6; margin-top: 5px; }

        button:hover { opacity: 0.9; transform: translateY(-2px); }
        button:disabled { background-color: #ccc; cursor: not-allowed; transform: none; }

        .status-panel {
            background: white;
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        
        .result-display {
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            background: #eee;
            border-radius: 5px;
        }

        /* ì˜¤ë¥¸ìª½ ì‹œê°í™” ì˜ì—­ */
        .visualization {
            flex: 1.5;
            min-width: 350px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #atom-svg {
            width: 100%;
            max-width: 400px;
            height: auto;
            border: 1px solid #eee;
            border-radius: 50%;
            background: white;
        }

        .message-box {
            margin-top: 20px;
            padding: 15px;
            background: #e8f4fd;
            border-left: 5px solid var(--primary-color);
            width: 100%;
            box-sizing: border-box;
            border-radius: 4px;
        }

        /* í€´ì¦ˆ ì˜ì—­ */
        .quiz-section {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px dashed #ccc;
        }
        .quiz-options { display: flex; gap: 10px; margin-top: 10px; }
        .quiz-btn { background: white; color: var(--text-color); border: 1px solid var(--primary-color); }
        .quiz-btn.correct { background: var(--success-color); color: white; }
        .quiz-btn.wrong { background: var(--danger-color); color: white; }

        /* ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        .electron { fill: var(--secondary-color); transition: all 0.5s ease-out; }
        .electron.moving { animation: pulse 0.5s infinite; }
        
        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .lab-bench { flex-direction: column; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ğŸ”¬ ì´ì˜¨ í˜•ì„± ì‹œë®¬ë ˆì´ì…˜</h1>
        <div class="subtitle">ì¤‘2 ê³¼í•™ > â… . ìš°ë¦¬ ëª¸ê³¼ í™”í•™ ë³€í™” > ì´ì˜¨ì˜ í˜•ì„±</div>
        <p><strong>í•™ìŠµ ëª©í‘œ:</strong> ì›ìê°€ ì „ìë¥¼ ìƒê±°ë‚˜ ì–»ì–´ ì´ì˜¨ì´ ë˜ëŠ” ê³¼ì •ì„ íƒêµ¬í•´ ë´…ì‹œë‹¤.</p>
    </header>

    <div class="lab-bench">
        <div class="controls">
            <div class="control-group">
                <label for="element-select">ğŸ§ª ì›ì†Œ ì„ íƒ</label>
                <select id="element-select" onchange="initExperiment()">
                    <option value="Na">ë‚˜íŠ¸ë¥¨ (Na) - ê¸ˆì†</option>
                    <option value="Mg">ë§ˆê·¸ë„¤ìŠ˜ (Mg) - ê¸ˆì†</option>
                    <option value="Cl">ì—¼ì†Œ (Cl) - ë¹„ê¸ˆì†</option>
                    <option value="O">ì‚°ì†Œ (O) - ë¹„ê¸ˆì†</option>
                    <option value="F">í”Œë£¨ì˜¤ë¦° (F) - ë¹„ê¸ˆì†</option>
                </select>
            </div>

            <div class="control-group">
                <label>âš¡ ì „ì ì´ë™ ì¡°ì‘</label>
                <button class="action-btn btn-lose" onclick="modifyElectron(-1)">â– ì „ì 1ê°œ ìƒê¸° (ë‚´ë³´ë‚´ê¸°)</button>
                <button class="action-btn btn-gain" onclick="modifyElectron(1)">â• ì „ì 1ê°œ ì–»ê¸° (ê°€ì ¸ì˜¤ê¸°)</button>
                <button class="action-btn btn-reset" onclick="initExperiment()">ğŸ”„ ì²˜ìŒ ìƒíƒœë¡œ ë˜ëŒë¦¬ê¸°</button>
            </div>

            <div class="status-panel">
                <div class="status-item"><span>ì›ìí•µ ì „í•˜(ì–‘ì„±ì):</span> <strong id="proton-display">+11</strong></div>
                <div class="status-item"><span>í˜„ì¬ ì „ì ìˆ˜:</span> <strong id="electron-display">11</strong></div>
                <div class="status-item" style="border-top:1px solid #eee; padding-top:5px; margin-top:5px;">
                    <span>ì´ ì „í•˜ëŸ‰:</span> <strong id="charge-display">0</strong>
                </div>
            </div>

            <div class="result-display" id="symbol-display">Na</div>
        </div>

        <div class="visualization">
            <svg id="atom-svg" viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg">
                </svg>

            <div class="message-box" id="feedback-msg">
                ì‹¤í—˜ì„ ì‹œì‘í•´ ë³¼ê¹Œìš”? ì›ì†Œë¥¼ ì„ íƒí•˜ê³  ì „ìë¥¼ ì´ë™ì‹œì¼œ ë³´ì„¸ìš”.
            </div>
        </div>
    </div>

    <div class="quiz-section" id="quiz-area" style="display:none;">
        <h3>ğŸ“ ê°œë… í™•ì¸ í€´ì¦ˆ</h3>
        <p id="quiz-question">ì´ ì›ìê°€ ì•ˆì •í•´ì§€ê¸° ìœ„í•´ ê°€ì¥ ì ì ˆí•œ ë³€í™”ëŠ”?</p>
        <div class="quiz-options" id="quiz-buttons">
            </div>
        <p id="quiz-feedback" style="font-weight:bold; margin-top:10px;"></p>
    </div>
</div>

<script>
    // 1. ë°ì´í„° ì •ì˜ (Data Dictionary)
    const elements = {
        Na: { name: 'ë‚˜íŠ¸ë¥¨', symbol: 'Na', atomicNumber: 11, goal: -1, type: 'metal' }, // goal: -1 (lose 1)
        Mg: { name: 'ë§ˆê·¸ë„¤ìŠ˜', symbol: 'Mg', atomicNumber: 12, goal: -2, type: 'metal' },
        Cl: { name: 'ì—¼ì†Œ', symbol: 'Cl', atomicNumber: 17, goal: 1, type: 'nonmetal' },
        O:  { name: 'ì‚°ì†Œ', symbol: 'O', atomicNumber: 8, goal: 2, type: 'nonmetal' },
        F:  { name: 'í”Œë£¨ì˜¤ë¦°', symbol: 'F', atomicNumber: 9, goal: 1, type: 'nonmetal' }
    };

    let currentElementKey = 'Na';
    let currentElectrons = 11;
    let initialElectrons = 11;

    // 2. ì´ˆê¸°í™” ë° ë Œë”ë§
    function initExperiment() {
        const select = document.getElementById('element-select');
        currentElementKey = select.value;
        const data = elements[currentElementKey];
        
        initialElectrons = data.atomicNumber;
        currentElectrons = data.atomicNumber;

        updateDisplay();
        generateQuiz();
        document.getElementById('feedback-msg').innerHTML = 
            `<strong>${data.name}(${data.symbol})</strong> ì›ìê°€ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤.<br>ì´ ì›ìëŠ” ${data.type === 'metal' ? 'ì „ì(ë“¤)ì„ ìƒì–´ ì–‘ì´ì˜¨ì´' : 'ì „ì(ë“¤)ì„ ì–»ì–´ ìŒì´ì˜¨ì´'} ë˜ê¸° ì‰½ìŠµë‹ˆë‹¤.`;
        document.getElementById('feedback-msg').style.borderColor = "#4a90e2";
        document.getElementById('feedback-msg').style.background = "#e8f4fd";
    }

    function updateDisplay() {
        const data = elements[currentElementKey];
        const netCharge = data.atomicNumber - currentElectrons;
        
        // í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        document.getElementById('proton-display').textContent = `+${data.atomicNumber}`;
        document.getElementById('electron-display').textContent = currentElectrons;
        
        let chargeText = "0 (ì¤‘ì„±)";
        if (netCharge > 0) chargeText = `+${netCharge} (ì–‘ì´ì˜¨)`;
        if (netCharge < 0) chargeText = `${netCharge} (ìŒì´ì˜¨)`;
        document.getElementById('charge-display').textContent = chargeText;
        document.getElementById('charge-display').style.color = netCharge === 0 ? 'black' : (netCharge > 0 ? '#e74c3c' : '#2980b9');

        // í™”í•™ì‹ í‘œê¸°
        let symbolHtml = data.symbol;
        if (netCharge !== 0) {
            const absCharge = Math.abs(netCharge);
            const sign = netCharge > 0 ? '+' : '-';
            const num = absCharge > 1 ? absCharge : '';
            symbolHtml += `<sup>${num}${sign}</sup>`;
        }
        document.getElementById('symbol-display').innerHTML = symbolHtml;

        drawAtom(data.atomicNumber, currentElectrons);
        checkStability(netCharge, data);
    }

    // 3. SVG ê·¸ë¦¬ê¸° ë¡œì§
    function drawAtom(protons, electrons) {
        const svg = document.getElementById('atom-svg');
        svg.innerHTML = ''; // ì´ˆê¸°í™”

        const cx = 200, cy = 200;
        
        // ì›ìí•µ
        const nucleus = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        nucleus.setAttribute("cx", cx);
        nucleus.setAttribute("cy", cy);
        nucleus.setAttribute("r", 30);
        nucleus.setAttribute("fill", "#e74c3c");
        svg.appendChild(nucleus);

        const nucleusText = document.createElementNS("http://www.w3.org/2000/svg", "text");
        nucleusText.setAttribute("x", cx);
        nucleusText.setAttribute("y", cy + 5);
        nucleusText.setAttribute("text-anchor", "middle");
        nucleusText.setAttribute("fill", "white");
        nucleusText.setAttribute("font-weight", "bold");
        nucleusText.textContent = `+${protons}`;
        svg.appendChild(nucleusText);

        // ì „ì ê»ì§ˆ ë° ì „ì ë°°ì¹˜ (ë³´ì–´ ëª¨ë¸)
        const shells = [2, 8, 8, 18]; // K, L, M, N
        let electronsLeft = electrons;
        let currentRadius = 60;

        for (let i = 0; i < shells.length; i++) {
            if (electronsLeft <= 0) break;

            let electronsInShell = Math.min(electronsLeft, shells[i]);
            
            // ê»ì§ˆ ê·¸ë¦¬ê¸°
            const shellCircle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            shellCircle.setAttribute("cx", cx);
            shellCircle.setAttribute("cy", cy);
            shellCircle.setAttribute("r", currentRadius);
            shellCircle.setAttribute("fill", "none");
            shellCircle.setAttribute("stroke", "#bdc3c7");
            shellCircle.setAttribute("stroke-width", "2");
            svg.appendChild(shellCircle);

            // ì „ì ê·¸ë¦¬ê¸°
            for (let j = 0; j < electronsInShell; j++) {
                const angle = (2 * Math.PI * j) / electronsInShell;
                const ex = cx + currentRadius * Math.cos(angle - Math.PI/2);
                const ey = cy + currentRadius * Math.sin(angle - Math.PI/2);

                const electron = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                electron.setAttribute("cx", ex);
                electron.setAttribute("cy", ey);
                electron.setAttribute("r", 6);
                electron.setAttribute("class", "electron");
                
                // ìµœì™¸ê° ì „ì ê°•ì¡° (ë§ˆì§€ë§‰ ê»ì§ˆì¼ ë•Œ)
                if (electronsLeft <= shells[i]) {
                     electron.setAttribute("fill", "#f1c40f");
                }

                svg.appendChild(electron);
            }

            electronsLeft -= electronsInShell;
            currentRadius += 40;
        }
    }

    // 4. ì¸í„°ë™ì…˜ ë¡œì§
    function modifyElectron(change) {
        // ì•ˆì „ ì¥ì¹˜: ì „ìê°€ ë„ˆë¬´ ì ê±°ë‚˜(0 ì´í•˜) ë„ˆë¬´ ë§ì§€ ì•Šë„ë¡(ìµœëŒ€ 20) ì œí•œ
        if (currentElectrons + change <= 0) {
            alert("ì „ìê°€ ë” ì´ìƒ ì—†ìŠµë‹ˆë‹¤!");
            return;
        }
        if (currentElectrons + change > 20) {
            alert("ì¤‘í•™êµ ê³¼ì •ì—ì„œëŠ” ì›ìë²ˆí˜¸ 20ë²ˆê¹Œì§€ë§Œ ë‹¤ë£¹ë‹ˆë‹¤.");
            return;
        }

        currentElectrons += change;
        updateDisplay();
    }

    function checkStability(netCharge, data) {
        const msgBox = document.getElementById('feedback-msg');
        const goal = data.goal; // ëª©í‘œ ì „í•˜ëŸ‰ (ì˜ˆ: NaëŠ” +1ì´ ëª©í‘œ, ì¦‰ ì „ì -1ê°œ)
        
        // í˜„ì¬ ì „í•˜ëŸ‰ê³¼ ëª©í‘œ ë¹„êµ
        // data.goal > 0 : ì „ìë¥¼ ì–»ì–´ì•¼ í•¨ (ìŒì´ì˜¨ ëª©í‘œ)
        // data.goal < 0 : ì „ìë¥¼ ìƒì–´ì•¼ í•¨ (ì–‘ì´ì˜¨ ëª©í‘œ)
        
        // ëª©í‘œ ìƒíƒœ ë„ë‹¬?
        const currentChangeInElectrons = currentElectrons - initialElectrons; // ì „ìë¥¼ ì–»ì—ˆìœ¼ë©´ +, ìƒì—ˆìœ¼ë©´ -
        // ëª©í‘œ: data.goal (ì˜ˆ: NaëŠ” -1)
        // ì‹¤ì œ ë³€í™”: currentChangeInElectrons
        
        // Na(goal: -1). í˜„ì¬ ì „ìë¥¼ 1ê°œ ìƒì—ˆë‹¤ë©´ currentChangeInElectrons = -1. ì„±ê³µ.
        
        if (currentChangeInElectrons === data.goal) {
            msgBox.innerHTML = `ğŸ‰ <strong>ì •ë‹µì…ë‹ˆë‹¤!</strong><br>ê°€ì¥ ë°”ê¹¥ìª½ ê»ì§ˆì´ ì „ìë¡œ ê½‰ ì°¨ê±°ë‚˜(8ê°œ) ë¹„ì›Œì ¸ì„œ ë§¤ìš° <strong>ì•ˆì •í•œ ì´ì˜¨</strong>ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.`;
            msgBox.style.backgroundColor = "#d4edda"; // ì´ˆë¡ìƒ‰ ë°°ê²½
            msgBox.style.borderColor = "#28a745";
            document.getElementById('symbol-display').style.color = "#27ae60";
        } else if (currentChangeInElectrons === 0) {
            msgBox.innerHTML = "ì›ìëŠ” ì¤‘ì„± ìƒíƒœì…ë‹ˆë‹¤. ì•ˆì •í•´ì§€ë ¤ë©´ ì „ìë¥¼ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œìš”?";
            msgBox.style.backgroundColor = "#e8f4fd";
            msgBox.style.borderColor = "#4a90e2";
        } else {
            // ë°©í–¥ì€ ë§ëŠ”ë° ê°œìˆ˜ê°€ í‹€ë¦° ê²½ìš°ì™€, ë°©í–¥ì´ í‹€ë¦° ê²½ìš° êµ¬ë¶„
            const correctDirection = (data.goal < 0 && change < 0) || (data.goal > 0 && change > 0);
            
            if ((data.goal < 0 && currentChangeInElectrons > 0) || (data.goal > 0 && currentChangeInElectrons < 0)) {
                 msgBox.innerHTML = `âš ï¸ <strong>ë¶ˆì•ˆì •í•©ë‹ˆë‹¤.</strong><br>${data.name}ì€ ${data.type === 'metal' ? 'ê¸ˆì†ì´ë¼ ì „ìë¥¼ ìƒëŠ” ê²ƒ' : 'ë¹„ê¸ˆì†ì´ë¼ ì „ìë¥¼ ì–»ëŠ” ê²ƒ'}ì„ ì¢‹ì•„í•©ë‹ˆë‹¤.`;
                 msgBox.style.backgroundColor = "#f8d7da";
                 msgBox.style.borderColor = "#dc3545";
            } else {
                 msgBox.innerHTML = "ë°©í–¥ì€ ë§ì§€ë§Œ, ì•„ì§ ê°€ì¥ ì•ˆì •í•œ ìƒíƒœ(ë¹„í™œì„± ê¸°ì²´ì™€ ê°™ì€ ì „ì ë°°ì¹˜)ëŠ” ì•„ë‹™ë‹ˆë‹¤.";
                 msgBox.style.backgroundColor = "#fff3cd";
                 msgBox.style.borderColor = "#ffc107";
            }
        }
    }
    
    // 5. í‰ê°€(í€´ì¦ˆ) ìƒì„± ë¡œì§
    function generateQuiz() {
        const quizArea = document.getElementById('quiz-area');
        const quizBtns = document.getElementById('quiz-buttons');
        const feedback = document.getElementById('quiz-feedback');
        
        quizArea.style.display = 'block';
        quizBtns.innerHTML = '';
        feedback.textContent = '';
        
        const data = elements[currentElementKey];
        const correctIon = `${data.symbol}${Math.abs(data.goal) > 1 ? Math.abs(data.goal) : ''}${data.goal > 0 ? '-' : '+'}`;
        
        // ë³´ê¸° ìƒì„± (ì •ë‹µ, ì¤‘ì„±ì›ì, ì˜¤ë‹µì´ì˜¨)
        const options = [
            { text: `${data.symbol}`, correct: false },
            { text: correctIon, correct: true }, // ì •ë‹µ (ì˜ˆ: Na+)
            { text: `${data.symbol}${data.goal > 0 ? '+' : '-'}`, correct: false } // ì˜¤ë‹µ (ë°˜ëŒ€ ì „í•˜)
        ];
        
        // ì…”í”Œ
        options.sort(() => Math.random() - 0.5);

        document.getElementById('quiz-question').innerText = 
            `ë¬¸ì œ: ${data.name} ì›ìê°€ ê°€ì¥ ì•ˆì •í•œ ìƒíƒœê°€ ë˜ì—ˆì„ ë•Œì˜ ì´ì˜¨ì‹ì€?`;

        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'quiz-btn';
            // sup íƒœê·¸ ì²˜ë¦¬ë¥¼ ìœ„í•´ innerHTML ì‚¬ìš©
            // í…ìŠ¤íŠ¸ íŒŒì‹±: Na+ -> Na<sup>+</sup>
            const formattedText = opt.text.replace(/([0-9]*)([+-])/, "<sup>$1$2</sup>");
            btn.innerHTML = formattedText;
            
            btn.onclick = () => {
                if(opt.correct) {
                    btn.classList.add('correct');
                    feedback.textContent = "â­• ì •ë‹µì…ë‹ˆë‹¤! ì „ì ê»ì§ˆì´ ì•ˆì •ëœ êµ¬ì¡°ë¥¼ ê°–ì·„ìŠµë‹ˆë‹¤.";
                    feedback.style.color = "green";
                } else {
                    btn.classList.add('wrong');
                    feedback.textContent = "âŒ ë‹¤ì‹œ ìƒê°í•´ë³¼ê¹Œìš”? ì˜¥í…Ÿ ê·œì¹™(8ì „ì ê·œì¹™)ì„ ë– ì˜¬ë ¤ë³´ì„¸ìš”.";
                    feedback.style.color = "red";
                }
            };
            quizBtns.appendChild(btn);
        });
    }

    // ì´ˆê¸° ì‹¤í–‰
    initExperiment();
</script>

</body>
</html>