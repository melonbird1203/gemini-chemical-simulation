<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¤‘3 ê³¼í•™: í™”í•™ ë°˜ì‘ì‹ ì‹œë®¬ë ˆì´í„°</title>
    <style>
        :root {
            --primary: #4a90e2;
            --success: #2ecc71;
            --danger: #e74c3c;
            --bg: #f5f7fa;
            --card: #ffffff;
        }
        body {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            background-color: var(--bg);
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            max-width: 900px;
            width: 100%;
            background: var(--card);
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            padding: 25px;
        }
        h1 { text-align: center; color: var(--primary); margin-bottom: 10px; }
        .description { text-align: center; color: #666; margin-bottom: 30px; }

        /* Controls */
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        select {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 16px;
        }

        /* Visualization Area */
        .lab-bench {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #eef2f7;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
        }
        .reaction-box {
            flex: 1;
            text-align: center;
            background: white;
            padding: 15px;
            border-radius: 10px;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 2px solid transparent;
        }
        .arrow { font-size: 40px; color: #999; margin: 0 15px; font-weight: bold; }
        
        /* Particles */
        .particle-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
            min-height: 100px;
        }
        .molecule {
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.05);
            border-radius: 50%; /* Just a container shape */
            padding: 5px;
            transition: all 0.3s ease;
        }
        .atom {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 10px;
            font-weight: bold;
            box-shadow: inset -2px -2px 5px rgba(0,0,0,0.2);
            position: relative;
        }
        
        /* Controls for Coefficients */
        .coefficient-control {
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .btn-count {
            width: 30px;
            height: 30px;
            border: none;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
        }
        .btn-count:hover { background: #357abd; }
        .coef-display { font-size: 24px; font-weight: bold; min-width: 30px; }

        /* Stats & Feedback */
        .stats-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .stat-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 5px solid #ccc;
        }
        .feedback-area {
            grid-column: 1 / -1;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            transition: all 0.3s;
        }
        .balanced { background-color: #d4edda; color: #155724; border-color: var(--success); }
        .unbalanced { background-color: #f8d7da; color: #721c24; border-color: var(--danger); }

        /* Mass Scale Visualization */
        .scale-viz {
            height: 10px;
            background: #ddd;
            border-radius: 5px;
            margin-top: 10px;
            position: relative;
            overflow: hidden;
        }
        .scale-bar {
            height: 100%;
            background: var(--success);
            width: 50%;
            transition: width 0.5s;
        }
        
        /* Atom Colors */
        .atom-H { background: #bdc3c7; color: #333; } /* Hydrogen - White/Grey */
        .atom-O { background: #e74c3c; } /* Oxygen - Red */
        .atom-N { background: #3498db; } /* Nitrogen - Blue */
        .atom-Cl { background: #2ecc71; } /* Chlorine - Green */
        .atom-Na { background: #9b59b6; } /* Sodium - Purple */

    </style>
</head>
<body>

<div class="container">
    <h1>âš—ï¸ ê°€ìƒ í™”í•™ ì‹¤í—˜ì‹¤: ë°˜ì‘ì‹ê³¼ ì…ì</h1>
    <p class="description">ê³„ìˆ˜ ì¡°ì ˆ ë²„íŠ¼(+/-)ì„ ëˆŒëŸ¬ ì…ì ìˆ˜ë¥¼ ë§ì¶”ê³ , ì§ˆëŸ‰ ë³´ì¡´ ë²•ì¹™ì´ ì„±ë¦½í•˜ëŠ”ì§€ í™•ì¸í•´ë³´ì„¸ìš”!</p>

    <div class="controls">
        <label for="reactionSelect"><strong>ì‹¤í—˜ ì£¼ì œ ì„ íƒ: </strong></label>
        <select id="reactionSelect" onchange="loadReaction()">
            <option value="water">ë¬¼ ìƒì„± ë°˜ì‘ (ìˆ˜ì†Œ + ì‚°ì†Œ â†’ ë¬¼)</option>
            <option value="ammonia">ì•”ëª¨ë‹ˆì•„ ìƒì„± ë°˜ì‘ (ì§ˆì†Œ + ìˆ˜ì†Œ â†’ ì•”ëª¨ë‹ˆì•„)</option>
            <option value="hcl">ì—¼í™”ìˆ˜ì†Œ ìƒì„± ë°˜ì‘ (ìˆ˜ì†Œ + ì—¼ì†Œ â†’ ì—¼í™”ìˆ˜ì†Œ)</option>
        </select>
    </div>

    <div class="lab-bench">
        <div class="reaction-box" id="reactantsBox">
            <h3>ë°˜ì‘ë¬¼ (Reactants)</h3>
            <div id="reactantControls" class="controls-row"></div>
            <div id="reactantParticles" class="particle-container"></div>
        </div>

        <div class="arrow">â</div>

        <div class="reaction-box" id="productsBox">
            <h3>ìƒì„±ë¬¼ (Products)</h3>
            <div id="productControls" class="controls-row"></div>
            <div id="productParticles" class="particle-container"></div>
        </div>
    </div>

    <div class="stats-panel">
        <div class="stat-box">
            <h4>âš›ï¸ ì›ì ê°œìˆ˜ ë¶„ì„</h4>
            <div id="atomAnalysis">ê³„ì‚° ì¤‘...</div>
        </div>
        <div class="stat-box">
            <h4>âš–ï¸ ì§ˆëŸ‰ ë³´ì¡´ ìƒíƒœ</h4>
            <div class="scale-viz">
                <div id="balanceBar" class="scale-bar"></div>
            </div>
            <div id="massText" style="margin-top:5px; font-size:14px;">ì¢Œìš° ì§ˆëŸ‰ ë¹„êµ</div>
        </div>
        <div id="feedback" class="feedback-area unbalanced">
            ì•„ì§ ë°˜ì‘ì‹ì˜ ê· í˜•ì´ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤. ì…ìì˜ ê°œìˆ˜ë¥¼ ì¡°ì ˆí•´ë³´ì„¸ìš”.
        </div>
    </div>
    
    <div style="text-align: center; margin-top: 20px;">
        <button onclick="window.print()" style="padding: 10px 20px; cursor:pointer; background:#333; color:white; border:none; border-radius:5px;">ğŸ–¨ï¸ ì‹¤í—˜ ê²°ê³¼ ë¦¬í¬íŠ¸ ì €ì¥ (PDF)</button>
    </div>
</div>

<script>
    // ì‹¤í—˜ ë°ì´í„° ì •ì˜
    const reactions = {
        water: {
            reactants: [
                { formula: 'H2', atoms: {H:2}, color: 'H', name: 'ìˆ˜ì†Œ' },
                { formula: 'O2', atoms: {O:2}, color: 'O', name: 'ì‚°ì†Œ' }
            ],
            products: [
                { formula: 'H2O', atoms: {H:2, O:1}, color: 'mix', layout: ['H','O','H'], name: 'ë¬¼' }
            ]
        },
        ammonia: {
            reactants: [
                { formula: 'N2', atoms: {N:2}, color: 'N', name: 'ì§ˆì†Œ' },
                { formula: 'H2', atoms: {H:2}, color: 'H', name: 'ìˆ˜ì†Œ' }
            ],
            products: [
                { formula: 'NH3', atoms: {N:1, H:3}, color: 'mix', layout: ['H','N','H','H'], name: 'ì•”ëª¨ë‹ˆì•„' }
            ]
        },
        hcl: {
            reactants: [
                { formula: 'H2', atoms: {H:2}, color: 'H', name: 'ìˆ˜ì†Œ' },
                { formula: 'Cl2', atoms: {Cl:2}, color: 'Cl', name: 'ì—¼ì†Œ' }
            ],
            products: [
                { formula: 'HCl', atoms: {H:1, Cl:1}, color: 'mix', layout: ['H','Cl'], name: 'ì—¼í™”ìˆ˜ì†Œ' }
            ]
        }
    };

    let currentReactionKey = 'water';
    let counts = { r1: 1, r2: 1, p1: 1 }; // Coefficients

    function loadReaction() {
        const select = document.getElementById('reactionSelect');
        currentReactionKey = select.value;
        // Reset counts
        counts = { r1: 1, r2: 1, p1: 1 }; 
        renderInterface();
        updateSimulation();
    }

    function renderInterface() {
        const reaction = reactions[currentReactionKey];
        
        // Render Controls
        document.getElementById('reactantControls').innerHTML = `
            <div class="coefficient-control">
                <span>${reaction.reactants[0].name}(${formatFormula(reaction.reactants[0].formula)}): </span>
                <button class="btn-count" onclick="changeCount('r1', -1)">-</button>
                <span class="coef-display" id="disp_r1">${counts.r1}</span>
                <button class="btn-count" onclick="changeCount('r1', 1)">+</button>
            </div>
            <div class="coefficient-control">
                <span>${reaction.reactants[1].name}(${formatFormula(reaction.reactants[1].formula)}): </span>
                <button class="btn-count" onclick="changeCount('r2', -1)">-</button>
                <span class="coef-display" id="disp_r2">${counts.r2}</span>
                <button class="btn-count" onclick="changeCount('r2', 1)">+</button>
            </div>
        `;

        document.getElementById('productControls').innerHTML = `
            <div class="coefficient-control">
                <span>${reaction.products[0].name}(${formatFormula(reaction.products[0].formula)}): </span>
                <button class="btn-count" onclick="changeCount('p1', -1)">-</button>
                <span class="coef-display" id="disp_p1">${counts.p1}</span>
                <button class="btn-count" onclick="changeCount('p1', 1)">+</button>
            </div>
        `;
    }

    function formatFormula(str) {
        return str.replace(/\d+/g, '<sub>$&</sub>');
    }

    function changeCount(key, delta) {
        if (counts[key] + delta >= 1 && counts[key] + delta <= 10) {
            counts[key] += delta;
            document.getElementById(`disp_${key}`).innerText = counts[key];
            updateSimulation();
        }
    }

    function createMoleculeHTML(data) {
        let html = '<div class="molecule">';
        if (data.color !== 'mix') {
            // Simple diatomic
            const atomCount = Object.values(data.atoms)[0];
            const atomType = Object.keys(data.atoms)[0];
            for(let i=0; i<atomCount; i++) {
                html += `<div class="atom atom-${data.color}">${atomType}</div>`;
            }
        } else {
            // Complex molecule
            data.layout.forEach(atomType => {
                let colorClass = `atom-${atomType}`;
                if(atomType === 'H') colorClass = 'atom-H';
                if(atomType === 'N') colorClass = 'atom-N';
                if(atomType === 'O') colorClass = 'atom-O';
                if(atomType === 'Cl') colorClass = 'atom-Cl';
                html += `<div class="atom ${colorClass}">${atomType}</div>`;
            });
        }
        html += '</div>';
        return html;
    }

    function updateSimulation() {
        const reaction = reactions[currentReactionKey];
        
        // 1. Update Particles Visuals
        const rBox = document.getElementById('reactantParticles');
        const pBox = document.getElementById('productParticles');
        
        rBox.innerHTML = '';
        pBox.innerHTML = '';

        // Add Reactant 1
        for(let i=0; i<counts.r1; i++) rBox.innerHTML += createMoleculeHTML(reaction.reactants[0]);
        // Add Reactant 2
        for(let i=0; i<counts.r2; i++) rBox.innerHTML += createMoleculeHTML(reaction.reactants[1]);
        // Add Product
        for(let i=0; i<counts.p1; i++) pBox.innerHTML += createMoleculeHTML(reaction.products[0]);

        // 2. Calculate Atoms
        let leftAtoms = {};
        let rightAtoms = {};

        // Count Left
        countAtomsInMolecule(reaction.reactants[0].atoms, counts.r1, leftAtoms);
        countAtomsInMolecule(reaction.reactants[1].atoms, counts.r2, leftAtoms);
        // Count Right
        countAtomsInMolecule(reaction.products[0].atoms, counts.p1, rightAtoms);

        // 3. Analysis & Feedback
        let analysisHTML = '<ul style="padding-left:20px; margin:0;">';
        let isBalanced = true;
        let totalLeft = 0;
        let totalRight = 0;

        // Compare all atom types present
        const allTypes = new Set([...Object.keys(leftAtoms), ...Object.keys(rightAtoms)]);
        
        allTypes.forEach(type => {
            const l = leftAtoms[type] || 0;
            const r = rightAtoms[type] || 0;
            totalLeft += l;
            totalRight += r;
            
            let status = l === r ? "âœ…" : "âŒ";
            if (l !== r) isBalanced = false;
            
            analysisHTML += `<li><strong>${type} ì›ì:</strong> ë°˜ì‘ ì „ ${l}ê°œ vs ë°˜ì‘ í›„ ${r}ê°œ ${status}</li>`;
        });
        analysisHTML += '</ul>';
        document.getElementById('atomAnalysis').innerHTML = analysisHTML;

        // 4. Update UI Status
        const feedback = document.getElementById('feedback');
        const balanceBar = document.getElementById('balanceBar');
        const massText = document.getElementById('massText');

        if (isBalanced) {
            feedback.className = 'feedback-area balanced';
            feedback.innerHTML = "ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! í™”í•™ ë°˜ì‘ì‹ì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!<br><small>ì§ˆëŸ‰ ë³´ì¡´ ë²•ì¹™ì´ ì„±ë¦½í•˜ë©°, ì…ì ìˆ˜ê°€ ì˜¬ë°”ë¥´ê²Œ ë§ì¶°ì¡ŒìŠµë‹ˆë‹¤.</small>";
            balanceBar.style.width = "50%"; // Center
            balanceBar.style.backgroundColor = "#2ecc71";
            massText.innerText = "ì§ˆëŸ‰ í‰í˜• (ë°˜ì‘ë¬¼ ì§ˆëŸ‰ = ìƒì„±ë¬¼ ì§ˆëŸ‰)";
        } else {
            feedback.className = 'feedback-area unbalanced';
            feedback.innerHTML = "âš ï¸ ë°˜ì‘ì‹ì˜ ê· í˜•ì´ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤. ì…ì ìˆ˜ë¥¼ ì¡°ì ˆí•˜ì„¸ìš”.";
            
            // Simple visual tilt
            if (totalLeft > totalRight) {
                balanceBar.style.width = "80%";
                balanceBar.style.backgroundColor = "#e74c3c";
                massText.innerText = "ë°˜ì‘ë¬¼(ì™¼ìª½)ì´ ë” ë¬´ê²ìŠµë‹ˆë‹¤.";
            } else {
                balanceBar.style.width = "20%";
                balanceBar.style.backgroundColor = "#e74c3c";
                massText.innerText = "ìƒì„±ë¬¼(ì˜¤ë¥¸ìª½)ì´ ë” ë¬´ê²ìŠµë‹ˆë‹¤.";
            }
        }
    }

    function countAtomsInMolecule(atomDef, count, targetObj) {
        for (const [atom, num] of Object.entries(atomDef)) {
            targetObj[atom] = (targetObj[atom] || 0) + (num * count);
        }
    }

    // Initialize
    loadReaction();
</script>

</body>
</html>