<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì—´ì˜ ì´ë™ê³¼ ëƒ‰ë‚œë°© íš¨ìœ¨ ì‹¤í—˜ì‹¤</title>
    <style>
        body { font-family: 'Nanum Gothic', sans-serif; background-color: #f0f4f8; text-align: center; color: #333; }
        .container { max-width: 900px; margin: 0 auto; padding: 20px; background: white; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; }
        .lab-area { position: relative; width: 600px; height: 400px; margin: 20px auto; border: 4px solid #555; background: #e0e0e0; border-radius: 8px; overflow: hidden; }
        canvas { display: block; }
        .controls { display: flex; justify-content: center; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; border: none; border-radius: 5px; transition: 0.3s; }
        .btn-heater { background-color: #e74c3c; color: white; }
        .btn-ac { background-color: #3498db; color: white; }
        .btn-fan { background-color: #2ecc71; color: white; }
        .btn-insul { background-color: #f1c40f; color: black; }
        .btn-reset { background-color: #95a5a6; color: white; }
        button:hover { opacity: 0.9; transform: scale(1.05); }
        .status-panel { margin-top: 15px; padding: 15px; background: #ecf0f1; border-radius: 8px; text-align: left; }
        .temp-display { font-weight: bold; font-size: 1.2em; }
        .feedback { color: #d35400; font-weight: bold; margin-top: 5px; }
        
        /* Device Icons */
        .device { width: 60px; height: 40px; position: absolute; cursor: grab; z-index: 10; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; border-radius: 4px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        #heater { background: red; top: 350px; left: 50px; }
        #ac { background: blue; top: 350px; left: 150px; }
        
        /* Walls for Insulation Visual */
        .lab-area.insulated { border-color: #f1c40f; border-width: 8px; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ  ëƒ‰ë‚œë°© íš¨ìœ¨ ê°€ìƒ ì‹¤í—˜ì‹¤</h1>
    <p>ê¸°êµ¬ë¥¼ ë“œë˜ê·¸í•˜ì—¬ ìœ„ì¹˜ë¥¼ ì¡ê³  ì „ì›ì„ ì¼œë³´ì„¸ìš”. ê³µê¸°ê°€ ì–´ë–»ê²Œ ì›€ì§ì¼ê¹Œìš”?</p>

    <div class="lab-area" id="room">
        <canvas id="simCanvas" width="600" height="400"></canvas>
        <div id="heater" class="device" draggable="true">íˆí„°</div>
        <div id="ac" class="device" draggable="true">ì—ì–´ì»¨</div>
    </div>

    <div class="controls">
        <button class="btn-heater" onclick="toggleDevice('heater')">ğŸ”¥ íˆí„° ì „ì›</button>
        <button class="btn-ac" onclick="toggleDevice('ac')">â„ï¸ ì—ì–´ì»¨ ì „ì›</button>
        <button class="btn-fan" onclick="toggleFan()">ğŸŒ€ ì„ í’ê¸°(ìˆœí™˜)</button>
        <button class="btn-insul" onclick="toggleInsulation()">ğŸ§± ë‹¨ì—´ì¬ ì‹œê³µ</button>
        <button class="btn-reset" onclick="resetSim()">ğŸ”„ ì´ˆê¸°í™”</button>
    </div>

    <div class="status-panel">
        <div>ğŸŒ¡ï¸ í‰ê·  ì‹¤ë‚´ ì˜¨ë„: <span id="avgTemp" class="temp-display">20Â°C</span></div>
        <div id="feedbackText" class="feedback">ì‹¤í—˜ì„ ì‹œì‘í•´ë³´ì„¸ìš”! ê¸°êµ¬ë¥¼ ì›í•˜ëŠ” ìœ„ì¹˜(ì²œì¥/ë°”ë‹¥)ë¡œ ì˜®ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
    </div>
</div>

<script>
    const canvas = document.getElementById('simCanvas');
    const ctx = canvas.getContext('2d');
    const room = document.getElementById('room');
    
    // State
    let particles = [];
    let heaterOn = false;
    let acOn = false;
    let fanOn = false;
    let insulationOn = false;
    let roomTemp = 20;

    // Devices Position (Relative to room)
    const devices = {
        heater: { el: document.getElementById('heater'), x: 50, y: 350, type: 'heat' },
        ac: { el: document.getElementById('ac'), x: 150, y: 350, type: 'cool' }
    };

    // Drag & Drop Logic
    let draggedItem = null;
    
    document.querySelectorAll('.device').forEach(item => {
        item.addEventListener('dragstart', function(e) {
            draggedItem = this;
            e.dataTransfer.effectAllowed = "move";
        });
    });

    room.addEventListener('dragover', function(e) { e.preventDefault(); });

    room.addEventListener('drop', function(e) {
        e.preventDefault();
        const rect = room.getBoundingClientRect();
        let y = e.clientY - rect.top - 20;
        
        // Snap to Ceiling or Floor
        if (y < 200) y = 10; // Ceiling
        else y = 350; // Floor

        draggedItem.style.top = y + 'px';
        draggedItem.style.left = (e.clientX - rect.left - 30) + 'px';
        
        // Update logic position
        const id = draggedItem.id;
        devices[id].y = y;
        devices[id].x = e.clientX - rect.left - 30;
        
        checkEfficiency();
    });

    // Particle Class
    class Particle {
        constructor(x, y, type) {
            this.x = x;
            this.y = y;
            this.type = type; // 'hot' or 'cold'
            this.vx = (Math.random() - 0.5) * 2;
            this.vy = type === 'hot' ? -1.5 : 1.5; // Hot rises, Cold sinks
            this.life = 100;
        }

        update() {
            // Fan Effect
            if (fanOn) {
                this.vx += (Math.random() - 0.5) * 2;
                this.vy += (Math.random() - 0.5) * 2;
            }

            // Move
            this.x += this.vx;
            this.y += this.vy;

            // Bounce off walls
            if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
            if (this.y < 0 || this.y > canvas.height) {
                this.vy *= -1;
                // Lose energy (temp normalization) faster if hitting floor/ceiling
                this.life -= 2; 
            }

            // Insulation Effect: Particles last longer with insulation
            const decayRate = insulationOn ? 0.5 : 1.5;
            this.life -= decayRate;
        }

        draw() {
            ctx.beginPath();
            ctx.arc(this.x, this.y, 5, 0, Math.PI * 2);
            ctx.fillStyle = this.type === 'hot' 
                ? `rgba(231, 76, 60, ${this.life/100})` 
                : `rgba(52, 152, 219, ${this.life/100})`;
            ctx.fill();
        }
    }

    function spawnParticles() {
        if (heaterOn) {
            // Spawn near heater
            particles.push(new Particle(devices.heater.x + 30, devices.heater.y + 20, 'hot'));
        }
        if (acOn) {
            // Spawn near AC
            particles.push(new Particle(devices.ac.x + 30, devices.ac.y + 20, 'cold'));
        }
    }

    function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        spawnParticles();

        particles.forEach((p, index) => {
            p.update();
            p.draw();
            if (p.life <= 0) particles.splice(index, 1);
        });

        updateTemp();
        requestAnimationFrame(animate);
    }

    function updateTemp() {
        // Simplified Temp Simulation
        let hotCount = particles.filter(p => p.type === 'hot').length;
        let coldCount = particles.filter(p => p.type === 'cold').length;
        
        // Base temp moves towards target based on particles
        let targetTemp = 20 + (hotCount * 0.1) - (coldCount * 0.1);
        
        // Insulation keeps temp stable
        if (!insulationOn && !heaterOn && !acOn) {
             // Return to ambient 20 faster without insulation
             roomTemp += (20 - roomTemp) * 0.05;
        } else {
             roomTemp += (targetTemp - roomTemp) * 0.05;
        }

        document.getElementById('avgTemp').innerText = Math.round(roomTemp) + "Â°C";
    }

    // Controls
    function toggleDevice(device) {
        if (device === 'heater') {
            heaterOn = !heaterOn;
            acOn = false; // Turn off other
        } else {
            acOn = !acOn;
            heaterOn = false;
        }
        checkEfficiency();
    }

    function toggleFan() {
        fanOn = !fanOn;
        checkEfficiency();
    }

    function toggleInsulation() {
        insulationOn = !insulationOn;
        room.classList.toggle('insulated');
        checkEfficiency();
    }

    function resetSim() {
        particles = [];
        heaterOn = false;
        acOn = false;
        fanOn = false;
        insulationOn = false;
        roomTemp = 20;
        room.classList.remove('insulated');
        document.getElementById('feedbackText').innerText = "ì‹¤í—˜ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.";
        
        // Reset positions visually
        devices.heater.el.style.top = '350px';
        devices.ac.el.style.top = '350px';
        devices.heater.y = 350;
        devices.ac.y = 350;
    }

    function checkEfficiency() {
        const feedback = document.getElementById('feedbackText');
        
        if (heaterOn) {
            if (devices.heater.y < 200 && !fanOn) { // Heater on Ceiling
                feedback.innerText = "âš ï¸ ë¹„íš¨ìœ¨ì ì…ë‹ˆë‹¤! ë”°ëœ»í•œ ê³µê¸°ëŠ” ìœ„ë¡œ ì˜¬ë¼ê°€ë¯€ë¡œ, ì²œì¥ì— íˆí„°ê°€ ìˆìœ¼ë©´ ì—´ì´ ì•„ë˜ë¡œ ë‚´ë ¤ì˜¤ì§€ ëª»í•´ìš”.";
            } else if (devices.heater.y >= 200) { // Heater on Floor
                feedback.innerText = "âœ… ì•„ì£¼ ì¢‹ìŠµë‹ˆë‹¤! ë”°ëœ»í•œ ê³µê¸°ê°€ ìœ„ë¡œ ì˜¬ë¼ê°€ë©° ë°© ì „ì²´ë¥¼ ë°ì›Œì¤ë‹ˆë‹¤ (ëŒ€ë¥˜ í˜„ìƒ).";
            } else if (fanOn) {
                feedback.innerText = "ğŸ’¡ ì„ í’ê¸°ê°€ ê³µê¸°ë¥¼ ì„ì–´ì£¼ì–´ ë¹„íš¨ìœ¨ì ì¸ ìœ„ì¹˜ë¥¼ ë³´ì™„í•˜ê³  ìˆìŠµë‹ˆë‹¤!";
            }
        } else if (acOn) {
            if (devices.ac.y >= 200 && !fanOn) { // AC on Floor
                feedback.innerText = "âš ï¸ ë¹„íš¨ìœ¨ì ì…ë‹ˆë‹¤! ì°¬ ê³µê¸°ëŠ” ë¬´ê±°ì›Œ ì•„ë˜ì— ê¹”ë¦¬ë¯€ë¡œ, ë°”ë‹¥ì— ì—ì–´ì»¨ì´ ìˆìœ¼ë©´ ë°© ìœ„ìª½ì€ ì—¬ì „íˆ ë”ì›Œìš”.";
            } else if (devices.ac.y < 200) { // AC on Ceiling
                feedback.innerText = "âœ… í›Œë¥­í•©ë‹ˆë‹¤! ì°¬ ê³µê¸°ê°€ ì•„ë˜ë¡œ ë‚´ë ¤ì˜¤ë©° ë°© ì „ì²´ë¥¼ ì‹œì›í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤.";
            }
        }
        
        if (insulationOn) {
             feedback.innerText += " (ë‹¨ì—´ì¬ê°€ ì—´ ì†ì‹¤ì„ ë§‰ì•„ íš¨ìœ¨ì´ ë” ë†’ì•„ì¡ŒìŠµë‹ˆë‹¤.)";
        }
    }

    // Start
    animate();

</script>

</body>
</html>