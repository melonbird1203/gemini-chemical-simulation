<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ìƒ ì‹¤í—˜ì‹¤: ì—íƒ„ì˜¬ê³¼ ë¬¼ì˜ ë¶„ë¦¬</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #f5f6fa;
            --glass-border: 2px solid #a4b0be;
            --liquid-mix: #eccc68; /* í˜¼í•©ë¬¼ ìƒ‰ */
            --liquid-eth: #dfe4ea; /* ì—íƒ„ì˜¬ ìƒ‰ (íˆ¬ëª…ì— ê°€ê¹Œì›€) */
            --liquid-water: #a4b0be; /* ë¬¼ ìƒ‰ */
            --fire-color: #ff6b6b;
        }

        body {
            font-family: 'Pretendard', 'Malgun Gothic', sans-serif;
            background-color: #2f3640;
            color: #333;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            display: grid;
            grid-template-columns: 250px 1fr 300px;
            gap: 20px;
            background-color: #fff;
            width: 1200px;
            height: 700px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        /* 1. ì™¼ìª½ ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .panel-left {
            background-color: var(--secondary-color);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            border-right: 1px solid #ddd;
        }

        h2 { font-size: 1.2rem; margin-top: 0; color: #2c3e50; }
        
        .control-group {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        label { display: block; margin-bottom: 8px; font-weight: bold; font-size: 0.9rem; }
        
        input[type="range"] { width: 100%; cursor: pointer; }
        
        button {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
        }

        .btn-start { background-color: var(--primary-color); color: white; }
        .btn-start:hover { background-color: #357abd; }
        
        .btn-swap { background-color: #e67e22; color: white; margin-top: 5px; }
        .btn-swap:disabled { background-color: #ccc; cursor: not-allowed; }

        .btn-reset { background-color: #7f8c8d; color: white; margin-top: auto; }

        .status-box {
            font-size: 0.85rem;
            line-height: 1.4;
            color: #555;
        }

        /* 2. ì¤‘ì•™ ì‹¤í—˜ ì‹œê°í™” (Apparatus) */
        .stage {
            position: relative;
            background-color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* ì‹¤í—˜ ê¸°êµ¬ ë°°ì¹˜ */
        .apparatus {
            position: relative;
            width: 500px;
            height: 400px;
        }

        /* ê°€ì—´ í”Œë¼ìŠ¤í¬ */
        .flask-source {
            position: absolute;
            bottom: 50px;
            left: 50px;
            width: 100px;
            height: 100px;
            border: var(--glass-border);
            border-radius: 50%;
            overflow: hidden;
            z-index: 2;
        }
        
        .flask-neck {
            position: absolute;
            bottom: 145px;
            left: 90px;
            width: 20px;
            height: 80px;
            border-left: var(--glass-border);
            border-right: var(--glass-border);
            background: rgba(255,255,255,0.5);
            z-index: 1;
        }

        /* ì•¡ì²´ (ì†ŒìŠ¤) */
        .liquid-source {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 50%; /* ì´ˆê¸° ë†’ì´ */
            background-color: var(--liquid-mix);
            transition: height 0.5s;
        }
        
        /* ê¸°í¬ ì• ë‹ˆë©”ì´ì…˜ */
        .bubble {
            position: absolute;
            background: rgba(255,255,255,0.6);
            border-radius: 50%;
            animation: rise 2s infinite;
            display: none;
        }

        @keyframes rise {
            0% { bottom: 0; transform: scale(1); opacity: 0; }
            50% { opacity: 1; }
            100% { bottom: 100%; transform: scale(1.5); opacity: 0; }
        }

        /* ë¶ˆê½ƒ */
        .flame {
            position: absolute;
            bottom: 10px;
            left: 85px;
            width: 30px;
            height: 30px;
            background: radial-gradient(circle, #f1c40f 20%, #e74c3c 80%);
            border-radius: 50% 50% 20% 20%;
            box-shadow: 0 0 10px #e67e22;
            transform-origin: bottom center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .flame.active { opacity: 1; animation: flicker 0.1s infinite alternate; }

        @keyframes flicker { from { transform: scale(1); } to { transform: scale(1.1); } }

        /* ëƒ‰ê°ê¸° (Liebig Condenser) - ë‹¨ìˆœí™” */
        .condenser {
            position: absolute;
            top: 180px;
            left: 110px;
            width: 200px;
            height: 30px;
            border: var(--glass-border);
            border-radius: 5px;
            background: rgba(200, 230, 255, 0.2);
            transform: rotate(15deg);
            z-index: 1;
        }

        .condenser-inner {
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 8px;
            background: transparent;
            border-top: 1px solid #aaa;
            border-bottom: 1px solid #aaa;
            transform: translateY(-50%);
        }

        .water-flow {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: repeating-linear-gradient(45deg, rgba(74, 144, 226, 0.1), rgba(74, 144, 226, 0.1) 10px, rgba(74, 144, 226, 0.2) 10px, rgba(74, 144, 226, 0.2) 20px);
            opacity: 0;
            transition: opacity 0.5s;
        }
        .water-flow.active { opacity: 1; animation: flow 2s linear infinite; }
        @keyframes flow { from { background-position: 0 0; } to { background-position: 50px 0; } }

        /* ë°›ëŠ” í”Œë¼ìŠ¤í¬ (ì‚¼ê°) */
        .flask-dest {
            position: absolute;
            bottom: 30px;
            right: 80px;
            width: 80px;
            height: 100px;
            clip-path: polygon(20% 0, 80% 0, 100% 100%, 0% 100%);
            border: var(--glass-border); /* clip-path ë•Œë¬¸ì— borderê°€ ì˜ë ¤ì„œ backgroundë¡œ ì²˜ë¦¬ */
            background: rgba(255,255,255,0.4);
            border-bottom: 2px solid #a4b0be;
        }

        .liquid-dest {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 0%;
            background-color: var(--liquid-eth);
            transition: height 0.5s;
        }

        .drop {
            position: absolute;
            right: 115px;
            top: 260px;
            width: 8px;
            height: 8px;
            background: #a4b0be;
            border-radius: 50%;
            display: none;
        }
        .drop.falling { display: block; animation: dropFall 1s linear infinite; }

        @keyframes dropFall { 0% { top: 260px; opacity: 1; } 100% { top: 370px; opacity: 0; } }

        /* ì¦ê¸° ì• ë‹ˆë©”ì´ì…˜ */
        .vapor {
            position: absolute;
            right: 80px;
            top: 240px;
            font-size: 20px;
            color: #aaa;
            opacity: 0;
        }
        .vapor.active { animation: vaporRise 1.5s infinite; opacity: 0.8; }
        @keyframes vaporRise { 0% { transform: translateY(0); opacity: 0.8; } 100% { transform: translateY(-20px); opacity: 0; } }

        /* 3. ì˜¤ë¥¸ìª½ ë°ì´í„° íŒ¨ë„ */
        .panel-right {
            background-color: var(--secondary-color);
            padding: 20px;
            border-left: 1px solid #ddd;
            display: flex;
            flex-direction: column;
        }

        .data-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .temp-display {
            font-size: 2rem;
            font-weight: bold;
            color: #e74c3c;
            text-align: center;
        }

        /* ê·¸ë˜í”„ ìº”ë²„ìŠ¤ */
        #tempChart {
            width: 100%;
            height: 150px;
            border-left: 2px solid #333;
            border-bottom: 2px solid #333;
            background: #fff;
        }
        
        .result-box {
            display: none;
            background: #dff9fb;
            border: 1px solid #c7ecee;
            padding: 10px;
            border-radius: 5px;
            font-size: 0.9rem;
        }

        /* íˆ´íŒ/ë¼ë²¨ */
        .label-tag {
            position: absolute;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            pointer-events: none;
        }

    </style>
</head>
<body>

<div class="container">
    <div class="panel-left">
        <h2>ğŸ§ª ì‹¤í—˜ ì œì–´</h2>
        
        <div class="control-group">
            <label>1. ëƒ‰ê°ìˆ˜ ê³µê¸‰</label>
            <label class="switch">
                <input type="checkbox" id="check-cooling"> 
                <span style="font-weight:normal">ë°¸ë¸Œ ì—´ê¸° (ON/OFF)</span>
            </label>
        </div>

        <div class="control-group">
            <label>2. ê°€ì—´ ì„¸ê¸° (ì•Œì½”ì˜¬ë¨í”„)</label>
            <input type="range" id="range-heat" min="0" max="100" value="0">
            <div style="font-size: 0.8rem; text-align: center; color:#666;" id="heat-val">êº¼ì§</div>
        </div>

        <div class="control-group">
            <label>3. ë°›ëŠ” ìš©ê¸° (Flask)</label>
            <div id="current-flask-info" style="margin-bottom:5px; font-size:0.9rem; color:blue;">í˜„ì¬: í”Œë¼ìŠ¤í¬ A</div>
            <button class="btn-swap" id="btn-swap" disabled>ìš©ê¸° êµì²´í•˜ê¸°!</button>
        </div>

        <div class="status-box" id="status-msg">
            ì‹¤í—˜ ì¤€ë¹„ ì™„ë£Œ.<br>ëƒ‰ê°ìˆ˜ë¥¼ ì¼œê³  ê°€ì—´ì„ ì‹œì‘í•˜ì„¸ìš”.
        </div>

        <button class="btn-reset" onclick="location.reload()">ì‹¤í—˜ ì´ˆê¸°í™”</button>
    </div>

    <div class="stage">
        <div class="apparatus">
            <div class="label-tag" style="bottom: 150px; left: 50px;">í˜¼í•©ë¬¼</div>
            <div class="label-tag" style="top: 150px; left: 160px;">ëƒ‰ê°ê¸°</div>
            <div class="label-tag" style="bottom: 130px; right: 80px;">ì¦ë¥˜ì•¡</div>
            <div class="label-tag" style="top: 120px; left: 70px;">ì˜¨ë„ê³„</div>

            <div class="flask-neck"></div>
            <div class="flask-source">
                <div class="liquid-source" id="liquid-source">
                    <div class="bubble" style="left:20%; width:10px; height:10px; animation-delay:0s;"></div>
                    <div class="bubble" style="left:50%; width:14px; height:14px; animation-delay:0.5s;"></div>
                    <div class="bubble" style="left:70%; width:8px; height:8px; animation-delay:1s;"></div>
                </div>
            </div>
            
            <div class="flame" id="flame"></div>

            <div style="position:absolute; top:80px; left:95px; width:6px; height:150px; background:#eee; border:1px solid #aaa; z-index:5;">
                <div id="thermometer-bar" style="position:absolute; bottom:0; width:100%; height:20%; background:red; transition:height 0.2s;"></div>
            </div>

            <div class="condenser">
                <div class="water-flow" id="water-flow"></div>
                <div class="condenser-inner"></div>
            </div>

            <div class="vapor" id="vapor-cloud">â˜ï¸</div>

            <div class="drop" id="drop"></div>

            <div class="flask-dest">
                <div class="liquid-dest" id="liquid-dest"></div>
            </div>
        </div>
    </div>

    <div class="panel-right">
        <h2>ğŸ“Š ê´€ì°° ë°ì´í„°</h2>
        
        <div class="data-card">
            <label>í˜„ì¬ ì˜¨ë„</label>
            <div class="temp-display" id="temp-display">25.0Â°C</div>
        </div>

        <div class="data-card">
            <label>ì˜¨ë„ ë³€í™” ê·¸ë˜í”„</label>
            <svg id="tempChart" viewBox="0 0 200 100" preserveAspectRatio="none">
                <polyline id="chart-line" fill="none" stroke="red" stroke-width="2" points="0,100" />
            </svg>
            <div style="display:flex; justify-content:space-between; font-size:0.7rem; color:#666;">
                <span>0ë¶„</span>
                <span>ì‹œê°„ â</span>
            </div>
        </div>

        <div class="data-card">
            <label>ìˆ˜ì§‘ëœ ì•¡ì²´ (í˜„ì¬ ìš©ê¸°)</label>
            <div id="collect-info">0 mL</div>
            <progress id="collect-bar" value="0" max="50" style="width:100%"></progress>
        </div>

        <div class="result-box" id="result-box">
            </div>
    </div>
</div>

<script>
    // --- 1. ì‹¤í—˜ ë³€ìˆ˜ ë° ìƒíƒœ ---
    const STATE = {
        temp: 25.0,        // í˜„ì¬ ì˜¨ë„
        heatPower: 0,      // ê°€ì—´ ì„¸ê¸° (0~100)
        coolingOn: false,  // ëƒ‰ê°ìˆ˜ ì—¬ë¶€
        
        // ë¬¼ì§ˆ ì–‘ (ê°€ìƒ ë‹¨ìœ„ mL)
        sourceEthanol: 50,
        sourceWater: 50,
        
        // ìˆ˜ì§‘ëœ ì–‘
        flask1: { ethanol: 0, water: 0 },
        flask2: { ethanol: 0, water: 0 },
        
        currentFlask: 1,   // í˜„ì¬ ë°›ëŠ” í”Œë¼ìŠ¤í¬ (1 or 2)
        time: 0,           // ì‹¤í—˜ ì‹œê°„
        isBoiling: false
    };

    // ìƒìˆ˜
    const BP_ETHANOL = 78.3; // ì—íƒ„ì˜¬ ë“ëŠ”ì 
    const BP_WATER = 100.0;  // ë¬¼ ë“ëŠ”ì 
    const ROOM_TEMP = 25.0;

    // --- 2. DOM ìš”ì†Œ ì—°ê²° ---
    const els = {
        heatRange: document.getElementById('range-heat'),
        heatVal: document.getElementById('heat-val'),
        checkCooling: document.getElementById('check-cooling'),
        btnSwap: document.getElementById('btn-swap'),
        statusMsg: document.getElementById('status-msg'),
        
        tempDisplay: document.getElementById('temp-display'),
        thermoBar: document.getElementById('thermometer-bar'),
        chartLine: document.getElementById('chart-line'),
        
        flame: document.getElementById('flame'),
        bubbles: document.querySelectorAll('.bubble'),
        waterFlow: document.getElementById('water-flow'),
        vaporCloud: document.getElementById('vapor-cloud'),
        drop: document.getElementById('drop'),
        
        liqSource: document.getElementById('liquid-source'),
        liqDest: document.getElementById('liquid-dest'),
        collectInfo: document.getElementById('collect-info'),
        collectBar: document.getElementById('collect-bar'),
        
        currentFlaskInfo: document.getElementById('current-flask-info'),
        resultBox: document.getElementById('result-box')
    };

    // ì°¨íŠ¸ ë°ì´í„° í¬ì¸íŠ¸
    let chartPoints = [];
    const MAX_CHART_POINTS = 200;

    // --- 3. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
    els.heatRange.addEventListener('input', (e) => {
        STATE.heatPower = parseInt(e.target.value);
        els.heatVal.innerText = STATE.heatPower === 0 ? "êº¼ì§" : `ì„¸ê¸°: ${STATE.heatPower}%`;
        
        // ë¶ˆê½ƒ ì‹œê°í™”
        els.flame.style.opacity = STATE.heatPower / 100;
        els.flame.classList.toggle('active', STATE.heatPower > 0);
        
        // ê±°í’ˆ ì‹œê°í™” (ê°€ì—´ ì¤‘ì¼ ë•Œë§Œ)
        els.bubbles.forEach(b => b.style.display = STATE.heatPower > 20 ? 'block' : 'none');
    });

    els.checkCooling.addEventListener('change', (e) => {
        STATE.coolingOn = e.target.checked;
        els.waterFlow.classList.toggle('active', STATE.coolingOn);
        updateStatus();
    });

    els.btnSwap.addEventListener('click', () => {
        if (STATE.currentFlask === 1) {
            STATE.currentFlask = 2;
            els.currentFlaskInfo.innerText = "í˜„ì¬: í”Œë¼ìŠ¤í¬ B (êµì²´ë¨)";
            els.currentFlaskInfo.style.color = "#e67e22";
            els.btnSwap.disabled = true; // í•œ ë²ˆë§Œ êµì²´ ê°€ëŠ¥
            els.liqDest.style.height = '0%'; // ì‹œê°ì  ë¦¬ì…‹
            updateStatus("í”Œë¼ìŠ¤í¬ë¥¼ êµì²´í–ˆìŠµë‹ˆë‹¤! ì´ì œ ë¬¼ì´ ë‚˜ì˜¬ ì°¨ë¡€ì¸ê°€ìš”?");
        }
    });

    // --- 4. ì‹œë®¬ë ˆì´ì…˜ ë£¨í”„ (í•µì‹¬ ë¡œì§) ---
    setInterval(gameLoop, 100); // 0.1ì´ˆë§ˆë‹¤ ê°±ì‹ 

    function gameLoop() {
        // A. ì˜¨ë„ ê³„ì‚° ë¡œì§
        let targetTemp = ROOM_TEMP;
        if (STATE.heatPower > 0) {
            // ê°€ì—´ ì‹œ ëª©í‘œ ì˜¨ë„ (ìµœëŒ€ 120ë„ê¹Œì§€)
            targetTemp = 120; 
        }

        // ì˜¨ë„ ìƒìŠ¹/í•˜ê°• ì†ë„
        let changeRate = (STATE.heatPower / 500) - 0.05; // ê°€ì—´ - ìì—°ëƒ‰ê°
        if (changeRate < -0.1) changeRate = -0.1; // ëƒ‰ê° ì†ë„ ì œí•œ

        // ë“ëŠ”ì  êµ¬ê°„(Plateau) êµ¬í˜„: ìƒë³€í™” ì ì—´ ì‹œë®¬ë ˆì´ì…˜
        // ì—íƒ„ì˜¬ì´ ë‚¨ì•„ìˆê³ , ì˜¨ë„ê°€ 78ë„ ê·¼ì²˜ì¼ ë•Œ ì˜¨ë„ê°€ ì˜ ì•ˆ ì˜¤ë¦„
        if (STATE.sourceEthanol > 1 && STATE.temp > 76 && STATE.temp < 80) {
            changeRate *= 0.1; // ì˜¨ë„ ìƒìŠ¹ ì–µì œ
        }
        // ë¬¼ë§Œ ë‚¨ì•˜ê³ , ì˜¨ë„ê°€ 100ë„ ê·¼ì²˜ì¼ ë•Œ
        if (STATE.sourceEthanol <= 1 && STATE.sourceWater > 1 && STATE.temp > 98 && STATE.temp < 102) {
            changeRate *= 0.1;
        }

        STATE.temp += changeRate;
        if (STATE.temp < ROOM_TEMP) STATE.temp = ROOM_TEMP; // ì‹¤ì˜¨ ë°‘ìœ¼ë¡œ ì•ˆ ë–¨ì–´ì§

        // B. ì¦ë°œ ë° ì‘ì¶• ë¡œì§
        let evaporationRate = 0;
        let vaporType = 'none'; // 'ethanol' or 'water' or 'mix'

        // ì—íƒ„ì˜¬ ë“ìŒ (78ë„ ì´ìƒ)
        if (STATE.temp >= BP_ETHANOL && STATE.sourceEthanol > 0) {
            evaporationRate = (STATE.temp - 70) * 0.05; // ì˜¨ë„ê°€ ë†’ì„ìˆ˜ë¡ ì¦ë°œ ë¹ ë¦„
            vaporType = 'ethanol';
        }
        
        // ë¬¼ ë“ìŒ (100ë„ ê·¼ì²˜) - ì—íƒ„ì˜¬ì´ ê±°ì˜ ë‹¤ ì—†ì–´ì§„ í›„ í™œë°œ
        if (STATE.temp >= 95 && STATE.sourceWater > 0) {
            let waterRate = (STATE.temp - 90) * 0.05;
            evaporationRate += waterRate;
            vaporType = (vaporType === 'ethanol') ? 'mix' : 'water';
        }

        // ê³¼ë„í•œ ê°€ì—´ ì‹œ ë¶ˆìˆœë¬¼ ì„ì„ ë¡œì§ (85ë„ ë„˜ìœ¼ë©´ ë¬¼ë„ ì¡°ê¸ˆì”© ê°™ì´ ì¦ë°œ)
        if (STATE.temp > 85 && STATE.sourceWater > 0 && STATE.sourceEthanol > 0) {
             vaporType = 'mix';
        }

        // ì‹¤ì œ ì•¡ì²´ ê°ì†Œ ë° ìˆ˜ì§‘ ì²˜ë¦¬
        if (evaporationRate > 0) {
            // ì†ŒìŠ¤ ê°ì†Œ
            if (vaporType === 'ethanol' || vaporType === 'mix') {
                let amount = Math.min(STATE.sourceEthanol, evaporationRate * 0.1);
                STATE.sourceEthanol -= amount;
            }
            if (vaporType === 'water' || vaporType === 'mix') {
                let amount = Math.min(STATE.sourceWater, evaporationRate * 0.1);
                // 100ë„ ì´í•˜ì—ì„œëŠ” ë¬¼ ì¦ë°œëŸ‰ ì ìŒ
                if (STATE.temp < 95) amount *= 0.1; 
                STATE.sourceWater -= amount;
            }

            // ì‘ì¶• (ëƒ‰ê°ìˆ˜ê°€ ìˆì–´ì•¼ë§Œ ìˆ˜ì§‘ë¨)
            if (STATE.coolingOn) {
                // ìˆ˜ì§‘
                let targetCollection = (STATE.currentFlask === 1) ? STATE.flask1 : STATE.flask2;
                
                // ìˆœë„ ê²°ì • ë¡œì§ (ë‹¨ìˆœí™”)
                if (STATE.temp < 82) {
                    targetCollection.ethanol += evaporationRate * 0.1;
                } else if (STATE.temp > 95) {
                    targetCollection.water += evaporationRate * 0.1;
                } else {
                    // ì„ì„ êµ¬ê°„
                    targetCollection.ethanol += evaporationRate * 0.05;
                    targetCollection.water += evaporationRate * 0.05;
                }

                // ì‹œê° íš¨ê³¼: ë¬¼ë°©ìš¸ ë–¨ì–´ì§
                els.drop.classList.add('falling');
                els.vaporCloud.classList.remove('active');
            } else {
                // ëƒ‰ê°ìˆ˜ ì—†ìŒ -> ì¦ê¸° ì†ì‹¤
                els.drop.classList.remove('falling');
                els.vaporCloud.classList.add('active'); // ì¦ê¸° ë‚ ì•„ê° ì• ë‹ˆë©”ì´ì…˜
                updateStatus("âš ï¸ ê²½ê³ : ëƒ‰ê°ìˆ˜ê°€ ì—†ì–´ ì¦ê¸°ê°€ ë‚ ì•„ê°€ê³  ìˆìŠµë‹ˆë‹¤!");
            }
        } else {
            els.drop.classList.remove('falling');
            els.vaporCloud.classList.remove('active');
        }

        // C. UI ì—…ë°ì´íŠ¸
        updateUI();
    }

    function updateUI() {
        // 1. ì˜¨ë„ê³„
        els.tempDisplay.innerText = STATE.temp.toFixed(1) + "Â°C";
        // ë†’ì´ ë§¤í•‘ (20ë„=0%, 120ë„=100%)
        let thermoHeight = Math.min(100, Math.max(0, (STATE.temp - 20))); 
        els.thermoBar.style.height = thermoHeight + "%";

        // 2. ê·¸ë˜í”„ ì—…ë°ì´íŠ¸
        STATE.time++;
        if (STATE.time % 5 === 0) { // 0.5ì´ˆë§ˆë‹¤ ì  ì°ê¸°
            // ê·¸ë˜í”„ Yì¢Œí‘œ: 100 - (ì˜¨ë„ë¹„ìœ¨)
            let y = 100 - ((STATE.temp - 20) * 0.8); // ìŠ¤ì¼€ì¼ ì¡°ì •
            if (y < 0) y = 0;
            
            // Xì¢Œí‘œ ìŠ¤ì¼€ì¼ë§
            let x = (chartPoints.length / MAX_CHART_POINTS) * 200;
            
            chartPoints.push(`${x},${y}`);
            if (chartPoints.length > MAX_CHART_POINTS) {
                // ê·¸ë˜í”„ ê½‰ ì°¨ë©´ ë¦¬ì…‹ í˜¹ì€ ìŠ¤í¬ë¡¤ (ì—¬ê¸°ì„  ë‹¨ìˆœí™” ìœ„í•´ ì •ì§€ or ì‹œí”„íŠ¸)
                // ê°„ë‹¨íˆ ì•ë¶€ë¶„ ì‚­ì œ
                chartPoints = []; // ë£¨í”„ë°± í•˜ê±°ë‚˜ ë©ˆì¶¤. êµìœ¡ìš©ì´ë¼ ë©ˆì¶¤ ì¶”ì²œ
            } else {
                els.chartLine.setAttribute('points', chartPoints.join(' '));
            }
        }

        // 3. ì•¡ì²´ ë†’ì´ ì‹œê°í™”
        let totalSourceStart = 100; // ì´ˆê¸° 100
        let currentSource = STATE.sourceEthanol + STATE.sourceWater;
        els.liqSource.style.height = (currentSource / totalSourceStart * 50) + "%"; // 50%ê°€ max height

        let currentCollectObj = (STATE.currentFlask === 1) ? STATE.flask1 : STATE.flask2;
        let currentCollectVol = currentCollectObj.ethanol + currentCollectObj.water;
        
        // ìˆ˜ì§‘ í”Œë¼ìŠ¤í¬ ë†’ì´ (ìµœëŒ€ 50ml ê°€ì •)
        els.liqDest.style.height = Math.min(100, (currentCollectVol / 50 * 100)) + "%";
        
        els.collectInfo.innerText = `${currentCollectVol.toFixed(1)} mL`;
        els.collectBar.value = currentCollectVol;

        // 4. ë²„íŠ¼ í™œì„±í™”
        // ì˜¨ë„ê°€ 80ë„ë¥¼ ë„˜ê³ , ì•„ì§ êµì²´ ì•ˆí–ˆìœ¼ë©´ êµì²´ ë²„íŠ¼ í™œì„±í™”
        if (STATE.temp > 82 && STATE.currentFlask === 1) {
            els.btnSwap.disabled = false;
            els.btnSwap.style.animation = "flicker 1s infinite"; // ê°•ì¡°
            updateStatus("ğŸ’¡ ì§€ê¸ˆì…ë‹ˆë‹¤! ìš©ê¸°ë¥¼ êµì²´í•˜ì„¸ìš”!");
        } else {
             els.btnSwap.style.animation = "";
        }

        // 5. ê²°ê³¼ ë¶„ì„ (ì‹¤í—˜ ì¢…ë£Œ ê°ì§€)
        if (currentSource < 5 && els.resultBox.style.display === "none") {
            showResult();
        }
    }

    function updateStatus(msg) {
        if (msg) els.statusMsg.innerText = msg;
    }

    function showResult() {
        els.resultBox.style.display = "block";
        
        // í”Œë¼ìŠ¤í¬ 1 ë¶„ì„
        let f1_total = STATE.flask1.ethanol + STATE.flask1.water;
        let f1_purity = f1_total > 0 ? (STATE.flask1.ethanol / f1_total * 100).toFixed(1) : 0;
        
        // í”Œë¼ìŠ¤í¬ 2 ë¶„ì„
        let f2_total = STATE.flask2.ethanol + STATE.flask2.water;
        let f2_water_purity = f2_total > 0 ? (STATE.flask2.water / f2_total * 100).toFixed(1) : 0;

        let feedback = "";
        if (f1_purity > 90) feedback = "ë§¤ìš° í›Œë¥­í•´ìš”! ìˆœìˆ˜í•œ ì—íƒ„ì˜¬ì„ ì˜ ë¶„ë¦¬í–ˆìŠµë‹ˆë‹¤.";
        else if (f1_purity > 70) feedback = "ì˜í–ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ê°€ì—´ì´ ë„ˆë¬´ ë¹ ë¥´ê±°ë‚˜ êµì²´ íƒ€ì´ë°ì´ ëŠ¦ì–´ ë¬¼ì´ ì¡°ê¸ˆ ì„ì˜€ë„¤ìš”.";
        else feedback = "ì¬ì‹œë„ í•´ë³´ì„¸ìš”. ì²œì²œíˆ ê°€ì—´í•˜ê³  80ë„ ë¶€ê·¼ì—ì„œ ìš©ê¸°ë¥¼ êµì²´í•´ì•¼ í•©ë‹ˆë‹¤.";

        els.resultBox.innerHTML = `
            <strong>ğŸ§ª ì‹¤í—˜ ê²°ê³¼ ë¶„ì„</strong><br>
            - 1ì°¨ ìˆ˜ì§‘ì•¡: ì—íƒ„ì˜¬ ë†ë„ <span style="color:red">${f1_purity}%</span><br>
            - 2ì°¨ ìˆ˜ì§‘ì•¡: ë¬¼ í•¨ëŸ‰ ${f2_water_purity}%<br>
            <br>
            <em>${feedback}</em>
        `;
    }
</script>

</body>
</html>