<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê°€ìƒì‹¤í—˜: ê¸°ì²´ì˜ ì••ë ¥ê³¼ ì…ì ìš´ë™</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; background-color: #f0f4f8; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        h1 { color: #2c3e50; }
        .container { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; }
        .lab-screen { position: relative; width: 400px; height: 500px; background: #fff; border: 4px solid #34495e; border-radius: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        canvas { display: block; }
        .controls { width: 300px; background: #ffffff; padding: 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .control-group { margin-bottom: 20px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; color: #555; }
        input[type=range] { width: 100%; }
        .btn-group { display: flex; gap: 10px; margin-bottom: 20px; }
        button { flex: 1; padding: 10px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-start { background-color: #27ae60; color: white; }
        .btn-stop { background-color: #e74c3c; color: white; }
        .btn-reset { background-color: #95a5a6; color: white; }
        button:hover { opacity: 0.9; transform: scale(1.02); }
        
        .monitor { margin-top: 20px; padding: 15px; background: #ecf0f1; border-radius: 8px; }
        .data-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 1.1em; }
        .value { font-weight: bold; color: #2980b9; }
        
        /* ì„¼ì„œ ì‹œê°í™” */
        .sensor-bar { height: 20px; background: #bdc3c7; border-radius: 10px; overflow: hidden; margin-top: 5px; }
        .sensor-fill { height: 100%; background: linear-gradient(90deg, #3498db, #e74c3c); width: 0%; transition: width 0.1s; }
        
        .tooltip { font-size: 0.9em; color: #7f8c8d; margin-top: 5px; }
    </style>
</head>
<body>

    <h1>ğŸ”¬ ê¸°ì²´ ì••ë ¥ ê°€ìƒ ì‹¤í—˜ì‹¤</h1>

    <div class="container">
        <div class="lab-screen" id="labScreen">
            <canvas id="simCanvas" width="400" height="500"></canvas>
            <div style="position: absolute; bottom: 10px; left: 0; width: 100%; text-align: center; color: #aaa; font-size: 0.8em;">
                ê°€ìƒ í˜íŠ¸ë³‘ ë‚´ë¶€
            </div>
        </div>

        <div class="controls">
            <div class="btn-group">
                <button class="btn-start" onclick="startSim()">â–¶ ì‹¤í—˜ ì‹œì‘</button>
                <button class="btn-stop" onclick="stopSim()">â¸ ì¼ì‹œ ì •ì§€</button>
                <button class="btn-reset" onclick="resetSim()">ğŸ”„ ì´ˆê¸°í™”</button>
            </div>

            <div class="control-group">
                <label>ğŸ«˜ ì½©(ì…ì) ê°œìˆ˜: <span id="countVal">10</span>ê°œ</label>
                <input type="range" id="particleCount" min="5" max="30" step="5" value="10" oninput="updateSettings()">
                <div class="tooltip">ì…ìì˜ ìˆ˜ê°€ ë§ìœ¼ë©´ ì–´ë–»ê²Œ ë ê¹Œìš”?</div>
            </div>

            <div class="control-group">
                <label>ğŸ‘‹ í”ë“¤ê¸° ê°•ë„ (ì˜¨ë„): <span id="speedVal">ë³´í†µ</span></label>
                <input type="range" id="shakeSpeed" min="1" max="5" step="1" value="3" oninput="updateSettings()">
                <div class="tooltip">ì„¸ê²Œ í”ë“¤ìˆ˜ë¡ ì…ìê°€ ë¹¨ë¼ì ¸ìš”!</div>
            </div>

            <hr>

            <div class="monitor">
                <h3>ğŸ“Š ì‹¤ì‹œê°„ ê²°ê³¼</h3>
                <div class="data-row">
                    <span>ì´ ì¶©ëŒ íšŸìˆ˜:</span>
                    <span class="value" id="collisionCount">0</span>
                </div>
                <div class="data-row">
                    <span>í˜„ì¬ ì••ë ¥(í˜):</span>
                    <span class="value" id="pressureValue">0</span> kPa
                </div>
                <label>ì••ë ¥ ê²Œì´ì§€</label>
                <div class="sensor-bar">
                    <div class="sensor-fill" id="pressureBar"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        
        let particles = [];
        let animationId;
        let isRunning = false;
        let totalCollisions = 0;
        let pressure = 0; // ìµœê·¼ ì¶©ëŒ ê¸°ë°˜ ì••ë ¥ ê³„ì‚°
        let collisionBuffer = []; // ìµœê·¼ 1ì´ˆê°„ ì¶©ëŒ ê¸°ë¡

        // ì„¤ì • ë³€ìˆ˜
        let pCount = 10;
        let speedMultiplier = 3; 

        class Particle {
            constructor() {
                this.r = 10; // ì½© í¬ê¸°
                this.x = Math.random() * (canvas.width - 40) + 20;
                this.y = Math.random() * (canvas.height - 40) + 20;
                // ì†ë„ëŠ” í”ë“¤ê¸° ê°•ë„ì— ë¹„ë¡€
                let speedBase = speedMultiplier * 1.5; 
                this.vx = (Math.random() - 0.5) * speedBase * 2;
                this.vy = (Math.random() - 0.5) * speedBase * 2;
                this.color = `hsl(${Math.random() * 60 + 20}, 70%, 50%)`; // ì½© ìƒ‰ìƒ (ê°ˆìƒ‰~ë…¸ë€ìƒ‰ ê³„ì—´)
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.strokeStyle = "#3e2723";
                ctx.stroke();
                ctx.closePath();
                
                // ê´‘íƒ íš¨ê³¼
                ctx.beginPath();
                ctx.arc(this.x - 3, this.y - 3, 3, 0, Math.PI * 2);
                ctx.fillStyle = "rgba(255,255,255,0.4)";
                ctx.fill();
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;

                // ë²½ ì¶©ëŒ ê°ì§€ (ì••ë ¥ ë°œìƒ ì›ì¸)
                if (this.x - this.r < 0 || this.x + this.r > canvas.width) {
                    this.vx = -this.vx;
                    this.x = Math.max(this.r, Math.min(this.x, canvas.width - this.r));
                    registerCollision();
                    triggerWallEffect(this.x < canvas.width/2 ? 0 : canvas.width, this.y);
                }

                if (this.y - this.r < 0 || this.y + this.r > canvas.height) {
                    this.vy = -this.vy;
                    this.y = Math.max(this.r, Math.min(this.y, canvas.height - this.r));
                    registerCollision();
                    triggerWallEffect(this.x, this.y < canvas.height/2 ? 0 : canvas.height);
                }
            }
        }

        let wallEffects = []; // ì¶©ëŒ ì‹œê° íš¨ê³¼ ì €ì¥

        function registerCollision() {
            totalCollisions++;
            collisionBuffer.push(Date.now());
            document.getElementById('collisionCount').innerText = totalCollisions;
        }

        function triggerWallEffect(x, y) {
            wallEffects.push({x: x, y: y, life: 10});
        }

        function drawWallEffects() {
            for (let i = wallEffects.length - 1; i >= 0; i--) {
                let e = wallEffects[i];
                ctx.beginPath();
                ctx.arc(e.x, e.y, 20 - e.life, 0, Math.PI * 2);
                ctx.strokeStyle = `rgba(231, 76, 60, ${e.life / 10})`;
                ctx.lineWidth = 2;
                ctx.stroke();
                e.life--;
                if (e.life <= 0) wallEffects.splice(i, 1);
            }
        }

        function calculatePressure() {
            const now = Date.now();
            // ìµœê·¼ 0.5ì´ˆ ë™ì•ˆì˜ ì¶©ëŒ íšŸìˆ˜ë§Œ ê³„ì‚°í•˜ì—¬ ì‹¤ì‹œê°„ ì••ë ¥(Force) ê·¼ì‚¬ì¹˜ ì‚°ì¶œ
            collisionBuffer = collisionBuffer.filter(t => now - t < 500);
            
            // ì••ë ¥ = ì¶©ëŒ ë¹ˆë„ * ì…ì ì†ë„(ìš´ë™ëŸ‰ ë³€í™”ëŸ‰ì— ë¹„ë¡€)
            let currentPressure = collisionBuffer.length * (speedMultiplier * 0.5); 
            
            // UI ì—…ë°ì´íŠ¸ (ìŠ¤ë¬´ë”© ì²˜ë¦¬)
            let pressureDisplay = Math.min(100, currentPressure); // 100ì´ ìµœëŒ€ë¼ê³  ê°€ì •
            document.getElementById('pressureValue').innerText = pressureDisplay.toFixed(1);
            document.getElementById('pressureBar').style.width = `${pressureDisplay}%`;
            
            // ìƒ‰ìƒ ë³€í™” (ì••ë ¥ ë†’ìœ¼ë©´ ë¹¨ê°•)
            let hue = 200 - (pressureDisplay * 2); // íŒŒë‘ -> ë¹¨ê°•
            document.getElementById('pressureBar').style.background = `linear-gradient(90deg, #3498db, hsl(${hue}, 80%, 50%))`;
        }

        function init() {
            particles = [];
            for (let i = 0; i < pCount; i++) {
                particles.push(new Particle());
            }
        }

        function animate() {
            if (!isRunning) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ê·¸ë¬¼ë§ ê°™ì€ ë°°ê²½ ê·¸ë¦¬ê¸° (ê³µê°„ê°)
            ctx.strokeStyle = "#e0e0e0";
            ctx.beginPath();
            for(let i=0; i<canvas.width; i+=40) { ctx.moveTo(i,0); ctx.lineTo(i,canvas.height); }
            for(let i=0; i<canvas.height; i+=40) { ctx.moveTo(0,i); ctx.lineTo(canvas.width,i); }
            ctx.stroke();

            particles.forEach(p => {
                p.update();
                p.draw();
            });

            drawWallEffects();
            calculatePressure();
            
            animationId = requestAnimationFrame(animate);
        }

        function startSim() {
            if (isRunning) return;
            isRunning = true;
            if (particles.length === 0) init();
            animate();
        }

        function stopSim() {
            isRunning = false;
            cancelAnimationFrame(animationId);
        }

        function resetSim() {
            stopSim();
            totalCollisions = 0;
            collisionBuffer = [];
            document.getElementById('collisionCount').innerText = "0";
            document.getElementById('pressureValue').innerText = "0";
            document.getElementById('pressureBar').style.width = "0%";
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            init();
            
            // ë¦¬ì…‹ í›„ ë°”ë¡œ ê·¸ë¦¬ê¸°
            ctx.strokeStyle = "#e0e0e0";
            ctx.beginPath();
            for(let i=0; i<canvas.width; i+=40) { ctx.moveTo(i,0); ctx.lineTo(i,canvas.height); }
            for(let i=0; i<canvas.height; i+=40) { ctx.moveTo(0,i); ctx.lineTo(canvas.width,i); }
            ctx.stroke();
            particles.forEach(p => p.draw());
        }

        function updateSettings() {
            pCount = parseInt(document.getElementById('particleCount').value);
            speedMultiplier = parseInt(document.getElementById('shakeSpeed').value);
            
            document.getElementById('countVal').innerText = pCount;
            
            let speedText = ["", "ë§¤ìš° ëŠë¦¼", "ëŠë¦¼", "ë³´í†µ", "ë¹ ë¦„", "ë§¤ìš° ë¹ ë¦„"];
            document.getElementById('speedVal').innerText = speedText[speedMultiplier];

            // ì‹¤í–‰ ì¤‘ì´ë©´ ì‹¤ì‹œê°„ ë°˜ì˜ì„ ìœ„í•´ ì¬ì´ˆê¸°í™” í•˜ê±°ë‚˜ ì†ë„ë§Œ ë³€ê²½
            if (isRunning) {
                // ì…ì ìˆ˜ ë³€ê²½ ì‹œ ë¦¬ì…‹ í•„ìš” (ê°„ë‹¨í•˜ê²Œ êµ¬í˜„)
                if (particles.length !== pCount) {
                    init();
                }
                // ì†ë„ ë³€ê²½ ë°˜ì˜
                particles.forEach(p => {
                     // ë°©í–¥ ìœ ì§€ë¥¼ ìœ„í•´ ì •ê·œí™” í›„ ì†ë ¥ ì¬ì ìš©
                     let currentSpeed = Math.sqrt(p.vx*p.vx + p.vy*p.vy);
                     if(currentSpeed === 0) currentSpeed = 1;
                     let newSpeed = speedMultiplier * 1.5;
                     p.vx = (p.vx / currentSpeed) * newSpeed;
                     p.vy = (p.vy / currentSpeed) * newSpeed;
                });
            }
        }
        
        // ì´ˆê¸° í™”ë©´ ê·¸ë¦¬ê¸°
        init();
        resetSim(); 
    </script>
</body>
</html>