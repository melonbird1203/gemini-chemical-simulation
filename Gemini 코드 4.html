<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ìƒ ì‹¤í—˜: ì…ìì˜ ìš´ë™ê³¼ í™•ì‚°</title>
    <style>
        :root {
            --primary-color: #4A90E2;
            --accent-color: #FF6B6B;
            --bg-color: #F0F4F8;
            --text-color: #333;
        }

        body {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            width: 100%;
            max-width: 800px;
        }

        h1 { margin: 0 0 10px 0; color: var(--primary-color); }
        p { margin: 0; color: #666; }

        .container {
            display: flex;
            gap: 20px;
            max-width: 1000px;
            width: 100%;
            flex-wrap: wrap;
            justify-content: center;
        }

        .controls {
            flex: 1;
            min-width: 250px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .control-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        input[type="range"] {
            width: 100%;
            cursor: pointer;
        }

        .value-display {
            float: right;
            color: var(--primary-color);
            font-weight: bold;
        }

        button {
            width: 100%;
            padding: 12px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
            margin-bottom: 10px;
        }

        button:hover { background-color: #357ABD; }
        button.reset { background-color: #95a5a6; }

        .simulation-area {
            position: relative;
            width: 500px;
            height: 500px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
        }

        #simCanvas {
            width: 100%;
            height: 100%;
        }

        .stats-panel {
            flex: 1;
            min-width: 250px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .stat-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 5px solid var(--accent-color);
        }

        .feedback-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 0.9em;
            line-height: 1.5;
        }

        /* Graph Placeholder */
        .graph-container {
            width: 100%;
            height: 150px;
            background: #fafafa;
            border: 1px solid #eee;
            margin-top: 10px;
            position: relative;
        }
        
        .source-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            background: #ddd;
            border-radius: 50%;
            border: 2px dashed #999;
            pointer-events: none;
            z-index: 1;
        }

    </style>
</head>
<body>

    <header>
        <h1>ğŸ§ª ê¸°ì²´ ì…ìì˜ í™•ì‚° ì‹¤í—˜ì‹¤</h1>
        <p>ì„ê³  ë°©í–¥ì œì˜ í–¥ê¸°ê°€ ì–´ë–»ê²Œ êµì‹¤ë¡œ í¼ì ¸ë‚˜ê°€ëŠ”ì§€ ì…ìì˜ ìš´ë™ìœ¼ë¡œ í™•ì¸í•´ ë³´ì„¸ìš”.</p>
    </header>

    <div class="container">
        <div class="controls">
            <h3>ğŸ›ï¸ ì‹¤í—˜ ì¡°ê±´ ì„¤ì •</h3>
            
            <div class="control-group">
                <label>ğŸŒ¡ï¸ ì˜¨ë„ (ì…ì ì†ë„) <span id="tempVal" class="value-display">25Â°C</span></label>
                <input type="range" id="tempSlider" min="0" max="80" value="25">
                <small style="color:#888;">ì˜¨ë„ê°€ ë†’ì„ìˆ˜ë¡ ì…ìëŠ” ì—ë„ˆì§€ë¥¼ ì–»ìŠµë‹ˆë‹¤.</small>
            </div>

            <div class="control-group">
                <label>âœ¨ ì…ì ìˆ˜ (í–¥ê¸° ë†ë„) <span id="countVal" class="value-display">100ê°œ</span></label>
                <input type="range" id="countSlider" min="50" max="500" step="50" value="100">
            </div>

            <button id="startBtn">ì‹¤í—˜ ì‹œì‘ (ë°©í–¥ì œ ê°œë´‰)</button>
            <button id="resetBtn" class="reset">ì´ˆê¸°í™”</button>

            <div class="feedback-box" id="feedbackText">
                ğŸ’¡ <b>ì‹¤í—˜ íŒ:</b><br>
                ë¨¼ì € ì˜¨ë„ë¥¼ 25Â°Cë¡œ ë‘ê³  ì‹¤í—˜ì„ ì‹œì‘í•´ ë³´ì„¸ìš”. ê·¸ í›„ ì˜¨ë„ë¥¼ ë†’ì—¬ ë³€í™”ë¥¼ ê´€ì°°í•´ ë³´ì„¸ìš”.
            </div>
        </div>

        <div class="simulation-area">
            <div class="source-indicator"></div> <canvas id="simCanvas" width="500" height="500"></canvas>
        </div>

        <div class="stats-panel">
            <h3>ğŸ“Š ì‹¤ì‹œê°„ ë¶„ì„</h3>
            
            <div class="stat-box">
                <strong>í‰ê·  í™•ì‚° ê±°ë¦¬</strong>
                <div id="diffusionRadius" style="font-size: 1.5em; margin-top:5px;">0 cm</div>
            </div>

            <div class="stat-box">
                <strong>ê²½ê³¼ ì‹œê°„</strong>
                <div id="timer" style="font-size: 1.5em; margin-top:5px;">0.0 ì´ˆ</div>
            </div>

            <label>ğŸ“ˆ í™•ì‚° ê±°ë¦¬ ê·¸ë˜í”„</label>
            <div class="graph-container">
                <canvas id="graphCanvas" width="250" height="150"></canvas>
            </div>
        </div>
    </div>

    <script>
        // --- 1. ì„¤ì • ë° ë³€ìˆ˜ ---
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        const graphCanvas = document.getElementById('graphCanvas');
        const graphCtx = graphCanvas.getContext('2d');

        let particles = [];
        let isRunning = false;
        let animationId;
        let startTime;
        let elapsedTime = 0;
        
        // ì‹¤í—˜ ë³€ìˆ˜
        let temperature = 25; // 0 ~ 80
        let particleCount = 100;
        const baseSpeed = 0.5; // ê¸°ë³¸ ì†ë„ ê³„ìˆ˜

        // DOM ìš”ì†Œ
        const tempSlider = document.getElementById('tempSlider');
        const countSlider = document.getElementById('countSlider');
        const tempVal = document.getElementById('tempVal');
        const countVal = document.getElementById('countVal');
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        const feedbackText = document.getElementById('feedbackText');
        const radiusDisplay = document.getElementById('diffusionRadius');
        const timerDisplay = document.getElementById('timer');

        // ê·¸ë˜í”„ ë°ì´í„°
        let graphData = []; // {time, radius}

        // --- 2. ì…ì í´ë˜ìŠ¤ (Particle) ---
        class Particle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                // ëœë¤ ë°©í–¥ ì„¤ì •
                const angle = Math.random() * Math.PI * 2;
                // ì†ë„ëŠ” ì˜¨ë„ì— ë¹„ë¡€í•˜ì—¬ ì„¤ì •ë  ê²ƒì„ (updateì—ì„œ ê³„ì‚°)
                this.vx = Math.cos(angle); 
                this.vy = Math.sin(angle);
                
                // ìƒ‰ìƒì€ ë³´ë¼ìƒ‰ ê³„ì—´ (ë¼ë²¤ë” í–¥ê¸° ëŠë‚Œ)
                this.color = `rgba(${100 + Math.random()*50}, ${50 + Math.random()*50}, ${200 + Math.random()*55}, 0.8)`;
                this.radius = 3;
            }

            update(tempMultiplier) {
                // ë¸Œë¼ìš´ ìš´ë™ ì‹œë®¬ë ˆì´ì…˜: ì•½ê°„ì˜ ë¬´ì‘ìœ„ì„± ì¶”ê°€
                this.vx += (Math.random() - 0.5) * 0.2;
                this.vy += (Math.random() - 0.5) * 0.2;

                // ì†ë„ ì •ê·œí™” í›„ ì˜¨ë„ ì ìš©
                const speed = Math.sqrt(this.vx**2 + this.vy**2);
                if (speed > 0) {
                    // ì˜¨ë„ê°€ ë†’ì„ìˆ˜ë¡ ë” ë¹ ë¥´ê²Œ (ê¸°ë³¸ì†ë„ + ì˜¨ë„ê³„ìˆ˜)
                    const currentSpeed = baseSpeed + (temperature / 20); 
                    this.vx = (this.vx / speed) * currentSpeed;
                    this.vy = (this.vy / speed) * currentSpeed;
                }

                this.x += this.vx;
                this.y += this.vy;

                // ë²½ ì¶©ëŒ (ë°˜ì‚¬)
                if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
                if (this.y < 0 || this.y > canvas.height) this.vy *= -1;
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
            }
        }

        // --- 3. ì‹œë®¬ë ˆì´ì…˜ ë¡œì§ ---
        function initParticles() {
            particles = [];
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;

            for (let i = 0; i < particleCount; i++) {
                // ì¤‘ì•™(ë°©í–¥ì œ)ì—ì„œ ì‹œì‘í•˜ë˜ ì•½ê°„ì˜ ì‚°í¬ë„ ê°€ì§
                const offsetX = (Math.random() - 0.5) * 20;
                const offsetY = (Math.random() - 0.5) * 20;
                particles.push(new Particle(centerX + offsetX, centerY + offsetY));
            }
        }

        function calculateAvgDistance() {
            if (particles.length === 0) return 0;
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            let totalDist = 0;
            particles.forEach(p => {
                const dist = Math.sqrt((p.x - centerX)**2 + (p.y - centerY)**2);
                totalDist += dist;
            });
            // í”½ì…€ì„ cmë¡œ ëŒ€ëµ í™˜ì‚° (10px = 1cm ê°€ì •)
            return (totalDist / particles.length / 10).toFixed(1);
        }

        function drawGraph() {
            if (graphData.length < 2) return;

            graphCtx.clearRect(0, 0, graphCanvas.width, graphCanvas.height);
            graphCtx.beginPath();
            graphCtx.strokeStyle = '#4A90E2';
            graphCtx.lineWidth = 2;

            // Xì¶•: ì‹œê°„ (ìµœëŒ€ 60ì´ˆ ê¸°ì¤€ ìŠ¤ì¼€ì¼ë§), Yì¶•: ê±°ë¦¬ (ìµœëŒ€ 25cm ê¸°ì¤€)
            const maxTime = 60; 
            const maxRadius = 25;

            graphCtx.moveTo(0, graphCanvas.height); // ì‹œì‘ì 

            graphData.forEach((point) => {
                const x = (point.time / maxTime) * graphCanvas.width;
                const y = graphCanvas.height - ((point.radius / maxRadius) * graphCanvas.height);
                graphCtx.lineTo(x, y);
            });

            graphCtx.stroke();
        }

        function animate() {
            if (!isRunning) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // ê·¸ë¦¬ë“œ ê·¸ë¦¬ê¸° (ë°°ê²½)
            ctx.strokeStyle = '#eee';
            ctx.beginPath();
            for(let i=0; i<canvas.width; i+=50) { ctx.moveTo(i,0); ctx.lineTo(i, canvas.height); }
            for(let i=0; i<canvas.height; i+=50) { ctx.moveTo(0,i); ctx.lineTo(canvas.width, i); }
            ctx.stroke();

            // ì…ì ì—…ë°ì´íŠ¸ ë° ê·¸ë¦¬ê¸°
            particles.forEach(p => {
                p.update();
                p.draw();
            });

            // ë°ì´í„° ì—…ë°ì´íŠ¸
            const now = Date.now();
            elapsedTime = (now - startTime) / 1000;
            timerDisplay.textContent = elapsedTime.toFixed(1) + " ì´ˆ";

            const avgRadius = calculateAvgDistance();
            radiusDisplay.textContent = avgRadius + " cm";

            // ê·¸ë˜í”„ ë°ì´í„° ìˆ˜ì§‘ (0.2ì´ˆë§ˆë‹¤)
            if (graphData.length === 0 || elapsedTime - graphData[graphData.length-1].time > 0.2) {
                graphData.push({ time: elapsedTime, radius: avgRadius });
                drawGraph();
            }

            animationId = requestAnimationFrame(animate);
        }

        // --- 4. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
        tempSlider.addEventListener('input', (e) => {
            temperature = parseInt(e.target.value);
            tempVal.textContent = temperature + "Â°C";
            updateFeedback();
        });

        countSlider.addEventListener('input', (e) => {
            particleCount = parseInt(e.target.value);
            countVal.textContent = particleCount + "ê°œ";
            if (!isRunning) initParticles(); // ì‹¤í–‰ ì¤‘ì´ ì•„ë‹ ë•Œë§Œ ë¦¬ì…‹ ì—†ì´ ì ìš©
        });

        startBtn.addEventListener('click', () => {
            if (isRunning) return;
            isRunning = true;
            if (particles.length === 0) initParticles();
            startTime = Date.now() - (elapsedTime * 1000); // ë©ˆì·„ë˜ ì‹œê°„ë¶€í„° ê³„ì†
            animate();
            startBtn.textContent = "ì‹¤í—˜ ì§„í–‰ ì¤‘...";
            startBtn.style.backgroundColor = "#2ecc71";
            updateFeedback();
        });

        resetBtn.addEventListener('click', () => {
            isRunning = false;
            cancelAnimationFrame(animationId);
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            graphCtx.clearRect(0, 0, graphCanvas.width, graphCanvas.height);
            
            elapsedTime = 0;
            graphData = [];
            particles = [];
            
            timerDisplay.textContent = "0.0 ì´ˆ";
            radiusDisplay.textContent = "0 cm";
            startBtn.textContent = "ì‹¤í—˜ ì‹œì‘ (ë°©í–¥ì œ ê°œë´‰)";
            startBtn.style.backgroundColor = ""; // ì›ë˜ ìƒ‰ìœ¼ë¡œ
            
            // ì´ˆê¸°í™” ì‹œ ì„¤ì •ê°’ëŒ€ë¡œ ì…ì ë‹¤ì‹œ ìƒì„±
            initParticles();
            // í™”ë©´ì— ë©ˆì¶˜ ì…ì ë³´ì—¬ì£¼ê¸°
            particles.forEach(p => p.draw());
            
            feedbackText.innerHTML = "ğŸ’¡ <b>ì¤€ë¹„ ì™„ë£Œ:</b><br>ì‹¤í—˜ ì¡°ê±´ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ì¡°ê±´ì„ ë³€ê²½í•˜ê³  ë‹¤ì‹œ ì‹œì‘í•´ë³´ì„¸ìš”.";
        });

        function updateFeedback() {
            if (temperature < 15) {
                feedbackText.innerHTML = "â„ï¸ <b>ê´€ì°° í¬ì¸íŠ¸:</b><br>ì˜¨ë„ê°€ ë‚®ìœ¼ë©´ ì…ìì˜ ì›€ì§ì„ì´ ë‘”í•´ì§‘ë‹ˆë‹¤. í–¥ê¸°ê°€ ë©€ë¦¬ í¼ì§€ëŠ” ë° ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¬ê² ì£ ?";
            } else if (temperature > 50) {
                feedbackText.innerHTML = "ğŸ”¥ <b>ê´€ì°° í¬ì¸íŠ¸:</b><br>ì˜¨ë„ê°€ ë§¤ìš° ë†’ìŠµë‹ˆë‹¤! ì…ìë“¤ì´ ì—ë„ˆì§€ë¥¼ ì–»ì–´ ë§¹ë ¬í•˜ê²Œ ì›€ì§ì´ëŠ” ê²ƒì„ í™•ì¸í•´ë³´ì„¸ìš”. í™•ì‚° ì†ë„ê°€ ê¸‰ê²©íˆ ë¹¨ë¼ì§‘ë‹ˆë‹¤.";
            } else {
                feedbackText.innerHTML = "ğŸ‘€ <b>ê´€ì°° í¬ì¸íŠ¸:</b><br>ì…ìë“¤ì´ ì‚¬ë°©ìœ¼ë¡œ í¼ì ¸ë‚˜ê°€ëŠ” 'ë¬´ì‘ìœ„ ìš´ë™'ì„ ê´€ì°°í•˜ì„¸ìš”. íŠ¹ì • ë°©í–¥ì´ ì•„ë‹ˆë¼ ëª¨ë“  ë°©í–¥ìœ¼ë¡œ í¼ì ¸ë‚˜ê°‘ë‹ˆë‹¤.";
            }
        }

        // ì´ˆê¸° í™”ë©´ ë Œë”ë§
        initParticles();
        particles.forEach(p => p.draw());

    </script>
</body>
</html>