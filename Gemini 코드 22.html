<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ìƒ ì‹¤í—˜ì‹¤: ë¬¼ì´ ì–¼ ë•Œì˜ ì˜¨ë„ ë³€í™”</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #f5f7fa;
            --accent-color: #e74c3c;
            --text-color: #333;
            --border-radius: 12px;
        }

        body {
            font-family: 'Pretendard', 'Malgun Gothic', sans-serif;
            background-color: #eceff1;
            margin: 0;
            padding: 20px;
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #eee;
            padding-bottom: 20px;
        }

        h1 { margin: 0; color: var(--primary-color); }
        .subtitle { color: #666; font-size: 0.95rem; margin-top: 5px; }

        /* Layout Grid */
        .lab-grid {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 25px;
        }

        @media (max-width: 900px) {
            .lab-grid { grid-template-columns: 1fr; }
        }

        /* Control Panel */
        .panel {
            background: var(--secondary-color);
            padding: 20px;
            border-radius: var(--border-radius);
            border: 1px solid #ddd;
        }

        .control-group { margin-bottom: 20px; }
        label { display: block; font-weight: bold; margin-bottom: 8px; font-size: 0.9rem; }
        
        input[type="range"] { width: 100%; cursor: pointer; }
        .value-display { font-size: 0.9rem; color: var(--primary-color); float: right; }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .btn-start { background-color: var(--primary-color); color: white; }
        .btn-start:hover { background-color: #357abd; }
        .btn-reset { background-color: #95a5a6; color: white; }
        .btn-reset:hover { background-color: #7f8c8d; }

        /* Visualization Area */
        .display-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .canvas-container {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            position: relative;
            height: 300px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .label-tag {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255,255,255,0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        #graphCanvas { width: 100%; height: 100%; }
        
        /* Particle & Beaker Animation */
        #simCanvas { background: linear-gradient(to bottom, #e0f7fa, #ffffff); width: 100%; height: 100%; }

        /* Feedback & Analysis */
        .analysis-box {
            grid-column: 1 / -1;
            background: #fff3e0;
            padding: 20px;
            border-radius: var(--border-radius);
            border-left: 5px solid #ff9800;
            margin-top: 20px;
            display: none; /* Hidden initially */
        }

        .analysis-box h3 { margin-top: 0; color: #e65100; }

        /* Educational Guide */
        .guide-box {
            margin-top: 30px;
            padding: 20px;
            background: #e8f5e9;
            border-radius: var(--border-radius);
            font-size: 0.95rem;
        }

        .status-bar {
            grid-column: 1 / -1;
            background: #333;
            color: white;
            padding: 10px;
            text-align: center;
            border-radius: 8px;
            font-family: monospace;
            font-size: 1.1rem;
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ğŸ§ª ë¬¼ì´ ì–¼ ë•Œ ì˜¨ë„ëŠ” ì–´ë–»ê²Œ ë³€í• ê¹Œ?</h1>
        <div class="subtitle">ì¤‘1 ê³¼í•™ > ë¬¼ì§ˆì˜ ìƒíƒœ ë³€í™” > ìƒíƒœ ë³€í™”ì™€ ì—´ì—ë„ˆì§€</div>
    </header>

    <div class="lab-grid">
        <aside class="panel">
            <h3>ğŸ›ï¸ ì‹¤í—˜ ì¡°ê±´ ì„¤ì •</h3>
            
            <div class="control-group">
                <label>ì´ˆê¸° ë¬¼ ì˜¨ë„: <span id="tempDisplay" class="value-display">20â„ƒ</span></label>
                <input type="range" id="initTemp" min="10" max="30" value="20">
            </div>

            <div class="control-group">
                <label>ëƒ‰ê° ê°•ë„ (ì†ë„): <span id="coolDisplay" class="value-display">ë³´í†µ</span></label>
                <input type="range" id="coolRate" min="1" max="3" value="2">
            </div>

            <div class="control-group">
                <p style="font-size: 0.85rem; color: #666;">
                    ğŸ’¡ <strong>Tip:</strong> ì‹¤ì œ ì‹¤í—˜ì‹¤ì—ì„œëŠ” ë“œë¼ì´ì•„ì´ìŠ¤ë‚˜ ì–¼ìŒ+ì†Œê¸ˆì„ ëƒ‰ë§¤ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
                </p>
            </div>

            <button class="btn btn-start" id="startBtn" onclick="toggleExperiment()">â–¶ ì‹¤í—˜ ì‹œì‘</button>
            <button class="btn btn-reset" onclick="resetExperiment()">â†º ì´ˆê¸°í™”</button>

            <div style="margin-top:20px; font-size: 0.9rem;">
                <strong>âš ï¸ ì•ˆì „ ìˆ˜ì¹™:</strong><br>
                ì‹¤ì œ ì˜¨ë„ê³„ë¥¼ ì “ê°œë¡œ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”. ë¹„ì»¤ê°€ ê¹¨ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </div>
        </aside>

        <main>
            <div class="status-bar">
                í˜„ì¬ ì˜¨ë„: <span id="currentTempDisplay">20.0</span>â„ƒ | ìƒíƒœ: <span id="stateDisplay">ì•¡ì²´ (ë¬¼)</span>
            </div>

            <div class="display-area" style="margin-top: 15px;">
                <div class="canvas-container">
                    <span class="label-tag">ğŸ”¬ ì…ì ë° ë¹„ì»¤ ê´€ì°°</span>
                    <canvas id="simCanvas" width="400" height="300"></canvas>
                </div>

                <div class="canvas-container">
                    <span class="label-tag">ğŸ“ˆ ì˜¨ë„ ë³€í™” ê·¸ë˜í”„</span>
                    <canvas id="graphCanvas" width="400" height="300"></canvas>
                </div>
            </div>

            <div id="resultBox" class="analysis-box">
                <h3>ğŸ§ ì‹¤í—˜ ê²°ê³¼ ë¶„ì„</h3>
                <p id="analysisText">ì‹¤í—˜ì´ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤...</p>
                <div id="quizSection" style="margin-top:15px; border-top:1px dashed #ccc; padding-top:10px; display:none;">
                    <strong>[í™•ì¸ ë¬¸ì œ]</strong> ë¬¼ì´ ì–´ëŠ” ë™ì•ˆ(0â„ƒ) ì˜¨ë„ê°€ ë‚´ë ¤ê°€ì§€ ì•Šê³  ì¼ì •í–ˆë˜ ì´ìœ ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?
                    <br><br>
                    <button class="btn" style="background:#fff; border:1px solid #ccc; font-weight:normal; font-size:0.9rem;" onclick="checkAnswer(1)">ëƒ‰ê° ì¥ì¹˜ê°€ ë©ˆì·„ê¸° ë•Œë¬¸ì—</button>
                    <button class="btn" style="background:#fff; border:1px solid #ccc; font-weight:normal; font-size:0.9rem;" onclick="checkAnswer(2)">ìƒíƒœê°€ ë³€í•˜ë©´ì„œ ì—´ì—ë„ˆì§€ë¥¼ ë°©ì¶œí–ˆê¸° ë•Œë¬¸ì—</button>
                    <p id="quizFeedback" style="font-weight:bold; color:var(--accent-color);"></p>
                </div>
            </div>
        </main>
    </div>

    <div class="guide-box">
        <h3>ğŸ“š í•™ìŠµ í¬ì¸íŠ¸</h3>
        <ul>
            <li><strong>ì–´ëŠ”ì :</strong> ì•¡ì²´ê°€ ì–¼ì–´ ê³ ì²´ë¡œ ë³€í•˜ëŠ” ë™ì•ˆ ì¼ì •í•˜ê²Œ ìœ ì§€ë˜ëŠ” ì˜¨ë„ì…ë‹ˆë‹¤. (ë¬¼ì˜ ì–´ëŠ”ì : 0â„ƒ)</li>
            <li><strong>ìƒíƒœ ë³€í™”ì™€ ì˜¨ë„:</strong> ë¬¼ì´ ì–¼ìŒìœ¼ë¡œ ë³€í•  ë•Œ ì…ìë“¤ì€ ê·œì¹™ì ìœ¼ë¡œ ë°°ì—´ë©ë‹ˆë‹¤. ì´ë•Œ ì…ìê°€ ê°€ì§€ê³  ìˆë˜ ì—ë„ˆì§€ë¥¼ ë°–ìœ¼ë¡œ <strong>ë°©ì¶œ</strong>í•˜ê¸° ë•Œë¬¸ì—, ê³„ì† ëƒ‰ê°í•´ë„ ì˜¨ë„ê°€ ë–¨ì–´ì§€ì§€ ì•Šê³  ìœ ì§€ë©ë‹ˆë‹¤.</li>
            <li><strong>ì…ì ìš´ë™:</strong> ì˜¨ë„ê°€ ë‚®ì•„ì§ˆìˆ˜ë¡ ì…ìì˜ ìš´ë™ì€ ë‘”í•´ì§€ê³ , ê³ ì²´ê°€ ë˜ë©´ ì œìë¦¬ì—ì„œ ì§„ë™í•©ë‹ˆë‹¤.</li>
        </ul>
    </div>
</div>

<script>
    // Configuration
    const canvasSim = document.getElementById('simCanvas');
    const ctxSim = canvasSim.getContext('2d');
    const canvasGraph = document.getElementById('graphCanvas');
    const ctxGraph = canvasGraph.getContext('2d');

    // State Variables
    let isRunning = false;
    let initialTemp = 20;
    let currentTemp = 20;
    let time = 0;
    let coolingRate = 0.05;
    let latentHeatDuration = 300; // Duration to stay at 0 degrees (in frames)
    let latentHeatCounter = 0;
    let particles = [];
    let graphData = [];
    let animationId;
    let isFrozen = false;

    // Initialize Particles
    function initParticles() {
        particles = [];
        for(let i=0; i<30; i++) {
            particles.push({
                x: Math.random() * canvasSim.width,
                y: Math.random() * canvasSim.height,
                vx: (Math.random() - 0.5) * 2,
                vy: (Math.random() - 0.5) * 2,
                baseX: 0, // Target position for solid lattice
                baseY: 0
            });
        }
        // Assign lattice positions
        let col = 0, row = 0;
        particles.forEach((p, index) => {
            if (index % 6 === 0) { col = 0; row++; }
            p.baseX = 50 + col * 60 + (row % 2 ? 30 : 0);
            p.baseY = 50 + row * 50;
            col++;
        });
    }

    // Controls
    document.getElementById('initTemp').addEventListener('input', (e) => {
        initialTemp = parseInt(e.target.value);
        if(!isRunning) {
            currentTemp = initialTemp;
            resetExperiment();
        }
        document.getElementById('tempDisplay').innerText = initialTemp + "â„ƒ";
    });

    document.getElementById('coolRate').addEventListener('input', (e) => {
        const val = parseInt(e.target.value);
        coolingRate = val * 0.03;
        document.getElementById('coolDisplay').innerText = val === 1 ? "ì•½í•¨" : val === 2 ? "ë³´í†µ" : "ê°•í•¨";
    });

    function toggleExperiment() {
        const btn = document.getElementById('startBtn');
        if (!isRunning) {
            isRunning = true;
            btn.innerText = "â¸ ì¼ì‹œ ì •ì§€";
            btn.classList.add('btn-reset'); // change style visually
            animate();
        } else {
            isRunning = false;
            btn.innerText = "â–¶ ì‹¤í—˜ ê³„ì†";
            btn.classList.remove('btn-reset');
            cancelAnimationFrame(animationId);
        }
    }

    function resetExperiment() {
        isRunning = false;
        cancelAnimationFrame(animationId);
        document.getElementById('startBtn').innerText = "â–¶ ì‹¤í—˜ ì‹œì‘";
        document.getElementById('startBtn').classList.remove('btn-reset');
        
        currentTemp = initialTemp;
        time = 0;
        latentHeatCounter = 0;
        isFrozen = false;
        graphData = [];
        
        document.getElementById('resultBox').style.display = 'none';
        document.getElementById('quizSection').style.display = 'none';
        document.getElementById('quizFeedback').innerText = "";
        
        updateDisplay();
        initParticles();
        drawSim();
        drawGraph();
    }

    function checkAnswer(ans) {
        const fb = document.getElementById('quizFeedback');
        if (ans === 2) {
            fb.innerHTML = "ğŸ™†â€â™‚ï¸ ì •ë‹µì…ë‹ˆë‹¤! ë¬¼ì´ ì–¼ìŒì´ ë  ë•Œ 'ì‘ê³ ì—´'ì„ ë°©ì¶œí•˜ì—¬ ì˜¨ë„ê°€ ìœ ì§€ë©ë‹ˆë‹¤.";
            fb.style.color = "green";
        } else {
            fb.innerHTML = "ğŸ™… ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”. ëƒ‰ê°ì€ ê³„ì† ë˜ê³  ìˆì§€ë§Œ, ë‚´ë¶€ì—ì„œ ì—ë„ˆì§€ê°€ ë‚˜ì˜¤ê³  ìˆì–´ìš”.";
            fb.style.color = "red";
        }
    }

    // Physics Engine
    function updatePhysics() {
        time++;

        if (currentTemp > 0) {
            // Liquid Phase
            currentTemp -= coolingRate;
            if (currentTemp < 0) currentTemp = 0; // Snap to 0
        } else if (currentTemp === 0) {
            // Phase Change Plateau
            if (latentHeatCounter < latentHeatDuration) {
                latentHeatCounter += (coolingRate * 20); // Consume latent heat buffer
            } else {
                currentTemp -= coolingRate; // Finish freezing
            }
        } else {
            // Solid Phase
            currentTemp -= coolingRate;
        }

        // Data recording (every 10 frames)
        if (time % 10 === 0) {
            graphData.push({t: time, temp: currentTemp});
        }

        // Check completion
        if (currentTemp <= -10) {
            isRunning = false;
            document.getElementById('startBtn').innerText = "âœ… ì‹¤í—˜ ì¢…ë£Œ";
            showResult();
        }
    }

    function showResult() {
        const box = document.getElementById('resultBox');
        const text = document.getElementById('analysisText');
        box.style.display = 'block';
        text.innerHTML = `
            <strong>ì‹¤í—˜ ì™„ë£Œ!</strong><br>
            ê·¸ë˜í”„ë¥¼ ë³´ì„¸ìš”. ì˜¨ë„ê°€ ë‚´ë ¤ê°€ë‹¤ê°€ <strong>0â„ƒ êµ¬ê°„ì—ì„œ í‰í‰í•œ ì„ </strong>ì´ ë‚˜íƒ€ë‚¬ë‚˜ìš”?<br>
            ì´ êµ¬ê°„ì´ ë°”ë¡œ ë¬¼ì´ ì–¼ìŒìœ¼ë¡œ ìƒíƒœê°€ ë³€í•˜ëŠ” <strong>'ì–´ëŠ”ì '</strong>ì…ë‹ˆë‹¤.
        `;
        document.getElementById('quizSection').style.display = 'block';
    }

    // Rendering
    function drawSim() {
        // Clear
        ctxSim.fillStyle = currentTemp <= 0 ? "#e3f2fd" : "#e0f7fa";
        ctxSim.fillRect(0, 0, canvasSim.width, canvasSim.height);

        // Draw Beaker Outline
        ctxSim.strokeStyle = "#aaa";
        ctxSim.lineWidth = 5;
        ctxSim.strokeRect(50, 50, 300, 240);
        
        // Water/Ice Level
        ctxSim.fillStyle = currentTemp <= 0 ? "rgba(200, 230, 255, 0.8)" : "rgba(74, 144, 226, 0.3)";
        ctxSim.fillRect(55, 100, 290, 185);

        // Thermometer Visual
        ctxSim.fillStyle = "#fff";
        ctxSim.fillRect(320, 20, 20, 250);
        ctxSim.strokeStyle = "#333";
        ctxSim.strokeRect(320, 20, 20, 250);
        
        // Mercury
        let height = 200 - (currentTemp * 5); 
        // Clamp height visually
        if(height > 240) height = 240; 
        if(height < 50) height = 50;

        ctxSim.fillStyle = "#e74c3c";
        ctxSim.fillRect(324, height + 20, 12, 250 - height);

        // Particles
        particles.forEach(p => {
            ctxSim.beginPath();
            ctxSim.arc(p.x, p.y, 8, 0, Math.PI * 2);
            ctxSim.fillStyle = currentTemp <= 0 ? "#2980b9" : "#3498db";
            ctxSim.fill();
            
            // Movement Logic
            if (currentTemp > 0) {
                // Liquid: Move freely but slower as temp drops
                let speedFactor = (currentTemp + 5) / 30; 
                p.x += p.vx * speedFactor;
                p.y += p.vy * speedFactor;

                // Bounce walls (simplified)
                if(p.x < 55 || p.x > 345) p.vx *= -1;
                if(p.y < 100 || p.y > 285) p.vy *= -1;
            } else {
                // Solid: Vibrate around lattice position
                // Move towards base
                p.x += (p.baseX - p.x) * 0.1;
                p.y += (p.baseY - p.y) * 0.1;
                
                // Vibrate
                p.x += (Math.random() - 0.5) * 1.5;
                p.y += (Math.random() - 0.5) * 1.5;
            }
        });
        
        // Visual Text Overlay
        ctxSim.fillStyle = "#333";
        ctxSim.font = "14px Arial";
        if (currentTemp > 0) {
            ctxSim.fillText("ì•¡ì²´ (í™œë°œí•œ ìš´ë™)", 140, 80);
        } else {
            ctxSim.fillText("ê³ ì²´ (ê·œì¹™ì  ë°°ì—´, ì§„ë™)", 130, 80);
        }
    }

    function drawGraph() {
        ctxGraph.clearRect(0, 0, canvasGraph.width, canvasGraph.height);
        
        // Axes
        ctxGraph.beginPath();
        ctxGraph.strokeStyle = "#666";
        ctxGraph.lineWidth = 2;
        ctxGraph.moveTo(40, 10);
        ctxGraph.lineTo(40, 270); // Y axis
        ctxGraph.lineTo(380, 270); // X axis
        ctxGraph.stroke();

        // Labels
        ctxGraph.font = "12px Arial";
        ctxGraph.fillStyle = "#666";
        ctxGraph.fillText("ì˜¨ë„(â„ƒ)", 10, 15);
        ctxGraph.fillText("ì‹œê°„", 360, 285);
        ctxGraph.fillText("0", 25, 170); // 0 degree mark
        
        // 0-line grid
        ctxGraph.beginPath();
        ctxGraph.strokeStyle = "#ddd";
        ctxGraph.moveTo(40, 170);
        ctxGraph.lineTo(380, 170);
        ctxGraph.stroke();

        if (graphData.length < 2) return;

        // Plot Line
        ctxGraph.beginPath();
        ctxGraph.strokeStyle = "#e74c3c";
        ctxGraph.lineWidth = 3;
        
        // Scaling: Y: 170 is 0 deg. 10px per deg.
        // X: 40 start, 1px per time unit/2
        
        graphData.forEach((point, i) => {
            const x = 40 + (point.t / 3);
            const y = 170 - (point.temp * 5);
            if (i === 0) ctxGraph.moveTo(x, y);
            else ctxGraph.lineTo(x, y);
        });
        ctxGraph.stroke();
    }

    function updateDisplay() {
        document.getElementById('currentTempDisplay').innerText = currentTemp.toFixed(1);
        if (currentTemp > 0) {
            document.getElementById('stateDisplay').innerText = "ì•¡ì²´ (ë¬¼)";
            document.getElementById('stateDisplay').style.color = "blue";
        } else if (currentTemp === 0 && latentHeatCounter < latentHeatDuration) {
            document.getElementById('stateDisplay').innerText = "ìƒíƒœ ë³€í™” ì¤‘ (ë¬¼+ì–¼ìŒ)";
            document.getElementById('stateDisplay').style.color = "purple";
        } else {
            document.getElementById('stateDisplay').innerText = "ê³ ì²´ (ì–¼ìŒ)";
            document.getElementById('stateDisplay').style.color = "#333";
        }
    }

    function animate() {
        if (!isRunning) return;
        updatePhysics();
        updateDisplay();
        drawSim();
        drawGraph();
        animationId = requestAnimationFrame(animate);
    }

    // Initial Draw
    initParticles();
    drawSim();
    drawGraph();

</script>

</body>
</html>