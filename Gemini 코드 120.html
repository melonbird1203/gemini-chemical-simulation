<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê°€ìƒ ì‹¤í—˜: ê²°ì • êµ¬ì¡°ì™€ ë‹¨ìœ„ê²©ì</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Malgun Gothic', sans-serif; background-color: #1a1a2e; color: #fff; }
        #container { width: 100vw; height: 100vh; display: block; }
        
        /* UI íŒ¨ë„ ìŠ¤íƒ€ì¼ */
        #ui-layer {
            position: absolute; top: 20px; left: 20px; width: 320px;
            background: rgba(255, 255, 255, 0.95); color: #333;
            padding: 20px; border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            max-height: 90vh; overflow-y: auto;
        }
        h2 { margin: 0 0 10px 0; font-size: 1.2rem; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 5px;}
        .control-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem;}
        
        button {
            width: 100%; padding: 8px; margin-bottom: 5px;
            border: none; border-radius: 5px; cursor: pointer;
            background-color: #3498db; color: white; font-weight: bold;
            transition: 0.2s;
        }
        button:hover { background-color: #2980b9; }
        button.active { background-color: #1abc9c; }
        
        .toggle-switch {
            display: flex; align-items: center; justify-content: space-between;
            background: #ecf0f1; padding: 10px; border-radius: 5px; cursor: pointer; margin-bottom: 5px;
        }
        
        #info-panel {
            margin-top: 15px; padding: 10px; background: #f1f8ff;
            border-left: 4px solid #3498db; border-radius: 4px; font-size: 0.9rem;
        }
        
        /* í€´ì¦ˆ ì˜ì—­ */
        #quiz-section { margin-top: 20px; border-top: 1px solid #ddd; padding-top: 10px; }
        .quiz-option { 
            display: block; width: 100%; text-align: left; background: #fff; color: #333; border: 1px solid #ccc; margin-bottom: 5px;
        }
        .quiz-feedback { font-size: 0.85rem; margin-top: 5px; font-weight: bold; }
        .correct { color: #27ae60; }
        .wrong { color: #c0392b; }

        .legend { display: flex; gap: 10px; font-size: 0.8rem; margin-top: 5px;}
        .dot { width: 10px; height: 10px; display: inline-block; border-radius: 50%; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>

    <div id="container"></div>

    <div id="ui-layer">
        <h2>ğŸ”¬ ê²°ì • êµ¬ì¡° ì‹¤í—˜ì‹¤</h2>
        
        <div class="control-group">
            <label>1. êµ¬ì¡° ì„ íƒ</label>
            <button onclick="setStructure('SC')" id="btn-sc">ë‹¨ìˆœ ì…ë°© (SC)</button>
            <button onclick="setStructure('BCC')" id="btn-bcc">ì²´ì‹¬ ì…ë°© (BCC)</button>
            <button onclick="setStructure('FCC')" id="btn-fcc" class="active">ë©´ì‹¬ ì…ë°© (FCC)</button>
        </div>

        <div class="control-group">
            <label>2. ê´€ì°° ëª¨ë“œ</label>
            <div class="toggle-switch" onclick="toggleCut()">
                <span>âœ‚ï¸ ë‹¨ìœ„ê²©ì ìë¥´ê¸° (Cut)</span>
                <span id="cut-status">OFF</span>
            </div>
            <div class="toggle-switch" onclick="toggleWireframe()">
                <span>ğŸ§Š ê²©ì í‹€ ë³´ê¸°</span>
                <span id="wire-status">ON</span>
            </div>
        </div>

        <div id="info-panel">
            <strong>ğŸ“Š ì…ì ìˆ˜ ê³„ì‚° ê³µì‹</strong><br>
            <span id="calc-formula">êµ¬ì¡°ë¥¼ ì„ íƒí•˜ì„¸ìš”.</span>
        </div>

        <div id="quiz-section">
            <label>ğŸ“ í™•ì¸ í€´ì¦ˆ</label>
            <p id="quiz-question" style="font-size: 0.9rem; margin-bottom: 5px;">ì´ êµ¬ì¡°ì˜ ë‹¨ìœ„ê²©ì ë‚´ ì…ì ìˆ˜ëŠ”?</p>
            <button class="quiz-option" onclick="checkAnswer(1)">1ê°œ</button>
            <button class="quiz-option" onclick="checkAnswer(2)">2ê°œ</button>
            <button class="quiz-option" onclick="checkAnswer(4)">4ê°œ</button>
            <div id="quiz-feedback" class="quiz-feedback"></div>
        </div>
    </div>

    <script>
        // --- 1. Three.js ê¸°ë³¸ ì„¤ì • ---
        let scene, camera, renderer, controls;
        let atomsGroup = new THREE.Group();
        let latticeBox;
        let currentStructure = 'FCC';
        let isCutMode = false;
        let isWireframe = true;

        // í´ë¦¬í•‘ í‰ë©´ (ë‹¨ìœ„ê²©ì ìë¥´ê¸°ìš©)
        const planes = [
            new THREE.Plane(new THREE.Vector3(1, 0, 0), -0.5), // x max
            new THREE.Plane(new THREE.Vector3(-1, 0, 0), -0.5), // x min
            new THREE.Plane(new THREE.Vector3(0, 1, 0), -0.5), // y max
            new THREE.Plane(new THREE.Vector3(0, -1, 0), -0.5), // y min
            new THREE.Plane(new THREE.Vector3(0, 0, 1), -0.5), // z max
            new THREE.Plane(new THREE.Vector3(0, 0, -1), -0.5)  // z min
        ];

        function init() {
            // ì”¬ ìƒì„±
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a2e);

            // ì¹´ë©”ë¼ ì„¤ì •
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100);
            camera.position.set(2.5, 2.5, 4);

            // ë Œë”ëŸ¬ ì„¤ì •
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.localClippingEnabled = false; // ì´ˆê¸°ì—” ìë¥´ê¸° ë¹„í™œì„±í™”
            document.getElementById('container').appendChild(renderer.domElement);

            // ì¡°ëª…
            const ambientLight = new THREE.AmbientLight(0x404040, 1.5);
            scene.add(ambientLight);
            const dirLight = new THREE.DirectionalLight(0xffffff, 1);
            dirLight.position.set(5, 10, 7);
            scene.add(dirLight);

            // ì»¨íŠ¸ë¡¤
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;

            // ë‹¨ìœ„ê²©ì ë°•ìŠ¤ (Wireframe)
            const boxGeo = new THREE.BoxGeometry(1, 1, 1);
            const boxMat = new THREE.LineBasicMaterial({ color: 0xffff00, linewidth: 2 });
            const boxEdges = new THREE.EdgesGeometry(boxGeo);
            latticeBox = new THREE.LineSegments(boxEdges, boxMat);
            scene.add(latticeBox);

            scene.add(atomsGroup);

            // ì´ˆê¸° êµ¬ì¡° ìƒì„±
            setStructure('FCC');

            window.addEventListener('resize', onWindowResize);
            animate();
        }

        // --- 2. êµ¬ì¡° ìƒì„± ë¡œì§ ---
        function createAtom(x, y, z, color, isCorner) {
            const geometry = new THREE.SphereGeometry(0.25, 32, 32);
            const material = new THREE.MeshPhongMaterial({ 
                color: color,
                shininess: 100,
                clippingPlanes: planes, // ìë¥´ê¸° í‰ë©´ í• ë‹¹
                clipShadows: true,
                side: THREE.DoubleSide
            });
            const sphere = new THREE.Mesh(geometry, material);
            sphere.position.set(x - 0.5, y - 0.5, z - 0.5); // ì¤‘ì‹¬ì¢Œí‘œ ë³´ì • (-0.5 ~ 0.5 ë²”ìœ„ë¡œ)
            
            // ë°ì´í„° ì†ì„± ì¶”ê°€ (êµìœ¡ìš©)
            sphere.userData = { isCorner: isCorner };
            
            atomsGroup.add(sphere);
        }

        function setStructure(type) {
            currentStructure = type;
            atomsGroup.clear(); // ê¸°ì¡´ ì…ì ì œê±°
            
            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('button[id^="btn-"]').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-${type.toLowerCase()}`).classList.add('active');

            // í€´ì¦ˆ ì´ˆê¸°í™”
            document.getElementById('quiz-feedback').innerHTML = "";

            // êµ¬ì¡°ë³„ ì¢Œí‘œ ìƒì„±
            if (type === 'SC') { // ë‹¨ìˆœ ì…ë°©
                const color = 0x3498db; // íŒŒë‘
                for(let x=0; x<=1; x++) for(let y=0; y<=1; y++) for(let z=0; z<=1; z++) {
                    createAtom(x, y, z, color, true);
                }
                updateInfo("ê¼­ì§“ì (8ê°œ) Ã— 1/8 = 1ê°œ", "ë‹¨ìˆœ ì…ë°© êµ¬ì¡° (SC)");
            } 
            else if (type === 'BCC') { // ì²´ì‹¬ ì…ë°©
                const cornerColor = 0x3498db;
                const centerColor = 0xe74c3c; // ë¹¨ê°• (ì²´ì‹¬)
                
                // ê¼­ì§“ì 
                for(let x=0; x<=1; x++) for(let y=0; y<=1; y++) for(let z=0; z<=1; z++) {
                    createAtom(x, y, z, cornerColor, true);
                }
                // ì²´ì‹¬
                createAtom(0.5, 0.5, 0.5, centerColor, false);
                updateInfo("(ê¼­ì§“ì  8 Ã— 1/8) + (ì²´ì‹¬ 1 Ã— 1) = 2ê°œ", "ì²´ì‹¬ ì…ë°© êµ¬ì¡° (BCC)");
            } 
            else if (type === 'FCC') { // ë©´ì‹¬ ì…ë°©
                const cornerColor = 0x3498db;
                const faceColor = 0xf1c40f; // ë…¸ë‘ (ë©´ì‹¬)

                // ê¼­ì§“ì 
                for(let x=0; x<=1; x++) for(let y=0; y<=1; y++) for(let z=0; z<=1; z++) {
                    createAtom(x, y, z, cornerColor, true);
                }
                // ë©´ì‹¬ (ê° ë©´ì˜ ì¤‘ì‹¬)
                const faces = [
                    [0.5, 0.5, 0], [0.5, 0.5, 1], // zì¶• ìˆ˜ì§ ë©´
                    [0.5, 0, 0.5], [0.5, 1, 0.5], // yì¶• ìˆ˜ì§ ë©´
                    [0, 0.5, 0.5], [1, 0.5, 0.5]  // xì¶• ìˆ˜ì§ ë©´
                ];
                faces.forEach(pos => createAtom(pos[0], pos[1], pos[2], faceColor, false));
                updateInfo("(ê¼­ì§“ì  8 Ã— 1/8) + (ë©´ì‹¬ 6 Ã— 1/2) = 4ê°œ", "ë©´ì‹¬ ì…ë°© êµ¬ì¡° (FCC)");
            }
        }

        // --- 3. ì¸í„°ë™ì…˜ ë° UI ë¡œì§ ---
        function toggleCut() {
            isCutMode = !isCutMode;
            renderer.localClippingEnabled = isCutMode;
            document.getElementById('cut-status').innerText = isCutMode ? "ON" : "OFF";
            document.getElementById('cut-status').style.color = isCutMode ? "#e74c3c" : "#333";
        }

        function toggleWireframe() {
            isWireframe = !isWireframe;
            latticeBox.visible = isWireframe;
            document.getElementById('wire-status').innerText = isWireframe ? "ON" : "OFF";
        }

        function updateInfo(formula, title) {
            document.getElementById('calc-formula').innerHTML = formula;
            // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
            const info = document.getElementById('info-panel');
            info.style.backgroundColor = "#fff";
            setTimeout(() => info.style.backgroundColor = "#f1f8ff", 200);
        }

        function checkAnswer(answer) {
            const feedback = document.getElementById('quiz-feedback');
            let correctAnswer = 0;
            if(currentStructure === 'SC') correctAnswer = 1;
            if(currentStructure === 'BCC') correctAnswer = 2;
            if(currentStructure === 'FCC') correctAnswer = 4;

            if (answer === correctAnswer) {
                feedback.innerHTML = `<span class="correct">ì •ë‹µì…ë‹ˆë‹¤!ğŸ‘</span><br>ë‹¨ìœ„ê²©ì ë‚´ ì…ì ìˆ˜ëŠ” ${correctAnswer}ê°œ ì…ë‹ˆë‹¤.`;
            } else {
                feedback.innerHTML = `<span class="wrong">ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”.ğŸ¤”</span><br>'ë‹¨ìœ„ê²©ì ìë¥´ê¸°'ë¥¼ ì¼œê³  ê²©ì ì•ˆìª½ ì¡°ê°ë“¤ì„ ëª¨ì•„ë³´ì„¸ìš”.`;
            }
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        init();
    </script>
</body>
</html>