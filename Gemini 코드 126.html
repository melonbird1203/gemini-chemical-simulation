<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í™”í•™ í‰í˜• ì‹œë®¬ë ˆì´ì…˜: Q vs K</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #f72585;
            --bg: #f8f9fa;
            --card-bg: #ffffff;
            --text: #2b2d42;
            --h2-color: #3a86ff; /* ìˆ˜ì†Œ */
            --i2-color: #8338ec; /* ì•„ì´ì˜¤ë”˜ */
            --hi-color: #06d6a0; /* ì•„ì´ì˜¤ë”˜í™”ìˆ˜ì†Œ */
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
            max-width: 800px;
        }

        h1 { margin-bottom: 5px; color: var(--secondary); }
        .subtitle { font-size: 0.9rem; color: #666; }

        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            max-width: 1200px;
            width: 100%;
        }

        @media (max-width: 900px) {
            .container { grid-template-columns: 1fr; }
        }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ ìŠ¤íƒ€ì¼ */
        .control-group { margin-bottom: 15px; }
        .control-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .slider-container { display: flex; align-items: center; gap: 10px; }
        input[type="range"] { flex-grow: 1; cursor: pointer; }
        .val-display { width: 50px; text-align: right; font-family: monospace; }
        
        .h2-label { color: var(--h2-color); }
        .i2-label { color: var(--i2-color); }
        .hi-label { color: var(--hi-color); }

        /* ê²°ê³¼ íŒ¨ë„ ìŠ¤íƒ€ì¼ */
        .result-box {
            text-align: center;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 8px;
            margin-top: 10px;
        }
        .formula { font-size: 1.2rem; margin: 10px 0; font-weight: bold; }
        .comparison { font-size: 1.5rem; color: var(--accent); font-weight: bold; margin: 10px 0; }
        .direction-arrow { font-size: 2rem; display: block; margin: 10px 0; transition: transform 0.3s; }

        /* ì‹œê°í™” ì˜ì—­ */
        canvas#particleCanvas {
            width: 100%;
            height: 200px;
            border-radius: 8px;
            background: #222;
        }
        
        .btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            width: 100%;
            margin-top: 10px;
            transition: background 0.2s;
        }
        .btn:hover { background-color: var(--secondary); }
        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        .btn-outline:hover { background-color: #eef2ff; }

        .quiz-section {
            margin-top: 20px;
            border-top: 1px solid #ddd;
            padding-top: 15px;
        }
        .feedback {
            margin-top: 10px;
            padding: 10px;
            border-radius: 6px;
            display: none;
        }
        .feedback.correct { background-color: #d4edda; color: #155724; }
        .feedback.wrong { background-color: #f8d7da; color: #721c24; }

    </style>
</head>
<body>

<header>
    <h1>ğŸ§ª ë°˜ì‘ì§€ìˆ˜(Q)ì™€ í‰í˜•ìƒìˆ˜(K)</h1>
    <div class="subtitle">ê³ ë“±í•™êµ í™”í•™â…¡: í™”í•™ í‰í˜•ì˜ ì§„í–‰ ë°©í–¥ ì˜ˆì¸¡</div>
    <p style="margin-top:10px; font-size: 0.95rem;">
        ë°˜ì‘ì‹: <strong style="color:var(--h2-color)">Hâ‚‚</strong>(g) + <strong style="color:var(--i2-color)">Iâ‚‚</strong>(g) â‡„ 2<strong style="color:var(--hi-color)">HI</strong>(g)
    </p>
</header>

<div class="container">
    <div class="left-col">
        <div class="card">
            <h3>ğŸ›ï¸ ë†ë„ ì¡°ê±´ ì„¤ì • (mol/L)</h3>
            
            <div class="control-group">
                <label class="h2-label">[Hâ‚‚] ìˆ˜ì†Œ ê¸°ì²´</label>
                <div class="slider-container">
                    <input type="range" id="h2-slider" min="0.1" max="5.0" step="0.1" value="1.0">
                    <span id="h2-val" class="val-display">1.0</span> M
                </div>
            </div>

            <div class="control-group">
                <label class="i2-label">[Iâ‚‚] ì•„ì´ì˜¤ë”˜ ê¸°ì²´</label>
                <div class="slider-container">
                    <input type="range" id="i2-slider" min="0.1" max="5.0" step="0.1" value="1.0">
                    <span id="i2-val" class="val-display">1.0</span> M
                </div>
            </div>

            <div class="control-group">
                <label class="hi-label">[HI] ì•„ì´ì˜¤ë”˜í™” ìˆ˜ì†Œ</label>
                <div class="slider-container">
                    <input type="range" id="hi-slider" min="0.0" max="5.0" step="0.1" value="0.5">
                    <span id="hi-val" class="val-display">0.5</span> M
                </div>
            </div>

            <div class="control-group" style="border-top: 1px dashed #ccc; padding-top: 15px;">
                <label>ğŸŒ¡ï¸ í‰í˜•ìƒìˆ˜ (K)</label>
                <select id="k-select" style="width: 100%; padding: 8px; border-radius: 4px;">
                    <option value="4">K = 4 (ê¸°ë³¸)</option>
                    <option value="50">K = 50 (ì •ë°˜ì‘ ìš°ì„¸)</option>
                    <option value="0.1">K = 0.1 (ì—­ë°˜ì‘ ìš°ì„¸)</option>
                </select>
            </div>
        </div>

        <div class="card" style="margin-top: 20px;">
            <h3>ğŸ“Š ê²°ê³¼ ë¶„ì„</h3>
            <div class="result-box">
                <div>í˜„ì¬ ë°˜ì‘ì§€ìˆ˜ Qê°’</div>
                <div class="formula" id="q-formula">Q = 0.25</div>
                <div class="comparison" id="comparison-text">Q < K</div>
                <div class="direction-arrow" id="direction-arrow">â¡ï¸</div>
                <div id="direction-desc">ì •ë°˜ì‘ ì§„í–‰ (ìƒì„±ë¬¼ ì¦ê°€)</div>
            </div>
            
            <div class="quiz-section">
                <h4>ğŸ¤” ì˜ˆì¸¡ í€´ì¦ˆ</h4>
                <p>í˜„ì¬ ì¡°ê±´ì—ì„œ ë°˜ì‘ì€ ì–´ë””ë¡œ ì§„í–‰ë ê¹Œìš”?</p>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-outline" onclick="checkAnswer('forward')">ì •ë°˜ì‘(â†’)</button>
                    <button class="btn btn-outline" onclick="checkAnswer('equilibrium')">í‰í˜•(=)</button>
                    <button class="btn btn-outline" onclick="checkAnswer('reverse')">ì—­ë°˜ì‘(â†)</button>
                </div>
                <div id="quiz-feedback" class="feedback"></div>
            </div>
        </div>
    </div>

    <div class="right-col">
        <div class="card">
            <h3>ğŸ”¬ ì…ì ëª¨í˜• (ì‹œê°í™”)</h3>
            <canvas id="particleCanvas"></canvas>
            <p style="font-size: 0.8rem; text-align: center; color: #666;">*ì…ìì˜ ê°œìˆ˜ëŠ” ë†ë„ì— ë¹„ë¡€í•˜ì—¬ í‘œì‹œë©ë‹ˆë‹¤.</p>
        </div>

        <div class="card" style="margin-top: 20px;">
            <h3>ğŸ“ˆ í‰í˜• ë„ë‹¬ ì˜ˆì¸¡ ê·¸ë˜í”„</h3>
            <div style="position: relative; height: 300px; width: 100%">
                <canvas id="chartCanvas"></canvas>
            </div>
            <button class="btn" onclick="updateGraph()">ê·¸ë˜í”„ ì—…ë°ì´íŠ¸ (í‰í˜• ì˜ˆì¸¡)</button>
        </div>
    </div>
</div>

<script>
    // ìƒíƒœ ë³€ìˆ˜
    let state = {
        H2: 1.0,
        I2: 1.0,
        HI: 0.5,
        K: 4.0,
        Q: 0
    };

    // DOM ìš”ì†Œ
    const sliders = {
        H2: document.getElementById('h2-slider'),
        I2: document.getElementById('i2-slider'),
        HI: document.getElementById('hi-slider')
    };
    const displays = {
        H2: document.getElementById('h2-val'),
        I2: document.getElementById('i2-val'),
        HI: document.getElementById('hi-val')
    };
    const kSelect = document.getElementById('k-select');
    
    // ì°¨íŠ¸ ì´ˆê¸°í™”
    let simulationChart;
    
    function initChart() {
        const ctx = document.getElementById('chartCanvas').getContext('2d');
        simulationChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    { label: '[Hâ‚‚]', borderColor: '#3a86ff', data: [], tension: 0.4 },
                    { label: '[Iâ‚‚]', borderColor: '#8338ec', data: [], tension: 0.4 },
                    { label: '[HI]', borderColor: '#06d6a0', data: [], tension: 0.4 }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { title: { display: true, text: 'ì‹œê°„ (ê°€ìƒ)' } },
                    y: { title: { display: true, text: 'ë†ë„ (M)' }, beginAtZero: true }
                },
                animation: {
                    duration: 1500
                }
            }
        });
    }

    // Q ê³„ì‚° ë° UI ì—…ë°ì´íŠ¸
    function updateCalculation() {
        // ê°’ ì½ê¸°
        state.H2 = parseFloat(sliders.H2.value);
        state.I2 = parseFloat(sliders.I2.value);
        state.HI = parseFloat(sliders.HI.value);
        state.K = parseFloat(kSelect.value);

        // UI ìˆ«ì í‘œì‹œ ì—…ë°ì´íŠ¸
        displays.H2.textContent = state.H2.toFixed(1);
        displays.I2.textContent = state.I2.toFixed(1);
        displays.HI.textContent = state.HI.toFixed(1);

        // Q ê³„ì‚°: Q = [HI]^2 / ([H2][I2])
        if (state.H2 * state.I2 === 0) {
            state.Q = state.HI > 0 ? 9999 : 0; // ë¶„ëª¨ê°€ 0ì¼ ë•Œ ì²˜ë¦¬
        } else {
            state.Q = (state.HI * state.HI) / (state.H2 * state.I2);
        }

        // ê²°ê³¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        const qElem = document.getElementById('q-formula');
        const compElem = document.getElementById('comparison-text');
        const arrowElem = document.getElementById('direction-arrow');
        const descElem = document.getElementById('direction-desc');

        qElem.innerHTML = `Q = ${state.Q.toFixed(2)}`;

        // ë¹„êµ ë¡œì§
        if (Math.abs(state.Q - state.K) < 0.01) {
            compElem.textContent = "Q = K";
            compElem.style.color = "#28a745";
            arrowElem.textContent = "â‡Œ";
            descElem.textContent = "í˜„ì¬ í‰í˜• ìƒíƒœì…ë‹ˆë‹¤.";
            state.direction = 'equilibrium';
        } else if (state.Q < state.K) {
            compElem.textContent = "Q < K";
            compElem.style.color = "#f72585";
            arrowElem.textContent = "â¡ï¸";
            descElem.textContent = "ì •ë°˜ì‘ ì§„í–‰ (ë°˜ì‘ë¬¼ â†’ ìƒì„±ë¬¼)";
            state.direction = 'forward';
        } else {
            compElem.textContent = "Q > K";
            compElem.style.color = "#f72585";
            arrowElem.textContent = "â¬…ï¸";
            descElem.textContent = "ì—­ë°˜ì‘ ì§„í–‰ (ìƒì„±ë¬¼ â†’ ë°˜ì‘ë¬¼)";
            state.direction = 'reverse';
        }

        // í€´ì¦ˆ í”¼ë“œë°± ì´ˆê¸°í™”
        document.getElementById('quiz-feedback').style.display = 'none';

        // ìº”ë²„ìŠ¤ ì…ì ì—…ë°ì´íŠ¸
        updateParticles();
        
        // ê·¸ë˜í”„ ìë™ ì—…ë°ì´íŠ¸ (ì˜µì…˜)
        // updateGraph(); 
    }

    // í€´ì¦ˆ ì •ë‹µ í™•ì¸
    window.checkAnswer = function(userGuess) {
        const feedback = document.getElementById('quiz-feedback');
        feedback.style.display = 'block';
        
        let correct = false;
        if (userGuess === state.direction) correct = true;

        if (correct) {
            feedback.className = 'feedback correct';
            feedback.innerHTML = `<strong>ì •ë‹µì…ë‹ˆë‹¤!</strong><br>Q(${state.Q.toFixed(2)})ì™€ K(${state.K})ì˜ ê´€ê³„ë¥¼ ì˜ ì´í•´í–ˆêµ°ìš”.`;
        } else {
            feedback.className = 'feedback wrong';
            let reason = "";
            if(state.direction === 'forward') reason = "Qê°€ Kë³´ë‹¤ ì‘ìœ¼ë¯€ë¡œ í‰í˜•ì— ë„ë‹¬í•˜ë ¤ë©´ ìƒì„±ë¬¼ì´ ë” ëŠ˜ì–´ë‚˜ì•¼ í•©ë‹ˆë‹¤.";
            else if(state.direction === 'reverse') reason = "Qê°€ Kë³´ë‹¤ í¬ë¯€ë¡œ í‰í˜•ì— ë„ë‹¬í•˜ë ¤ë©´ ë°˜ì‘ë¬¼ì´ ë” ëŠ˜ì–´ë‚˜ì•¼ í•©ë‹ˆë‹¤.";
            else reason = "Qì™€ Kê°€ ê°™ìœ¼ë¯€ë¡œ ì´ë¯¸ í‰í˜• ìƒíƒœì…ë‹ˆë‹¤.";
            
            feedback.innerHTML = `<strong>ì•„ì‰½ë„¤ìš”.</strong><br>${reason}`;
        }
    };

    // ê·¸ë˜í”„ ê³„ì‚° ë° ê·¸ë¦¬ê¸° (2ì°¨ ë°©ì •ì‹ ê·¼ì˜ ê³µì‹ í™œìš©)
    window.updateGraph = function() {
        // í‰í˜• ìƒíƒœì˜ x êµ¬í•˜ê¸° (H2 - x, I2 - x, HI + 2x)
        // Kc = (HI + 2x)^2 / ((H2-x)(I2-x))
        // í’€ì´: (4 - Kc)x^2 + (4HI + Kc(H2+I2))x + (HI^2 - Kc*H2*I2) = 0
        
        const a = 4 - state.K;
        const b = 4 * state.HI + state.K * (state.H2 + state.I2);
        const c = Math.pow(state.HI, 2) - state.K * state.H2 * state.I2;

        let x = 0;

        if (Math.abs(a) < 1e-5) {
            // aê°€ 0ì— ê°€ê¹Œìš°ë©´ 1ì°¨ ë°©ì •ì‹ bx + c = 0
            x = -c / b;
        } else {
            const det = b*b - 4*a*c;
            if (det >= 0) {
                const x1 = (-b + Math.sqrt(det)) / (2*a);
                const x2 = (-b - Math.sqrt(det)) / (2*a);
                
                // ë¬¼ë¦¬ì ìœ¼ë¡œ ê°€ëŠ¥í•œ í•´ ì°¾ê¸° (ë†ë„ëŠ” ìŒìˆ˜ê°€ ë  ìˆ˜ ì—†ìŒ)
                // -HI/2 < x < min(H2, I2) ì¡°ê±´ í•„ìš”í•˜ë‚˜ ë‹¨ìˆœí•˜ê²Œ ê·¼ì‚¬
                // ì´ˆê¸°ê°’ì—ì„œ ë³€í™”ëŸ‰ì´ ë” ì‘ì€ ìª½ì´ ë¬¼ë¦¬ì  í•´ì¼ ê°€ëŠ¥ì„±ì´ ë†’ìŒ
                if (Math.abs(x1) < Math.abs(x2)) x = x1;
                else x = x2;
            }
        }

        // ê·¸ë˜í”„ ë°ì´í„° ìƒì„± (0 ~ 10ì´ˆ)
        const labels = [];
        const dataH2 = [];
        const dataI2 = [];
        const dataHI = [];
        const steps = 20;

        for (let i = 0; i <= steps; i++) {
            labels.push(i);
            // ì§€ìˆ˜ í•¨ìˆ˜ì  ì ‘ê·¼ìœ¼ë¡œ í‰í˜• ë„ë‹¬ ì‹œë®¬ë ˆì´ì…˜
            const progress = 1 - Math.exp(-i / 5); // 0 -> 1 ë¡œ ê°
            const currentX = x * progress;
            
            dataH2.push(Math.max(0, state.H2 - currentX));
            dataI2.push(Math.max(0, state.I2 - currentX));
            dataHI.push(Math.max(0, state.HI + 2 * currentX));
        }

        simulationChart.data.labels = labels;
        simulationChart.data.datasets[0].data = dataH2;
        simulationChart.data.datasets[1].data = dataI2;
        simulationChart.data.datasets[2].data = dataHI;
        simulationChart.update();
    };

    // ì…ì ì• ë‹ˆë©”ì´ì…˜ (Canvas)
    const canvas = document.getElementById('particleCanvas');
    const ctx = canvas.getContext('2d');
    let particles = [];

    function resizeCanvas() {
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;
    }

    class Particle {
        constructor(type) {
            this.type = type; // 'H2', 'I2', 'HI'
            this.reset();
        }
        
        reset() {
            this.x = Math.random() * canvas.width;
            this.y = Math.random() * canvas.height;
            this.vx = (Math.random() - 0.5) * 2;
            this.vy = (Math.random() - 0.5) * 2;
            this.radius = this.type === 'HI' ? 6 : 4;
        }

        draw() {
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
            if(this.type === 'H2') ctx.fillStyle = '#3a86ff';
            else if(this.type === 'I2') ctx.fillStyle = '#8338ec';
            else ctx.fillStyle = '#06d6a0';
            ctx.fill();
            
            // ë¶„ì ëª¨ì–‘ ë””í…Œì¼ (ë‘ ê°œ ë¶™ì€ ëª¨ì–‘ í‘œí˜„)
            if (this.type !== 'HI') {
                ctx.beginPath();
                ctx.arc(this.x + 3, this.y + 3, 2, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(255,255,255,0.3)';
                ctx.fill();
            }
        }

        update() {
            this.x += this.vx;
            this.y += this.vy;

            if(this.x < 0 || this.x > canvas.width) this.vx *= -1;
            if(this.y < 0 || this.y > canvas.height) this.vy *= -1;
            
            this.draw();
        }
    }

    function updateParticles() {
        particles = [];
        // ë†ë„ì— ë¹„ë¡€í•˜ì—¬ ì…ì ìˆ˜ ìƒì„± (ìµœëŒ€ ê°œìˆ˜ ì œí•œ)
        const scale = 10; 
        const countH2 = Math.min(50, Math.floor(state.H2 * scale));
        const countI2 = Math.min(50, Math.floor(state.I2 * scale));
        const countHI = Math.min(50, Math.floor(state.HI * scale));

        for(let i=0; i<countH2; i++) particles.push(new Particle('H2'));
        for(let i=0; i<countI2; i++) particles.push(new Particle('I2'));
        for(let i=0; i<countHI; i++) particles.push(new Particle('HI'));
    }

    function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles.forEach(p => p.update());
        requestAnimationFrame(animate);
    }

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
    Object.values(sliders).forEach(slider => {
        slider.addEventListener('input', updateCalculation);
    });
    kSelect.addEventListener('change', updateCalculation);
    window.addEventListener('resize', resizeCanvas);

    // ì´ˆê¸° ì‹¤í–‰
    initChart();
    resizeCanvas();
    updateCalculation();
    updateGraph(); // ì´ˆê¸° ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
    animate();

</script>
</body>
</html>