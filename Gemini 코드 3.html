<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ìƒì‹¤í—˜: ì•„ì„¸í†¤ì˜ ì¦ë°œê³¼ ì…ì ìš´ë™</title>
    <style>
        :root {
            --primary-color: #4A90E2;
            --bg-color: #f4f7f6;
            --panel-bg: #ffffff;
        }
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 { color: #333; margin-bottom: 10px; }
        .container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 1000px;
        }
        /* ì‹¤í—˜ ì˜ì—­ */
        .lab-area {
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
        }
        canvas {
            border: 2px solid #ddd;
            border-radius: 10px;
            background: #f9f9f9;
            cursor: crosshair;
        }
        
        /* ì œì–´ íŒ¨ë„ */
        .control-panel {
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 300px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .digital-scale {
            background: #222;
            color: #0f0;
            font-family: 'Courier New', monospace;
            font-size: 2em;
            text-align: center;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: 0.2s;
        }
        .btn-start { background-color: var(--primary-color); color: white; }
        .btn-start:hover { background-color: #357ABD; }
        .btn-reset { background-color: #e74c3c; color: white; }
        
        label { font-weight: bold; display: block; margin-bottom: 5px; }
        input[type="range"] { width: 100%; }

        .info-box {
            background-color: #e8f4fd;
            border-left: 5px solid var(--primary-color);
            padding: 10px;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        /* ì…ì ì„¤ëª… */
        .legend {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.85rem;
            margin-top: 5px;
        }
        .dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; }
        .blue-dot { background-color: rgba(74, 144, 226, 0.8); }
    </style>
</head>
<body>

    <h1>ğŸ§ª ì•„ì„¸í†¤ ì¦ë°œê³¼ ì…ì ìš´ë™</h1>
    <p style="text-align: center; color: #666;">ì•„ì„¸í†¤ì´ ì¦ë°œí•  ë•Œ ì…ìë“¤ì€ ì–´ë–»ê²Œ ì›€ì§ì¼ê¹Œìš”? ëˆˆì— ë³´ì´ì§€ ì•ŠëŠ” ì„¸ê³„ë¥¼ ê´€ì°°í•´ë³´ì„¸ìš”.</p>

    <div class="container">
        <div class="lab-area">
            <div style="position: absolute; top: 30px; left: 30px; font-weight: bold; color: #555;">í˜„ë¯¸ê²½ í™•ëŒ€ í™”ë©´ (ì…ì ëª¨í˜•)</div>
            <canvas id="simCanvas" width="500" height="400"></canvas>
            <div class="legend">
                <span class="dot blue-dot"></span> <span>ì•„ì„¸í†¤ ì…ì</span>
                <span style="color: #888;">(ë°°ê²½ì˜ í° ê³µê°„ì€ ê³µê¸°ì…ë‹ˆë‹¤)</span>
            </div>
        </div>

        <div class="control-panel">
            <div>
                <label>ì „ì ì €ìš¸ (ì§ˆëŸ‰)</label>
                <div class="digital-scale" id="massDisplay">5.00 g</div>
            </div>

            <div class="info-box" id="feedbackBox">
                ì‹¤í—˜ ì¤€ë¹„ ì™„ë£Œ.<br>
                'ì‹¤í—˜ ì‹œì‘' ë²„íŠ¼ì„ ëˆŒëŸ¬ ì•„ì„¸í†¤ì„ ì¦ë°œì‹œì¼œ ë³´ì„¸ìš”.
            </div>

            <div>
                <label for="tempSlider">ì˜¨ë„ ì¡°ì ˆ (ì…ì ì†ë„)</label>
                <input type="range" id="tempSlider" min="1" max="5" value="2" step="1">
                <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: #666;">
                    <span>ì°¨ê°€ì›€</span>
                    <span>ìƒì˜¨</span>
                    <span>ëœ¨ê±°ì›€</span>
                </div>
            </div>

            <button class="btn btn-start" id="startBtn">ì‹¤í—˜ ì‹œì‘</button>
            <button class="btn btn-reset" id="resetBtn">ì´ˆê¸°í™”</button>
            
            <div style="margin-top: 10px; font-size: 0.85rem; color: #555;">
                <strong>ğŸ’¡ í•™ìŠµ í¬ì¸íŠ¸:</strong><br>
                ì…ìê°€ ì•¡ì²´ í‘œë©´(ì¤‘ì•™)ì—ì„œ ê³µê¸° ì¤‘(ë°”ê¹¥)ìœ¼ë¡œ íŠ€ì–´ ë‚˜ê°€ëŠ” í˜„ìƒì´ ë°”ë¡œ <strong>'ì¦ë°œ'</strong>ì…ë‹ˆë‹¤.
            </div>
        </div>
    </div>

    <script>
        // --- ì‹œë®¬ë ˆì´ì…˜ ì„¤ì • ---
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        const massDisplay = document.getElementById('massDisplay');
        const feedbackBox = document.getElementById('feedbackBox');
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        const tempSlider = document.getElementById('tempSlider');

        let particles = [];
        let animationId;
        let isRunning = false;
        let temperature = 2; // 1~5
        const initialMass = 5.00;
        let currentMass = initialMass;
        
        // ê±°ë¦„ì¢…ì´(ì•¡ì²´ ì¡´ì¬ ì˜ì—­) ì •ì˜ - ìº”ë²„ìŠ¤ ì¤‘ì•™
        const liquidRadius = 80;
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;

        // ì…ì í´ë˜ìŠ¤
        class Particle {
            constructor() {
                // ì´ˆê¸° ìœ„ì¹˜ëŠ” ì¤‘ì•™ ì•¡ì²´ ì˜ì—­ ë‚´ ëœë¤ ë¶„í¬
                const angle = Math.random() * Math.PI * 2;
                const r = Math.sqrt(Math.random()) * liquidRadius; // ê· ì¼ ë¶„í¬
                this.x = centerX + r * Math.cos(angle);
                this.y = centerY + r * Math.sin(angle);
                
                // ì†ë„ (ì˜¨ë„ì— ë¹„ë¡€)
                this.vx = (Math.random() - 0.5) * temperature;
                this.vy = (Math.random() - 0.5) * temperature;
                
                this.state = 'liquid'; // liquid(ì•¡ì²´ ìƒíƒœ), gas(ì¦ë°œëœ ìƒíƒœ)
                this.escaped = false; // ì™„ì „íˆ í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°”ëŠ”ì§€
                this.alpha = 1; // íˆ¬ëª…ë„
            }

            update() {
                // ì˜¨ë„ì— ë”°ë¼ ì†ë„ ì—…ë°ì´íŠ¸ (ì‹¤ì‹œê°„ ë°˜ì˜)
                const speedMultiplier = temperature * 0.5; 
                
                // ëœë¤ ìš´ë™ (ë¸Œë¼ìš´ ìš´ë™ ìœ ì‚¬ íš¨ê³¼)
                this.vx += (Math.random() - 0.5) * 0.2;
                this.vy += (Math.random() - 0.5) * 0.2;

                // ì†ë„ ì œí•œ
                const maxSpeed = temperature * 1.5;
                const speed = Math.sqrt(this.vx*this.vx + this.vy*this.vy);
                if(speed > maxSpeed) {
                    this.vx = (this.vx / speed) * maxSpeed;
                    this.vy = (this.vy / speed) * maxSpeed;
                }

                this.x += this.vx;
                this.y += this.vy;

                // ìƒíƒœ í™•ì¸: ì•¡ì²´ ì˜ì—­ì„ ë²—ì–´ë‚¬ëŠ”ê°€?
                const distFromCenter = Math.sqrt((this.x - centerX)**2 + (this.y - centerY)**2);
                
                if (this.state === 'liquid') {
                    // ì•¡ì²´ ìƒíƒœì¼ ë•Œ: ì¸ë ¥(ê°€ìƒì˜ ì‘ì§‘ë ¥) í‰ë‚´
                    // ì˜¨ë„ê°€ ë‚®ìœ¼ë©´ ì¤‘ì‹¬ë¶€ë¡œ ì‚´ì§ ë‹¹ê¹€, ë†’ìœ¼ë©´ ì˜ íŠ€ì–´ë‚˜ê°
                    if (distFromCenter > liquidRadius) {
                        // í™•ë¥ ì ìœ¼ë¡œ íƒˆì¶œ (ì˜¨ë„ê°€ ë†’ì„ìˆ˜ë¡ íƒˆì¶œ í™•ë¥  ì¦ê°€)
                        if (Math.random() < (temperature * 0.01)) {
                            this.state = 'gas'; // ì¦ë°œ!
                        } else {
                            // íƒˆì¶œ ì‹¤íŒ¨: íŠ•ê²¨ ë‚˜ì˜´ (ë°˜ì‚¬)
                            const angle = Math.atan2(this.y - centerY, this.x - centerX);
                            this.vx = -Math.cos(angle) * speed;
                            this.vy = -Math.sin(angle) * speed;
                        }
                    }
                } else {
                    // ê¸°ì²´ ìƒíƒœ(ì¦ë°œ í›„): ììœ ë¡­ê²Œ í™•ì‚°, íˆ¬ëª…í•´ì§€ë©° ì‚¬ë¼ì§
                    this.alpha -= 0.005;
                    if (this.alpha <= 0) this.escaped = true;
                }
            }

            draw() {
                if (this.escaped) return;
                ctx.beginPath();
                ctx.arc(this.x, this.y, 4 + (temperature * 0.5), 0, Math.PI * 2);
                ctx.fillStyle = `rgba(74, 144, 226, ${this.alpha})`; // ì•„ì„¸í†¤ ìƒ‰ìƒ
                ctx.fill();
                ctx.closePath();
            }
        }

        function init() {
            particles = [];
            // ì…ì 300ê°œ ìƒì„±
            for (let i = 0; i < 300; i++) {
                particles.push(new Particle());
            }
            currentMass = initialMass;
            massDisplay.innerText = currentMass.toFixed(2) + " g";
            temperature = parseInt(tempSlider.value);
            drawBackground();
            
            // ì •ì§€ ìƒíƒœì—ì„œì˜ ì´ˆê¸° ë Œë”ë§
            particles.forEach(p => p.draw());
        }

        function drawBackground() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ê±°ë¦„ì¢…ì´ ì˜ì—­ í‘œì‹œ
            ctx.beginPath();
            ctx.arc(centerX, centerY, liquidRadius, 0, Math.PI * 2);
            ctx.strokeStyle = "#ccc";
            ctx.setLineDash([5, 5]);
            ctx.stroke();
            ctx.setLineDash([]);
            ctx.fillStyle = "rgba(255, 255, 255, 0.5)";
            ctx.fill();
            
            // í…ìŠ¤íŠ¸ ë¼ë²¨
            ctx.fillStyle = "#999";
            ctx.font = "12px sans-serif";
            ctx.fillText("ê±°ë¦„ì¢…ì´ ì˜ì—­", centerX - 35, centerY + liquidRadius + 20);
        }

        function animate() {
            if (!isRunning) return;

            drawBackground();
            temperature = parseInt(tempSlider.value);

            let activeParticles = 0;
            let liquidParticles = 0;

            particles.forEach(p => {
                if (!p.escaped) {
                    p.update();
                    p.draw();
                    activeParticles++;
                    if(p.state === 'liquid') liquidParticles++;
                }
            });

            // ì§ˆëŸ‰ ê³„ì‚°: ì•¡ì²´ ì˜ì—­ì— ë‚¨ì•„ìˆëŠ” ì…ì ìˆ˜ì— ë¹„ë¡€
            // ì‹œê°ì  íš¨ê³¼ë¥¼ ìœ„í•´ ì•½ê°„ì˜ ë³´ì •
            const massRatio = liquidParticles / 300;
            currentMass = initialMass * massRatio;
            massDisplay.innerText = Math.max(0, currentMass).toFixed(2) + " g";

            // í”¼ë“œë°± ì—…ë°ì´íŠ¸
            if (liquidParticles < 250 && liquidParticles > 100) {
                feedbackBox.innerHTML = "ì•„ì„¸í†¤ ì…ìë“¤ì´ í™œë°œí•˜ê²Œ ìš´ë™í•˜ë©°<br>ê³µê¸° ì¤‘ìœ¼ë¡œ ë‚ ì•„ê°€ê³  ìˆìŠµë‹ˆë‹¤! (ì¦ë°œ)";
            } else if (liquidParticles <= 10) {
                feedbackBox.innerHTML = "ê±°ì˜ ëª¨ë“  ì…ìê°€ ì¦ë°œí–ˆìŠµë‹ˆë‹¤.<br>ì§ˆëŸ‰ì´ 0gì— ê°€ê¹Œì›Œì¡ŒìŠµë‹ˆë‹¤.";
                stopSimulation();
            }

            animationId = requestAnimationFrame(animate);
        }

        function startSimulation() {
            if (isRunning) return;
            isRunning = true;
            startBtn.innerText = "ì§„í–‰ ì¤‘...";
            startBtn.disabled = true;
            tempSlider.disabled = false;
            animate();
        }

        function stopSimulation() {
            isRunning = false;
            cancelAnimationFrame(animationId);
            startBtn.innerText = "ì‹¤í—˜ ì™„ë£Œ";
        }

        function resetSimulation() {
            isRunning = false;
            cancelAnimationFrame(animationId);
            startBtn.innerText = "ì‹¤í—˜ ì‹œì‘";
            startBtn.disabled = false;
            feedbackBox.innerHTML = "ì‹¤í—˜ ì¤€ë¹„ ì™„ë£Œ.<br>'ì‹¤í—˜ ì‹œì‘' ë²„íŠ¼ì„ ëˆŒëŸ¬ ì•„ì„¸í†¤ì„ ì¦ë°œì‹œì¼œ ë³´ì„¸ìš”.";
            init();
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        startBtn.addEventListener('click', startSimulation);
        resetBtn.addEventListener('click', resetSimulation);
        tempSlider.addEventListener('input', () => {
            temperature = parseInt(tempSlider.value);
            if(isRunning) {
                feedbackBox.innerHTML = `ì˜¨ë„ ì„¤ì •: ${temperature}ë‹¨ê³„<br>ì˜¨ë„ê°€ ë†’ì„ìˆ˜ë¡ ì…ì ìš´ë™ì´ ë¹¨ë¼ì§‘ë‹ˆë‹¤.`;
            }
        });

        // ì´ˆê¸°í™” ì‹¤í–‰
        init();

    </script>
</body>
</html>