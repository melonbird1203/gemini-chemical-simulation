<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—¼í™” ì½”ë°œíŠ¸ ë™ì  í‰í˜• ê°€ìƒ ì‹¤í—˜</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #f5f7fa;
            --accent-pink: #ffb7b2;
            --accent-blue: #a2c2e0;
            --text-color: #333;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f2f5;
            color: var(--text-color);
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color), #357abd);
            color: white;
            padding: 20px 30px;
        }

        h1 { margin: 0; font-size: 1.5rem; }
        p.subtitle { margin: 5px 0 0; opacity: 0.9; font-size: 0.9rem; }

        .lab-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            padding: 20px;
        }

        /* ì‹¤í—˜ ì˜ì—­ */
        .experiment-area {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .paper-container {
            position: relative;
            height: 200px;
            background: #eee;
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 2px dashed #ccc;
            overflow: hidden;
            transition: background 0.5s;
        }

        #cobaltPaper {
            width: 120px;
            height: 120px;
            background-color: #a2c2e0; /* ì´ˆê¸° íŒŒë€ìƒ‰ ê³„ì—´ */
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: background-color 0.1s;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: white;
            text-shadow: 0 1px 3px rgba(0,0,0,0.3);
            border-radius: 4px;
        }

        .micro-view {
            background: #222;
            border-radius: 12px;
            padding: 10px;
            position: relative;
        }

        canvas#particleCanvas {
            width: 100%;
            height: 200px;
            display: block;
        }

        .view-label {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .control-panel {
            background: var(--secondary-color);
            padding: 20px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        input[type="range"] {
            width: 100%;
            cursor: pointer;
        }

        .status-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 5px solid var(--primary-color);
        }

        .status-text {
            font-weight: bold;
            margin-bottom: 5px;
            display: block;
        }

        .desc-text {
            font-size: 0.85rem;
            color: #666;
            line-height: 1.4;
        }

        /* ê·¸ë˜í”„ ë° í€´ì¦ˆ */
        .dashboard {
            padding: 0 20px 20px 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .chart-container {
            background: white;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 10px;
            height: 200px;
        }

        .quiz-section {
            background: #fff8e1;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ffe0b2;
        }

        .btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 10px;
        }
        .btn:hover { background: #357abd; }

        .hidden { display: none; }
        
        /* ë°˜ì‘ì‹ ìŠ¤íƒ€ì¼ */
        .reaction-equation {
            text-align: center;
            font-family: serif;
            margin-bottom: 10px;
            background: #fff;
            padding: 10px;
            border-radius: 8px;
        }

        @media (max-width: 768px) {
            .lab-layout, .dashboard { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ğŸ§ª ì—¼í™” ì½”ë°œíŠ¸ì˜ ë™ì  í‰í˜• ì‹¤í—˜ì‹¤</h1>
        <p class="subtitle">ê³ ë“±í•™êµ í™”í•™â… : ì˜¨ë„ì™€ ìŠµë„ì— ë”°ë¥¸ ê°€ì—­ ë°˜ì‘ ê´€ì°°</p>
    </header>

    <div class="lab-layout">
        <div class="experiment-area">
            <div class="reaction-equation">
                <span style="color:blue">CoClâ‚‚</span> (íŒŒë€ìƒ‰) + 6Hâ‚‚O 
                â‡„ 
                <span style="color: #ff6b6b">CoClâ‚‚Â·6Hâ‚‚O</span> (ë¶„í™ìƒ‰)
            </div>

            <div class="paper-container" id="envContainer">
                <div class="view-label" style="color:#333; top:-25px; left:0;">ğŸ“¸ ê±°ì‹œì  ê´€ì : ì‹¤ì œ ì‹¤í—˜</div>
                <div id="cobaltPaper">ì—¼í™” ì½”ë°œíŠ¸<br>ì¢…ì´</div>
                <div id="steamEffect" style="position:absolute; width:100%; height:100%; pointer-events:none;"></div>
            </div>

            <div class="micro-view">
                <div class="view-label">ğŸ” ë¯¸ì‹œì  ê´€ì : ì…ì ëª¨ë¸</div>
                <canvas id="particleCanvas"></canvas>
            </div>
        </div>

        <div class="control-panel">
            <h3>ğŸ›ï¸ ì‹¤í—˜ ì¡°ê±´ ì¡°ì ˆ</h3>
            
            <div class="control-group">
                <label>ğŸŒ¡ï¸ ì˜¨ë„ (Temperature): <span id="tempVal">25</span>Â°C</label>
                <input type="range" id="tempSlider" min="0" max="100" value="25">
                <small style="color:#666">ì˜¨ë„ê°€ ë†’ì„ìˆ˜ë¡ ë¬¼ ë¶„ìê°€ ì¦ë°œí•˜ë ¤ í•©ë‹ˆë‹¤.</small>
            </div>

            <div class="control-group">
                <label>ğŸ’§ ìŠµë„ (Humidity): <span id="humidVal">40</span>%</label>
                <input type="range" id="humidSlider" min="0" max="100" value="40">
                <small style="color:#666">ìŠµë„ê°€ ë†’ì„ìˆ˜ë¡ ë¬¼ ë¶„ìê°€ ì¢…ì´ì— ë‹¬ë¼ë¶™ìŠµë‹ˆë‹¤.</small>
            </div>

            <div class="status-box">
                <span class="status-text" id="equilibriumStatus">ìƒíƒœ: í‰í˜• ìœ ì§€ ì¤‘</span>
                <span class="desc-text" id="reactionDesc">í˜„ì¬ ì •ë°˜ì‘ê³¼ ì—­ë°˜ì‘ì˜ ì†ë„ê°€ ê°™ìŠµë‹ˆë‹¤.</span>
            </div>
        </div>
    </div>

    <div class="dashboard">
        <div class="chart-container">
            <canvas id="rateChart"></canvas>
        </div>

        <div class="quiz-section">
            <h3>ğŸ“ ê°œë… í™•ì¸ í€´ì¦ˆ</h3>
            <p id="quizQuestion">í˜„ì¬ ìƒíƒœì—ì„œ ì˜¨ë„ë¥¼ ê¸‰ê²©íˆ ì˜¬ë¦¬ë©´ ìƒ‰ì€ ì–´ë–»ê²Œ ë³€í• ê¹Œìš”?</p>
            <div id="quizOptions">
                <button class="btn" onclick="checkAnswer(0)">íŒŒë€ìƒ‰ ìª½ìœ¼ë¡œ ì´ë™</button>
                <button class="btn" onclick="checkAnswer(1)">ë¶„í™ìƒ‰ ìª½ìœ¼ë¡œ ì´ë™</button>
                <button class="btn" onclick="checkAnswer(2)">ë³€í™” ì—†ìŒ</button>
            </div>
            <p id="quizFeedback" style="margin-top:10px; font-weight:bold; color:var(--primary-color);"></p>
        </div>
    </div>
</div>

<script>
    // --- 1. ìƒíƒœ ë³€ìˆ˜ ë° ì„¤ì • ---
    const state = {
        temp: 25,       // 0 ~ 100 C
        humidity: 40,   // 0 ~ 100 %
        hydration: 0.4, // 0(Blue) ~ 1(Pink) : ì‹¤ì œ ë¬¼ ê²°í•© ì •ë„
        targetHydration: 0.4,
        isEquilibrium: true
    };

    const canvas = document.getElementById('particleCanvas');
    const ctx = canvas.getContext('2d');
    
    // ì°¨íŠ¸ ì„¤ì •
    const ctxChart = document.getElementById('rateChart').getContext('2d');
    const rateChart = new Chart(ctxChart, {
        type: 'bar',
        data: {
            labels: ['ì •ë°˜ì‘ (ìˆ˜í™”)', 'ì—­ë°˜ì‘ (íƒˆìˆ˜)'],
            datasets: [{
                label: 'ë°˜ì‘ ì†ë„',
                data: [50, 50],
                backgroundColor: ['#ffb7b2', '#a2c2e0']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: { y: { beginAtZero: true, max: 100 } },
            animation: { duration: 200 } // ë¹ ë¥¸ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´
        }
    });

    // --- 2. ì…ì ì‹œìŠ¤í…œ (ë¯¸ì‹œì  ê´€ì ) ---
    let particles = [];
    const particleCount = 40;

    class WaterMolecule {
        constructor() {
            this.x = Math.random() * canvas.width;
            this.y = Math.random() * canvas.height;
            this.vx = (Math.random() - 0.5) * 2;
            this.vy = (Math.random() - 0.5) * 2;
            this.radius = 3;
            this.state = 'free'; // 'free' or 'bound'
            this.targetCo = null; // ê²°í•©í•  ì½”ë°œíŠ¸ ìœ„ì¹˜
        }

        update(tempFactor, cobaltPositions) {
            // ì˜¨ë„ì— ë”°ë¥¸ ì†ë„ ë³€í™”
            const speed = 1 + tempFactor * 3;
            
            if (this.state === 'free') {
                this.x += this.vx * speed;
                this.y += this.vy * speed;

                // ë²½ íŠ€ê¸°ê¸°
                if(this.x < 0 || this.x > canvas.width) this.vx *= -1;
                if(this.y < 0 || this.y > canvas.height) this.vy *= -1;

                // ê²°í•© ë¡œì§: ìŠµë„ê°€ ë†’ê³ (state.hydrationì´ ë†’ìŒ) ìš°ì—°íˆ ì½”ë°œíŠ¸ ê·¼ì²˜ë©´ ê²°í•©
                if (Math.random() < state.hydration && Math.random() < 0.05) {
                    const target = cobaltPositions[Math.floor(Math.random() * cobaltPositions.length)];
                    this.state = 'bound';
                    this.targetCo = target;
                }
            } else {
                // ê²°í•© ìƒíƒœ (Co ì£¼ë³€ì„ ë§´ë”)
                if (this.targetCo) {
                    const angle = Date.now() / 200 + this.x; // íšŒì „ ì• ë‹ˆë©”ì´ì…˜
                    this.x = this.targetCo.x + Math.cos(angle) * 10;
                    this.y = this.targetCo.y + Math.sin(angle) * 10;
                }

                // ë¶„ë¦¬ ë¡œì§: ì˜¨ë„ê°€ ë†’ìœ¼ë©´(tempFactor ë†’ìŒ) ë–¨ì–´ì ¸ ë‚˜ê°
                // í˜¹ì€ í˜„ì¬ hydration ëª©í‘œë³´ë‹¤ ë„ˆë¬´ ë§ì´ ê²°í•©ë˜ì–´ ìˆìœ¼ë©´ ë¶„ë¦¬
                if (Math.random() < tempFactor * 0.1 || (!state.isEquilibrium && state.hydration < 0.5 && Math.random() < 0.1)) {
                    this.state = 'free';
                    this.vx = (Math.random() - 0.5) * 2;
                    this.vy = (Math.random() - 0.5) * 2;
                }
            }
        }

        draw() {
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
            ctx.fillStyle = this.state === 'bound' ? '#ff6b6b' : '#00ffff'; // ê²°í•© ì‹œ ë¶‰ì€ìƒ‰ í‹´íŠ¸, ììœ  ì‹œ ë¬¼ìƒ‰
            ctx.fill();
        }
    }

    // ì½”ë°œíŠ¸ ì´ì˜¨ ìœ„ì¹˜ ê³ ì • (ì¤‘ì•™ì— ê²©ì í˜•íƒœ)
    const cobaltIons = [];
    function initParticles() {
        canvas.width = canvas.parentElement.offsetWidth;
        canvas.height = 200;
        
        // ì½”ë°œíŠ¸ ì´ì˜¨ 3ê°œ ë°°ì¹˜
        for(let i=1; i<=3; i++) {
            cobaltIons.push({ x: canvas.width * (i/4), y: canvas.height/2 });
        }

        for(let i=0; i<particleCount; i++) {
            particles.push(new WaterMolecule());
        }
    }

    // --- 3. í•µì‹¬ ì‹œë®¬ë ˆì´ì…˜ ë¡œì§ ---
    function updateSimulation() {
        // 1. ëª©í‘œ ìˆ˜í™”ë„ ê³„ì‚° (ë‹¨ìˆœí™”ëœ ë¬¼ë¦¬ ëª¨ë¸)
        // ìŠµë„ê°€ ë†’ì„ìˆ˜ë¡(100), ì˜¨ë„ê°€ ë‚®ì„ìˆ˜ë¡(0) Pink(1.0)ì— ê°€ê¹Œì›Œì§
        // H: 0~100, T: 0~100
        // Formula: Base + (Humidity * 0.8) - (Temp * 0.8)
        let target = 0.5 + (state.humidity - state.temp) / 100;
        target = Math.max(0, Math.min(1, target)); // 0~1 ì‚¬ì´ í´ë¨í•‘
        state.targetHydration = target;

        // 2. ì ì§„ì  ë³€í™” (ë°˜ì‘ ì†ë„ ê°œë…)
        const reactionSpeed = 0.02; // ë°˜ì‘ ì§„í–‰ ì†ë„
        if (Math.abs(state.hydration - state.targetHydration) > 0.005) {
            state.isEquilibrium = false;
            if (state.hydration < state.targetHydration) {
                state.hydration += reactionSpeed; // ì •ë°˜ì‘ ìš°ì„¸
            } else {
                state.hydration -= reactionSpeed; // ì—­ë°˜ì‘ ìš°ì„¸
            }
        } else {
            state.isEquilibrium = true;
        }

        // 3. UI ì—…ë°ì´íŠ¸
        updateUI();
        
        // 4. ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„
        drawScene();
        requestAnimationFrame(updateSimulation);
    }

    function updateUI() {
        // ìƒ‰ìƒ ë³´ê°„ (Blue -> Pink)
        // Blue: rgb(65, 105, 225) -> Pink: rgb(255, 182, 193)
        const r = 65 + (255 - 65) * state.hydration;
        const g = 105 + (182 - 105) * state.hydration;
        const b = 225 + (193 - 225) * state.hydration;
        
        const colorString = `rgb(${Math.round(r)}, ${Math.round(g)}, ${Math.round(b)})`;
        document.getElementById('cobaltPaper').style.backgroundColor = colorString;

        // í…ìŠ¤íŠ¸ í”¼ë“œë°±
        const statusEl = document.getElementById('equilibriumStatus');
        const descEl = document.getElementById('reactionDesc');

        // ë°˜ì‘ ì†ë„ ê·¸ë˜í”„ ë°ì´í„° ì—…ë°ì´íŠ¸ (ê°€ìƒì˜ ì‹œê°í™”)
        // í‰í˜•ì´ ì•„ë‹ˆë©´ ìš°ì„¸í•œ ìª½ ì†ë„ê°€ ë” í¼
        let fwdRate = 50;
        let revRate = 50;

        if (!state.isEquilibrium) {
            statusEl.innerText = "ìƒíƒœ: ë°˜ì‘ ì§„í–‰ ì¤‘ âš ï¸";
            statusEl.style.color = "#d32f2f";
            
            if (state.hydration < state.targetHydration) {
                // ì •ë°˜ì‘ ìš°ì„¸ (ë¬¼ê³¼ ê²°í•© ì¤‘)
                descEl.innerHTML = "ìŠµë„ê°€ ë†’ì•„ <b>ì •ë°˜ì‘(ìˆ˜í™”)</b>ì´ ìš°ì„¸í•©ë‹ˆë‹¤.<br>ì¢…ì´ê°€ ë¶‰ê²Œ ë³€í•˜ê³  ìˆìŠµë‹ˆë‹¤.";
                fwdRate = 70; revRate = 30;
            } else {
                // ì—­ë°˜ì‘ ìš°ì„¸ (ë¬¼ ì¦ë°œ ì¤‘)
                descEl.innerHTML = "ì˜¨ë„ê°€ ë†’ì•„ <b>ì—­ë°˜ì‘(íƒˆìˆ˜)</b>ì´ ìš°ì„¸í•©ë‹ˆë‹¤.<br>ì¢…ì´ê°€ í‘¸ë¥´ê²Œ ë³€í•˜ê³  ìˆìŠµë‹ˆë‹¤.";
                fwdRate = 30; revRate = 70;
            }
        } else {
            statusEl.innerText = "ìƒíƒœ: ë™ì  í‰í˜• ë„ë‹¬ âœ…";
            statusEl.style.color = "#2e7d32";
            descEl.innerHTML = "ê²‰ë³´ê¸° ë³€í™”ëŠ” ì—†ì§€ë§Œ, ì…ìëŠ” ëŠì„ì—†ì´ ì´ë™í•˜ë©°<br><b>ì •ë°˜ì‘ ì†ë„ = ì—­ë°˜ì‘ ì†ë„</b>ì¸ ìƒíƒœì…ë‹ˆë‹¤.";
        }

        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        rateChart.data.datasets[0].data = [fwdRate, revRate];
        rateChart.update('none'); // 'none' mode for performance
    }

    function drawScene() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // ì½”ë°œíŠ¸ ì´ì˜¨ ê·¸ë¦¬ê¸° (ê³ ì •)
        ctx.fillStyle = '#4169e1';
        cobaltIons.forEach(co => {
            ctx.beginPath();
            ctx.arc(co.x, co.y, 15, 0, Math.PI*2);
            ctx.fill();
            ctx.fillStyle = 'white';
            ctx.font = '10px Arial';
            ctx.fillText("Co", co.x-7, co.y+4);
            ctx.fillStyle = '#4169e1';
        });

        // ë¬¼ ë¶„ì ì—…ë°ì´íŠ¸ ë° ê·¸ë¦¬ê¸°
        const tempFactor = state.temp / 100; // 0 ~ 1
        particles.forEach(p => {
            p.update(tempFactor, cobaltIons);
            p.draw();
        });
    }

    // --- 4. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
    document.getElementById('tempSlider').addEventListener('input', (e) => {
        state.temp = parseInt(e.target.value);
        document.getElementById('tempVal').innerText = state.temp;
    });

    document.getElementById('humidSlider').addEventListener('input', (e) => {
        state.humidity = parseInt(e.target.value);
        document.getElementById('humidVal').innerText = state.humidity;
    });

    // --- 5. í€´ì¦ˆ ë¡œì§ ---
    function checkAnswer(option) {
        const feedback = document.getElementById('quizFeedback');
        // ì§ˆë¬¸: ì˜¨ë„ë¥¼ ê¸‰ê²©íˆ ì˜¬ë¦¬ë©´? (ì—­ë°˜ì‘ ìš°ì„¸ -> íŒŒë€ìƒ‰)
        if(option === 0) {
            feedback.innerText = "ì •ë‹µì…ë‹ˆë‹¤! ğŸ‘ ì˜¨ë„ê°€ ì˜¤ë¥´ë©´ ë¬¼ì´ ì¦ë°œ(ì—­ë°˜ì‘)í•˜ì—¬ ë¬´ìˆ˜ ì—¼í™” ì½”ë°œíŠ¸(íŒŒë€ìƒ‰)ê°€ ë©ë‹ˆë‹¤.";
            feedback.style.color = "#2e7d32";
        } else if(option === 1) {
            feedback.innerText = "ì•„ë‹™ë‹ˆë‹¤. ë¶‰ì€ìƒ‰(ë¶„í™ìƒ‰)ì€ ë¬¼ê³¼ ê²°í•©í–ˆì„ ë•Œ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. ì˜¨ë„ê°€ ì˜¤ë¥´ë©´ ë¬¼ì´ ì–´ë–»ê²Œ ë ê¹Œìš”?";
            feedback.style.color = "#d32f2f";
        } else {
            feedback.innerText = "í‹€ë ¸ìŠµë‹ˆë‹¤. í‰í˜•ì´ ê¹¨ì§€ë©´ì„œ ìƒˆë¡œìš´ í‰í˜• ìƒíƒœë¡œ ì´ë™í•˜ê²Œ ë©ë‹ˆë‹¤.";
            feedback.style.color = "#d32f2f";
        }
    }

    // ì´ˆê¸°í™” ë° ì‹¤í–‰
    window.addEventListener('resize', initParticles);
    initParticles();
    updateSimulation();

</script>
</body>
</html>