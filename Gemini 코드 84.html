<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ìƒ ì‹¤í—˜ì‹¤: ì„¸ìƒì„ ë°”ê¾¸ëŠ” í™”í•™</title>
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #10b981;
            --accent: #f59e0b;
            --bg: #f8fafc;
            --text: #1e293b;
            --card-bg: #ffffff;
        }

        body {
            font-family: 'Pretendard', 'Malgun Gothic', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* Header */
        header {
            background-color: var(--primary);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Layout */
        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Sidebar */
        aside {
            width: 250px;
            background-color: var(--card-bg);
            border-right: 1px solid #e2e8f0;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            overflow-y: auto;
        }

        h3 { margin: 0 0 10px 0; font-size: 1.1rem; color: #475569; }

        .btn-topic {
            width: 100%;
            padding: 12px;
            text-align: left;
            border: 1px solid #e2e8f0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }

        .btn-topic:hover { background-color: #eff6ff; border-color: var(--primary); }
        .btn-topic.active { background-color: var(--primary); color: white; border-color: var(--primary); }

        /* Main Content */
        main {
            flex: 1;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            overflow-y: auto;
        }

        /* Step Navigation */
        .tabs {
            display: flex;
            gap: 10px;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
        }

        .tab {
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            color: #64748b;
        }

        .tab.active { background-color: var(--secondary); color: white; }

        /* Simulation Area */
        .sim-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 20px;
            display: flex;
            gap: 20px;
            min-height: 400px;
        }

        .canvas-area {
            flex: 2;
            background: #1e293b;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        canvas { border-radius: 8px; }

        .info-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .info-card {
            background: #f1f5f9;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--accent);
        }

        .control-panel {
            margin-top: auto;
            border-top: 1px solid #cbd5e1;
            padding-top: 15px;
        }

        button.action-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
        }
        button.action-btn:hover { background-color: #1d4ed8; }

        /* Report Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .report-header { border-bottom: 2px solid var(--primary); padding-bottom: 10px; margin-bottom: 20px; }
        .score-badge { float: right; background: var(--accent); color: white; padding: 5px 10px; border-radius: 15px; }

    </style>
</head>
<body>

<header>
    <div class="logo">ğŸ§ª CHEM-LAB: ì„¸ìƒì„ ë°”ê¾¸ëŠ” í™”í•™</div>
    <div style="font-size: 0.9rem;">ê³ ë“±í•™êµ í™”í•™â…  > 1. í™”í•™ì˜ ì²«ê±¸ìŒ</div>
</header>

<div class="container">
    <aside>
        <h3>1. íƒêµ¬ ì£¼ì œ ì„ íƒ</h3>
        <button class="btn-topic active" onclick="selectTopic('can')">ğŸ¥« í†µì¡°ë¦¼ (ê¸ˆì† ì‚°í™”)</button>
        <button class="btn-topic" onclick="selectTopic('diaper')">ğŸ‘¶ ì•„ê¸° ê¸°ì €ê·€ (ê³ ë¶„ì)</button>
        <button class="btn-topic" onclick="selectTopic('sunscreen')">â˜€ï¸ ì„ í¬ë¦¼ (ìì™¸ì„  ì°¨ë‹¨)</button>
        <button class="btn-topic" onclick="selectTopic('postit')">ğŸ“ í¬ìŠ¤íŠ¸ì‡ (ì ‘ì°©ì œ)</button>
        <button class="btn-topic" onclick="selectTopic('foil')">ğŸ¥˜ ì•Œë£¨ë¯¸ëŠ„ í¬ì¼ (ê¸ˆì†ë°•)</button>
        
        <div style="margin-top: auto; border-top: 1px solid #e2e8f0; padding-top: 1rem;">
            <h3>ğŸ“Š ë‚˜ì˜ íƒêµ¬ í˜„í™©</h3>
            <div id="progress-text" style="font-size: 0.9rem; color: #64748b;">ì§„í–‰ë¥ : 0%</div>
            <button onclick="showReport()" style="margin-top:10px; width:100%; background:#475569; color:white; border:none; padding:8px; border-radius:4px; cursor:pointer;">ğŸ“‘ íƒêµ¬ ë³´ê³ ì„œ ìƒì„±</button>
        </div>
    </aside>

    <main>
        <div class="tabs">
            <div class="tab active" onclick="setTab('history')">1. ì—­ì‚¬ì™€ ë°°ê²½</div>
            <div class="tab" onclick="setTab('principle')">2. í™”í•™ ì›ë¦¬ (ì‹œë®¬ë ˆì´ì…˜)</div>
            <div class="tab" onclick="setTab('social')">3. ì‚¬íšŒì  ì˜í–¥</div>
            <div class="tab" onclick="setTab('quiz')">4. ê°œë… í™•ì¸</div>
        </div>

        <h2 id="section-title">í†µì¡°ë¦¼: ì‹ëŸ‰ ë³´ì¡´ì˜ í˜ëª…</h2>
        
        <div class="sim-container">
            <div class="canvas-area" id="canvas-wrapper">
                <canvas id="mainCanvas" width="500" height="350"></canvas>
                </div>

            <div class="info-area">
                <div id="info-content">
                    </div>
                <div class="control-panel" id="control-panel">
                    </div>
            </div>
        </div>

        <div id="feedback-area" style="background:#dbeafe; padding:1rem; border-radius:8px; display:none;">
            ğŸ¤– <span id="ai-feedback"></span>
        </div>
    </main>
</div>

<div id="reportModal" class="modal">
    <div class="modal-content">
        <div class="report-header">
            <h2>ğŸ§ª ê³¼í•™ íƒêµ¬ ë³´ê³ ì„œ</h2>
            <span style="font-size: 0.9rem; color: #666;">2015 ê°œì • êµìœ¡ê³¼ì • í™”í•™â… </span>
        </div>
        <div id="report-body">
            </div>
        <button onclick="document.getElementById('reportModal').style.display='none'" style="margin-top:20px; padding:10px 20px; background:#e2e8f0; border:none; border-radius:4px; cursor:pointer;">ë‹«ê¸°</button>
        <button onclick="window.print()" style="margin-top:20px; padding:10px 20px; background:var(--primary); color:white; border:none; border-radius:4px; cursor:pointer; margin-left:10px;">PDF ì €ì¥/ì¸ì‡„</button>
    </div>
</div>

<script>
    // --- Data Source ---
    const db = {
        can: {
            title: "í†µì¡°ë¦¼: ì‹ëŸ‰ ë³´ì¡´ì˜ í˜ëª…",
            history: "ë‚˜í´ë ˆì˜¹ ì „ìŸ ë‹¹ì‹œ ì‹ëŸ‰ ë³´ê¸‰ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ê³ ì•ˆë˜ì—ˆìŠµë‹ˆë‹¤. ì´ˆê¸°ì—ëŠ” ë³‘ì¡°ë¦¼ì´ì—ˆìœ¼ë‚˜, ì´í›„ ì£¼ì„ìœ¼ë¡œ ë„ê¸ˆí•œ ê¹¡í†µì´ ê°œë°œë˜ì—ˆìŠµë‹ˆë‹¤.",
            principle: "ì² (Fe) í‘œë©´ì— ì£¼ì„(Sn)ì„ ì–‡ê²Œ ì…í˜€ ì² ì´ ì‚°ì†Œì™€ ë§Œë‚˜ ë…¹ìŠ¤ëŠ”(ì‚°í™”) ê²ƒì„ ë°©ì§€í•©ë‹ˆë‹¤. ì£¼ì„ì€ ì² ë³´ë‹¤ ì‚°í™”ê°€ ì˜ ë˜ì§€ ì•ŠëŠ” ê¸ˆì†ì…ë‹ˆë‹¤.",
            social: "ìŒì‹ì˜ ì¥ê¸° ë³´ê´€ê³¼ ì´ë™ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ì—¬ ì‹ìƒí™œì˜ ì‹œê³µê°„ì  ì œì•½ì„ ê·¹ë³µí•˜ê³ , ì‰ì—¬ ë†ì‚°ë¬¼ì˜ í™œìš©ë„ë¥¼ ë†’ì˜€ìŠµë‹ˆë‹¤.",
            simType: "coating", 
            quiz: { q: "í†µì¡°ë¦¼ ë‚´ë¶€ì˜ ì² ì´ ë…¹ìŠ¬ì§€ ì•ŠëŠ” ì´ìœ ëŠ” ë¬´ì—‡ì¸ê°€ìš”?", a: ["ì² ë³´ë‹¤ ë°˜ì‘ì„±ì´ í° ê¸ˆì† ë„ê¸ˆ", "ì² ë³´ë‹¤ ë°˜ì‘ì„±ì´ ì‘ì€ ì£¼ì„ ë„ê¸ˆ", "í”Œë¼ìŠ¤í‹± ì½”íŒ…"], answer: 1 }
        },
        diaper: {
            title: "ì•„ê¸° ê¸°ì €ê·€: ê³ ë¶„ìì˜ ë§ˆë²•",
            history: "ê³¼ê±° ì²œ ê¸°ì €ê·€ì˜ ë¶ˆí¸í•¨ì„ í•´ì†Œí•˜ê¸° ìœ„í•´ 1980ë…„ëŒ€ ê³ í¡ìˆ˜ì„± ìˆ˜ì§€(SAP)ë¥¼ ì´ìš©í•œ ì¼íšŒìš© ê¸°ì €ê·€ê°€ ëŒ€ì¤‘í™”ë˜ì—ˆìŠµë‹ˆë‹¤.",
            principle: "ê³ í¡ìˆ˜ì„± ìˆ˜ì§€(SAP)ëŠ” ê·¸ë¬¼ êµ¬ì¡°ë¥¼ ê°€ì§„ ê³ ë¶„ìì…ë‹ˆë‹¤. ë¬¼ ë¶„ìê°€ ë“¤ì–´ì˜¤ë©´ ì‚¼íˆ¬ì•• í˜„ìƒ ë“±ìœ¼ë¡œ ì¸í•´ ê·¸ë¬¼ êµ¬ì¡°ê°€ íŒ½ì°½í•˜ë©° ë¬¼ì„ ê°€ë‘¡ë‹ˆë‹¤.",
            social: "ìœ¡ì•„ ë…¸ë™ ì‹œê°„ì„ íšê¸°ì ìœ¼ë¡œ ì¤„ì´ê³  ìœ„ìƒ ìˆ˜ì¤€ì„ ë†’ì˜€ìŠµë‹ˆë‹¤. ë‹¤ë§Œ, íê¸°ë¬¼ ì²˜ë¦¬ ë¬¸ì œëŠ” ìƒˆë¡œìš´ í™˜ê²½ ê³¼ì œì…ë‹ˆë‹¤.",
            simType: "sap",
            quiz: { q: "ê³ í¡ìˆ˜ì„± ìˆ˜ì§€ê°€ ë¬¼ì„ í¡ìˆ˜í•˜ë©´ êµ¬ì¡°ê°€ ì–´ë–»ê²Œ ë³€í•˜ë‚˜ìš”?", a: ["ë…¹ì•„ì„œ ì‚¬ë¼ì§„ë‹¤", "ê·¸ë¬¼ êµ¬ì¡°ê°€ íŒ½ì°½í•œë‹¤", "ë”±ë”±í•˜ê²Œ êµ³ëŠ”ë‹¤"], answer: 1 }
        },
        sunscreen: {
            title: "ì„ í¬ë¦¼: ìì™¸ì„ ìœ¼ë¡œë¶€í„°ì˜ ë³´í˜¸",
            history: "í”¼ë¶€ì•”ê³¼ í™”ìƒì„ ì˜ˆë°©í•˜ê¸° ìœ„í•´ ê°œë°œë˜ì—ˆìŠµë‹ˆë‹¤. ë¬´ê¸° ìì™¸ì„  ì°¨ë‹¨ì œì™€ ìœ ê¸° ìì™¸ì„  ì°¨ë‹¨ì œë¡œ ë‚˜ë‰©ë‹ˆë‹¤.",
            principle: "ì´ì‚°í™” íƒ€ì´íƒ€ëŠ„(TiO2)ì´ë‚˜ ì‚°í™” ì•„ì—°(ZnO) ê°™ì€ ì…ìê°€ í”¼ë¶€ í‘œë©´ì—ì„œ ê±°ìš¸ì²˜ëŸ¼ ìì™¸ì„ ì„ ë°˜ì‚¬í•˜ê±°ë‚˜ ì‚°ë€ì‹œí‚µë‹ˆë‹¤.",
            social: "ì•¼ì™¸ í™œë™ ì‹œ í”¼ë¶€ ê±´ê°•ì„ ì§€í‚¤ê³  í”¼ë¶€ì•” ë°œìƒë¥ ì„ ë‚®ì¶”ëŠ” ë° ê¸°ì—¬í–ˆìŠµë‹ˆë‹¤.",
            simType: "uv",
            quiz: { q: "ë¬´ê¸° ìì™¸ì„  ì°¨ë‹¨ì œì˜ ì£¼ëœ ì›ë¦¬ëŠ”?", a: ["ìì™¸ì„  í¡ìˆ˜ í›„ ì—´ ë°©ì¶œ", "ìì™¸ì„  ë°˜ì‚¬ ë° ì‚°ë€", "í”¼ë¶€ ì„¸í¬ ê°•í™”"], answer: 1 }
        },
        postit: {
            title: "í¬ìŠ¤íŠ¸ì‡: ì‹¤íŒ¨í•œ ì ‘ì°©ì œì˜ ë¶€í™œ",
            history: "ê°•ë ¥ ì ‘ì°©ì œë¥¼ ë§Œë“¤ë ¤ë‹¤ ì‹¤ìˆ˜ë¡œ ë§Œë“¤ì–´ì§„ 'ì˜ ë–¨ì–´ì§€ëŠ” ì ‘ì°©ì œ'ë¥¼ ë©”ëª¨ì§€ì— ì ìš©í•˜ì—¬ íƒ„ìƒí–ˆìŠµë‹ˆë‹¤.",
            principle: "ì ‘ì°©ì œ ì…ìê°€ ì•„ì£¼ ì‘ì€ êµ¬(Sphere) í˜•íƒœì…ë‹ˆë‹¤. ì ‘ì°© ë©´ì ì´ ì‘ì•„ ì‰½ê²Œ ë¶™ì—ˆë‹¤ ë–¨ì–´ì§ˆ ìˆ˜ ìˆìœ¼ë©° ëˆì ì„ì´ ë‚¨ì§€ ì•ŠìŠµë‹ˆë‹¤.",
            social: "ì •ë³´ì˜ ê¸°ë¡ê³¼ ê³µìœ  ë°©ì‹ì„ ê°„í¸í•˜ê²Œ ë§Œë“¤ì–´ ì‚¬ë¬´ ë° í•™ìŠµ íš¨ìœ¨ì„ ë†’ì˜€ìŠµë‹ˆë‹¤.",
            simType: "sphere",
            quiz: { q: "í¬ìŠ¤íŠ¸ì‡ì´ ì‰½ê²Œ ë–¨ì–´ì§€ëŠ” ì´ìœ ëŠ”?", a: ["ì ‘ì°©ì œê°€ ì•½í•´ì„œ", "ë¯¸ì„¸í•œ êµ¬í˜• ì…ìë¡œ ì ‘ì°© ë©´ì ì´ ì ì–´ì„œ", "ì •ì „ê¸°ë¥¼ ì´ìš©í•˜ë¯€ë¡œ"], answer: 1 }
        },
        foil: {
            title: "ì•Œë£¨ë¯¸ëŠ„ í¬ì¼: ê°€ë³ê³  ê°•í•œ ê¸ˆì†ë°•",
            history: "ê³¼ê±°ì—ëŠ” ê¸ˆì´ë‚˜ ì€ë°•ì„ ì‚¬ìš©í–ˆìœ¼ë‚˜, ì•Œë£¨ë¯¸ëŠ„ ì œë ¨ ê¸°ìˆ ì˜ ë°œë‹¬(ì „ê¸° ë¶„í•´)ë¡œ ì €ë ´í•˜ê²Œ ëŒ€ëŸ‰ ìƒì‚°ë˜ì—ˆìŠµë‹ˆë‹¤.",
            principle: "ì•Œë£¨ë¯¸ëŠ„ì€ ì „ì„±(í´ì§€ëŠ” ì„±ì§ˆ)ì´ ë§¤ìš° ì¢‹ì•„ ì–‡ì€ ë°•ìœ¼ë¡œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í‘œë©´ì— ì¹˜ë°€í•œ ì‚°í™” í”¼ë§‰ì´ í˜•ì„±ë˜ì–´ ë‚´ë¶€ ë¶€ì‹ì„ ë§‰ìŠµë‹ˆë‹¤.",
            social: "ì¡°ë¦¬ ë° í¬ì¥ ìš©ê¸°ë¡œ ë„ë¦¬ ì“°ì´ë©°, ì—´ ì „ë„ìœ¨ì´ ë†’ì•„ ì¡°ë¦¬ ì‹œê°„ì„ ë‹¨ì¶•ì‹œí‚µë‹ˆë‹¤.",
            simType: "metal",
            quiz: { q: "ì•Œë£¨ë¯¸ëŠ„ì´ ë…¹ìŠ¬ì§€ ì•ŠëŠ” ê²ƒì²˜ëŸ¼ ë³´ì´ëŠ” ì´ìœ ëŠ”?", a: ["ë°˜ì‘ì„±ì´ ì „í˜€ ì—†ì–´ì„œ", "í‘œë©´ì— ì‚°í™” í”¼ë§‰ì´ ë³´í˜¸í•´ì„œ", "ë§¤ìš° ë¬´ê±°ìš´ ê¸ˆì†ì´ë¼ì„œ"], answer: 1 }
        }
    };

    // --- State ---
    let currentTopic = 'can';
    let currentTab = 'history';
    let animationId = null;
    let particles = [];
    let progress = { can: false, diaper: false, sunscreen: false, postit: false, foil: false };

    // --- Core Functions ---
    function selectTopic(topic) {
        currentTopic = topic;
        // UI Update
        document.querySelectorAll('.btn-topic').forEach(b => b.classList.remove('active'));
        document.querySelector(`.btn-topic[onclick="selectTopic('${topic}')"]`).classList.add('active');
        
        // Reset View
        setTab('history');
        renderContent();
    }

    function setTab(tab) {
        currentTab = tab;
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab')[['history', 'principle', 'social', 'quiz'].indexOf(tab)].classList.add('active');
        
        renderContent();
        
        if(tab === 'principle') {
            startSimulation();
        } else {
            stopSimulation();
        }
    }

    function renderContent() {
        const data = db[currentTopic];
        const infoDiv = document.getElementById('info-content');
        const controlDiv = document.getElementById('control-panel');
        const title = document.getElementById('section-title');
        const feedback = document.getElementById('feedback-area');

        title.textContent = data.title;
        feedback.style.display = 'none';

        if (currentTab === 'history') {
            infoDiv.innerHTML = `<div class="info-card"><h3>ğŸ“š ì—­ì‚¬ì  ë°°ê²½</h3><p>${data.history}</p></div>`;
            controlDiv.innerHTML = `<button class="action-btn" onclick="setTab('principle')">í™”í•™ ì›ë¦¬ ì•Œì•„ë³´ê¸° (ì‹¤í—˜ ì‹œì‘) ğŸ‘‰</button>`;
        } else if (currentTab === 'principle') {
            infoDiv.innerHTML = `<div class="info-card"><h3>ğŸ”¬ í™”í•™ ì›ë¦¬</h3><p>${data.principle}</p></div>`;
            controlDiv.innerHTML = getSimulationControls(data.simType);
        } else if (currentTab === 'social') {
            infoDiv.innerHTML = `<div class="info-card"><h3>ğŸŒ ì‚¬íšŒì  ê¸°ì—¬</h3><p>${data.social}</p></div>`;
            controlDiv.innerHTML = `<button class="action-btn" onclick="setTab('quiz')">ê°œë… í™•ì¸ í€´ì¦ˆ í’€ê¸° ğŸ‘‰</button>`;
        } else if (currentTab === 'quiz') {
            infoDiv.innerHTML = `
                <div class="info-card">
                    <h3>âœï¸ í€´ì¦ˆ</h3>
                    <p>${data.quiz.q}</p>
                    ${data.quiz.a.map((opt, i) => `<div style="margin:5px 0;"><input type="radio" name="q" id="o${i}" value="${i}"> <label for="o${i}">${opt}</label></div>`).join('')}
                </div>`;
            controlDiv.innerHTML = `<button class="action-btn" onclick="checkAnswer()">ì •ë‹µ í™•ì¸</button>`;
        }
    }

    // --- Simulation Logic (Canvas) ---
    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');

    function getSimulationControls(type) {
        if(type === 'sap') return `<button class="action-btn" onclick="triggerSimAction('addWater')">ğŸ’§ ë¬¼ ë¶“ê¸° (ë³€í™” ê´€ì°°)</button>`;
        if(type === 'uv') return `<button class="action-btn" onclick="triggerSimAction('toggleUV')">â˜€ï¸ ìì™¸ì„  ì˜ê¸° ON/OFF</button>`;
        if(type === 'coating') return `<button class="action-btn" onclick="triggerSimAction('oxidize')">ğŸ’¨ ì‚°ì†Œ ë…¸ì¶œ ì‹œí‚¤ê¸°</button>`;
        return `<div style="text-align:center; color:#666;">ìë™ ì¬ìƒ ì¤‘ì…ë‹ˆë‹¤.</div>`;
    }

    let simState = { waterLevel: 0, uvOn: false, oxidized: false };

    function triggerSimAction(action) {
        if(action === 'addWater') {
            simState.waterLevel = Math.min(simState.waterLevel + 1, 5);
            giveFeedback("ìˆ˜ë¶„ì´ ê³ ë¶„ì ì‚¬ìŠ¬ ì‚¬ì´ë¡œ ë“¤ì–´ê°€ê³  ìˆìŠµë‹ˆë‹¤! ë¶€í”¼ê°€ ì»¤ì§€ëŠ” ê²ƒì„ ê´€ì°°í•˜ì„¸ìš”.");
        }
        if(action === 'toggleUV') {
            simState.uvOn = !simState.uvOn;
            giveFeedback(simState.uvOn ? "ìì™¸ì„ (ë…¸ë€ ì„ )ì´ í”¼ë¶€ë¡œ í–¥í•©ë‹ˆë‹¤. ì°¨ë‹¨ì œ ì…ìê°€ ì–´ë–»ê²Œ ë§‰ì•„ë‚´ë‚˜ìš”?" : "ìì™¸ì„  ì°¨ë‹¨ ì‹¤í—˜ ì¤‘ì§€");
        }
        if(action === 'oxidize') {
            simState.oxidized = true;
            giveFeedback("ì‚°ì†Œê°€ ì ‘ê·¼í•©ë‹ˆë‹¤! ì£¼ì„(Sn) ì¸µì´ ì² (Fe)ì„ ì–´ë–»ê²Œ ë³´í˜¸í•˜ëŠ”ì§€ ë³´ì„¸ìš”.");
        }
    }

    function giveFeedback(msg) {
        const el = document.getElementById('feedback-area');
        const txt = document.getElementById('ai-feedback');
        el.style.display = 'block';
        txt.textContent = msg;
    }

    function startSimulation() {
        simState = { waterLevel: 0, uvOn: false, oxidized: false }; // Reset
        particles = [];
        
        // Init particles based on topic
        if (db[currentTopic].simType === 'uv') {
            for(let i=0; i<20; i++) particles.push({x: Math.random()*500, y: Math.random()*-200, speed: 2+Math.random()});
        }

        if (animationId) cancelAnimationFrame(animationId);
        animate();
    }

    function stopSimulation() {
        if (animationId) cancelAnimationFrame(animationId);
        ctx.clearRect(0,0,canvas.width, canvas.height);
        
        // Draw static placeholder
        ctx.fillStyle = "#f1f5f9";
        ctx.fillRect(0,0,500,350);
        ctx.fillStyle = "#94a3b8";
        ctx.font = "20px sans-serif";
        ctx.textAlign = "center";
        ctx.fillText("í™”í•™ ì›ë¦¬ ì‹œê°í™” ì˜ì—­", 250, 175);
    }

    function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const type = db[currentTopic].simType;

        if (type === 'sap') {
            // Background
            ctx.fillStyle = "#e2e8f0";
            ctx.fillRect(0,0,500,350);
            
            // Polymer Chains (Mesh)
            ctx.strokeStyle = "#475569";
            ctx.lineWidth = 2;
            const expansion = simState.waterLevel * 20;
            const size = 30 + expansion;
            
            ctx.beginPath();
            for(let x=100 - expansion; x<400+expansion; x+=size) {
                for(let y=100 - expansion; y<250+expansion; y+=size) {
                    ctx.rect(x, y, size, size);
                    // Water molecules inside
                    if(simState.waterLevel > 0) {
                        ctx.fillStyle = "#3b82f6";
                        ctx.beginPath();
                        ctx.arc(x+size/2, y+size/2, 5 * simState.waterLevel, 0, Math.PI*2);
                        ctx.fill();
                    }
                }
            }
            ctx.stroke();
            
            ctx.fillStyle = "#1e293b";
            ctx.font = "16px sans-serif";
            ctx.fillText(simState.waterLevel === 0 ? "ê±´ì¡°í•œ ê³ ë¶„ì ê·¸ë¬¼ êµ¬ì¡°" : "ë¬¼ì„ í¡ìˆ˜í•˜ì—¬ íŒ½ì°½í•œ êµ¬ì¡° (ê²”í™”)", 250, 320);

        } else if (type === 'uv') {
            // Skin
            ctx.fillStyle = "#fca5a5";
            ctx.fillRect(0, 300, 500, 50);
            ctx.fillStyle = "#000"; ctx.fillText("í”¼ë¶€ í‘œë©´", 250, 330);

            // Sunscreen Layer
            ctx.fillStyle = "rgba(255, 255, 255, 0.8)";
            ctx.fillRect(0, 280, 500, 20);
            
            // Particles (TiO2)
            ctx.fillStyle = "white";
            for(let i=0; i<500; i+=25) {
                ctx.beginPath(); ctx.arc(i, 290, 5, 0, Math.PI*2); ctx.fill();
            }

            // UV Rays
            if(simState.uvOn) {
                ctx.strokeStyle = "#facc15"; // Yellow UV
                ctx.lineWidth = 2;
                particles.forEach(p => {
                    p.y += p.speed;
                    
                    // Draw Ray
                    ctx.beginPath();
                    ctx.moveTo(p.x, p.y - 20);
                    ctx.lineTo(p.x, p.y);
                    ctx.stroke();

                    // Bounce logic
                    if(p.y >= 280) {
                        // Reset to top
                        p.y = -20;
                        p.x = Math.random() * 500;
                    }
                });
            } else {
                ctx.fillStyle = "#cbd5e1";
                ctx.fillText("ë²„íŠ¼ì„ ëˆŒëŸ¬ ìì™¸ì„ ì„ ì˜ì„¸ìš”", 250, 150);
            }

        } else if (type === 'coating') {
            // Iron Base
            ctx.fillStyle = "#94a3b8"; // Iron gray
            ctx.fillRect(100, 150, 300, 100);
            ctx.fillStyle = "white"; ctx.fillText("ì²  (Fe)", 250, 200);

            // Tin Coating
            ctx.fillStyle = "#e2e8f0"; // Tin light gray
            ctx.fillRect(95, 145, 310, 110); // Surrounding
            ctx.clearRect(100, 150, 300, 100); // Cut out iron
            
            // Re-draw iron to be behind? No, just frame it.
            ctx.strokeStyle = "#38bdf8"; // Tin color
            ctx.lineWidth = 5;
            ctx.strokeRect(100, 150, 300, 100);
            ctx.fillText("ì£¼ì„ (Sn) ë„ê¸ˆì¸µ", 250, 130);

            if(simState.oxidized) {
                // Oxygen particles
                ctx.fillStyle = "#ef4444"; // Red Oxygen
                for(let i=0; i<10; i++) {
                    ctx.beginPath();
                    ctx.arc(100 + i*30, 140, 5, 0, Math.PI*2);
                    ctx.fill();
                    ctx.fillText("Oâ‚‚", 100 + i*30, 120);
                }
                ctx.fillStyle = "#10b981";
                ctx.fillText("ì£¼ì„ì´ ì‚°ì†Œë¥¼ ë§‰ì•„ ì² ì´ ì•ˆì „í•©ë‹ˆë‹¤!", 250, 300);
            }

        } else if (type === 'sphere') {
             // Paper
             ctx.fillStyle = "#fef08a"; // Postit yellow
             ctx.fillRect(100, 100, 300, 150);
             
             // Adhesive spheres
             ctx.fillStyle = "rgba(0,0,0,0.2)";
             for(let i=0; i<10; i++) {
                 ctx.beginPath();
                 ctx.arc(120 + i*30, 250, 10, 0, Math.PI*2); // Spheres at bottom
                 ctx.fill();
             }
             
             // Zoom view
             ctx.fillStyle = "white";
             ctx.strokeStyle = "#000";
             ctx.beginPath(); ctx.arc(350, 80, 60, 0, Math.PI*2); ctx.fill(); ctx.stroke();
             ctx.fillStyle = "#000";
             ctx.fillText("í™•ëŒ€: êµ¬í˜• ì…ì", 350, 160);
             
             // Draw Single Sphere touching surface
             ctx.beginPath(); ctx.arc(350, 80, 30, 0, Math.PI*2); 
             ctx.fillStyle="rgba(0,0,0,0.5)"; ctx.fill();
             
             ctx.fillStyle = "#1e293b";
             ctx.fillText("ì ‘ì´‰ ë©´ì ì´ ì‘ì•„ ì˜ ë–¨ì–´ì§", 250, 320);
        } else {
             ctx.fillStyle = "#64748b";
             ctx.fillText("ì´ ì£¼ì œëŠ” ëª¨ì‹ë„ë§Œ ì œê³µë©ë‹ˆë‹¤.", 250, 175);
        }

        animationId = requestAnimationFrame(animate);
    }

    // --- Quiz & Report ---
    function checkAnswer() {
        const selected = document.querySelector('input[name="q"]:checked');
        if (!selected) {
            alert("ì •ë‹µì„ ì„ íƒí•´ì£¼ì„¸ìš”!");
            return;
        }
        
        const isCorrect = parseInt(selected.value) === db[currentTopic].quiz.answer;
        const feedbackArea = document.getElementById('feedback-area');
        
        if (isCorrect) {
            giveFeedback("ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰ ì´ ì£¼ì œì˜ íƒêµ¬ë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.");
            progress[currentTopic] = true;
            updateProgress();
        } else {
            giveFeedback("ì•„ì‰½ë„¤ìš”. ë‹¤ì‹œ í•œë²ˆ ì›ë¦¬ë¥¼ ìƒê°í•´ë³¼ê¹Œìš”? íŒíŠ¸: ì‹œë®¬ë ˆì´ì…˜ íƒ­ì„ ë‹¤ì‹œ ë³´ì„¸ìš”.");
        }
    }

    function updateProgress() {
        const completed = Object.values(progress).filter(v => v).length;
        const total = Object.keys(progress).length;
        const percent = Math.round((completed / total) * 100);
        document.getElementById('progress-text').textContent = `ì§„í–‰ë¥ : ${percent}% (${completed}/${total})`;
    }

    function showReport() {
        const completedTopics = Object.keys(progress).filter(k => progress[k]);
        if(completedTopics.length === 0) {
            alert("ì•„ì§ ì™„ë£Œëœ íƒêµ¬ê°€ ì—†ìŠµë‹ˆë‹¤. í€´ì¦ˆë¥¼ í’€ì–´ íƒêµ¬ë¥¼ ì™„ë£Œí•´ì£¼ì„¸ìš”!");
            return;
        }

        let html = `<h3>âœ… ì™„ë£Œí•œ íƒêµ¬ ëª©ë¡</h3><ul>`;
        completedTopics.forEach(topic => {
            html += `<li><strong>${db[topic].title}</strong><br>
            - í•µì‹¬ ì›ë¦¬: ${db[topic].principle}<br>
            - ì‚¬íšŒì  ê°€ì¹˜: ${db[topic].social}</li><br>`;
        });
        html += `</ul>`;
        
        html += `<div style="background:#f8fafc; padding:15px; border-radius:8px; margin-top:20px;">
            <h4>ğŸ‘©â€ğŸ« ì„ ìƒë‹˜ì˜ ì½”ë©˜íŠ¸</h4>
            <p>í™”í•™ì´ ìš°ë¦¬ ìƒí™œì˜ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë° ì–¼ë§ˆë‚˜ ì¤‘ìš”í•œ ì—­í• ì„ í•˜ëŠ”ì§€ ì˜ ì´í•´í–ˆêµ°ìš”! 
            íŠ¹íˆ <strong>${db[completedTopics[0]].title}</strong> ì‚¬ë¡€ë¥¼ í†µí•´ í™”í•™ ë°˜ì‘ê³¼ ì†Œì¬ì˜ íŠ¹ì„±ì„ ì—°ê²°í•œ ì ì´ í›Œë¥­í•©ë‹ˆë‹¤.</p>
        </div>`;

        document.getElementById('report-body').innerHTML = html;
        document.getElementById('reportModal').style.display = 'flex';
    }
</script>

</body>
</html>