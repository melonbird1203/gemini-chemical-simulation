<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³¼í•™ ê°€ìƒì‹¤í—˜: ë•€ì˜ ì¦ë°œê³¼ ì²´ì˜¨ ì¡°ì ˆ</title>
    <style>
        :root { --primary: #3b82f6; --bg: #f3f4f6; --text: #1f2937; }
        body { font-family: 'Malgun Gothic', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        h1 { color: #1e3a8a; margin-bottom: 10px; }
        .container { display: flex; gap: 20px; max-width: 1200px; width: 100%; flex-wrap: wrap; justify-content: center; }
        .panel { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); flex: 1; min-width: 300px; }
        .visual-panel { flex: 2; position: relative; }
        
        /* Controls */
        .control-group { margin-bottom: 20px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; }
        input[type="range"] { width: 100%; }
        select { width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ccc; }
        button { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 16px; width: 100%; transition: 0.2s; }
        button:hover { background: #2563eb; }
        button.reset { background: #ef4444; margin-top: 10px; }

        /* Canvas Areas */
        canvas { background: #e5e7eb; border-radius: 8px; width: 100%; display: block; }
        #simCanvas { height: 300px; cursor: crosshair; position: relative; }
        #graphCanvas { height: 150px; margin-top: 10px; background: #fff; border: 1px solid #ddd; }

        /* Tooltip & Info */
        .info-box { background: #dbeafe; padding: 10px; border-radius: 6px; margin-top: 10px; font-size: 14px; border-left: 4px solid var(--primary); }
        .status-bar { display: flex; justify-content: space-between; margin-top: 10px; font-weight: bold; }
        
        /* Animal Cards */
        .animal-tabs { display: flex; gap: 10px; margin-top: 20px; }
        .animal-tab { padding: 8px 15px; background: #e0e7ff; border-radius: 20px; cursor: pointer; border: 1px solid #c7d2fe; }
        .animal-tab.active { background: var(--primary); color: white; border-color: var(--primary); }
        .animal-content { margin-top: 10px; padding: 15px; background: #f9fafb; border-radius: 8px; display: none; }
        .animal-content.active { display: block; }

    </style>
</head>
<body>

    <h1>ğŸ’§ ë•€ì˜ ì¦ë°œê³¼ ì²´ì˜¨ ë³€í™” ì‹¤í—˜</h1>
    <p>ì¡°ê±´ì„ ì„¤ì •í•˜ê³  "ì‹¤í—˜ ì‹œì‘"ì„ ëˆŒëŸ¬ ì…ìì˜ ì›€ì§ì„ê³¼ ì²´ì˜¨ ë³€í™”ë¥¼ ê´€ì°°í•˜ì„¸ìš”.</p>

    <div class="container">
        <div class="panel">
            <h3>ğŸ›ï¸ ì‹¤í—˜ ì¡°ê±´ ì„¤ì •</h3>
            <div class="control-group">
                <label>ì™¸ë¶€ ì˜¨ë„: <span id="tempVal">30</span>â„ƒ</label>
                <input type="range" id="tempSlider" min="20" max="40" value="30">
            </div>
            <div class="control-group">
                <label>ë•€(ìˆ˜ë¶„)ì˜ ì–‘</label>
                <select id="sweatSelect">
                    <option value="0">ì—†ìŒ (ê±´ì¡°í•œ í”¼ë¶€)</option>
                    <option value="50">ì ìŒ (ì†¡ê¸€ì†¡ê¸€)</option>
                    <option value="150">ë§ìŒ (ë¹„ì˜¤ë“¯ íë¦„)</option>
                </select>
            </div>
            <button onclick="startSimulation()">â–¶ ì‹¤í—˜ ì‹œì‘</button>
            <button class="reset" onclick="resetSimulation()">â†º ì´ˆê¸°í™”</button>

            <div class="info-box" id="feedbackBox">
                ì¤€ë¹„ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì‹¤í—˜ ì¡°ê±´ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.
            </div>
        </div>

        <div class="panel visual-panel">
            <h3>ğŸ”¬ í”¼ë¶€ í‘œë©´ í™•ëŒ€ & ë°ì´í„°</h3>
            <canvas id="simCanvas"></canvas>
            <div class="status-bar">
                <span style="color:red">í˜„ì¬ ì²´ì˜¨: <span id="bodyTempDisplay">36.5</span>â„ƒ</span>
                <span style="color:blue">ì¦ë°œëŸ‰: <span id="evapRateDisplay">0</span>%</span>
            </div>
            
            <h4>ğŸ“ˆ ì²´ì˜¨ ë³€í™” ê·¸ë˜í”„</h4>
            <canvas id="graphCanvas"></canvas>
        </div>
    </div>

    <div class="container">
        <div class="panel">
            <h3>ğŸ¾ ë™ë¬¼ë“¤ì˜ ì²´ì˜¨ ì¡°ì ˆ ë„ê°</h3>
            <div class="animal-tabs">
                <div class="animal-tab active" onclick="showAnimal('human')">ì‚¬ëŒ</div>
                <div class="animal-tab" onclick="showAnimal('dog')">ê°œ</div>
                <div class="animal-tab" onclick="showAnimal('cat')">ê³ ì–‘ì´</div>
                <div class="animal-tab" onclick="showAnimal('kangaroo')">ìº¥ê±°ë£¨</div>
            </div>
            
            <div id="human" class="animal-content active">
                <strong>ì‚¬ëŒ (ë•€ìƒ˜ ë°œë‹¬)</strong><br>
                í”¼ë¶€ ì „ì²´ì— ë•€ìƒ˜ì´ ìˆì–´ ë•€ì´ <strong>ì¦ë°œ</strong>í•˜ë©° ì—´ì„ ë¹¼ì•—ì•„ ê°‘ë‹ˆë‹¤.<br>
                <em>ì›ë¦¬: ì•¡ì²´ â†’ ê¸°ì²´ ìƒíƒœ ë³€í™” (í¡ì—´ ë°˜ì‘)</em>
            </div>
            <div id="dog" class="animal-content">
                <strong>ê°œ (í—ë–¡ì„)</strong><br>
                ë•€ìƒ˜ì´ ê±°ì˜ ì—†ìŠµë‹ˆë‹¤. í˜€ë¥¼ ë‚´ë°€ê³  í—ë–¡ì—¬ í˜€ì˜ ì¹¨ì„ <strong>ì¦ë°œ</strong>ì‹œí‚µë‹ˆë‹¤.<br>
                <em>ì›ë¦¬: í˜¸í¡ì„ í†µí•œ ìˆ˜ë¶„ ì¦ë°œë¡œ ì²´ì˜¨ ìœ ì§€</em>
            </div>
            <div id="cat" class="animal-content">
                <strong>ê³ ì–‘ì´ (ê·¸ë£¨ë°)</strong><br>
                ëª¸ì— ì¹¨ì„ ë¬»íˆëŠ” 'ê·¸ë£¨ë°'ì„ í•©ë‹ˆë‹¤. ì¹¨ì´ <strong>ì¦ë°œ</strong>í•˜ë©´ì„œ í„¸ê³¼ í”¼ë¶€ì˜ ì—´ì„ ì‹í™ë‹ˆë‹¤.<br>
                <em>ì£¼ì˜: ë„ˆë¬´ ë”ìš°ë©´ ê°œêµ¬í˜¸í¡ì„ í•˜ê¸°ë„ í•©ë‹ˆë‹¤.</em>
            </div>
            <div id="kangaroo" class="animal-content">
                <strong>ìº¥ê±°ë£¨ (ì¹¨ ë°”ë¥´ê¸°)</strong><br>
                ì•ë°œì— ì¹¨ì„ ì”ëœ© ë°”ë¦…ë‹ˆë‹¤. ì¹¨ì´ <strong>ì¦ë°œ</strong>í•  ë•Œ í˜ˆê´€ì´ ë§ì€ ì•ë°œì˜ ì˜¨ë„ë¥¼ ë‚®ì¶¥ë‹ˆë‹¤.
            </div>
        </div>
    </div>

<script>
    // Configuration & State
    const simCanvas = document.getElementById('simCanvas');
    const ctx = simCanvas.getContext('2d');
    const graphCanvas = document.getElementById('graphCanvas');
    const gCtx = graphCanvas.getContext('2d');
    
    // Fit canvas resolution
    function resizeCanvas() {
        simCanvas.width = simCanvas.clientWidth;
        simCanvas.height = simCanvas.clientHeight;
        graphCanvas.width = graphCanvas.clientWidth;
        graphCanvas.height = graphCanvas.clientHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    setTimeout(resizeCanvas, 100);

    let isRunning = false;
    let particles = [];
    let time = 0;
    let bodyTemp = 36.5;
    let envTemp = 30;
    let sweatAmount = 0;
    let history = []; // Graph data
    
    // Elements
    const tempSlider = document.getElementById('tempSlider');
    const sweatSelect = document.getElementById('sweatSelect');
    const tempVal = document.getElementById('tempVal');
    const bodyTempDisplay = document.getElementById('bodyTempDisplay');
    const feedbackBox = document.getElementById('feedbackBox');

    tempSlider.oninput = () => tempVal.innerText = tempSlider.value;

    class Particle {
        constructor() {
            this.x = Math.random() * simCanvas.width;
            this.y = simCanvas.height - 20 - Math.random() * 10; // On skin surface
            this.vx = (Math.random() - 0.5) * 2;
            this.vy = (Math.random() - 0.5) * 2; // Vibrating liquid
            this.state = 'liquid'; // liquid or gas
            this.energy = Math.random(); 
            this.color = `rgba(59, 130, 246, 0.8)`; // Blue water
        }

        update(tempForce) {
            if (this.state === 'liquid') {
                // Vibration
                this.x += (Math.random() - 0.5) * 2;
                this.y += (Math.random() - 0.5) * 2;
                
                // Evaporation Logic: Higher temp = higher chance to evaporate
                if (Math.random() < tempForce * 0.005) {
                    this.state = 'gas';
                    this.vy = -2 - Math.random() * 2; // Fly up
                }
            } else {
                // Gas state behavior
                this.y += this.vy;
                this.x += (Math.random() - 0.5) * 4;
                this.vy *= 0.99; // Slightly slow down
                
                // Fade out
                if (this.y < 0) this.y = -100; // Remove logic simplified
            }
        }

        draw() {
            if (this.y < -50) return;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.state === 'liquid' ? 4 : 6, 0, Math.PI * 2);
            ctx.fillStyle = this.state === 'liquid' ? this.color : `rgba(200, 200, 255, 0.4)`;
            ctx.fill();
        }
    }

    function initParticles(amount) {
        particles = [];
        for(let i=0; i<amount; i++) {
            particles.push(new Particle());
        }
    }

    function startSimulation() {
        if (isRunning) return;
        isRunning = true;
        envTemp = parseInt(tempSlider.value);
        let sweatVal = parseInt(sweatSelect.value);
        sweatAmount = sweatVal;
        
        initParticles(sweatVal);
        history = [];
        time = 0;
        bodyTemp = 36.5; // Reset body temp
        
        loop();
        updateFeedback();
    }

    function resetSimulation() {
        isRunning = false;
        particles = [];
        ctx.clearRect(0, 0, simCanvas.width, simCanvas.height);
        gCtx.clearRect(0, 0, graphCanvas.width, graphCanvas.height);
        bodyTemp = 36.5;
        bodyTempDisplay.innerText = "36.5";
        feedbackBox.innerText = "ì¡°ê±´ì„ ì„¤ì •í•˜ê³  ì‹¤í—˜ì„ ì‹œì‘í•´ì£¼ì„¸ìš”.";
    }

    function updateFeedback() {
        if (sweatAmount === 0 && envTemp > 37) {
            feedbackBox.innerHTML = "âš ï¸ <strong>ìœ„í—˜!</strong> ë•€ì´ ë‚˜ì§€ ì•ŠëŠ” ìƒíƒœì—ì„œ ì™¸ë¶€ ì˜¨ë„ê°€ ë†’ìŠµë‹ˆë‹¤. ì²´ì˜¨ì´ ìƒìŠ¹í•  ê²ƒì…ë‹ˆë‹¤.";
        } else if (sweatAmount > 100) {
            feedbackBox.innerHTML = "ğŸ’¡ <strong>ê´€ì°° í¬ì¸íŠ¸:</strong> ë§ì€ ì–‘ì˜ ë•€ ì…ìê°€ ê¸°ì²´ë¡œ ë³€í•˜ë©´ì„œ í”¼ë¶€ì˜ ì—´ì„ ë¹ ë¥´ê²Œ ê°€ì ¸ê°‘ë‹ˆë‹¤. (í¡ì—´ ë°˜ì‘)";
        } else {
            feedbackBox.innerHTML = "ğŸ” <strong>ê´€ì°° ì¤‘:</strong> íŒŒë€ìƒ‰ ì•¡ì²´ ì…ìê°€ ë‚ ì•„ê°€ë©°(ê¸°í™”) í”¼ë¶€ í‘œë©´ì˜ ì˜¨ë„ê°€ ì–´ë–»ê²Œ ë³€í•˜ëŠ”ì§€ ë³´ì„¸ìš”.";
        }
    }

    function loop() {
        if (!isRunning) return;
        
        ctx.clearRect(0, 0, simCanvas.width, simCanvas.height);
        
        // Draw Skin Surface
        let skinColorRed = Math.min(255, 200 + (bodyTemp - 36.5) * 20);
        let skinColorBlue = Math.max(100, 200 - (bodyTemp - 36.5) * 20);
        ctx.fillStyle = `rgb(${skinColorRed}, 150, ${skinColorBlue})`; // Skin color changes with temp
        ctx.fillRect(0, simCanvas.height - 20, simCanvas.width, 20);
        
        // Physics Calculation
        // 1. Heat gain from environment
        let heatGain = (envTemp - bodyTemp) * 0.005;
        
        // 2. Heat loss from evaporation (Endothermic)
        let evaporationCount = particles.filter(p => p.state === 'gas' && p.y > 0).length;
        let activeLiquid = particles.filter(p => p.state === 'liquid').length;
        let coolingFactor = 0;

        // Count new evaporations in this frame (approx)
        let evaporatingNow = 0;
        
        // Update Particles
        let tempForce = (envTemp + bodyTemp) / 2; // Factor affecting evap rate
        particles.forEach(p => {
            let oldState = p.state;
            p.update(tempForce);
            p.draw();
            if (oldState === 'liquid' && p.state === 'gas') evaporatingNow++;
        });

        // Calculate Temperature Change
        // Cooling depends on HOW MANY particles just evaporated (taking energy away)
        coolingFactor = evaporatingNow * 0.02; 
        
        bodyTemp += heatGain;
        bodyTemp -= coolingFactor;
        
        // Limit body temp range for simulation sanity
        if (bodyTemp < 34) bodyTemp = 34; 
        if (bodyTemp > 42) bodyTemp = 42;

        // UI Updates
        bodyTempDisplay.innerText = bodyTemp.toFixed(2);
        document.getElementById('evapRateDisplay').innerText = Math.round((activeLiquid / sweatAmount) * 100) || 0;

        // Graph Logic
        time++;
        if (time % 10 === 0) {
            history.push(bodyTemp);
            drawGraph();
        }

        if (time < 1000) { // Limit run time
            requestAnimationFrame(loop);
        } else {
            isRunning = false;
            feedbackBox.innerHTML = "âœ… ì‹¤í—˜ ì¢…ë£Œ. ê·¸ë˜í”„ë¥¼ ë¶„ì„í•´ë³´ì„¸ìš”. ì²´ì˜¨ì´ ì–´ë–»ê²Œ ë³€í–ˆë‚˜ìš”?";
        }
    }

    function drawGraph() {
        gCtx.clearRect(0, 0, graphCanvas.width, graphCanvas.height);
        gCtx.beginPath();
        gCtx.strokeStyle = "#ef4444";
        gCtx.lineWidth = 2;
        
        let maxVal = 42;
        let minVal = 34;
        let widthStep = graphCanvas.width / 100; // fit 100 points roughly

        history.forEach((val, index) => {
            let x = index * widthStep;
            let y = graphCanvas.height - ((val - minVal) / (maxVal - minVal) * graphCanvas.height);
            if (index === 0) gCtx.moveTo(x, y);
            else gCtx.lineTo(x, y);
        });
        gCtx.stroke();
        
        // Baseline (36.5)
        gCtx.beginPath();
        gCtx.strokeStyle = "#ccc";
        gCtx.setLineDash([5, 5]);
        let baseY = graphCanvas.height - ((36.5 - minVal) / (maxVal - minVal) * graphCanvas.height);
        gCtx.moveTo(0, baseY);
        gCtx.lineTo(graphCanvas.width, baseY);
        gCtx.stroke();
        gCtx.setLineDash([]);
    }

    function showAnimal(id) {
        document.querySelectorAll('.animal-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.animal-content').forEach(c => c.classList.remove('active'));
        
        event.target.classList.add('active');
        document.getElementById(id).classList.add('active');
    }
</script>
</body>
</html>