<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¤‘3 ê³¼í•™ - ì§ˆëŸ‰ ë³´ì¡´ ë²•ì¹™ ê°€ìƒ ì‹¤í—˜</title>
    <style>
        :root {
            --primary: #4A90E2;
            --success: #2ECC71;
            --danger: #E74C3C;
            --bg: #F5F7FA;
            --text: #2C3E50;
        }
        body { font-family: 'Pretendard', sans-serif; margin: 0; padding: 20px; background: var(--bg); color: var(--text); }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: var(--primary); }
        
        /* ì‹¤í—˜ ì œì–´ íŒ¨ë„ */
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; padding: 15px; background: #eef2f7; border-radius: 10px; }
        .control-group { display: flex; flex-direction: column; gap: 10px; }
        label { font-weight: bold; }
        select, button { padding: 10px; border-radius: 5px; border: 1px solid #ccc; font-size: 1rem; cursor: pointer; }
        button.primary { background: var(--primary); color: white; border: none; font-weight: bold; transition: 0.3s; }
        button.primary:hover { background: #357ABD; }
        button:disabled { background: #ccc; cursor: not-allowed; }

        /* ì‹¤í—˜ëŒ€ (Visual Stage) */
        .lab-bench { 
            position: relative; 
            height: 350px; 
            background: #e0e0e0; 
            border-radius: 10px; 
            display: flex; 
            justify-content: center; 
            align-items: flex-end; 
            padding-bottom: 30px; 
            overflow: hidden;
            border-bottom: 5px solid #bbb;
        }

        /* ì €ìš¸ */
        .scale {
            width: 200px;
            height: 60px;
            background: #333;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #0f0;
            font-family: 'Courier New', monospace;
            font-size: 1.5rem;
            position: relative;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            z-index: 10;
        }
        .scale::after { content: 'ELECTRONIC SCALE'; position: absolute; bottom: 2px; font-size: 0.6rem; color: #888; }

        /* í”Œë¼ìŠ¤í¬ ë° ì‹¤í—˜ ê¸°êµ¬ */
        .flask-container {
            position: absolute;
            bottom: 90px; /* ì €ìš¸ ìœ„ */
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.5s;
        }
        .flask {
            width: 80px;
            height: 100px;
            background: rgba(255, 255, 255, 0.4);
            border: 2px solid rgba(100, 100, 100, 0.5);
            border-radius: 40% 40% 5px 5px;
            position: relative;
            overflow: hidden;
        }
        .liquid {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 40px;
            background: #AEC6CF; /* ê¸°ë³¸ ì•¡ì²´ ìƒ‰ */
            transition: background 1s, height 1s;
        }
        .test-tube {
            width: 15px;
            height: 50px;
            background: rgba(255,255,255,0.6);
            border: 1px solid #888;
            border-radius: 0 0 10px 10px;
            position: absolute;
            top: 10px;
            left: 32px;
            z-index: 5;
        }
        .test-tube-liquid {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 30px;
            background: #ffcccc;
            border-radius: 0 0 8px 8px;
        }

        /* ëšœê»‘ */
        .lid {
            width: 40px;
            height: 10px;
            background: #555;
            position: absolute;
            top: -10px;
            left: 20px;
            display: none; /* ê¸°ë³¸ ìˆ¨ê¹€ */
        }

        /* ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ */
        .bubble {
            position: absolute;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            bottom: 0;
            animation: rise 2s infinite ease-in;
        }
        @keyframes rise {
            0% { transform: translateY(0) scale(1); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(-80px) scale(1.5); opacity: 0; }
        }
        
        .precipitate {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 10px;
            background: #fff; /* í°ìƒ‰ ì•™ê¸ˆ */
            opacity: 0;
            transition: opacity 2s;
        }

        /* ê²°ê³¼ ë¶„ì„ ë° ì…ì ëª¨í˜• */
        .analysis-section { margin-top: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .data-log, .particle-model { background: #fff; border: 1px solid #ddd; padding: 15px; border-radius: 10px; height: 200px; overflow-y: auto; }
        .particle-model { display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9rem; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #f2f2f2; }
        
        .feedback-box { grid-column: 1 / -1; padding: 15px; background: #e8f5e9; border-radius: 5px; display: none; }
    </style>
</head>
<body>

<div class="container">
    <h1>âš–ï¸ ì§ˆëŸ‰ ë³´ì¡´ ë²•ì¹™ ê°€ìƒ ì‹¤í—˜ì‹¤</h1>
    <p style="text-align: center; color: #666;">ì‹¤í—˜ ì¡°ê±´ì„ ì„ íƒí•˜ê³  ë°˜ì‘ ì „í›„ì˜ ì§ˆëŸ‰ ë³€í™”ë¥¼ ê´€ì°°í•˜ì„¸ìš”.</p>

    <div class="controls">
        <div class="control-group">
            <label for="reactionType">1. ë°˜ì‘ ì„ íƒ</label>
            <select id="reactionType">
                <option value="precipitate">â‘  ì•™ê¸ˆ ìƒì„± (íƒ„ì‚° ë‚˜íŠ¸ë¥¨ + ì—¼í™” ì¹¼ìŠ˜)</option>
                <option value="gas">â‘¡ ê¸°ì²´ ë°œìƒ (íƒ„ì‚° ìˆ˜ì†Œ ë‚˜íŠ¸ë¥¨ + ì‹ì´ˆ)</option>
            </select>
        </div>
        <div class="control-group">
            <label for="systemType">2. ìš©ê¸° ìƒíƒœ (ê³„)</label>
            <select id="systemType">
                <option value="open">ì—´ë¦° ìš©ê¸° (ëšœê»‘ ì—†ìŒ)</option>
                <option value="closed">ë‹«íŒ ìš©ê¸° (ëšœê»‘ ìˆìŒ)</option>
            </select>
        </div>
    </div>
    <div style="text-align: center; margin-bottom: 20px;">
        <button id="btnMeasure" class="primary" onclick="measureInitial()">ë°˜ì‘ ì „ ì§ˆëŸ‰ ì¸¡ì •</button>
        <button id="btnReact" class="primary" onclick="runReaction()" disabled>ë°˜ì‘ ì‹œì‘ (ì„ê¸°)</button>
        <button id="btnReset" onclick="resetLab()">ì‹¤í—˜ ì´ˆê¸°í™”</button>
    </div>

    <div class="lab-bench">
        <div class="flask-container" id="flaskContainer">
            <div class="lid" id="lid"></div>
            <div class="flask">
                <div class="liquid" id="flaskLiquid"></div>
                <div class="precipitate" id="precipitateLayer"></div>
                <div class="test-tube" id="testTube">
                    <div class="test-tube-liquid" id="tubeLiquid"></div>
                </div>
            </div>
        </div>
        <div class="scale">
            <span id="scaleDisplay">0.0 g</span>
        </div>
    </div>

    <div class="analysis-section">
        <div class="data-log">
            <h3>ğŸ“ ì‹¤í—˜ ê¸°ë¡</h3>
            <table id="resultTable">
                <thead>
                    <tr>
                        <th>ë°˜ì‘ ì¢…ë¥˜</th>
                        <th>ìš©ê¸°</th>
                        <th>ë°˜ì‘ ì „</th>
                        <th>ë°˜ì‘ í›„</th>
                        <th>ê²°ê³¼</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        <div class="particle-model" id="particleArea">
            <h3>âš›ï¸ ì…ì ëª¨í˜• ë³´ê¸°</h3>
            <p style="color:#777; font-size: 0.9rem;">ì‹¤í—˜ì„ ì™„ë£Œí•˜ë©´ ì´ê³³ì— ì…ì ëª¨í˜• ì„¤ëª…ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</p>
        </div>
        <div class="feedback-box" id="feedbackBox"></div>
    </div>
</div>

<script>
    // ìƒíƒœ ë³€ìˆ˜
    let currentMass = 0;
    let isReacted = false;
    let currentReaction = 'precipitate';
    let currentSystem = 'open';
    const initialMassBase = 250.5; // ë¹„ì»¤ + ì‹œì•½ ê¸°ë³¸ ë¬´ê²Œ

    // DOM ìš”ì†Œ
    const scaleDisplay = document.getElementById('scaleDisplay');
    const flaskLiquid = document.getElementById('flaskLiquid');
    const tubeLiquid = document.getElementById('tubeLiquid');
    const testTube = document.getElementById('testTube');
    const lid = document.getElementById('lid');
    const precipitateLayer = document.getElementById('precipitateLayer');
    const feedbackBox = document.getElementById('feedbackBox');
    const particleArea = document.getElementById('particleArea');

    // 1. ì´ˆê¸° ì§ˆëŸ‰ ì¸¡ì •
    function measureInitial() {
        if (isReacted) return;
        
        currentReaction = document.getElementById('reactionType').value;
        currentSystem = document.getElementById('systemType').value;

        // ì‹œê°ì  ì„¤ì •
        lid.style.display = currentSystem === 'closed' ? 'block' : 'none';
        
        // ë°˜ì‘ë¬¼ ìƒ‰ìƒ ì„¤ì •
        if (currentReaction === 'precipitate') {
            flaskLiquid.style.background = '#E0F7FA'; // íƒ„ì‚° ë‚˜íŠ¸ë¥¨ ìˆ˜ìš©ì•¡
            tubeLiquid.style.background = '#E3F2FD'; // ì—¼í™” ì¹¼ìŠ˜ ìˆ˜ìš©ì•¡
        } else {
            flaskLiquid.style.background = '#FFF3E0'; // ì‹ì´ˆ
            tubeLiquid.style.background = '#ffffff'; // íƒ„ì‚° ìˆ˜ì†Œ ë‚˜íŠ¸ë¥¨ (ê³ ì²´ ê°€ë£¨ ëŠë‚Œ)
        }

        // ì§ˆëŸ‰ í‘œì‹œ (ì†Œìˆ˜ì  ì²«ì§¸ìë¦¬)
        currentMass = initialMassBase; 
        // ë‹«íŒ ê³„ì¼ ê²½ìš° ëšœê»‘ ë¬´ê²Œ ì¶”ê°€
        if (currentSystem === 'closed') currentMass += 5.0;

        updateScale(currentMass);
        document.getElementById('btnMeasure').disabled = true;
        document.getElementById('btnReact').disabled = false;
        document.getElementById('reactionType').disabled = true;
        document.getElementById('systemType').disabled = true;

        showFeedback("ì¤€ë¹„ ì™„ë£Œ! ì´ì œ 'ë°˜ì‘ ì‹œì‘' ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‘ ë¬¼ì§ˆì„ ì„ì–´ë³´ì„¸ìš”.");
    }

    // 2. ë°˜ì‘ ì‹¤í–‰
    function runReaction() {
        isReacted = true;
        document.getElementById('btnReact').disabled = true;

        // ì• ë‹ˆë©”ì´ì…˜: ì‹œí—˜ê´€ ê¸°ìš¸ì´ê¸°
        testTube.style.transform = "rotate(130deg) translate(10px, 20px)";
        testTube.style.transition = "transform 1s";

        // ì•¡ì²´ ì„ì„ íš¨ê³¼
        setTimeout(() => {
            tubeLiquid.style.opacity = 0; // ì‹œí—˜ê´€ ë‚´ìš©ë¬¼ ë¹„ìš°ê¸°
            
            if (currentReaction === 'precipitate') {
                handlePrecipitateReaction();
            } else {
                handleGasReaction();
            }
        }, 800);
    }

    // ì•™ê¸ˆ ìƒì„± ë°˜ì‘ ë¡œì§
    function handlePrecipitateReaction() {
        flaskLiquid.style.background = "#E0F7FA"; 
        precipitateLayer.style.opacity = 1; // í°ìƒ‰ ì•™ê¸ˆ ìƒì„±
        
        finishReaction(currentMass, "ì§ˆëŸ‰ ë³€í™” ì—†ìŒ");
        showParticleModel("precipitate");
    }

    // ê¸°ì²´ ë°œìƒ ë°˜ì‘ ë¡œì§
    function handleGasReaction() {
        flaskLiquid.style.background = "#FFE0B2"; // ë°˜ì‘ í›„ ìƒ‰
        createBubbles(); // ê±°í’ˆ ì• ë‹ˆë©”ì´ì…˜

        let finalMass = currentMass;
        let resultText = "ì§ˆëŸ‰ ë³€í™” ì—†ìŒ";

        if (currentSystem === 'open') {
            // ì—´ë¦° ê³„ì—ì„œëŠ” ê¸°ì²´ê°€ ë‚ ì•„ê°€ ì§ˆëŸ‰ ê°ì†Œ (ì•½ 1.5g ê°ì†Œ ì„¤ì •)
            finalMass = currentMass - 1.5;
            resultText = "ì§ˆëŸ‰ ê°ì†Œ (ê¸°ì²´ íƒˆì¶œ)";
            
            // ì €ìš¸ ì„œì„œíˆ ê°ì†Œí•˜ëŠ” ì• ë‹ˆë©”ì´ì…˜
            let tempMass = currentMass;
            const interval = setInterval(() => {
                tempMass -= 0.1;
                updateScale(tempMass);
                if (tempMass <= finalMass) clearInterval(interval);
            }, 100);
        } else {
            // ë‹«íŒ ê³„
            updateScale(finalMass);
        }

        setTimeout(() => {
            finishReaction(finalMass, resultText);
            showParticleModel("gas", currentSystem);
        }, 2000);
    }

    // ê²°ê³¼ ì²˜ë¦¬
    function finishReaction(finalVal, resultMsg) {
        const table = document.getElementById('resultTable').querySelector('tbody');
        const row = table.insertRow();
        
        let rName = currentReaction === 'precipitate' ? 'ì•™ê¸ˆ ìƒì„±' : 'ê¸°ì²´ ë°œìƒ';
        let sName = currentSystem === 'open' ? 'ì—´ë¦° ìš©ê¸°' : 'ë‹«íŒ ìš©ê¸°';
        let initialDisplay = currentSystem === 'closed' ? (initialMassBase + 5).toFixed(1) : initialMassBase.toFixed(1);

        row.innerHTML = `
            <td>${rName}</td>
            <td>${sName}</td>
            <td>${initialDisplay} g</td>
            <td style="font-weight:bold; color:${finalVal < parseFloat(initialDisplay) ? 'red' : 'green'}">${finalVal.toFixed(1)} g</td>
            <td>${resultMsg}</td>
        `;

        let feedback = "";
        if (currentReaction === 'gas' && currentSystem === 'open') {
            feedback = "âš ï¸ <strong>ì§ˆëŸ‰ì´ ì¤„ì–´ë“¤ì—ˆë‚˜ìš”?</strong><br>ìƒì„±ëœ ì´ì‚°í™” íƒ„ì†Œ ê¸°ì²´ê°€ ê³µê¸° ì¤‘ìœ¼ë¡œ ë‚ ì•„ê°”ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ì‚¬ë¼ì§„ ê¸°ì²´ì˜ ì§ˆëŸ‰ê¹Œì§€ í•©ì¹˜ë©´ ì „ì²´ ì§ˆëŸ‰ì€ ë³´ì¡´ë©ë‹ˆë‹¤.";
        } else {
            feedback = "âœ… <strong>ì§ˆëŸ‰ì´ ë³€í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!</strong><br>í™”í•™ ë°˜ì‘ì´ ì¼ì–´ë‚˜ë„ ì›ìì˜ ì¢…ë¥˜ì™€ ìˆ˜ëŠ” ë³€í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì „ì²´ ì§ˆëŸ‰ì€ ë³´ì¡´ë©ë‹ˆë‹¤.";
        }
        showFeedback(feedback);
    }

    // ê¸°ì²´ ê±°í’ˆ ìƒì„± (ì‹œê° íš¨ê³¼)
    function createBubbles() {
        const flask = document.querySelector('.flask');
        for(let i=0; i<10; i++) {
            let b = document.createElement('div');
            b.className = 'bubble';
            b.style.left = Math.random() * 60 + 10 + 'px';
            b.style.width = Math.random() * 5 + 5 + 'px';
            b.style.height = b.style.width;
            b.style.animationDuration = (Math.random() * 1 + 1) + 's';
            flask.appendChild(b);
            
            // ê¸°ì²´ê°€ ë‚ ì•„ê°€ëŠ” íš¨ê³¼ (ì—´ë¦° ê³„ì¼ ë•Œë§Œ í™”ë©´ ë°–ìœ¼ë¡œ)
            if (currentSystem === 'open') {
                setTimeout(() => b.remove(), 1000);
            } else {
                // ë‹«íŒ ê³„ë©´ ëšœê»‘ì— ë¶€ë”ªí˜€ ì‚¬ë¼ì§
                setTimeout(() => b.remove(), 1000); 
            }
        }
    }

    // ì…ì ëª¨í˜• ì‹œê°í™” (SVG/ì„¤ëª…)
    function showParticleModel(type, system) {
        let content = "";
        if (type === 'precipitate') {
            content = `
                <div style="font-size:2rem;">âšªâš« + ğŸ”µğŸ”´ â†’ âšªğŸ”´(â†“) + ğŸ”µâš«</div>
                <p><strong>ì•™ê¸ˆ ìƒì„± ë°˜ì‘ì‹:</strong><br>Naâ‚‚COâ‚ƒ + CaClâ‚‚ â†’ CaCOâ‚ƒ(â†“) + 2NaCl</p>
                <p>ì›ìë“¤ì€ íŒŒíŠ¸ë„ˆë§Œ ë°”ê¾¸ì—ˆì„ ë¿, ì‚¬ë¼ì§€ê±°ë‚˜ ìƒˆë¡œ ìƒê¸°ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
            `;
        } else {
            let extra = system === 'open' ? "<br><span style='color:red'>(ê°œë°©ê³„: ê¸°ì²´ ë¶„ìê°€ ìš©ê¸° ë°–ìœ¼ë¡œ íƒˆì¶œ!)</span>" : "";
            content = `
                <div style="font-size:2rem;">ğŸŸ âšª + ğŸŸ£ â†’ âš«âšªâšª(g) + ğŸ’§</div>
                <p><strong>ê¸°ì²´ ë°œìƒ ë°˜ì‘ì‹:</strong><br>NaHCOâ‚ƒ + HAc â†’ COâ‚‚ + Hâ‚‚O + NaAc</p>
                <p>ë°œìƒí•œ ì´ì‚°í™” íƒ„ì†Œ(COâ‚‚) ë¶„ìë„ ì§ˆëŸ‰ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.${extra}</p>
            `;
        }
        particleArea.innerHTML = content;
    }

    function updateScale(val) {
        scaleDisplay.innerText = val.toFixed(1) + " g";
    }

    function showFeedback(msg) {
        feedbackBox.style.display = 'block';
        feedbackBox.innerHTML = msg;
    }

    function resetLab() {
        isReacted = false;
        document.getElementById('btnMeasure').disabled = false;
        document.getElementById('btnReact').disabled = true;
        document.getElementById('reactionType').disabled = false;
        document.getElementById('systemType').disabled = false;
        
        // ì‹œê°í™” ì´ˆê¸°í™”
        testTube.style.transform = "rotate(0deg)";
        tubeLiquid.style.opacity = 1;
        flaskLiquid.style.background = "#AEC6CF";
        precipitateLayer.style.opacity = 0;
        document.querySelectorAll('.bubble').forEach(b => b.remove());
        
        scaleDisplay.innerText = "0.0 g";
        feedbackBox.style.display = 'none';
        particleArea.innerHTML = "<h3>âš›ï¸ ì…ì ëª¨í˜• ë³´ê¸°</h3><p style='color:#777;'>ì‹¤í—˜ì„ ì™„ë£Œí•˜ë©´ ì´ê³³ì— ì…ì ëª¨í˜• ì„¤ëª…ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</p>";
    }
</script>

</body>
</html>