<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ìƒ ì‹¤í—˜: ë³´ì¼ ë²•ì¹™ ì‹œë®¬ë ˆì´ì…˜</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #4a90e2;
            --bg-color: #f5f7fa;
            --container-bg: #ffffff;
            --text-color: #333;
        }
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 { margin-bottom: 10px; color: var(--primary-color); }
        .experiment-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            max-width: 1200px;
            width: 100%;
            background: var(--container-bg);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        /* Left Panel: Control & Visual */
        .control-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .visual-area {
            position: relative;
            height: 400px;
            background: #eef2f7;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            overflow: hidden;
            border: 2px solid #ccc;
        }
        .syringe-body {
            width: 150px;
            background: rgba(255, 255, 255, 0.8);
            border: 3px solid #555;
            border-bottom: 5px solid #555;
            border-radius: 0 0 10px 10px;
            position: relative;
            transition: height 0.5s ease-out;
            overflow: hidden; /* Keep particles inside */
        }
        .piston {
            width: 144px;
            height: 20px;
            background: #888;
            position: absolute;
            top: 0;
            left: 3px;
        }
        .piston-rod {
            width: 20px;
            height: 400px;
            background: #aaa;
            position: absolute;
            bottom: 20px;
            left: 65px;
        }
        .weight-plate {
            width: 100px;
            height: 10px;
            background: #333;
            position: absolute;
            bottom: 420px; /* Adjust via JS */
            left: 25px;
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
            color: white;
            font-size: 12px;
        }
        .weight {
            width: 60px;
            height: 20px;
            background: #d32f2f;
            margin-bottom: 2px;
            border-radius: 3px;
            text-align: center;
            line-height: 20px;
            color: white;
            font-size: 10px;
        }
        
        /* Particle Canvas */
        #particleCanvas {
            position: absolute;
            bottom: 0;
            left: 0;
        }

        .controls {
            padding: 15px;
            background: #f0f8ff;
            border-radius: 10px;
            border-left: 5px solid var(--primary-color);
        }
        input[type=range] { width: 100%; cursor: pointer; }

        /* Right Panel: Data & Graphs */
        .data-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .chart-container {
            height: 200px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }
        .data-table th, .data-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        .data-table th { background-color: #f2f2f2; }

        .quiz-section {
            grid-column: 1 / -1;
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            display: none; /* Show after some interaction */
        }

        .btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
        .btn:hover { background: #357abd; }

    </style>
</head>
<body>

    <h1>ğŸ§ª ë³´ì¼ ë²•ì¹™ ê°€ìƒ ì‹¤í—˜ì‹¤</h1>
    <p>ì••ë ¥ì„ ë³€í™”ì‹œì¼œ ê¸°ì²´ì˜ ë¶€í”¼ê°€ ì–´ë–»ê²Œ ë³€í•˜ëŠ”ì§€ ê´€ì°°í•´ë³´ì„¸ìš”.</p>

    <div class="experiment-container">
        <div class="control-panel">
            <div class="visual-area" id="visualArea">
                <div class="syringe-body" id="syringe">
                    <canvas id="particleCanvas"></canvas>
                    <div class="piston" id="piston">
                        <div class="piston-rod">
                            <div class="weight-plate" id="weightPlate"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="controls">
                <label for="pressureSlider"><strong>ì••ë ¥ (Pressure) ì¡°ì ˆ:</strong> <span id="pressureValue">1.0</span> atm</label>
                <input type="range" id="pressureSlider" min="0.2" max="3.0" step="0.2" value="1.0">
                <p style="font-size: 0.9em; color: #666;">ğŸ’¡ ìŠ¬ë¼ì´ë”ë¥¼ ì›€ì§ì´ë©´ ì¶”ì˜ ê°œìˆ˜ê°€ ë³€í•©ë‹ˆë‹¤.</p>
                <div>
                    <strong>í˜„ì¬ ë¶€í”¼ (Volume):</strong> <span id="volumeValue">0</span> mL
                </div>
                <button class="btn" onclick="recordData()">í˜„ì¬ ë°ì´í„° ê¸°ë¡í•˜ê¸°</button>
            </div>
        </div>

        <div class="data-panel">
            <div class="chart-container">
                <canvas id="pvChart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="pInvVChart"></canvas>
            </div>
            <div style="overflow-y: auto; max-height: 150px;">
                <table class="data-table" id="dataTable">
                    <thead>
                        <tr>
                            <th>ì‹œë„</th>
                            <th>ì••ë ¥ (P)</th>
                            <th>ë¶€í”¼ (V)</th>
                            <th>P Ã— V</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </div>
        </div>

        <div class="quiz-section" id="quizSection">
            <h3>ğŸ¤” ìƒê°í•´ë³´ê¸°</h3>
            <p>ì••ë ¥ì´ 2ë°°ë¡œ ì¦ê°€í–ˆì„ ë•Œ, ë¶€í”¼ëŠ” ì–´ë–»ê²Œ ë³€í–ˆë‚˜ìš”?</p>
            <div id="quizFeedback" style="font-weight: bold; color: #d32f2f;"></div>
            <button class="btn" onclick="checkAnswer('decrease')">1/2ë¡œ ê°ì†Œí–ˆë‹¤</button>
            <button class="btn" onclick="checkAnswer('increase')">2ë°°ë¡œ ì¦ê°€í–ˆë‹¤</button>
            <button class="btn" onclick="checkAnswer('same')">ë³€í•˜ì§€ ì•Šì•˜ë‹¤</button>
        </div>
    </div>

    <script>
        // --- ìƒìˆ˜ ë° ë³€ìˆ˜ ì„¤ì • ---
        const CONSTANT_K = 100; // PV = 100 (ì˜ˆì‹œ ìƒìˆ˜)
        const syringeWidth = 150;
        const maxSyringeHeight = 350;
        
        let currentPressure = 1.0;
        let currentVolume = 100;
        let trialCount = 0;
        let recordedData = [];

        // DOM ìš”ì†Œ
        const slider = document.getElementById('pressureSlider');
        const pValDisplay = document.getElementById('pressureValue');
        const vValDisplay = document.getElementById('volumeValue');
        const syringe = document.getElementById('syringe');
        const weightPlate = document.getElementById('weightPlate');
        const canvas = document.getElementById('particleCanvas');
        const ctx = canvas.getContext('2d');
        const tableBody = document.querySelector('#dataTable tbody');
        const quizSection = document.getElementById('quizSection');

        // --- ì…ì ì• ë‹ˆë©”ì´ì…˜ ì„¤ì • ---
        const particles = [];
        const numParticles = 30; // ì…ì ê°œìˆ˜
        
        class Particle {
            constructor() {
                this.x = Math.random() * (syringeWidth - 10) + 5;
                this.y = Math.random() * (currentVolume * 3) + 5; // Scaling factor approximation
                this.vx = (Math.random() - 0.5) * 4;
                this.vy = (Math.random() - 0.5) * 4;
                this.radius = 3;
            }

            update(heightLimit) {
                this.x += this.vx;
                this.y += this.vy;

                // ë²½ ì¶©ëŒ (ì¢Œìš°)
                if (this.x - this.radius < 0 || this.x + this.radius > syringeWidth) {
                    this.vx *= -1;
                }
                
                // ë²½ ì¶©ëŒ (ìƒí•˜) - ìœ„ìª½ì€ í”¼ìŠ¤í†¤(heightLimit), ì•„ë˜ìª½ì€ ë°”ë‹¥(max)
                // ì¢Œí‘œê³„: ìº”ë²„ìŠ¤ëŠ” ìœ„ê°€ 0ì´ì§€ë§Œ, CSSë¡œ ì•„ë˜ ê³ ì •. 
                // ì‹œê°ì ìœ¼ë¡œ ìº”ë²„ìŠ¤ì˜ ë†’ì´ëŠ” ì£¼ì‚¬ê¸° ë†’ì´ì™€ ê°™ìŒ.
                if (this.y - this.radius < 0) {
                    this.y = this.radius;
                    this.vy *= -1;
                }
                if (this.y + this.radius > heightLimit) {
                    this.y = heightLimit - this.radius;
                    this.vy *= -1;
                }
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = "#ff5722";
                ctx.fill();
                ctx.closePath();
            }
        }

        // ì´ˆê¸° ì…ì ìƒì„±
        for(let i=0; i<numParticles; i++) {
            particles.push(new Particle());
        }

        // --- ì°¨íŠ¸ ì„¤ì • (Chart.js) ---
        const pvCtx = document.getElementById('pvChart').getContext('2d');
        const pvChart = new Chart(pvCtx, {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'P-V ê·¸ë˜í”„ (ë°˜ë¹„ë¡€)',
                    data: [],
                    backgroundColor: 'rgba(74, 144, 226, 1)',
                    borderColor: 'rgba(74, 144, 226, 1)',
                    showLine: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { title: { display: true, text: 'ì••ë ¥ (atm)' }, min: 0, max: 3.5 },
                    y: { title: { display: true, text: 'ë¶€í”¼ (mL)' }, min: 0 }
                }
            }
        });

        const pInvCtx = document.getElementById('pInvVChart').getContext('2d');
        const pInvChart = new Chart(pInvCtx, {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'P - 1/V ê·¸ë˜í”„ (ë¹„ë¡€)',
                    data: [],
                    backgroundColor: 'rgba(255, 99, 132, 1)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    showLine: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { title: { display: true, text: 'ì••ë ¥ (atm)' }, min: 0, max: 3.5 },
                    y: { title: { display: true, text: '1 / ë¶€í”¼ (1/mL)' }, min: 0 }
                }
            }
        });

        // --- ë©”ì¸ ë¡œì§ ---

        function updateSimulation() {
            // 1. ê°’ ê³„ì‚° (ë³´ì¼ ë²•ì¹™: V = k / P)
            currentPressure = parseFloat(slider.value);
            currentVolume = (CONSTANT_K / currentPressure).toFixed(1);

            // 2. í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            pValDisplay.innerText = currentPressure.toFixed(1);
            vValDisplay.innerText = currentVolume;

            // 3. ì£¼ì‚¬ê¸° ì‹œê°í™” (ë†’ì´ ì¡°ì ˆ)
            // ë¶€í”¼ 100ml -> ë†’ì´ 300px ê°€ì •
            const visualHeight = currentVolume * 3; 
            syringe.style.height = `${visualHeight}px`;
            
            // ìº”ë²„ìŠ¤ í¬ê¸° ì¡°ì •
            canvas.width = syringeWidth;
            canvas.height = visualHeight;

            // 4. ì¶”(Weight) ì‹œê°í™”
            weightPlate.innerHTML = '';
            // 0.2 atm ë‹¹ ì¶” 1ê°œë¼ê³  ê°€ì • (ê°„ì†Œí™”)
            const numWeights = Math.round(currentPressure * 5); 
            for(let i=0; i<numWeights; i++) {
                const w = document.createElement('div');
                w.className = 'weight';
                w.innerText = "0.2";
                weightPlate.appendChild(w);
            }
        }

        function animate() {
            // ìº”ë²„ìŠ¤ ì§€ìš°ê¸°
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ì…ì ì—…ë°ì´íŠ¸ ë° ê·¸ë¦¬ê¸°
            particles.forEach(p => {
                p.update(canvas.height);
                p.draw();
            });

            requestAnimationFrame(animate);
        }

        function recordData() {
            trialCount++;
            const p = parseFloat(currentPressure);
            const v = parseFloat(currentVolume);
            const k = (p * v).toFixed(1);

            // í‘œì— ì¶”ê°€
            const row = `<tr>
                <td>${trialCount}</td>
                <td>${p}</td>
                <td>${v}</td>
                <td>${k}</td>
            </tr>`;
            tableBody.innerHTML += row;

            // ê·¸ë˜í”„ ë°ì´í„° ì¶”ê°€
            pvChart.data.datasets[0].data.push({x: p, y: v});
            // ë°ì´í„° ì •ë ¬ (ì„ ì„ ì˜ˆì˜ê²Œ ê·¸ë¦¬ê¸° ìœ„í•´ xì¶• ê¸°ì¤€ ì •ë ¬)
            pvChart.data.datasets[0].data.sort((a, b) => a.x - b.x);
            pvChart.update();

            // P vs 1/V ê·¸ë˜í”„ (ë³´í†µ 1/P vs V ë˜ëŠ” P vs 1/V ì‚¬ìš©. ì—¬ê¸°ì„œëŠ” P vs 1/Vë¡œ ì„ í˜• í™•ì¸)
            // ì„±ì·¨ê¸°ì¤€ì— ë§ì¶° êµê³¼ì„œì ìœ¼ë¡œëŠ” 1/P(x) - V(y)ê°€ ì›ì ì„ í†µê³¼í•˜ëŠ” ì§ì„ ì„.
            // ì—¬ê¸°ì„œëŠ” P(x) - 1/V(y) ë„ ì§ì„ ì´ ë¨.
            pInvChart.data.datasets[0].data.push({x: p, y: 1/v});
            pInvChart.data.datasets[0].data.sort((a, b) => a.x - b.x);
            pInvChart.update();

            // 3íšŒ ì´ìƒ ì¸¡ì • ì‹œ í€´ì¦ˆ í‘œì‹œ
            if(trialCount >= 3) {
                quizSection.style.display = 'block';
            }
        }

        function checkAnswer(ans) {
            const feedback = document.getElementById('quizFeedback');
            if (ans === 'decrease') {
                feedback.innerText = "ì •ë‹µì…ë‹ˆë‹¤! ğŸ‘ ì••ë ¥ê³¼ ë¶€í”¼ëŠ” ë°˜ë¹„ë¡€ ê´€ê³„ì…ë‹ˆë‹¤.";
                feedback.style.color = "green";
            } else {
                feedback.innerText = "ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”. ì…ìë“¤ì´ ì¢ì€ ê³µê°„ì— ê°‡íˆë©´ ì–´ë–»ê²Œ ë ê¹Œìš”?";
                feedback.style.color = "#d32f2f";
            }
        }

        // ì´ˆê¸°í™” ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        slider.addEventListener('input', updateSimulation);
        updateSimulation(); // ì´ˆê¸° ì‹¤í–‰
        animate(); // ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘

    </script>
</body>
</html>