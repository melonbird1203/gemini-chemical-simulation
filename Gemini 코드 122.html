<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ìƒ ì‹¤í—˜: ì–´ëŠ”ì  ë‚´ë¦¼ê³¼ ë¶„ìëŸ‰ ì¸¡ì •</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #f5f7fa;
            --accent-color: #e74c3c;
            --text-color: #2c3e50;
            --success-color: #27ae60;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #ecf0f1;
            color: var(--text-color);
            line-height: 1.6;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 2rem;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }

        .panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        h2 { border-bottom: 2px solid var(--secondary-color); padding-bottom: 10px; margin-top: 0; font-size: 1.2rem; }
        h3 { font-size: 1.1rem; margin-top: 15px; margin-bottom: 5px; color: #555; }

        /* Controls */
        .control-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem; }
        select, input[type="number"], input[type="range"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-sizing: border-box;
        }
        
        .slider-val { float: right; color: var(--primary-color); font-weight: bold; }

        button {
            width: 100%;
            padding: 12px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.2s;
            margin-top: 10px;
        }
        button:hover { background-color: #357abd; }
        button.secondary { background-color: #95a5a6; }
        button.check-btn { background-color: var(--success-color); margin-top: 5px;}

        /* Visualization */
        .vis-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            height: 350px;
        }
        
        #particleCanvas {
            width: 100%;
            height: 100%;
            background: #eef2f3;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .chart-wrapper {
            position: relative;
            height: 100%;
            width: 100%;
            background: white;
            border-radius: 8px;
            border: 1px solid #ddd;
            padding: 10px;
            box-sizing: border-box;
        }

        /* Results & Analysis */
        .results-area {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .formula-box {
            background: var(--secondary-color);
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            text-align: center;
            border: 1px dashed #bdc3c7;
        }

        .calc-input {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }
        .calc-input input { width: 80px; }

        .feedback {
            margin-top: 10px;
            padding: 10px;
            border-radius: 6px;
            font-weight: bold;
            display: none;
        }
        .feedback.correct { background-color: #d4edda; color: #155724; }
        .feedback.wrong { background-color: #f8d7da; color: #721c24; }
        .feedback.info { background-color: #d1ecf1; color: #0c5460; }

        /* Responsive */
        @media (max-width: 768px) {
            .container { grid-template-columns: 1fr; }
            .vis-container { grid-template-columns: 1fr; height: auto; }
            #particleCanvas { height: 250px; }
            .chart-wrapper { height: 250px; }
            .results-area { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<header>
    <h1>ğŸ§ª ì–´ëŠ”ì  ë‚´ë¦¼ê³¼ ë¶„ìëŸ‰ ì¸¡ì • ì‹¤í—˜</h1>
    <p>í™”í•™â…¡: ë¬½ì€ ìš©ì•¡ì˜ ì´ê´„ì„± í•™ìŠµ ì‹œë®¬ë ˆì´ì…˜</p>
</header>

<div class="container">
    <div class="panel">
        <h2>1. ì‹¤í—˜ ì„¤ê³„</h2>
        
        <div class="control-group">
            <label for="solventType">ìš©ë§¤ ì„ íƒ (Solvent)</label>
            <select id="solventType">
                <option value="water">ë¬¼ (K_f = 1.86 â„ƒ/m)</option>
                <option value="benzene">ë²¤ì   (K_f = 5.12 â„ƒ/m)</option>
            </select>
            <small style="color:red; display:none;" id="benzeneWarning">âš ï¸ ë²¤ì  ì€ ë…ì„±ì´ ìˆìœ¼ë¯€ë¡œ í›„ë“œ ë‚´ì—ì„œ ì·¨ê¸‰í•˜ì„¸ìš”!</small>
        </div>

        <div class="control-group">
            <label>ìš©ë§¤ ì§ˆëŸ‰ (W) <span class="slider-val" id="solventMassVal">100g</span></label>
            <input type="range" id="solventMass" min="50" max="200" step="10" value="100">
        </div>

        <div class="control-group">
            <label for="soluteType">ë¯¸ì§€ ìš©ì§ˆ ì„ íƒ (Solute)</label>
            <select id="soluteType">
                <option value="A">ë¯¸ì§€ ì‹œë£Œ A (ê³ ì²´ ë¶„ë§)</option>
                <option value="B">ë¯¸ì§€ ì‹œë£Œ B (í°ìƒ‰ ê²°ì •)</option>
                <option value="C">ë¯¸ì§€ ì‹œë£Œ C (ì„¤íƒ• ëª¨ì–‘)</option>
            </select>
        </div>

        <div class="control-group">
            <label>ìš©ì§ˆ ì§ˆëŸ‰ (w) <span class="slider-val" id="soluteMassVal">0g</span></label>
            <input type="range" id="soluteMass" min="0" max="30" step="1" value="0">
        </div>

        <button id="startBtn" onclick="startExperiment()">â„ï¸ ëƒ‰ê° ì‹¤í—˜ ì‹œì‘</button>
        <button class="secondary" onclick="resetExperiment()">ğŸ”„ ì´ˆê¸°í™”</button>
    </div>

    <div class="panel">
        <h2>2. ì‹¤í—˜ ê´€ì°°</h2>
        <div class="vis-container">
            <div style="position: relative;">
                <canvas id="particleCanvas"></canvas>
                <div style="position: absolute; top: 10px; left: 10px; background: rgba(255,255,255,0.8); padding: 5px; border-radius: 4px; font-size: 0.8rem;">
                    ğŸ”µ ìš©ë§¤ ì…ì<br>ğŸ”´ ìš©ì§ˆ ì…ì
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="tempChart"></canvas>
            </div>
        </div>
        <div style="margin-top: 10px; text-align: center;">
            í˜„ì¬ ì˜¨ë„: <span id="currentTemp" style="font-weight: bold; font-size: 1.2rem;">25.0</span> â„ƒ 
            <span id="stateStatus" style="margin-left: 10px; font-size: 0.9rem; color: #777;">(ì•¡ì²´)</span>
        </div>
    </div>

    <div class="panel results-area">
        <div>
            <h2>3. ë°ì´í„° ë¶„ì„</h2>
            <p>ëƒ‰ê° ê³¡ì„ ì—ì„œ í‰í‰í•´ì§€ëŠ” êµ¬ê°„(ì–´ëŠ”ì )ì„ ì°¾ì•„ ì…ë ¥í•˜ì„¸ìš”.</p>
            
            <div class="calc-input">
                <label>ìˆœìˆ˜í•œ ìš©ë§¤ ì–´ëŠ”ì  ($T_0$):</label>
                <input type="number" id="pureFpInput" step="0.1" placeholder="â„ƒ">
            </div>
            <div class="calc-input">
                <label>ìš©ì•¡ì˜ ì–´ëŠ”ì  ($T_f$):</label>
                <input type="number" id="solutionFpInput" step="0.1" placeholder="â„ƒ">
            </div>
            
            <div class="feedback info" id="dtResult" style="display:block; margin-bottom:10px;">
                ì–´ëŠ”ì  ë‚´ë¦¼($\Delta T_f$) = ?
            </div>
            
            <button class="check-btn" onclick="checkFreezingPoint()">ë°ì´í„° í™•ì¸</button>
        </div>

        <div>
            <h2>4. ê²°ë¡  ë° í‰ê°€</h2>
            <div class="formula-box">
                $$ M = \frac{K_f \times w \times 1000}{\Delta T_f \times W} $$
            </div>
            <p>ìœ„ ê³µì‹ì„ ì´ìš©í•˜ì—¬ ë¯¸ì§€ ì‹œë£Œì˜ ë¶„ìëŸ‰ì„ ê³„ì‚°í•´ë³´ì„¸ìš”.</p>
            
            <div class="calc-input">
                <label>ê³„ì‚°ëœ ë¶„ìëŸ‰(M):</label>
                <input type="number" id="mwInput" placeholder="g/mol">
            </div>
            <div class="control-group">
                <label>ì´ ë¬¼ì§ˆì€ ë¬´ì—‡ì¼ê¹Œìš”?</label>
                <select id="guessMaterial">
                    <option value="">ë¬¼ì§ˆ ì„ íƒ...</option>
                    <option value="60">ìš”ì†Œ (MW: 60)</option>
                    <option value="180">í¬ë„ë‹¹ (MW: 180)</option>
                    <option value="342">ì„¤íƒ• (MW: 342)</option>
                    <option value="128">ë‚˜í”„íƒˆë Œ (MW: 128)</option>
                </select>
            </div>
            
            <button class="check-btn" onclick="checkConclusion()">ê²°ê³¼ ì œì¶œ ë° ì •ë‹µ í™•ì¸</button>
            <div id="finalFeedback" class="feedback"></div>
        </div>
    </div>
</div>

<script>
    // Constants & State
    const SOLVENTS = {
        water: { name: 'ë¬¼', kf: 1.86, fp: 0.0, color: '#3498db', density: 1.0 },
        benzene: { name: 'ë²¤ì  ', kf: 5.12, fp: 5.5, color: '#e67e22', density: 0.88 }
    };

    const SOLUTES = {
        A: { mw: 180, name: 'í¬ë„ë‹¹' }, // Glucose
        B: { mw: 60, name: 'ìš”ì†Œ' },    // Urea
        C: { mw: 342, name: 'ì„¤íƒ•' }    // Sucrose
    };

    let state = {
        running: false,
        time: 0,
        temp: 25.0,
        solvent: 'water',
        solute: 'A',
        w: 0, // solute mass
        W: 100, // solvent mass
        currentFp: 0,
        history: [],
        particles: []
    };

    // Chart Setup
    let chart;
    const ctxChart = document.getElementById('tempChart').getContext('2d');

    function initChart() {
        if(chart) chart.destroy();
        chart = new Chart(ctxChart, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'ì˜¨ë„ (â„ƒ)',
                    data: [],
                    borderColor: '#e74c3c',
                    tension: 0.4,
                    pointRadius: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: false,
                scales: {
                    y: { title: { display: true, text: 'ì˜¨ë„ (â„ƒ)' }, min: -5, max: 30 },
                    x: { title: { display: true, text: 'ì‹œê°„ (s)' } }
                }
            }
        });
    }

    // Input Listeners
    document.getElementById('solventMass').addEventListener('input', (e) => {
        document.getElementById('solventMassVal').innerText = e.target.value + 'g';
        state.W = parseFloat(e.target.value);
    });
    document.getElementById('soluteMass').addEventListener('input', (e) => {
        document.getElementById('soluteMassVal').innerText = e.target.value + 'g';
        state.w = parseFloat(e.target.value);
        if(state.w > 0) initParticles();
    });
    document.getElementById('solventType').addEventListener('change', (e) => {
        state.solvent = e.target.value;
        document.getElementById('benzeneWarning').style.display = (state.solvent === 'benzene') ? 'block' : 'none';
        initParticles();
    });
    document.getElementById('soluteType').addEventListener('change', (e) => state.solute = e.target.value);

    // Particle System
    const canvas = document.getElementById('particleCanvas');
    const ctx = canvas.getContext('2d');
    
    function resizeCanvas() {
        canvas.width = canvas.parentElement.offsetWidth;
        canvas.height = canvas.parentElement.offsetHeight;
    }
    window.addEventListener('resize', resizeCanvas);

    function initParticles() {
        resizeCanvas();
        state.particles = [];
        // Add Solvent Particles (Blue)
        const solventCount = 50;
        for(let i=0; i<solventCount; i++) {
            state.particles.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                vx: (Math.random() - 0.5) * 2,
                vy: (Math.random() - 0.5) * 2,
                type: 'solvent',
                r: 4
            });
        }
        // Add Solute Particles (Red)
        const soluteCount = Math.floor(state.w * 1.5); // Visual representation
        for(let i=0; i<soluteCount; i++) {
            state.particles.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                vx: (Math.random() - 0.5) * 1.5,
                vy: (Math.random() - 0.5) * 1.5,
                type: 'solute',
                r: 6
            });
        }
    }

    function drawParticles() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Speed factor based on temp (Freezing stops movement)
        let speedFactor = (state.temp + 10) / 35; 
        if(state.temp <= state.currentFp) speedFactor = 0.1; // Solid state vibration

        state.particles.forEach(p => {
            if(state.running || speedFactor > 0.1) {
                p.x += p.vx * speedFactor;
                p.y += p.vy * speedFactor;

                // Bounce
                if(p.x < 0 || p.x > canvas.width) p.vx *= -1;
                if(p.y < 0 || p.y > canvas.height) p.vy *= -1;
            } else {
                // Vibrate in place if frozen
                p.x += (Math.random()-0.5) * 0.5;
                p.y += (Math.random()-0.5) * 0.5;
            }

            ctx.beginPath();
            ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
            ctx.fillStyle = p.type === 'solvent' ? SOLVENTS[state.solvent].color : '#e74c3c';
            ctx.fill();
            
            // Draw connections if frozen (Lattice visual)
            if(state.temp <= state.currentFp && p.type === 'solvent') {
                ctx.strokeStyle = "rgba(255,255,255,0.3)";
                ctx.stroke();
            }
        });

        // Overlay text based on state
        if(state.temp <= state.currentFp) {
            ctx.fillStyle = "rgba(0,0,0,0.5)";
            ctx.fillRect(0,0,canvas.width, canvas.height);
            ctx.fillStyle = "white";
            ctx.font = "20px Arial";
            ctx.textAlign = "center";
            ctx.fillText("ì‘ê³ ë¨ (Solid)", canvas.width/2, canvas.height/2);
        }

        requestAnimationFrame(drawParticles);
    }

    // Experiment Logic
    function calculateTrueValues() {
        const solv = SOLVENTS[state.solvent];
        const solu = SOLUTES[state.solute];
        
        // Molality (m) = (w / MW) / (W / 1000)
        const moles = state.w / solu.mw;
        const kgSolvent = state.W / 1000;
        const molality = moles / kgSolvent;
        
        const dt = solv.kf * molality;
        const fp = solv.fp - dt;
        
        return { fp, dt, molality };
    }

    function startExperiment() {
        if(state.running) return;
        
        // Reset Visuals
        state.time = 0;
        state.temp = 25.0;
        state.history = [];
        initChart();
        
        const trueVals = calculateTrueValues();
        state.currentFp = trueVals.fp;
        state.running = true;
        
        document.getElementById('startBtn').disabled = true;
        document.getElementById('soluteMass').disabled = true;
        document.getElementById('solventMass').disabled = true;

        const loop = setInterval(() => {
            if(!state.running) {
                clearInterval(loop);
                return;
            }

            state.time += 1;
            
            // Simulation Logic: Cooling
            // Newton's law of cooling approximation + Phase transition plateau
            if(state.temp > state.currentFp) {
                // Liquid phase cooling
                state.temp -= 0.2 + (Math.random() * 0.05); 
            } else if (state.temp > state.currentFp - 0.5) {
                // Phase change plateau (Freezing)
                // Supercooling effect slight visualization could be added here, keeping simple for now
                state.temp = state.currentFp + (Math.random() * 0.1 - 0.05);
            } else {
                // Solid phase cooling
                 state.temp -= 0.1;
            }

            // Update UI
            document.getElementById('currentTemp').innerText = state.temp.toFixed(1);
            if(state.temp <= state.currentFp + 0.1) {
                document.getElementById('stateStatus').innerText = "(ì‘ê³  ì¤‘)";
            } else {
                document.getElementById('stateStatus').innerText = "(ì•¡ì²´)";
            }

            // Update Chart
            chart.data.labels.push(state.time);
            chart.data.datasets[0].data.push(state.temp);
            
            // Dynamic Scale
            if(state.temp < chart.options.scales.y.min) {
                chart.options.scales.y.min = state.temp - 2;
            }
            chart.update();

            // End condition
            if(state.time > 100 || state.temp < state.currentFp - 3) {
                state.running = false;
                document.getElementById('startBtn').disabled = false;
                document.getElementById('soluteMass').disabled = false;
                document.getElementById('solventMass').disabled = false;
                alert("ì‹¤í—˜ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ë˜í”„ë¥¼ ë³´ê³  ì–´ëŠ”ì ì„ ë¶„ì„í•´ë³´ì„¸ìš”.");
            }

        }, 100); // 100ms update rate
    }

    function resetExperiment() {
        state.running = false;
        state.temp = 25.0;
        document.getElementById('currentTemp').innerText = "25.0";
        initChart();
        document.getElementById('finalFeedback').style.display = 'none';
        document.getElementById('dtResult').innerText = "ì–´ëŠ”ì  ë‚´ë¦¼ = ?";
        document.getElementById('dtResult').className = "feedback info";
        
        // Clear inputs
        document.querySelectorAll('.calc-input input').forEach(i => i.value = '');
    }

    // Analysis Logic
    function checkFreezingPoint() {
        const t0 = parseFloat(document.getElementById('pureFpInput').value);
        const tf = parseFloat(document.getElementById('solutionFpInput').value);
        const feedback = document.getElementById('dtResult');
        
        if(isNaN(t0) || isNaN(tf)) {
            alert("ì˜¨ë„ ê°’ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }

        const userDt = t0 - tf;
        const trueVals = calculateTrueValues();
        
        // Allow error margin of 0.5
        const isCorrectT0 = Math.abs(t0 - SOLVENTS[state.solvent].fp) < 0.5;
        const isCorrectTf = Math.abs(tf - trueVals.fp) < 0.5;

        if(isCorrectT0 && isCorrectTf) {
            feedback.innerHTML = `ì •í™•í•©ë‹ˆë‹¤! <br> ì–´ëŠ”ì  ë‚´ë¦¼($\\Delta T_f$) : <strong>${userDt.toFixed(2)}â„ƒ</strong>`;
            feedback.className = "feedback correct";
        } else {
            let msg = "ê°’ì´ ì¡°ê¸ˆ ë‹¤ë¦…ë‹ˆë‹¤. <br>";
            if(!isCorrectT0) msg += `- ìˆœìˆ˜í•œ ${SOLVENTS[state.solvent].name}ì˜ ì–´ëŠ”ì ì„ ë‹¤ì‹œ í™•ì¸í•˜ì„¸ìš”.<br>`;
            if(!isCorrectTf) msg += `- ê·¸ë˜í”„ì—ì„œ ì˜¨ë„ê°€ ì¼ì •í•˜ê²Œ ìœ ì§€ë˜ëŠ” êµ¬ê°„ì„ ì°¾ì•„ë³´ì„¸ìš”.`;
            feedback.innerHTML = msg;
            feedback.className = "feedback wrong";
        }
    }

    function checkConclusion() {
        const userMw = parseFloat(document.getElementById('mwInput').value);
        const guess = document.getElementById('guessMaterial').value;
        const feedback = document.getElementById('finalFeedback');
        
        const trueMw = SOLUTES[state.solute].mw;
        
        if(isNaN(userMw) || !guess) {
            alert("ê³„ì‚°ëœ ë¶„ìëŸ‰ê³¼ ì˜ˆìƒ ë¬¼ì§ˆì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.");
            return;
        }

        // Calculate Error
        const error = Math.abs((userMw - trueMw) / trueMw * 100);
        
        let html = "";
        let isSuccess = false;

        if (error < 10) {
            html += `âœ… <strong>í›Œë¥­í•©ë‹ˆë‹¤!</strong> ê³„ì‚°ëœ ë¶„ìëŸ‰ì´ ì‹¤ì œ ê°’(${trueMw})ê³¼ ê±°ì˜ ì¼ì¹˜í•©ë‹ˆë‹¤. (ì˜¤ì°¨: ${error.toFixed(1)}%)<br>`;
            isSuccess = true;
        } else {
            html += `âš ï¸ <strong>ê³„ì‚°ì„ ë‹¤ì‹œ í™•ì¸í•´ë³´ì„¸ìš”.</strong><br>ê³µì‹ì— ëŒ€ì…í•œ ê°’ë“¤($K_f, w, W, \\Delta T_f$) ë‹¨ìœ„ë¥¼ ì ê²€í•´ë³´ì„¸ìš”.<br>`;
        }

        if(isSuccess && parseInt(guess) === trueMw) {
            html += `ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤! ë¯¸ì§€ ì‹œë£ŒëŠ” <strong>${SOLUTES[state.solute].name}</strong>ì˜€ìŠµë‹ˆë‹¤.`;
            feedback.className = "feedback correct";
        } else if (isSuccess) {
            html += `â“ ë¶„ìëŸ‰ ê³„ì‚°ì€ ë§ì•˜ì§€ë§Œ, ë¬¼ì§ˆ ì¶”ë¡ ì´ í‹€ë ¸ìŠµë‹ˆë‹¤. ë¶„ìëŸ‰ ${trueMw}ì¸ ë¬¼ì§ˆì„ ë‹¤ì‹œ ì„ íƒí•´ë³´ì„¸ìš”.`;
            feedback.className = "feedback info";
        } else {
             feedback.className = "feedback wrong";
        }
        
        feedback.style.display = 'block';
        feedback.innerHTML = html;
    }

    // Initialize
    initParticles();
    drawParticles();
    initChart();
</script>

</body>
</html>