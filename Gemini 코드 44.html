<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¬¼ì§ˆì˜ íŠ¹ì„±: ì–´ëŠ”ì  ê°€ìƒ ì‹¤í—˜</title>
    <style>
        :root { --primary: #4a90e2; --bg: #f5f7fa; --text: #333; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        h1 { color: var(--primary); margin-bottom: 10px; }
        .container { display: flex; gap: 20px; max-width: 1000px; width: 100%; flex-wrap: wrap; }
        .panel { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); flex: 1; min-width: 300px; }
        
        /* Controls */
        .control-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; }
        select, button { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; margin-bottom: 5px; cursor: pointer; }
        button { background: var(--primary); color: white; border: none; font-weight: bold; transition: 0.3s; }
        button:hover { background: #357abd; }
        button.reset { background: #e74c3c; }

        /* Visualization */
        .lab-view { display: flex; justify-content: space-around; align-items: center; height: 200px; background: #eef2f7; border-radius: 8px; position: relative; }
        .test-tube { width: 40px; height: 120px; border: 2px solid #555; border-radius: 0 0 20px 20px; border-top: none; position: relative; background: rgba(255,255,255,0.5); overflow: hidden; }
        .chemical { width: 100%; height: 60%; position: absolute; bottom: 0; transition: background 1s; }
        .thermometer { width: 6px; height: 140px; background: #ccc; position: absolute; left: 50%; top: 20px; transform: translateX(-50%); border-radius: 3px; }
        .mercury { width: 100%; background: red; position: absolute; bottom: 0; transition: height 0.2s; }
        
        /* Particle View */
        .particle-box { width: 100px; height: 100px; border: 2px dashed #aaa; border-radius: 50%; position: relative; overflow: hidden; background: #fff; margin-top: 10px; }
        .particle { width: 8px; height: 8px; background: var(--primary); border-radius: 50%; position: absolute; }
        
        /* Graph */
        canvas { width: 100%; height: 300px; background: #fff; border: 1px solid #eee; }

        .status-display { text-align: center; font-size: 1.2em; font-weight: bold; margin-top: 10px; color: #555; }
        .data-readout { display: flex; justify-content: space-between; font-family: monospace; font-size: 1.1em; margin-top: 10px; }
    </style>
</head>
<body>

    <h1>â„ï¸ ì–´ëŠ”ì  ì¸¡ì • ê°€ìƒ ì‹¤í—˜ì‹¤</h1>
    <p>ë¬¼ì§ˆì˜ ì¢…ë¥˜ì™€ ì§ˆëŸ‰ì„ ì„ íƒí•˜ê³  ëƒ‰ê°ì‹œì¼œë³´ì„¸ìš”.</p>

    <div class="container">
        <div class="panel" style="flex: 0.8;">
            <h2>âš™ï¸ ì‹¤í—˜ ì„¤ì •</h2>
            <div class="control-group">
                <label>ì‹œë£Œ ì„ íƒ</label>
                <select id="substance">
                    <option value="lauric">ë¡œë¥´ì‚° (ì˜ˆìƒ ì–´ëŠ”ì : ???)</option>
                    <option value="palmitic">íŒ”ë¯¸íŠ¸ì‚° (ì˜ˆìƒ ì–´ëŠ”ì : ???)</option>
                    <option value="unknown">ë¯¸ì§€ì˜ ë¬¼ì§ˆ A</option>
                </select>
            </div>
            <div class="control-group">
                <label>ì‹œë£Œì˜ ì§ˆëŸ‰</label>
                <select id="mass">
                    <option value="1">1g (ì ì€ ì–‘)</option>
                    <option value="2">2g (ë§ì€ ì–‘)</option>
                </select>
            </div>
            <div class="control-group">
                <label>ëƒ‰ê° ì†ë„</label>
                <select id="speed">
                    <option value="1">ìì—° ëƒ‰ê° (ë³´í†µ)</option>
                    <option value="2">ê¸‰ì† ëƒ‰ê° (ë¹ ë¦„)</option>
                </select>
            </div>
            <button onclick="startExperiment()" id="startBtn">ì‹¤í—˜ ì‹œì‘ â–¶</button>
            <button onclick="resetExperiment()" class="reset">ì´ˆê¸°í™” â†º</button>
            
            <div class="status-display" id="stateText">ìƒíƒœ: ì¤€ë¹„ ë¨</div>
            <div class="data-readout">
                <span id="timeDisplay">ì‹œê°„: 0s</span>
                <span id="tempDisplay">ì˜¨ë„: 80.0Â°C</span>
            </div>
        </div>

        <div class="panel">
            <h2>ğŸ‘€ ê´€ì°°: ì…ìì™€ ì˜¨ë„</h2>
            <div class="lab-view">
                <div style="text-align:center;">
                    <div class="test-tube">
                        <div class="chemical" id="chemicalFill" style="background: #aaccff;"></div>
                        <div class="thermometer"><div class="mercury" id="mercuryHeight" style="height: 80%;"></div></div>
                    </div>
                    <small>ì‹œí—˜ê´€</small>
                </div>
                
                <div style="text-align:center;">
                    <div class="particle-box" id="particleBox">
                        </div>
                    <small>ì…ì ë°°ì—´ (í™•ëŒ€)</small>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="panel">
            <h2>ğŸ“‰ ì˜¨ë„-ì‹œê°„ ê·¸ë˜í”„</h2>
            <canvas id="graphCanvas" width="800" height="300"></canvas>
            <p id="analysis-feedback" style="color: blue; font-weight: bold; margin-top: 10px;"></p>
        </div>
    </div>

<script>
    // ì‹¤í—˜ ë°ì´í„° ë° ìƒìˆ˜
    const SUBSTANCES = {
        'lauric': { name: 'ë¡œë¥´ì‚°', fp: 44, colorLiq: '#fdfd96', colorSol: '#ffffff' },
        'palmitic': { name: 'íŒ”ë¯¸íŠ¸ì‚°', fp: 63, colorLiq: '#ffcccb', colorSol: '#ffe4e1' },
        'unknown': { name: 'ë¯¸ì§€ì˜ ë¬¼ì§ˆ A', fp: 54, colorLiq: '#e0ffff', colorSol: '#f0ffff' } // ì˜ˆ: ë¯¸ë¦¬ìŠ¤í‹´ì‚° ê·¼ì‚¬ì¹˜
    };

    let isRunning = false;
    let timer = null;
    let time = 0;
    let temp = 80;
    let currentSubstance = null;
    let currentMass = 1;
    let coolingFactor = 1;
    
    // ìƒíƒœ ë³€í™” ë¡œì§ ë³€ìˆ˜
    let latentHeatDuration = 0; 
    let maxLatentHeat = 0;

    // ê·¸ë˜í”„ ë°ì´í„°
    let dataPoints = [];

    // ì´ˆê¸°í™”
    window.onload = () => {
        initParticles();
        drawGraph();
    };

    function initParticles() {
        const box = document.getElementById('particleBox');
        box.innerHTML = '';
        for(let i=0; i<15; i++) {
            let p = document.createElement('div');
            p.className = 'particle';
            p.style.left = Math.random() * 80 + 'px';
            p.style.top = Math.random() * 80 + 'px';
            box.appendChild(p);
        }
    }

    function startExperiment() {
        if(isRunning) return;
        
        const subKey = document.getElementById('substance').value;
        currentSubstance = SUBSTANCES[subKey];
        currentMass = parseFloat(document.getElementById('mass').value);
        const speedVal = parseFloat(document.getElementById('speed').value);

        // ì´ˆê¸° ì„¤ì •
        isRunning = true;
        document.getElementById('startBtn').disabled = true;
        document.getElementById('substance').disabled = true;
        document.getElementById('mass').disabled = true;
        
        time = 0;
        temp = 80; // ì‹œì‘ ì˜¨ë„
        dataPoints = [{t:0, temp:80}];
        
        // ì§ˆëŸ‰ì´ í´ìˆ˜ë¡ ìƒíƒœ ë³€í™” ì‹œê°„ì´ ê¸¸ì–´ì§ (ì ì—´ êµ¬ê°„)
        // ëƒ‰ê° ì†ë„ê°€ ë¹ ë¥´ë©´ ë¹¨ë¦¬ ì‹ìŒ
        maxLatentHeat = (currentMass * 100) / speedVal; 
        latentHeatDuration = maxLatentHeat;
        coolingFactor = (0.5 * speedVal) / currentMass; // ì§ˆëŸ‰ì´ í¬ë©´ ì²œì²œíˆ ì‹ìŒ

        document.getElementById('analysis-feedback').innerText = "ì‹¤í—˜ ì¤‘... ê·¸ë˜í”„ì˜ ê¸°ìš¸ê¸°ì™€ í‰í‰í•œ êµ¬ê°„ì„ ê´€ì°°í•˜ì„¸ìš”.";

        timer = setInterval(updateExperiment, 100);
    }

    function updateExperiment() {
        time += 0.5; // ê°€ìƒ ì‹œê°„ 0.5ì´ˆì”© ì¦ê°€

        // ì˜¨ë„ ê³„ì‚° ë¡œì§ (ë‰´í„´ì˜ ëƒ‰ê° ë²•ì¹™ ë‹¨ìˆœí™” + ìƒíƒœ ë³€í™”)
        let targetTemp = 20; // ì‹¤ë‚´ ì˜¨ë„
        let diff = temp - targetTemp;

        // ì–´ëŠ”ì  ë„ë‹¬ ì‹œ ë¡œì§
        if (temp <= currentSubstance.fp + 0.5 && temp >= currentSubstance.fp - 0.5 && latentHeatDuration > 0) {
            // ìƒíƒœ ë³€í™” êµ¬ê°„ (ì˜¨ë„ ìœ ì§€)
            temp = currentSubstance.fp + (Math.random() * 0.2 - 0.1); // ì•½ê°„ì˜ ë…¸ì´ì¦ˆ ì¶”ê°€
            latentHeatDuration -= 1;
            document.getElementById('stateText').innerText = "ìƒíƒœ: ì‘ê³  ì¤‘ (ì•¡ì²´+ê³ ì²´)";
            updateParticles('solidifying');
        } else {
            // ì¼ë°˜ ëƒ‰ê° êµ¬ê°„
            if (latentHeatDuration <= 0) {
                // ì™„ì „íˆ ê³ ì²´ê°€ ëœ í›„
                document.getElementById('stateText').innerText = "ìƒíƒœ: ê³ ì²´";
                updateParticles('solid');
                document.getElementById('chemicalFill').style.background = currentSubstance.colorSol;
            } else {
                // ì•„ì§ ì•¡ì²´
                document.getElementById('stateText').innerText = "ìƒíƒœ: ì•¡ì²´";
                updateParticles('liquid');
                document.getElementById('chemicalFill').style.background = currentSubstance.colorLiq;
            }
            temp -= (diff * 0.02 * coolingFactor);
        }

        // ë°ì´í„° ê¸°ë¡
        if (time % 1 === 0) dataPoints.push({t: time, temp: temp});
        
        // í™”ë©´ ì—…ë°ì´íŠ¸
        updateUI();
        drawGraph();

        // ì¢…ë£Œ ì¡°ê±´
        if (time > 120 || temp <= 25) {
            stopExperiment();
        }
    }

    function stopExperiment() {
        clearInterval(timer);
        isRunning = false;
        document.getElementById('startBtn').innerText = "ì‹¤í—˜ ì™„ë£Œ";
        analyzeResult();
    }

    function resetExperiment() {
        clearInterval(timer);
        isRunning = false;
        time = 0;
        temp = 80;
        dataPoints = [];
        document.getElementById('startBtn').disabled = false;
        document.getElementById('startBtn').innerText = "ì‹¤í—˜ ì‹œì‘ â–¶";
        document.getElementById('substance').disabled = false;
        document.getElementById('mass').disabled = false;
        document.getElementById('analysis-feedback').innerText = "";
        document.getElementById('stateText').innerText = "ìƒíƒœ: ì¤€ë¹„ ë¨";
        drawGraph();
        initParticles();
    }

    function updateUI() {
        document.getElementById('timeDisplay').innerText = `ì‹œê°„: ${Math.floor(time)}s`;
        document.getElementById('tempDisplay').innerText = `ì˜¨ë„: ${temp.toFixed(1)}Â°C`;
        
        // ì˜¨ë„ê³„ ë†’ì´ ì¡°ì ˆ (0~100ë„ ê¸°ì¤€)
        document.getElementById('mercuryHeight').style.height = `${temp}%`;
    }

    function updateParticles(state) {
        const particles = document.querySelectorAll('.particle');
        particles.forEach(p => {
            if(state === 'liquid') {
                // í™œë°œí•œ ì›€ì§ì„
                p.style.transform = `translate(${Math.random()*10-5}px, ${Math.random()*10-5}px)`;
            } else if (state === 'solidifying') {
                // ì ì°¨ ëŠë ¤ì§
                p.style.transform = `translate(${Math.random()*4-2}px, ${Math.random()*4-2}px)`;
            } else {
                // ì œìë¦¬ ì§„ë™ (ê³ ì²´)
                p.style.transform = `translate(${Math.random()*2-1}px, ${Math.random()*2-1}px)`;
            }
        });
    }

    function drawGraph() {
        const canvas = document.getElementById('graphCanvas');
        const ctx = canvas.getContext('2d');
        const width = canvas.width;
        const height = canvas.height;

        // ë°°ê²½ ë° ì¶•
        ctx.fillStyle = '#fff';
        ctx.fillRect(0,0,width,height);
        ctx.strokeStyle = '#eee';
        ctx.beginPath();
        // ê²©ì ê·¸ë¦¬ê¸° ìƒëµ(ê°„ì†Œí™”)
        
        // ì¶• ê·¸ë¦¬ê¸°
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(40, 10); ctx.lineTo(40, height-30); // Yì¶•
        ctx.moveTo(40, height-30); ctx.lineTo(width-10, height-30); // Xì¶•
        ctx.stroke();

        // ë°ì´í„° ê·¸ë¦¬ê¸°
        if(dataPoints.length < 2) return;

        ctx.strokeStyle = '#4a90e2';
        ctx.lineWidth = 3;
        ctx.beginPath();
        
        // Xì¶•: 0~120ì´ˆ, Yì¶•: 20~100ë„ ë§¤í•‘
        const mapX = (t) => 40 + (t / 120) * (width - 60);
        const mapY = (tmp) => height - 30 - ((tmp - 20) / 80) * (height - 40);

        ctx.moveTo(mapX(dataPoints[0].t), mapY(dataPoints[0].temp));
        
        for(let i=1; i<dataPoints.length; i++) {
            ctx.lineTo(mapX(dataPoints[i].t), mapY(dataPoints[i].temp));
        }
        ctx.stroke();
    }

    function analyzeResult() {
        let msg = `ì‹¤í—˜ ê²°ê³¼: ${currentSubstance.name}ì˜ ì–´ëŠ”ì ì€ ì•½ ${currentSubstance.fp}Â°Cì—ì„œ ê´€ì°°ë˜ì—ˆìŠµë‹ˆë‹¤. `;
        if(currentMass == 2) {
            msg += "ì§ˆëŸ‰ì´ 2gìœ¼ë¡œ ëŠ˜ì–´ë‚¬ì§€ë§Œ, ìˆ˜í‰ êµ¬ê°„ì˜ ì˜¨ë„ëŠ” ë³€í•˜ì§€ ì•Šê³  ì‹œê°„ë§Œ ê¸¸ì–´ì¡ŒìŠµë‹ˆë‹¤.";
        } else {
            msg += "ì§ˆëŸ‰ê³¼ ê´€ê³„ì—†ì´ ë¬¼ì§ˆì˜ ê³ ìœ í•œ ì–´ëŠ”ì ì€ ì¼ì •í•©ë‹ˆë‹¤.";
        }
        document.getElementById('analysis-feedback').innerText = msg;
    }
</script>
</body>
</html>