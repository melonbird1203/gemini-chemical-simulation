<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ìƒ í™”í•™ ì‹¤í—˜ì‹¤: ì€ë„ê¸ˆê³¼ ì „ê¸° ë¶„í•´</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #50c878;
            --bg-color: #f4f7f6;
            --panel-bg: #ffffff;
            --text-color: #333;
            --danger-color: #e74c3c;
        }

        body {
            font-family: 'Pretendard', 'Malgun Gothic', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
            max-width: 800px;
        }

        h1 { margin: 0; color: var(--primary-color); }
        .subtitle { font-size: 0.9rem; color: #666; margin-top: 5px; }

        .container {
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 20px;
            max-width: 1200px;
            width: 100%;
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        /* ì™¼ìª½ ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .controls {
            padding: 15px;
            background: #f9f9f9;
            border-radius: 10px;
        }
        
        .control-group { margin-bottom: 20px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 0.9rem; }
        input[type="range"] { width: 100%; }
        
        .value-display { float: right; color: var(--primary-color); font-weight: bold; }

        button {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            margin-bottom: 10px;
            transition: 0.2s;
        }
        .btn-start { background-color: var(--primary-color); color: white; }
        .btn-reset { background-color: #95a5a6; color: white; }
        .btn-start:hover { background-color: #357abd; }

        /* ì¤‘ì•™ ì‹¤í—˜ í™”ë©´ */
        .simulation-area {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #fff;
            border: 1px solid #eee;
            border-radius: 10px;
            height: 500px;
            overflow: hidden;
        }

        /* ë¹„ì»¤ì™€ ì „ê·¹ ì‹œê°í™” */
        #beaker {
            width: 200px;
            height: 250px;
            border-bottom: 3px solid #ccc;
            border-left: 3px solid #ccc;
            border-right: 3px solid #ccc;
            border-radius: 0 0 20px 20px;
            position: relative;
            background: linear-gradient(to bottom, rgba(200, 240, 255, 0.3), rgba(0, 150, 255, 0.1));
            margin-top: 50px;
        }

        .liquid {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 80%;
            background: rgba(0, 255, 255, 0.1);
            border-radius: 0 0 15px 15px;
        }

        /* ì „ê·¹ */
        .electrode {
            position: absolute;
            top: -40px;
            width: 20px;
            height: 150px;
            transition: background-color 0.5s;
        }
        
        #anode { 
            left: 40px; 
            background: silver; /* ì€íŒ */
            border: 1px solid #999;
        }
        
        #cathode { 
            right: 40px; 
            width: 40px; /* íœë˜íŠ¸ ëª¨ì–‘ì„ ìœ„í•´ ë„“ê²Œ */
            height: 120px;
            background: #b87333; /* êµ¬ë¦¬ìƒ‰ */
            border-radius: 50% 50% 10px 10px; /* ìˆŸê°€ë½/íœë˜íŠ¸ ëª¨ì–‘ */
            border: 1px solid #8d5524;
        }

        /* ì „ì„  ë° ë°°í„°ë¦¬ */
        .wire {
            position: absolute;
            top: 20px;
            height: 2px;
            background: #333;
            z-index: 10;
        }
        .wire-left { left: 50%; width: 140px; transform: translateX(-110px); }
        .wire-right { left: 50%; width: 140px; transform: translateX(-30px); }
        
        .battery {
            position: absolute;
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 30px;
            background: #eee;
            border: 2px solid #333;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* ì…ì ì• ë‹ˆë©”ì´ì…˜ (ì „ì, ì´ì˜¨) */
        .particle {
            position: absolute;
            border-radius: 50%;
            font-size: 10px;
            font-weight: bold;
            pointer-events: none;
            opacity: 0;
        }
        .electron { color: yellow; background: red; width: 12px; height: 12px; display: flex; align-items: center; justify-content: center; font-size: 8px;}
        .ion { color: white; background: blue; width: 16px; height: 16px; display: flex; align-items: center; justify-content: center; font-size: 9px; }

        /* ì˜¤ë¥¸ìª½ ê²°ê³¼ ë° í€´ì¦ˆ */
        .info-panel {
            padding: 15px;
            background: #f0f8ff;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .data-box {
            background: white;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        
        .reaction-eq {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            background: #eef;
            padding: 5px;
            border-radius: 3px;
            margin: 5px 0;
            font-size: 0.9rem;
        }

        .graph-container {
            height: 150px;
            background: white;
            border: 1px solid #ddd;
            position: relative;
            display: flex;
            align-items: flex-end;
            padding: 5px;
        }
        .graph-bar {
            width: 100%;
            background: silver;
            transition: height 0.5s;
            max-height: 100%;
        }

        .quiz-box {
            background: #fff3cd;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ffeeba;
        }
        .quiz-options button {
            margin: 2px;
            font-size: 0.8rem;
            padding: 5px;
            width: auto;
        }

        /* íˆ´íŒ ë° ì•ˆë‚´ */
        .tooltip {
            position: absolute;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            pointer-events: none;
        }

        @keyframes moveElectronLeft {
            0% { transform: translate(0, 0); opacity: 1; }
            100% { transform: translate(100px, -50px); opacity: 0; }
        }
    </style>
</head>
<body>

    <header>
        <h1>ğŸ§ª ì€ë„ê¸ˆ ì‹¤í—˜ì‹¤ (Electroplating)</h1>
        <div class="subtitle">ê³ ë“±í•™êµ í™”í•™ II - ì „ê¸° í™”í•™: ì „ê¸° ë¶„í•´ì˜ ì›ë¦¬</div>
    </header>

    <div class="container">
        <div class="controls">
            <h3>ğŸ›ï¸ ì‹¤í—˜ ì¡°ê±´ ì„¤ì •</h3>
            
            <div class="control-group">
                <label>ì „ë¥˜ ì„¸ê¸° (A) <span id="val-current" class="value-display">1.0 A</span></label>
                <input type="range" id="input-current" min="0.5" max="5.0" step="0.5" value="1.0">
            </div>

            <div class="control-group">
                <label>ë°˜ì‘ ì‹œê°„ (ê°€ìƒ ë¶„) <span id="val-time" class="value-display">0 ë¶„</span></label>
                <div style="font-size:0.8rem; color:#666;">* ì‹œë®¬ë ˆì´ì…˜ ì†ë„: 1ì´ˆ = 10ë¶„</div>
            </div>

            <div class="control-group">
                <label>ì „í•´ì§ˆ ë†ë„ (M)</label>
                <select id="input-conc" style="width:100%; padding:5px;">
                    <option value="0.1">0.1 M KAg(CN)â‚‚ (ë¬½ìŒ)</option>
                    <option value="0.5" selected>0.5 M KAg(CN)â‚‚ (í‘œì¤€)</option>
                    <option value="1.0">1.0 M KAg(CN)â‚‚ (ì§„í•¨)</option>
                </select>
            </div>

            <button class="btn-start" id="btn-toggle">ì‹¤í—˜ ì‹œì‘ (Start)</button>
            <button class="btn-reset" id="btn-reset">ì´ˆê¸°í™” (Reset)</button>

            <div style="margin-top: 20px; font-size: 0.85rem; background:#eee; padding:10px; border-radius:5px;">
                <strong>âš ï¸ ì•ˆì „ ë…¸íŠ¸:</strong><br>
                ì‹¤ì œ ì‹¤í—˜ì—ì„œëŠ” ì‹œì•ˆí™”ë¬¼(CN)ì´ ë§¹ë…ì„±ì´ë¯€ë¡œ, í•™êµì—ì„œëŠ” ì•ˆì „í•œ ì§ˆì‚°ì€($AgNO_3$) ìˆ˜ìš©ì•¡ì„ ì£¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ ì‹œë®¬ë ˆì´ì…˜ì€ ì‚°ì—… ê³µì • ì›ë¦¬ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.
            </div>
        </div>

        <div class="simulation-area" id="sim-area">
            <div class="battery">+ ì „ì› ì¥ì¹˜ -</div>
            <div class="wire wire-left"></div>
            <div class="wire wire-right"></div>
            
            <div id="beaker">
                <div class="liquid"></div>
                
                <div id="anode" class="electrode">
                    <div class="tooltip" style="top:-30px; left:-10px;">Ag (ì€íŒ)</div>
                </div>
                
                <div id="cathode" class="electrode">
                    <div class="tooltip" style="top:-30px; left:-10px;">Cu (íœë˜íŠ¸)</div>
                </div>

                <div id="particles-layer"></div>
            </div>
            
            <div id="electron-path" style="position:absolute; top:20px; width:100%; height:20px;"></div>
        </div>

        <div class="info-panel">
            <div class="data-box">
                <h4>ğŸ“Š ì‹¤í—˜ ê²°ê³¼ (Data)</h4>
                <div>ì„ì¶œëœ ì€ì˜ ì§ˆëŸ‰: <span id="result-mass" style="color:var(--primary-color); font-weight:bold;">0.00</span> g</div>
                <div>íë¥¸ ì „ì ëª°ìˆ˜: <span id="result-mol">0.00</span> mol</div>
                <hr>
                <div class="reaction-eq">
                    <strong>(+)ê·¹ ì‚°í™”:</strong><br> $Ag(s) \rightarrow Ag^+(aq) + e^-$
                </div>
                <div class="reaction-eq">
                    <strong>(-)ê·¹ í™˜ì›:</strong><br> $Ag^+(aq) + e^- \rightarrow Ag(s)$
                </div>
            </div>

            <div class="data-box">
                <h4>ğŸ“ˆ ë„ê¸ˆëŸ‰ ê·¸ë˜í”„</h4>
                <div class="graph-container">
                    <div id="graph-bar" class="graph-bar" style="height: 0%;"></div>
                    <div style="position:absolute; bottom:5px; right:5px; font-size:0.8rem;">Mass</div>
                </div>
            </div>

            <div class="quiz-box">
                <h4>ğŸ§  ê°œë… í™•ì¸ í€´ì¦ˆ</h4>
                <div id="quiz-question">ì „ê¸° ë¶„í•´ ì‹œ ì „ìëŠ” ì–´ë””ì—ì„œ ì–´ë””ë¡œ ì´ë™í• ê¹Œìš”?</div>
                <div class="quiz-options" id="quiz-options" style="margin-top:5px;">
                    <button onclick="checkAnswer(1)">ì€íŒ â†’ íœë˜íŠ¸</button>
                    <button onclick="checkAnswer(2)">íœë˜íŠ¸ â†’ ì€íŒ</button>
                </div>
                <div id="quiz-feedback" style="font-size:0.9rem; margin-top:5px; font-weight:bold;"></div>
            </div>
        </div>
    </div>

    <script>
        // ìƒìˆ˜ ë° ë³€ìˆ˜
        const FARADAY = 96485; // C/mol
        const MOLAR_MASS_AG = 107.87; // g/mol
        let isRunning = false;
        let timer = 0; // ì‹œë®¬ë ˆì´ì…˜ ì‹œê°„ (ë‹¨ìœ„: 10ë¶„ tick)
        let totalCharge = 0; // ì¿¨ë¡±
        let massDeposited = 0;
        let animationFrame;
        
        // DOM ìš”ì†Œ
        const inputCurrent = document.getElementById('input-current');
        const valCurrent = document.getElementById('val-current');
        const valTime = document.getElementById('val-time');
        const btnToggle = document.getElementById('btn-toggle');
        const btnReset = document.getElementById('btn-reset');
        const cathode = document.getElementById('cathode');
        const anode = document.getElementById('anode');
        const resultMass = document.getElementById('result-mass');
        const resultMol = document.getElementById('result-mol');
        const graphBar = document.getElementById('graph-bar');
        const particlesLayer = document.getElementById('particles-layer');

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        inputCurrent.addEventListener('input', (e) => {
            valCurrent.textContent = e.target.value + " A";
        });

        btnToggle.addEventListener('click', toggleSimulation);
        btnReset.addEventListener('click', resetSimulation);

        function toggleSimulation() {
            if (isRunning) {
                stopSimulation();
            } else {
                startSimulation();
            }
        }

        function startSimulation() {
            isRunning = true;
            btnToggle.textContent = "ì¼ì‹œ ì •ì§€ (Pause)";
            btnToggle.style.backgroundColor = "#e67e22";
            runLoop();
        }

        function stopSimulation() {
            isRunning = false;
            btnToggle.textContent = "ì‹¤í—˜ ê³„ì† (Resume)";
            btnToggle.style.backgroundColor = "#4a90e2";
            cancelAnimationFrame(animationFrame);
        }

        function resetSimulation() {
            stopSimulation();
            timer = 0;
            totalCharge = 0;
            massDeposited = 0;
            updateUI();
            
            // ì‹œê°ì  ì´ˆê¸°í™”
            cathode.style.backgroundColor = "#b87333"; // êµ¬ë¦¬ìƒ‰ ë³µêµ¬
            anode.style.opacity = 1;
            btnToggle.textContent = "ì‹¤í—˜ ì‹œì‘ (Start)";
            graphBar.style.height = "0%";
            particlesLayer.innerHTML = '';
            document.getElementById('quiz-feedback').textContent = '';
        }

        function runLoop() {
            if (!isRunning) return;

            // ë…¼ë¦¬ ì—…ë°ì´íŠ¸ (1í”„ë ˆì„ë‹¹ ê°€ìƒì˜ ì‹œê°„ ê²½ê³¼)
            // í¸ì˜ìƒ 1 í”„ë ˆì„ = ì‹¤ì œ 10ë¶„ ì •ë„ì˜ ë°˜ì‘ì´ë¼ê³  ê°€ì • (ë¹ ë¥¸ ì‹œë®¬ë ˆì´ì…˜)
            const current = parseFloat(inputCurrent.value);
            const timeStep = 60 * 10; // 10ë¶„ (600ì´ˆ)
            
            timer += 10; // ë¶„ ë‹¨ìœ„ í‘œì‹œìš©
            const chargeStep = current * timeStep; // Q = I * t
            totalCharge += chargeStep;

            // íŒ¨ëŸ¬ë°ì´ ë²•ì¹™ ê³„ì‚°: w = (M * Q) / (n * F)
            // ì€(Ag)ì€ 1ê°€ ì´ì˜¨ì´ë¯€ë¡œ n=1
            massDeposited = (MOLAR_MASS_AG * totalCharge) / (1 * FARADAY);
            const molElectron = totalCharge / FARADAY;

            updateUI(molElectron);
            animateParticles();

            // ì¢…ë£Œ ì¡°ê±´ (ë„ˆë¬´ ì˜¤ë˜í•˜ë©´ ë©ˆì¶¤)
            if (timer > 600) { // ê°€ìƒ 600ë¶„
                stopSimulation();
                alert("ì‹¤í—˜ ì¢…ë£Œ! ë„ê¸ˆì´ ì¶©ë¶„íˆ ë‘êº¼ì›Œì¡ŒìŠµë‹ˆë‹¤.");
            } else {
                // ì†ë„ ì¡°ì ˆ (ë„ˆë¬´ ë¹ ë¥´ì§€ ì•Šê²Œ)
                setTimeout(() => {
                    animationFrame = requestAnimationFrame(runLoop);
                }, 100); // 0.1ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸
            }
        }

        function updateUI(molElectron = 0) {
            valTime.textContent = timer + " ë¶„";
            resultMass.textContent = massDeposited.toFixed(2);
            resultMol.textContent = molElectron.toFixed(3);

            // ê·¸ë˜í”„ ì—…ë°ì´íŠ¸ (ìµœëŒ€ 10g ê¸°ì¤€ìœ¼ë¡œ ë†’ì´ ì„¤ì •)
            let graphHeight = (massDeposited / 10) * 100; 
            if (graphHeight > 100) graphHeight = 100;
            graphBar.style.height = graphHeight + "%";

            // ì‹œê°ì  ë³€í™”: íœë˜íŠ¸ ìƒ‰ìƒ ë³€í™” (êµ¬ë¦¬ìƒ‰ -> ì€ìƒ‰)
            // êµ¬ë¦¬ìƒ‰(RGB: 184, 115, 51) -> ì€ìƒ‰(RGB: 192, 192, 192)
            // ë„ê¸ˆëŸ‰ì— ë”°ë¼ ë³´ê°„
            const ratio = Math.min(massDeposited / 2.0, 1); // 2gì´ë©´ ì™„ì „íˆ ì€ìƒ‰
            const r = Math.round(184 + (192 - 184) * ratio);
            const g = Math.round(115 + (192 - 115) * ratio);
            const b = Math.round(51 + (192 - 51) * ratio);
            cathode.style.backgroundColor = `rgb(${r}, ${g}, ${b})`;

            // ì–‘ê·¹(ì€íŒ) ë¶€ì‹ íš¨ê³¼
            anode.style.opacity = Math.max(0.2, 1 - (ratio * 0.5));
        }

        function animateParticles() {
            // ì´ì˜¨ ìƒì„± (Ag+) : Anode -> Cathode
            const ion = document.createElement('div');
            ion.className = 'particle ion';
            ion.textContent = 'Agâº';
            ion.style.left = '60px'; // Anode ìœ„ì¹˜ ê·¼ì²˜
            ion.style.top = Math.random() * 100 + 50 + 'px';
            particlesLayer.appendChild(ion);

            // ì „ì ìƒì„± (e-) : íšŒë¡œë¥¼ ë”°ë¼ ì´ë™í•˜ëŠ” íš¨ê³¼ëŠ” CSSë¡œ í•˜ë˜, 
            // ì—¬ê¸°ì„œëŠ” ìš©ì•¡ ë‚´ ë°˜ì‘ì„ ë³´ì—¬ì£¼ê¸° ìœ„í•´ íœë˜íŠ¸ ê·¼ì²˜ì—ì„œ ì‚¬ë¼ì§€ëŠ” ê²ƒ í‘œí˜„
            
            // ì´ì˜¨ ì´ë™ ì• ë‹ˆë©”ì´ì…˜
            const anim = ion.animate([
                { transform: 'translate(0, 0)', opacity: 1 },
                { transform: `translate(100px, ${Math.random()*20 - 10}px)`, opacity: 0 }
            ], {
                duration: 1500,
                easing: 'ease-in'
            });

            anim.onfinish = () => ion.remove();
        }

        // í€´ì¦ˆ ë¡œì§
        function checkAnswer(ans) {
            const feedback = document.getElementById('quiz-feedback');
            if (ans === 1) {
                feedback.innerHTML = "<span style='color:blue'>ì •ë‹µì…ë‹ˆë‹¤!</span><br>ì „ìëŠ” (-)ê·¹ì¸ íœë˜íŠ¸ë¡œ í˜ëŸ¬ë“¤ì–´ê°€ Agâº ì´ì˜¨ì„ í™˜ì›ì‹œí‚µë‹ˆë‹¤.";
            } else {
                feedback.innerHTML = "<span style='color:red'>ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”.</span><br>ì „ì›ì€ ì „ìë¥¼ ë°€ì–´ëƒ…ë‹ˆë‹¤. ì „ìê°€ ìŒ“ì´ëŠ” ê³³ì´ (-)ê·¹ì´ ë©ë‹ˆë‹¤.";
            }
        }
    </script>
</body>
</html>