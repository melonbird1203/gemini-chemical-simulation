<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ìƒ ì‹¤í—˜: ì‚°í™”ì œì™€ í™˜ì›ì œì˜ êµ¬ë¶„ (SOâ‚‚)</title>
    <style>
        :root {
            --primary: #4F46E5;
            --secondary: #10B981;
            --danger: #EF4444;
            --bg: #F3F4F6;
            --card: #FFFFFF;
            --text: #1F2937;
        }
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            max-width: 900px;
            width: 100%;
            background: var(--card);
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 30px;
            box-sizing: border-box;
        }
        h1 {
            text-align: center;
            color: var(--primary);
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #6B7280;
            margin-bottom: 30px;
            font-size: 0.95em;
        }
        
        /* Control Panel */
        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
            background: #EEF2FF;
            padding: 15px;
            border-radius: 12px;
        }
        select, button {
            padding: 10px 20px;
            border-radius: 8px;
            border: 1px solid #D1D5DB;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        button.primary {
            background-color: var(--primary);
            color: white;
            border: none;
            font-weight: bold;
        }
        button.primary:hover {
            background-color: #4338CA;
        }
        button.toggle {
            background-color: white;
            color: var(--text);
        }
        button.toggle.active {
            background-color: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        /* Simulation Area */
        .simulation-stage {
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            height: 300px;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            background: #FAFAFA;
            margin-bottom: 20px;
        }
        .molecule {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 30px;
            transition: all 1s ease;
            position: relative;
        }
        .atom-group {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 1.5rem;
            font-weight: bold;
            padding: 15px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 3px solid #E5E7EB;
            min-width: 60px;
            justify-content: center;
        }
        .ox-num {
            font-size: 0.8rem;
            color: var(--danger);
            font-weight: bold;
            margin-top: 5px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .ox-num.visible {
            opacity: 1;
        }
        
        /* Animation Elements */
        .electron {
            width: 12px;
            height: 12px;
            background-color: #F59E0B; /* Yellow */
            border-radius: 50%;
            position: absolute;
            display: none;
            box-shadow: 0 0 8px #F59E0B;
            z-index: 10;
        }

        /* Results & Quiz */
        .equation-box {
            text-align: center;
            font-size: 1.2rem;
            margin: 20px 0;
            padding: 15px;
            background: #F9FAFB;
            border-radius: 8px;
        }
        .quiz-section {
            margin-top: 30px;
            border-top: 2px dashed #E5E7EB;
            padding-top: 20px;
            display: none;
        }
        .quiz-options {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }
        .feedback-box {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            display: none;
        }
        .feedback-correct { background-color: #D1FAE5; color: #065F46; }
        .feedback-wrong { background-color: #FEE2E2; color: #991B1B; }

        /* Helpers */
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-left: 5px;
        }
        .badge-ox { background-color: #DBEAFE; color: #1E40AF; } /* Blue for Ox */
        .badge-red { background-color: #FCE7F3; color: #9D174D; } /* Pink for Red */

        .safety-note {
            margin-top: 20px;
            font-size: 0.8rem;
            color: #6B7280;
            text-align: center;
            background: #FEF3C7;
            padding: 10px;
            border-radius: 8px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ”¬ ê°€ìƒ ì‹¤í—˜ì‹¤: ì‚°í™”ì œì™€ í™˜ì›ì œ</h1>
    <div class="subtitle">ì´ì‚°í™” í™©(SOâ‚‚)ì€ ëˆ„êµ¬ë¥¼ ë§Œë‚˜ëŠëƒì— ë”°ë¼ ì—­í• ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.</div>

    <div class="controls">
        <label style="display:flex; align-items:center; gap:10px;">
            <strong>ì‹¤í—˜ ì„ íƒ:</strong>
            <select id="reactionSelect">
                <option value="react1">ì‹¤í—˜ A: SOâ‚‚ + Clâ‚‚ (ì—¼ì†Œ ê¸°ì²´ì™€ì˜ ë°˜ì‘)</option>
                <option value="react2">ì‹¤í—˜ B: SOâ‚‚ + Hâ‚‚S (í™©í™” ìˆ˜ì†Œì™€ì˜ ë°˜ì‘)</option>
            </select>
        </label>
        <button class="primary" onclick="startExperiment()">ì‹¤í—˜ ì‹œì‘ â–¶</button>
        <button class="toggle" id="oxToggleBtn" onclick="toggleOxidationNumbers()">ì‚°í™”ìˆ˜ ë³´ê¸° OFF</button>
    </div>

    <div class="simulation-stage" id="stage">
        <div style="text-align:center; color:#9CA3AF;">
            ì‹¤í—˜ì„ ì„ íƒí•˜ê³  [ì‹¤í—˜ ì‹œì‘] ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”.<br>
            ë¹„ì»¤ ì•ˆì—ì„œ ì¼ì–´ë‚˜ëŠ” ì „ì ì´ë™ì„ ê´€ì°°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </div>
    </div>
    
    <div id="electron" class="electron"></div>

    <div class="equation-box" id="equationDisplay">
        ë°˜ì‘ì‹ ëŒ€ê¸° ì¤‘...
    </div>

    <div class="quiz-section" id="quizSection">
        <h3>ğŸ¤” ìƒê° ë„“íˆê¸°: ì´ ë°˜ì‘ì—ì„œ ëˆ„ê°€ 'ì‚°í™”ì œ'ì¼ê¹Œìš”?</h3>
        <p>ì „ìë¥¼ ì–»ì–´ ìì‹ ì˜ ì‚°í™”ìˆ˜ê°€ ê°ì†Œí•œ ë¬¼ì§ˆì„ ì°¾ì•„ë³´ì„¸ìš”.</p>
        <div class="quiz-options" id="quizButtons">
            </div>
        <div class="feedback-box" id="feedback"></div>
    </div>

    <div class="safety-note">
        âš ï¸ <strong>ì•ˆì „ ì£¼ì˜:</strong> ì‹¤ì œ ì‹¤í—˜ì‹¤ì—ì„œ SOâ‚‚ì™€ Clâ‚‚, Hâ‚‚SëŠ” ë…ì„±ì´ ê°•í•œ ê¸°ì²´ì…ë‹ˆë‹¤. ë°˜ë“œì‹œ í›„ë“œ(Hood) ë‚´ì—ì„œ ë³´í˜¸ ì¥êµ¬ë¥¼ ì°©ìš©í•˜ê³  ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤. ì´ ì‹œë®¬ë ˆì´ì…˜ì€ ì•ˆì „í•œ í•™ìŠµì„ ìœ„í•´ ì œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.
    </div>
</div>

<script>
    // --- Data & State ---
    const reactions = {
        react1: {
            title: "SOâ‚‚ + Clâ‚‚ + 2Hâ‚‚O â†’ Hâ‚‚SOâ‚„ + 2HCl",
            reactants: [
                { name: "SOâ‚‚", s_ox: "+4", role: "reduction_agent" }, // í™˜ì›ì œ (ìì‹ ì€ ì‚°í™”ë¨)
                { name: "Clâ‚‚", cl_ox: "0", role: "oxidizing_agent" }   // ì‚°í™”ì œ (ìì‹ ì€ í™˜ì›ë¨)
            ],
            products: [
                { name: "SOâ‚„Â²â»", s_ox: "+6" },
                { name: "Clâ»", cl_ox: "-1" }
            ],
            desc: "í™©(S)ì˜ ì‚°í™”ìˆ˜ê°€ +4ì—ì„œ +6ìœ¼ë¡œ ì¦ê°€í–ˆìŠµë‹ˆë‹¤.<br>ì—¼ì†Œ(Cl)ì˜ ì‚°í™”ìˆ˜ëŠ” 0ì—ì„œ -1ë¡œ ê°ì†Œí–ˆìŠµë‹ˆë‹¤.",
            electronFlow: "SOâ‚‚ â†’ Clâ‚‚", // ì „ìëŠ” í™˜ì›ì œì—ì„œ ì‚°í™”ì œë¡œ ì´ë™
            quizAnswer: "Clâ‚‚",
            quizExplanation: "Clâ‚‚ëŠ” ì „ìë¥¼ ì–»ì–´(0 â†’ -1) í™˜ì›ë˜ì—ˆìŠµë‹ˆë‹¤. ë‚¨ì„ ì‚°í™”ì‹œì¼°ìœ¼ë¯€ë¡œ <strong>ì‚°í™”ì œ</strong>ì…ë‹ˆë‹¤!"
        },
        react2: {
            title: "2Hâ‚‚S + SOâ‚‚ â†’ 3S + 2Hâ‚‚O",
            reactants: [
                { name: "SOâ‚‚", s_ox: "+4", role: "oxidizing_agent" }, // ì‚°í™”ì œ
                { name: "Hâ‚‚S", s_ox: "-2", role: "reduction_agent" }  // í™˜ì›ì œ
            ],
            products: [
                { name: "S", s_ox: "0" }
            ],
            desc: "SOâ‚‚ì˜ í™©(S)ì€ +4ì—ì„œ 0ìœ¼ë¡œ ê°ì†Œí–ˆìŠµë‹ˆë‹¤.<br>Hâ‚‚Sì˜ í™©(S)ì€ -2ì—ì„œ 0ìœ¼ë¡œ ì¦ê°€í–ˆìŠµë‹ˆë‹¤.",
            electronFlow: "Hâ‚‚S â†’ SOâ‚‚",
            quizAnswer: "SOâ‚‚",
            quizExplanation: "SOâ‚‚ëŠ” ì „ìë¥¼ ì–»ì–´(+4 â†’ 0) í™˜ì›ë˜ì—ˆìŠµë‹ˆë‹¤. ë‚¨ì„ ì‚°í™”ì‹œì¼°ìœ¼ë¯€ë¡œ <strong>ì‚°í™”ì œ</strong>ì…ë‹ˆë‹¤!"
        }
    };

    let currentReaction = null;
    let showOxidation = false;

    // --- Core Functions ---

    function toggleOxidationNumbers() {
        showOxidation = !showOxidation;
        const btn = document.getElementById('oxToggleBtn');
        const oxNums = document.querySelectorAll('.ox-num');
        
        if (showOxidation) {
            btn.textContent = "ì‚°í™”ìˆ˜ ë³´ê¸° ON";
            btn.classList.add('active');
            oxNums.forEach(el => el.classList.add('visible'));
        } else {
            btn.textContent = "ì‚°í™”ìˆ˜ ë³´ê¸° OFF";
            btn.classList.remove('active');
            oxNums.forEach(el => el.classList.remove('visible'));
        }
    }

    function startExperiment() {
        const select = document.getElementById('reactionSelect');
        const stage = document.getElementById('stage');
        const eqDisplay = document.getElementById('equationDisplay');
        const quizSection = document.getElementById('quizSection');
        const feedback = document.getElementById('feedback');

        // Reset UI
        stage.innerHTML = '';
        quizSection.style.display = 'none';
        feedback.style.display = 'none';
        currentReaction = reactions[select.value];

        // 1. Render Reactants
        const leftSide = document.createElement('div');
        leftSide.className = 'molecule';
        leftSide.innerHTML = `
            <div class="atom-group" style="border-color:#60A5FA;">
                ${currentReaction.reactants[0].name}
            </div>
            <div class="ox-num ${showOxidation ? 'visible' : ''}">S: ${currentReaction.reactants[0].s_ox}</div>
        `;
        
        const rightSide = document.createElement('div');
        rightSide.className = 'molecule';
        const reactant2 = currentReaction.reactants[1];
        // Dynamic ox label logic
        let oxLabel = "";
        if(reactant2.name === "Clâ‚‚") oxLabel = `Cl: ${reactant2.cl_ox}`;
        else oxLabel = `S: ${reactant2.s_ox}`;

        rightSide.innerHTML = `
            <div class="atom-group" style="border-color:#34D399;">
                ${reactant2.name}
            </div>
            <div class="ox-num ${showOxidation ? 'visible' : ''}">${oxLabel}</div>
        `;

        stage.appendChild(leftSide);
        
        // Plus sign
        const plus = document.createElement('div');
        plus.innerHTML = "â•";
        plus.style.fontSize = "1.5rem";
        stage.appendChild(plus);

        stage.appendChild(rightSide);

        // Update Equation Text
        eqDisplay.innerHTML = `<strong>ë°˜ì‘ì‹:</strong> ${currentReaction.title}`;

        // 2. Animate Electrons (Wait a bit then animate)
        setTimeout(() => {
            runElectronAnimation(leftSide, rightSide);
        }, 500);
    }

    function runElectronAnimation(leftEl, rightEl) {
        const electron = document.getElementById('electron');
        const stage = document.getElementById('stage');
        const rectStage = stage.getBoundingClientRect();
        
        // Determine Start and End based on electron flow logic
        // react1: SO2(Left) -> Cl2(Right)
        // react2: H2S(Right) -> SO2(Left) logic needs to be mapped
        
        let startRect, endRect;
        const selectValue = document.getElementById('reactionSelect').value;

        if (selectValue === 'react1') {
            // SO2 is Left, Cl2 is Right. Flow: Left -> Right
            startRect = leftEl.getBoundingClientRect();
            endRect = rightEl.getBoundingClientRect();
        } else {
            // SO2 is Left, H2S is Right. Flow: H2S -> SO2 (Right -> Left)
            startRect = rightEl.getBoundingClientRect();
            endRect = leftEl.getBoundingClientRect();
        }

        // Setup Electron Position relative to stage
        electron.style.display = 'block';
        electron.style.left = (startRect.left - rectStage.left + startRect.width/2) + 'px';
        electron.style.top = (startRect.top - rectStage.top + startRect.height/2) + 'px';

        // Animate
        const animation = electron.animate([
            { transform: 'scale(1)' },
            { 
                left: (endRect.left - rectStage.left + endRect.width/2) + 'px', 
                top: (endRect.top - rectStage.top + endRect.height/2) + 'px',
                transform: 'scale(1.5)',
                background: '#EF4444' // Turn red during transfer
            },
            { transform: 'scale(1)', background: '#F59E0B' }
        ], {
            duration: 1500,
            iterations: 2,
            easing: 'ease-in-out'
        });

        animation.onfinish = () => {
            electron.style.display = 'none';
            showResult();
        };
    }

    function showResult() {
        const quizSection = document.getElementById('quizSection');
        const quizButtons = document.getElementById('quizButtons');
        const eqDisplay = document.getElementById('equationDisplay');

        // Show changes description
        eqDisplay.innerHTML += `<br><span style="color:#4B5563; font-size:0.9rem;">â„¹ï¸ ${currentReaction.desc}</span>`;
        
        // Setup Quiz
        quizSection.style.display = 'block';
        quizButtons.innerHTML = '';

        // Generate Buttons for Reactants
        currentReaction.reactants.forEach(r => {
            const btn = document.createElement('button');
            btn.textContent = r.name;
            btn.onclick = () => checkAnswer(r.name);
            quizButtons.appendChild(btn);
        });
    }

    function checkAnswer(selected) {
        const feedback = document.getElementById('feedback');
        feedback.style.display = 'block';
        
        if (selected === currentReaction.quizAnswer) {
            feedback.className = 'feedback-box feedback-correct';
            feedback.innerHTML = `âœ… ì •ë‹µì…ë‹ˆë‹¤! <br> ${currentReaction.quizExplanation}`;
        } else {
            feedback.className = 'feedback-box feedback-wrong';
            feedback.innerHTML = `âŒ ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”. <br> ì‚°í™”ì œëŠ” **ìì‹ ì€ í™˜ì›ë˜ë©´ì„œ(ì‚°í™”ìˆ˜ ê°ì†Œ)** ë‚¨ì„ ì‚°í™”ì‹œí‚¤ëŠ” ë¬¼ì§ˆì…ë‹ˆë‹¤.`;
        }
    }
</script>

</body>
</html>