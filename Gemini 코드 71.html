<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¤‘3 ê³¼í•™: í™”í•™ ë°˜ì‘ì‹ ë§Œë“¤ê¸° ê°€ìƒ ì‹¤í—˜</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --success-color: #2ecc71;
            --warning-color: #e74c3c;
            --bg-color: #f5f7fa;
            --card-bg: #ffffff;
        }

        body {
            font-family: 'Pretendard', 'Malgun Gothic', sans-serif;
            background-color: var(--bg-color);
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            max-width: 900px;
            width: 100%;
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #eee;
            padding-bottom: 20px;
        }

        h1 { margin: 0 0 10px 0; color: var(--primary-color); }
        p.subtitle { color: #666; margin: 0; }

        /* Controls */
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            background: #eef2f7;
            padding: 15px;
            border-radius: 10px;
        }

        select, button {
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 8px;
            border: 1px solid #ccc;
            cursor: pointer;
        }

        button.primary {
            background-color: var(--primary-color);
            color: white;
            border: none;
            font-weight: bold;
        }
        
        button.primary:hover { background-color: #357abd; }

        /* Equation Area */
        .equation-area {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            font-size: 24px;
            margin-bottom: 30px;
            font-weight: bold;
        }

        .chemical-group {
            display: flex;
            align-items: center;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        input[type="number"] {
            width: 50px;
            padding: 5px;
            font-size: 20px;
            text-align: center;
            margin-right: 5px;
            border: 2px solid var(--primary-color);
            border-radius: 5px;
        }

        /* Visualization Area */
        .visual-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            gap: 20px;
        }

        .side-panel {
            flex: 1;
            background: #fff;
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 15px;
            min-height: 200px;
            position: relative;
        }

        .side-label {
            position: absolute;
            top: -12px;
            left: 20px;
            background: var(--bg-color);
            padding: 0 10px;
            font-weight: bold;
            color: #555;
        }

        .molecule-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 10px;
            align-content: flex-start;
        }

        /* Molecules & Atoms */
        .molecule {
            display: inline-flex;
            align-items: center;
            background: rgba(0,0,0,0.05);
            padding: 5px;
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .atom {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
            box-shadow: inset -2px -2px 5px rgba(0,0,0,0.2);
            margin: 0 -2px; /* Overlap slightly for bonding */
            border: 1px solid rgba(0,0,0,0.1);
        }

        /* Atom Colors */
        .atom.H { background-color: #bdc3c7; color: #333; } /* Hydrogen - White/Grey */
        .atom.O { background-color: #e74c3c; } /* Oxygen - Red */
        .atom.N { background-color: #3498db; } /* Nitrogen - Blue */
        .atom.C { background-color: #2c3e50; } /* Carbon - Black */

        /* Feedback Section */
        .feedback-section {
            background: #fafafa;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .atom-count-display {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 15px;
        }

        .count-box {
            background: white;
            padding: 10px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .status-msg {
            font-size: 18px;
            font-weight: bold;
            margin-top: 10px;
            min-height: 30px;
        }

        .status-msg.success { color: var(--success-color); }
        .status-msg.error { color: var(--warning-color); }

        /* Animation */
        @keyframes popIn {
            0% { transform: scale(0); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .molecule { animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ğŸ§ª í™”í•™ ë°˜ì‘ì‹ ë§ˆìŠ¤í„°</h1>
        <p class="subtitle">ê³„ìˆ˜ë¥¼ ì¡°ì ˆí•˜ì—¬ ë°˜ì‘ë¬¼ê³¼ ìƒì„±ë¬¼ì˜ ì›ì ê°œìˆ˜ë¥¼ ë§ì¶°ë³´ì„¸ìš”!</p>
    </header>

    <div class="controls">
        <label for="reactionSelect">ì‹¤í—˜ ì£¼ì œ ì„ íƒ: </label>
        <select id="reactionSelect" onchange="loadReaction()">
            <option value="0">1ë‹¨ê³„: ë¬¼ì˜ í•©ì„± (ìˆ˜ì†Œ + ì‚°ì†Œ)</option>
            <option value="1">2ë‹¨ê³„: ì•”ëª¨ë‹ˆì•„ í•©ì„± (ì§ˆì†Œ + ìˆ˜ì†Œ)</option>
            <option value="2">3ë‹¨ê³„: ë©”í…Œì¸ ì—°ì†Œ (ë©”í…Œì¸ + ì‚°ì†Œ)</option>
        </select>
        <button class="primary" onclick="resetCoefficients()">ì´ˆê¸°í™”</button>
    </div>

    <div id="equationDisplay" class="equation-area">
        </div>

    <div class="visual-container">
        <div class="side-panel" id="reactantsPanel">
            <span class="side-label">ë°˜ì‘ë¬¼ (Reactants)</span>
            <div id="reactantsVisual" class="molecule-container"></div>
        </div>
        
        <div style="display:flex; align-items:center; font-size:30px; color:#aaa;">â®•</div>

        <div class="side-panel" id="productsPanel">
            <span class="side-label">ìƒì„±ë¬¼ (Products)</span>
            <div id="productsVisual" class="molecule-container"></div>
        </div>
    </div>

    <div class="feedback-section">
        <h3>ğŸ“Š ì…ì ìˆ˜ ë¶„ì„ ë¦¬í¬íŠ¸</h3>
        <div id="atomCounts" class="atom-count-display">
            </div>
        <div id="resultMessage" class="status-msg"></div>
        <button id="checkBtn" class="primary" style="margin-top:10px; display:none;" onclick="celebrate()">ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤! ë‹¤ìŒ ë¬¸ì œë¡œ?</button>
    </div>
</div>

<script>
    // --- Data: Reaction Scenarios ---
    const reactions = [
        {
            name: "ë¬¼ì˜ í•©ì„±",
            reactants: [
                { formula: "Hâ‚‚", composition: ["H","H"], color: "H" },
                { formula: "Oâ‚‚", composition: ["O","O"], color: "O" }
            ],
            products: [
                { formula: "Hâ‚‚O", composition: ["O","H","H"], color: "mixed" } // H2O structure handled in render
            ],
            correct: [2, 1, 2], // Coefficients
            info: "ìˆ˜ì†Œ ê¸°ì²´ì™€ ì‚°ì†Œ ê¸°ì²´ê°€ ë°˜ì‘í•˜ë©´ ë¬¼ì´ ìƒì„±ë©ë‹ˆë‹¤."
        },
        {
            name: "ì•”ëª¨ë‹ˆì•„ í•©ì„±",
            reactants: [
                { formula: "Nâ‚‚", composition: ["N","N"], color: "N" },
                { formula: "Hâ‚‚", composition: ["H","H"], color: "H" }
            ],
            products: [
                { formula: "NHâ‚ƒ", composition: ["N","H","H","H"], color: "mixed" }
            ],
            correct: [1, 3, 2],
            info: "ì§ˆì†Œì™€ ìˆ˜ì†Œë¥¼ ê³ ì˜¨ ê³ ì••ì—ì„œ ë°˜ì‘ì‹œì¼œ ì•”ëª¨ë‹ˆì•„ë¥¼ ë§Œë“­ë‹ˆë‹¤."
        },
        {
            name: "ë©”í…Œì¸ ì—°ì†Œ",
            reactants: [
                { formula: "CHâ‚„", composition: ["C","H","H","H","H"], color: "mixed" },
                { formula: "Oâ‚‚", composition: ["O","O"], color: "O" }
            ],
            products: [
                { formula: "COâ‚‚", composition: ["C","O","O"], color: "mixed" },
                { formula: "Hâ‚‚O", composition: ["O","H","H"], color: "mixed" }
            ],
            correct: [1, 2, 1, 2],
            info: "ë©”í…Œì¸ì´ ì‚°ì†Œì™€ ë°˜ì‘í•˜ì—¬ ì´ì‚°í™” íƒ„ì†Œì™€ ë¬¼ì„ ìƒì„±í•©ë‹ˆë‹¤."
        }
    ];

    let currentReactionId = 0;
    let currentCoefficients = [];

    // --- Core Functions ---

    function init() {
        loadReaction();
    }

    function loadReaction() {
        const select = document.getElementById('reactionSelect');
        currentReactionId = parseInt(select.value);
        const reaction = reactions[currentReactionId];
        
        // Initialize coefficients to 1 for all compounds
        const totalCompounds = reaction.reactants.length + reaction.products.length;
        currentCoefficients = new Array(totalCompounds).fill(1);

        renderEquationInputs();
        updateSimulation();
    }

    function resetCoefficients() {
        currentCoefficients.fill(1);
        const inputs = document.querySelectorAll('.coeff-input');
        inputs.forEach(input => input.value = 1);
        updateSimulation();
    }

    function renderEquationInputs() {
        const reaction = reactions[currentReactionId];
        const container = document.getElementById('equationDisplay');
        container.innerHTML = '';

        let globalIndex = 0;

        // Render Reactants
        reaction.reactants.forEach((r, idx) => {
            if (idx > 0) container.innerHTML += ' + ';
            container.appendChild(createInputGroup(r.formula, globalIndex));
            globalIndex++;
        });

        // Arrow
        container.innerHTML += ' â ';

        // Render Products
        reaction.products.forEach((p, idx) => {
            if (idx > 0) container.innerHTML += ' + ';
            container.appendChild(createInputGroup(p.formula, globalIndex));
            globalIndex++;
        });
    }

    function createInputGroup(formula, index) {
        const div = document.createElement('div');
        div.className = 'chemical-group';
        
        const input = document.createElement('input');
        input.type = 'number';
        input.min = '1';
        input.max = '10';
        input.value = currentCoefficients[index];
        input.className = 'coeff-input';
        input.dataset.index = index;
        input.oninput = (e) => handleInput(e, index);
        input.onchange = (e) => { if(e.target.value < 1) e.target.value = 1; handleInput(e, index); };

        div.appendChild(input);
        
        // Formatting Subscript (simple replace for logic)
        const formattedFormula = formula.replace(/([0-9]+)/g, "<sub>$1</sub>");
        const span = document.createElement('span');
        span.innerHTML = formattedFormula;
        div.appendChild(span);

        return div;
    }

    function handleInput(e, index) {
        let val = parseInt(e.target.value);
        if (isNaN(val) || val < 1) val = 1;
        currentCoefficients[index] = val;
        updateSimulation();
    }

    // --- Visualization Logic ---

    function updateSimulation() {
        const reaction = reactions[currentReactionId];
        
        // 1. Render Molecules
        renderMolecules(reaction.reactants, 'reactantsVisual', 0);
        renderMolecules(reaction.products, 'productsVisual', reaction.reactants.length);

        // 2. Calculate Atom Counts
        const leftCounts = calculateAtoms(reaction.reactants, 0, reaction.reactants.length);
        const rightCounts = calculateAtoms(reaction.products, reaction.reactants.length, reaction.reactants.length + reaction.products.length);

        // 3. Update Feedback
        updateFeedback(leftCounts, rightCounts);
    }

    function renderMolecules(compounds, containerId, offset) {
        const container = document.getElementById(containerId);
        container.innerHTML = '';

        compounds.forEach((comp, idx) => {
            const count = currentCoefficients[idx + offset];
            for (let i = 0; i < count; i++) {
                const molDiv = document.createElement('div');
                molDiv.className = 'molecule';
                
                // Construct atoms based on composition
                // Special simplified layouts for visuals
                comp.composition.forEach(atomType => {
                    const atom = document.createElement('div');
                    atom.className = `atom ${atomType}`;
                    atom.textContent = atomType;
                    molDiv.appendChild(atom);
                });
                
                container.appendChild(molDiv);
            }
        });
    }

    function calculateAtoms(compounds, startIdx, endIdx) {
        let counts = {};
        compounds.forEach((comp, idx) => {
            const coeff = currentCoefficients[startIdx + idx];
            comp.composition.forEach(atom => {
                counts[atom] = (counts[atom] || 0) + coeff;
            });
        });
        return counts;
    }

    function updateFeedback(left, right) {
        const atomDiv = document.getElementById('atomCounts');
        const msgDiv = document.getElementById('resultMessage');
        const checkBtn = document.getElementById('checkBtn');
        
        atomDiv.innerHTML = '';
        checkBtn.style.display = 'none';

        // Get all unique atom types involved
        const allAtoms = new Set([...Object.keys(left), ...Object.keys(right)]);
        let allBalanced = true;

        allAtoms.forEach(atom => {
            const lCount = left[atom] || 0;
            const rCount = right[atom] || 0;
            const isBalanced = lCount === rCount;
            if (!isBalanced) allBalanced = false;

            const box = document.createElement('div');
            box.className = 'count-box';
            box.style.borderBottom = isBalanced ? `4px solid var(--success-color)` : `4px solid var(--warning-color)`;
            box.innerHTML = `
                <strong>${atom} ì›ì</strong><br>
                ë°˜ì‘ ì „: ${lCount} <br>
                ë°˜ì‘ í›„: ${rCount}
            `;
            atomDiv.appendChild(box);
        });

        if (allBalanced) {
            msgDiv.textContent = "ì™„ë²½í•©ë‹ˆë‹¤! ë°˜ì‘ ì „í›„ì˜ ì›ì ê°œìˆ˜ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤. (ì§ˆëŸ‰ ë³´ì¡´ ë²•ì¹™ ì„±ë¦½)";
            msgDiv.className = "status-msg success";
            
            // Check if it matches the *simplest* integer ratio (Standard answer)
            // For now, we just accept balanced equations.
            checkBtn.style.display = 'inline-block';
            checkBtn.textContent = currentReactionId < reactions.length -1 ? "ë‹¤ìŒ ë‹¨ê³„ ë„ì „í•˜ê¸°" : "ëª¨ë“  í•™ìŠµ ì™„ë£Œ!";
        } else {
            msgDiv.textContent = "ì•„ì§ ê· í˜•ì´ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤. ì›ì ê°œìˆ˜ë¥¼ ë¹„êµí•´ë³´ì„¸ìš”.";
            msgDiv.className = "status-msg error";
        }
    }

    function celebrate() {
        if(currentReactionId < reactions.length - 1) {
            const select = document.getElementById('reactionSelect');
            select.value = currentReactionId + 1;
            loadReaction();
        } else {
            alert("ì¶•í•˜í•©ë‹ˆë‹¤! ëª¨ë“  í™”í•™ ë°˜ì‘ì‹ í€˜ìŠ¤íŠ¸ë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!");
        }
    }

    // Start
    window.onload = init;

</script>

</body>
</html>