<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„¸ìƒì„ ë°”ê¾¸ëŠ” í™”í•™ - ê°œë… íƒêµ¬ ë¹™ê³ </title>
    <style>
        :root {
            --primary: #4A90E2;
            --secondary: #50E3C2;
            --accent: #FF6B6B;
            --bg: #F5F7FA;
            --text: #2C3E50;
            --card-bg: #ffffff;
        }

        body {
            font-family: 'Pretendard', 'Malgun Gothic', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        h1 {
            color: var(--primary);
            text-align: center;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1rem;
        }

        /* Container */
        .container {
            width: 100%;
            max-width: 1000px;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 30px;
            box-sizing: border-box;
        }

        /* Stages */
        .stage {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        .stage.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Stage 1: Chemist Selection */
        .chemist-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .chemist-card {
            border: 2px solid #eee;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .chemist-card:hover, .chemist-card.selected {
            border-color: var(--primary);
            background-color: #f0f7ff;
            transform: translateY(-5px);
        }

        .chemist-icon {
            font-size: 3rem;
            margin-bottom: 10px;
            display: block;
        }

        /* Stage 2 & 3: Bingo Board */
        .game-layout {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }

        .board-area {
            flex: 1;
            min-width: 300px;
        }

        .sidebar-area {
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .bingo-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            background: #eee;
            padding: 10px;
            border-radius: 15px;
            aspect-ratio: 1;
        }

        .bingo-cell {
            background: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-weight: bold;
            font-size: 0.9rem;
            padding: 5px;
            cursor: pointer;
            position: relative;
            transition: background 0.2s;
            user-select: none;
            word-break: keep-all;
        }

        .bingo-cell.drag-over {
            background: #e1f0ff;
            border: 2px dashed var(--primary);
        }

        .bingo-cell.marked {
            background: #d4edda;
            color: #155724;
        }
        
        .bingo-cell.marked::after {
            content: 'O';
            position: absolute;
            font-size: 4rem;
            color: rgba(40, 167, 69, 0.5);
            pointer-events: none;
        }

        .term-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .term-item {
            background: white;
            border: 1px solid #ddd;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: grab;
            font-size: 0.9rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .term-item.used {
            opacity: 0.5;
            cursor: default;
            background: #eee;
            text-decoration: line-through;
        }

        /* Game Interface */
        .mentor-box {
            background: #e8f4fd;
            border-left: 5px solid var(--primary);
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .mentor-title {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quiz-card {
            background: white;
            border: 2px solid var(--secondary);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }

        .hint-btn {
            background: white;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 8px 15px;
            border-radius: 20px;
            margin: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .hint-btn:hover {
            background: var(--primary);
            color: white;
        }

        .hint-btn:disabled {
            background: #eee;
            border-color: #ccc;
            color: #999;
            cursor: not-allowed;
        }

        .hint-content {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            font-weight: bold;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: background 0.2s;
        }

        .btn-primary:hover {
            background: #357abd;
        }
        
        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 400px;
            text-align: center;
            animation: popIn 0.3s;
        }

        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .bingo-line {
            position: absolute;
            background: rgba(255, 107, 107, 0.7);
            z-index: 10;
        }

    </style>
</head>
<body>

    <h1>âš—ï¸ ì„¸ìƒì„ ë°”ê¾¸ëŠ” í™”í•™: ê°œë… ë¹™ê³ </h1>
    <p class="subtitle">í™”í•™â…  1ë‹¨ì›: í™”í•™ì˜ ìœ ìš©ì„± íƒêµ¬ ì‹œë®¬ë ˆì´ì…˜</p>

    <div class="container">
        <div id="stage-1" class="stage active">
            <h2>Step 1. í•¨ê»˜í•  ë©˜í†  í™”í•™ìë¥¼ ì„ íƒí•˜ì„¸ìš”</h2>
            <p>ì´ í™”í•™ìê°€ ì‹¤í—˜ì„ ì§„í–‰í•˜ë©° íŒíŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>
            <div class="chemist-grid" id="chemist-list">
                </div>
            <button class="btn-primary" id="btn-to-setup" disabled>ì„ íƒ ì™„ë£Œ</button>
        </div>

        <div id="stage-2" class="stage">
            <h2>Step 2. ë¹™ê³ íŒì„ ì„¤ê³„í•˜ì„¸ìš”</h2>
            <p>ì•„ë˜ ìš©ì–´ë¥¼ ë“œë˜ê·¸í•˜ì—¬ ë¹™ê³ íŒì˜ ë¹ˆì¹¸ì„ ì±„ì›Œì£¼ì„¸ìš”. (9ê°œ í•„ìˆ˜)</p>
            
            <div class="game-layout">
                <div class="board-area">
                    <div class="bingo-board" id="setup-board">
                        </div>
                </div>
                <div class="sidebar-area">
                    <div class="term-bank" id="term-bank">
                        </div>
                    <div class="mentor-box">
                        <div class="mentor-title">
                            <span id="setup-mentor-icon">ğŸ‘¨â€ğŸ”¬</span>
                            <span id="setup-mentor-name">ë©˜í† </span>ì˜ ì¡°ì–¸
                        </div>
                        <p>ìš©ì–´ë¥¼ ë°°ì¹˜í•˜ë©´ì„œ ê° ë‹¨ì–´ì˜ ì˜ë¯¸ë¥¼ í•œ ë²ˆì”© ìƒê°í•´ë³´ì„¸ìš”. ë°°ì¹˜ê°€ ëë‚˜ë©´ [ì‹¤í—˜ ì‹œì‘] ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>
                    </div>
                    <button class="btn-primary" id="btn-start-game" disabled>ì‹¤í—˜ ì‹œì‘ (Bingo Start)</button>
                </div>
            </div>
        </div>

        <div id="stage-3" class="stage">
            <h2>Step 3. ê°œë… íƒêµ¬ ë° ë¹™ê³  ì™„ì„±</h2>
            <div class="game-layout">
                <div class="board-area">
                    <div class="bingo-board" id="game-board">
                        </div>
                </div>
                <div class="sidebar-area">
                    <div class="mentor-box">
                        <div class="mentor-title">
                            <span id="game-mentor-icon">ğŸ‘¨â€ğŸ”¬</span>
                            <span id="game-mentor-name">ë©˜í† </span>
                        </div>
                        <p id="mentor-message">ë¬¸ì œë¥¼ ë³´ê³  í•´ë‹¹í•˜ëŠ” í™”í•™ ìš©ì–´ë¥¼ ë¹™ê³ íŒì—ì„œ í´ë¦­í•˜ì„¸ìš”!</p>
                    </div>

                    <div class="quiz-card">
                        <h3>ğŸ” ì´ ìš©ì–´ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?</h3>
                        <div class="hint-controls">
                            <button class="hint-btn active" onclick="game.showHint('def')">1. ì •ì˜</button>
                            <button class="hint-btn" onclick="game.showHint('ex')">2. ì‹¤ìƒí™œ ì˜ˆì‹œ</button>
                            <button class="hint-btn" onclick="game.showHint('hist')">3. ì—­ì‚¬ì  ë°œê²¬</button>
                        </div>
                        <div class="hint-content" id="current-clue">
                            [ì‹¤í—˜ ì‹œì‘] ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë¬¸ì œê°€ ë‚˜ì˜µë‹ˆë‹¤.
                        </div>
                    </div>
                    
                    <div style="margin-top: 10px; text-align: center;">
                        <span id="bingo-count" style="font-size: 1.2rem; font-weight: bold; color: var(--accent);">í˜„ì¬ ë¹™ê³ : 0ì¤„</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="feedback-modal">
        <div class="modal-content">
            <h2 id="fb-title">ì •ë‹µì…ë‹ˆë‹¤!</h2>
            <p id="fb-desc">ì„¤ëª… í…ìŠ¤íŠ¸</p>
            <button class="btn-primary" onclick="game.nextTurn()">ë‹¤ìŒ ë¬¸ì œ</button>
        </div>
    </div>

    <div class="modal-overlay" id="win-modal">
        <div class="modal-content">
            <h2>ğŸ‰ ì‹¤í—˜ ì„±ê³µ! (3ë¹™ê³  ë‹¬ì„±)</h2>
            <p>í™”í•™ì˜ ìœ ìš©ì„±ê³¼ ì£¼ìš” ê°œë…ì„ í›Œë¥­í•˜ê²Œ ì—°ê²°í–ˆìŠµë‹ˆë‹¤.</p>
            <div id="final-stats" style="margin: 20px 0; background:#f5f5f5; padding:10px; border-radius:10px;"></div>
            <button class="btn-primary" onclick="location.reload()">ë‹¤ì‹œ ì‹¤í—˜í•˜ê¸°</button>
        </div>
    </div>

<script>
/**
 * Data: Chemists and Terms based on High School Chemistry I Curriculum
 */
const CHEMISTS = [
    { id: 'hbr', name: 'í”„ë¦¬ì¸  í•˜ë²„', icon: 'ğŸ­', desc: 'ê³µê¸° ì¤‘ì˜ ì§ˆì†Œë¡œ ì•”ëª¨ë‹ˆì•„ë¥¼ í•©ì„±í•˜ì—¬ ì‹ëŸ‰ ë¬¸ì œë¥¼ í•´ê²°í–ˆì–´ìš”.' },
    { id: 'wal', name: 'ìºëŸ¬ë”ìŠ¤', icon: 'ğŸ‘•', desc: 'ìµœì´ˆì˜ í•©ì„± ì„¬ìœ ì¸ ë‚˜ì¼ë¡ ì„ ê°œë°œí•˜ì—¬ ì˜ë¥˜ í˜ëª…ì„ ì¼ìœ¼ì¼°ì–´ìš”.' },
    { id: 'men', name: 'ë©˜ë¸ë ˆì˜ˆí”„', icon: 'ğŸ“Š', desc: 'ì›ì†Œë“¤ì˜ ê·œì¹™ì„±ì„ ë°œê²¬í•˜ê³  ì£¼ê¸°ìœ¨í‘œë¥¼ ë§Œë“¤ì—ˆì–´ìš”.' },
    { id: 'dal', name: 'ëŒí„´', icon: 'âš«', desc: 'ì›ìì„¤ì„ ì œì•ˆí•˜ì—¬ í˜„ëŒ€ í™”í•™ì˜ ê¸°ì´ˆë¥¼ ë‹¤ì¡Œì–´ìš”.' },
    { id: 'lav', name: 'ë¼ë¶€ì•„ì§€ì—', icon: 'âš–ï¸', desc: 'ì§ˆëŸ‰ ë³´ì¡´ ë²•ì¹™ì„ ë°œê²¬í•˜ê³  ì—°ì†Œì˜ ì›ë¦¬ë¥¼ ë°í˜”ì–´ìš”.' },
    { id: 'boy', name: 'ë³´ì¼', icon: 'ğŸˆ', desc: 'ê¸°ì²´ì˜ ì••ë ¥ê³¼ ë¶€í”¼ ê´€ê³„ë¥¼ ë°í˜€ëƒˆì–´ìš”.' }
];

const TERMS = [
    { id: 'nh3', name: 'ì•”ëª¨ë‹ˆì•„', def: 'ì§ˆì†Œì™€ ìˆ˜ì†Œê°€ ë°˜ì‘í•˜ì—¬ ìƒì„±ë˜ëŠ” í™”í•©ë¬¼ì…ë‹ˆë‹¤.', ex: 'í™”í•™ ë¹„ë£Œì˜ ì›ë£Œë¡œ ì‚¬ìš©ë˜ì–´ ì‹ëŸ‰ ì¦ì‚°ì— ê¸°ì—¬í–ˆìŠµë‹ˆë‹¤.', hist: 'í•˜ë²„ì™€ ë³´ìŠˆê°€ ëŒ€ëŸ‰ ìƒì‚° ê³µì •ì„ ê°œë°œí–ˆìŠµë‹ˆë‹¤.' },
    { id: 'fe', name: 'ì² ', def: 'ì§€ê°ì— í’ë¶€í•˜ê²Œ ë§¤ì¥ëœ ê¸ˆì† ì›ì†Œì…ë‹ˆë‹¤.', ex: 'ë‹¨ë‹¨í•˜ì—¬ ê±´ì¶•ë¬¼, ë‹¤ë¦¬, ìë™ì°¨, ê¸°ê³„ ë“±ì˜ ì¬ë£Œë¡œ ì“°ì…ë‹ˆë‹¤.', hist: 'ì œë ¨ ê¸°ìˆ ì˜ ë°œë‹¬ë¡œ ë†ê¸°êµ¬ì™€ ë¬´ê¸°ê°€ í˜ì‹ ì ìœ¼ë¡œ ë°œì „í–ˆìŠµë‹ˆë‹¤.' },
    { id: 'fossil', name: 'í™”ì„ ì—°ë£Œ', def: 'ì˜¤ëœ ì„¸ì›” ë™ì•ˆ ë•…ì†ì— ë¬»íŒ ë™ì‹ë¬¼ì˜ ìœ í•´ë¡œ ë§Œë“¤ì–´ì§„ ì—ë„ˆì§€ì›ì…ë‹ˆë‹¤.', ex: 'ì„íƒ„, ì„ìœ , ì²œì—°ê°€ìŠ¤ê°€ ìˆìœ¼ë©° ë‚œë°©ê³¼ ìˆ˜ì†¡ì— ì“°ì…ë‹ˆë‹¤.', hist: 'ì‚°ì—… í˜ëª…ì˜ ì£¼ë™ë ¥ì´ ë˜ì—ˆìœ¼ë‚˜ í™˜ê²½ ë¬¸ì œì˜ ì›ì¸ì´ê¸°ë„ í•©ë‹ˆë‹¤.' },
    { id: 'nylon', name: 'ë‚˜ì¼ë¡ ', def: 'ìºëŸ¬ë”ìŠ¤ê°€ ê°œë°œí•œ ìµœì´ˆì˜ í•©ì„± ì„¬ìœ ì…ë‹ˆë‹¤.', ex: 'ì§ˆê¸°ê³  ì‹ ì¶•ì„±ì´ ì¢‹ì•„ ìŠ¤íƒ€í‚¹, ë°§ì¤„, ì¹«ì†” ë“±ì— ì“°ì…ë‹ˆë‹¤.', hist: '"ê±°ë¯¸ì¤„ë³´ë‹¤ ê°€ëŠ˜ê³  ê°•ì² ë³´ë‹¤ ê°•í•˜ë‹¤"ë¼ëŠ” ë¬¸êµ¬ë¡œ ì†Œê°œë˜ì—ˆìŠµë‹ˆë‹¤.' },
    { id: 'plastic', name: 'í”Œë¼ìŠ¤í‹±', def: 'ì›ìœ ì—ì„œ ë¶„ë¦¬í•œ ë‚˜í”„íƒ€ë¥¼ ì›ë£Œë¡œ ë§Œë“  ê³ ë¶„ì í™”í•©ë¬¼ì…ë‹ˆë‹¤.', ex: 'ê°€ë³ê³  ë…¹ìŠ¬ì§€ ì•Šìœ¼ë©° ì„±í˜•ì´ ì‰¬ì›Œ ìƒí™œìš©í’ˆ ì „ë°˜ì— ì“°ì…ë‹ˆë‹¤.', hist: 'ëŒ€ëŸ‰ ìƒì‚°ì´ ê°€ëŠ¥í•´ì§€ë©° ìœ ë¦¬, ë‚˜ë¬´, ê¸ˆì†ì„ ëŒ€ì²´í–ˆìŠµë‹ˆë‹¤.' },
    { id: 'concrete', name: 'ì½˜í¬ë¦¬íŠ¸', def: 'ì‹œë©˜íŠ¸, ëª¨ë˜, ìê°ˆ, ë¬¼ì„ ì„ì–´ ë§Œë“  ê±´ì¶• ìì¬ì…ë‹ˆë‹¤.', ex: 'ì•„íŒŒíŠ¸, ëŒ, ë„ë¡œ ê±´ì„¤ì— í•„ìˆ˜ì ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.', hist: 'ë¡œë§ˆ ì‹œëŒ€ë¶€í„° ì‚¬ìš©ë˜ì—ˆìœ¼ë©° í˜„ëŒ€ ë„ì‹œ ê±´ì„¤ì˜ ì£¼ì—­ì…ë‹ˆë‹¤.' },
    { id: 'fire', name: 'ë¶ˆ', def: 'ë¬¼ì§ˆì´ ì‚°ì†Œì™€ ê²©ë ¬í•˜ê²Œ ë°˜ì‘í•˜ë©° ë¹›ê³¼ ì—´ì„ ë‚´ëŠ” í˜„ìƒì…ë‹ˆë‹¤.', ex: 'ìŒì‹ì„ ìµí˜€ ë¨¹ê³ , ì¶”ìœ„ë¥¼ í”¼í•˜ë©°, ë§¹ìˆ˜ë¡œë¶€í„° ë³´í˜¸í•˜ëŠ” ë° ì“°ì˜€ìŠµë‹ˆë‹¤.', hist: 'ì¸ë¥˜ ë¬¸ëª… ì‹œì‘ì˜ ê°€ì¥ ì¤‘ìš”í•œ ë°œê²¬ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤.' },
    { id: 'aspirin', name: 'ì•„ìŠ¤í”¼ë¦°', def: 'ë²„ë“œë‚˜ë¬´ ê»ì§ˆ ì„±ë¶„ì„ í•©ì„±í•˜ì—¬ ë§Œë“  ì§„í†µì œì…ë‹ˆë‹¤.', ex: 'ë‘í†µ, ì¹˜í†µ í•´ì—´ì œë¡œ ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” ì˜ì•½í’ˆì…ë‹ˆë‹¤.', hist: 'í˜¸í”„ë§Œì´ í•©ì„±í•˜ì—¬ ì¸ë¥˜ì˜ ìˆ˜ëª… ì—°ì¥ì— ê¸°ì—¬í–ˆìŠµë‹ˆë‹¤.' },
    { id: 'cement', name: 'ì‹œë©˜íŠ¸', def: 'ì„íšŒì„ì„ ê°€ì—´í•˜ì—¬ ë§Œë“  ê°€ë£¨ í˜•íƒœì˜ ì ‘ì°©ì œì…ë‹ˆë‹¤.', ex: 'ì½˜í¬ë¦¬íŠ¸ì˜ ì£¼ì›ë£Œë¡œ ê±´ì¶•ë¬¼ì˜ ë¼ˆëŒ€ë¥¼ ë§Œë“­ë‹ˆë‹¤.', hist: 'ê±´ì¶• ê¸°ìˆ ì˜ í˜ëª…ì„ ê°€ì ¸ì˜¨ ì¤‘ìš”í•œ ê±´ì¶• ì¬ë£Œì…ë‹ˆë‹¤.' },
    { id: 'alkali', name: 'ì—¼ìƒ‰', def: 'ì²œì—° ì„¬ìœ ë‚˜ í•©ì„± ì„¬ìœ ì— ìƒ‰ì„ ì…íˆëŠ” ê¸°ìˆ ì…ë‹ˆë‹¤.', ex: 'ì˜·ì„ ë‹¤ì–‘í•œ ìƒ‰ìƒìœ¼ë¡œ ë§Œë“¤ì–´ ê°œì„±ì„ í‘œí˜„í•˜ê²Œ í•´ì¤ë‹ˆë‹¤.', hist: 'ìµœì´ˆì˜ í•©ì„± ì—¼ë£Œ ëª¨ë¸Œ(Mauve)ëŠ” ìš°ì—°íˆ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.' },
    { id: 'ethanol', name: 'ì—íƒ„ì˜¬', def: 'ìˆ ì˜ ì£¼ì„±ë¶„ì´ë©° ì†Œë…ì œë‚˜ ì—°ë£Œë¡œë„ ì“°ì´ëŠ” íƒ„ì†Œ í™”í•©ë¬¼ì…ë‹ˆë‹¤.', ex: 'ë³‘ì›ì—ì„œ ì†Œë…ìš©ìœ¼ë¡œ ì“°ê±°ë‚˜ ë°”ì´ì˜¤ ì—°ë£Œë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.', hist: 'ë°œíš¨ ê¸°ìˆ ì„ í†µí•´ ì¸ë¥˜ê°€ ì˜¤ë«ë™ì•ˆ ì´ìš©í•´ì™”ìŠµë‹ˆë‹¤.' },
    { id: 'methane', name: 'ë©”í…Œì¸', def: 'ê°€ì¥ ê°„ë‹¨í•œ íƒ„ì†Œ í™”í•©ë¬¼ë¡œ LNGì˜ ì£¼ì„±ë¶„ì…ë‹ˆë‹¤.', ex: 'ë„ì‹œê°€ìŠ¤ë¡œ ê°€ì •ì—ì„œ ë‚œë°©ê³¼ ì¡°ë¦¬ì— ì‚¬ìš©í•©ë‹ˆë‹¤.', hist: 'ì™„ì „ ì—°ì†Œ ì‹œ ì´ì‚°í™”íƒ„ì†Œì™€ ë¬¼ì„ ìƒì„±í•©ë‹ˆë‹¤.' }
];

/**
 * Game Logic
 */
const game = {
    state: {
        selectedChemist: null,
        boardTerms: Array(9).fill(null), // IDs of terms on board
        targetTerm: null, // Current question answer
        markedIndices: [], // Indices (0-8) marked correct
        hintsShown: 0,
        turnCount: 0,
        correctCount: 0
    },

    init: () => {
        game.renderChemists();
        game.renderTermBank();
        game.renderSetupBoard();
    },

    // Stage 1: Chemist
    renderChemists: () => {
        const list = document.getElementById('chemist-list');
        list.innerHTML = CHEMISTS.map(c => `
            <div class="chemist-card" onclick="game.selectChemist('${c.id}', this)">
                <span class="chemist-icon">${c.icon}</span>
                <h3>${c.name}</h3>
                <p style="font-size:0.8rem; color:#666;">${c.desc}</p>
            </div>
        `).join('');
    },

    selectChemist: (id, el) => {
        document.querySelectorAll('.chemist-card').forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        game.state.selectedChemist = CHEMISTS.find(c => c.id === id);
        document.getElementById('btn-to-setup').disabled = false;
    },

    goToSetup: () => {
        document.getElementById('stage-1').classList.remove('active');
        document.getElementById('stage-2').classList.add('active');
        
        // Update Mentor UI
        const c = game.state.selectedChemist;
        document.getElementById('setup-mentor-icon').innerText = c.icon;
        document.getElementById('setup-mentor-name').innerText = c.name;
    },

    // Stage 2: Setup Board
    renderTermBank: () => {
        const bank = document.getElementById('term-bank');
        bank.innerHTML = TERMS.map(t => `
            <div class="term-item" id="term-${t.id}" draggable="true" 
                 ondragstart="game.drag(event)" data-id="${t.id}">
                ${t.name}
            </div>
        `).join('');
    },

    renderSetupBoard: () => {
        const board = document.getElementById('setup-board');
        board.innerHTML = '';
        for(let i=0; i<9; i++) {
            const cell = document.createElement('div');
            cell.className = 'bingo-cell';
            cell.dataset.index = i;
            cell.ondrop = game.drop;
            cell.ondragover = game.allowDrop;
            // Touch/Click fallback
            cell.onclick = () => game.handleCellClickSetup(i);
            board.appendChild(cell);
        }
    },

    drag: (ev) => {
        ev.dataTransfer.setData("text", ev.target.dataset.id);
    },

    allowDrop: (ev) => {
        ev.preventDefault();
    },

    drop: (ev) => {
        ev.preventDefault();
        const termId = ev.dataTransfer.getData("text");
        const term = TERMS.find(t => t.id === termId);
        const index = ev.target.dataset.index;
        
        if(index !== undefined && term) {
            game.placeTerm(index, term);
        }
    },

    // Simple click-to-place logic for mobile friendliness
    selectedTermForSetup: null,
    
    handleTermClickSetup: (termId) => {
       // Logic to handle click selection if needed (simplified for drag focus here)
    },

    placeTerm: (index, term) => {
        // Remove from existing slot if moved within board
        const existingIndex = game.state.boardTerms.findIndex(tid => tid === term.id);
        if(existingIndex !== -1) {
            game.state.boardTerms[existingIndex] = null;
            document.querySelector(`#setup-board .bingo-cell[data-index='${existingIndex}']`).innerText = '';
        }

        game.state.boardTerms[index] = term.id;
        
        // Update UI
        const cells = document.querySelectorAll('#setup-board .bingo-cell');
        cells[index].innerText = term.name;
        cells[index].style.backgroundColor = '#e8f4fd';

        // Update Bank Style
        document.querySelectorAll('.term-item').forEach(el => {
            if(game.state.boardTerms.includes(el.dataset.id)) {
                el.classList.add('used');
            } else {
                el.classList.remove('used');
            }
        });

        // Check if full
        const isFull = game.state.boardTerms.every(t => t !== null);
        document.getElementById('btn-start-game').disabled = !isFull;
    },

    startGame: () => {
        document.getElementById('stage-2').classList.remove('active');
        document.getElementById('stage-3').classList.add('active');

        // Copy board layout
        const gameBoard = document.getElementById('game-board');
        gameBoard.innerHTML = '';
        game.state.boardTerms.forEach((tid, i) => {
            const term = TERMS.find(t => t.id === tid);
            const cell = document.createElement('div');
            cell.className = 'bingo-cell';
            cell.dataset.index = i;
            cell.dataset.id = tid;
            cell.innerText = term.name;
            cell.onclick = () => game.checkAnswer(i, tid);
            gameBoard.appendChild(cell);
        });

        // Setup Mentor
        const c = game.state.selectedChemist;
        document.getElementById('game-mentor-icon').innerText = c.icon;
        document.getElementById('game-mentor-name').innerText = c.name;

        game.nextTurn();
    },

    // Stage 3: Play
    nextTurn: () => {
        document.getElementById('feedback-modal').style.display = 'none';
        
        // Pick a term that is on the board AND not yet marked
        const availableIndices = game.state.boardTerms
            .map((tid, idx) => ({ tid, idx }))
            .filter(item => !game.state.markedIndices.includes(item.idx));

        if(availableIndices.length === 0) {
            // Should be handled by win condition, but safety check
            return; 
        }

        const target = availableIndices[Math.floor(Math.random() * availableIndices.length)];
        game.state.targetTerm = TERMS.find(t => t.id === target.tid);
        
        // Reset Hints
        game.state.hintsShown = 1;
        game.updateHintUI();
    },

    updateHintUI: () => {
        const t = game.state.targetTerm;
        const el = document.getElementById('current-clue');
        const btns = document.querySelectorAll('.hint-btn');
        
        btns.forEach((b, i) => {
            if (i < game.state.hintsShown) {
                b.classList.add('active');
                b.disabled = false;
            } else {
                b.classList.remove('active');
                b.disabled = false; // User can click to reveal
            }
        });

        let text = '';
        if(game.state.hintsShown === 1) text = `[ì •ì˜]<br>${t.def}`;
        if(game.state.hintsShown === 2) text = `[ì‹¤ìƒí™œ ì˜ˆì‹œ]<br>${t.ex}`;
        if(game.state.hintsShown === 3) text = `[ì—­ì‚¬ì  ë°œê²¬]<br>${t.hist}`;
        
        el.innerHTML = text;
    },

    showHint: (type) => {
        if(type === 'def') game.state.hintsShown = 1;
        if(type === 'ex') game.state.hintsShown = 2;
        if(type === 'hist') game.state.hintsShown = 3;
        game.updateHintUI();
    },

    checkAnswer: (index, termId) => {
        if(game.state.markedIndices.includes(index)) return; // Already marked

        const isCorrect = termId === game.state.targetTerm.id;
        const modal = document.getElementById('feedback-modal');
        const title = document.getElementById('fb-title');
        const desc = document.getElementById('fb-desc');

        if(isCorrect) {
            // Correct
            game.state.markedIndices.push(index);
            document.querySelectorAll('#game-board .bingo-cell')[index].classList.add('marked');
            
            title.innerText = "ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤!";
            title.style.color = "var(--primary)";
            desc.innerHTML = `
                <strong>${game.state.targetTerm.name}</strong><br><br>
                ${game.state.targetTerm.def}<br>
                (ë¹™ê³ íŒì— O í‘œì‹œê°€ ë˜ì—ˆìŠµë‹ˆë‹¤)
            `;
            modal.style.display = 'flex';
            
            game.checkBingo();
        } else {
            // Incorrect
            title.innerText = "ğŸ¤” ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”";
            title.style.color = "var(--accent)";
            desc.innerHTML = `
                ì„ íƒí•œ ìš©ì–´ëŠ” <strong>${TERMS.find(t=>t.id===termId).name}</strong>ì…ë‹ˆë‹¤.<br>
                ë©˜í† ì˜ ì„¤ëª…ì„ ë‹¤ì‹œ ì½ê³  íŒíŠ¸ë¥¼ í™œìš©í•´ë³´ì„¸ìš”!
            `;
            // Just close button logic modified slightly for incorrect
            const btn = modal.querySelector('button');
            const oldOnClick = btn.onclick;
            btn.innerText = "ë‹¤ì‹œ ì‹œë„";
            btn.onclick = () => {
                modal.style.display = 'none';
                btn.onclick = oldOnClick; // restore
                btn.innerText = "ë‹¤ìŒ ë¬¸ì œ";
            };
            modal.style.display = 'flex';
        }
    },

    checkBingo: () => {
        const wins = [
            [0,1,2], [3,4,5], [6,7,8], // Rows
            [0,3,6], [1,4,7], [2,5,8], // Cols
            [0,4,8], [2,4,6]           // Diagonals
        ];

        let bingoCount = 0;
        wins.forEach(line => {
            if(line.every(i => game.state.markedIndices.includes(i))) {
                bingoCount++;
            }
        });

        document.getElementById('bingo-count').innerText = `í˜„ì¬ ë¹™ê³ : ${bingoCount}ì¤„`;

        if(bingoCount >= 3) {
            setTimeout(() => {
                document.getElementById('win-modal').style.display = 'flex';
                document.getElementById('final-stats').innerHTML = `
                    <p>í•¨ê»˜í•œ ë©˜í† : ${game.state.selectedChemist.name}</p>
                    <p>í•™ìŠµí•œ ìš©ì–´: 9ê°œ</p>
                    <p>ê³¼í•™ê³¼ ì¸ë¥˜ì˜ ë°œì „ ê´€ê³„ë¥¼ ì´í•´í–ˆìŠµë‹ˆë‹¤!</p>
                `;
            }, 500);
        }
    }
};

// Event Listeners setup
document.getElementById('btn-to-setup').addEventListener('click', game.goToSetup);
document.getElementById('btn-start-game').addEventListener('click', game.startGame);

// Initialize
game.init();

</script>
</body>
</html>