<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ìƒ ì‹¤í—˜ì‹¤: ë¬¼ê³¼ ì‹ìš©ìœ  ë¶„ë¦¬í•˜ê¸°</title>
    <style>
        /* --- ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì„¤ì • --- */
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background-color: #f0f4f8;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            color: #333;
        }

        h1 { margin: 15px 0; color: #2c3e50; font-size: 1.5rem; }
        
        /* --- ë ˆì´ì•„ì›ƒ --- */
        .container {
            display: flex;
            gap: 20px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            max-width: 900px;
            width: 95%;
            height: 80vh;
        }

        /* --- ì™¼ìª½: ì„¤ëª… ë° ì œì–´ íŒ¨ë„ --- */
        .control-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
            border-right: 2px solid #eee;
            padding-right: 20px;
        }

        .guide-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            border-left: 5px solid #2196f3;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .status-display {
            font-weight: bold;
            color: #e67e22;
            min-height: 20px;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: #fafafa;
            padding: 15px;
            border-radius: 8px;
        }

        .control-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        button {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
        }

        .btn-stopper { background: #607d8b; color: white; }
        .btn-stopper.open { background: #4caf50; }
        .btn-reset { background: #ff5722; color: white; margin-top: auto;}

        input[type="range"] { width: 60%; cursor: pointer; }

        /* --- ì˜¤ë¥¸ìª½: ì‹œë®¬ë ˆì´ì…˜ ì˜ì—­ --- */
        .sim-area {
            flex: 1.5;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 20px;
            background: radial-gradient(circle at center, #ffffff 0%, #f0f0f0 100%);
            border-radius: 8px;
            overflow: hidden;
        }

        /* --- ë¶„ë³„ê¹”ë•Œê¸° ê·¸ë˜í”½ --- */
        .stand {
            position: absolute;
            width: 10px;
            height: 90%;
            background: #555;
            left: 30%;
            bottom: 0;
        }
        .stand-clamp {
            position: absolute;
            width: 60px;
            height: 10px;
            background: #555;
            left: 30%;
            top: 180px;
        }

        .funnel-container {
            position: relative;
            width: 120px;
            height: 250px;
            z-index: 2;
        }

        /* ê¹”ë•Œê¸° ëª¸ì²´ */
        .funnel-body {
            position: relative;
            width: 100px;
            height: 140px;
            margin: 0 auto;
            border: 3px solid #aaa;
            border-top: none;
            border-radius: 10% 10% 50% 50% / 10% 10% 90% 90%;
            background: rgba(255, 255, 255, 0.2);
            overflow: hidden;
            box-shadow: inset 5px 0 10px rgba(255,255,255,0.5);
        }

        /* ì•¡ì²´ ì¸µ */
        .liquid-oil {
            position: absolute;
            top: 0;
            width: 100%;
            background: rgba(255, 235, 59, 0.8); /* ë…¸ë€ìƒ‰ ì‹ìš©ìœ  */
            transition: height 0.1s linear;
        }
        .liquid-water {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: rgba(33, 150, 243, 0.8); /* íŒŒë€ìƒ‰ ë¬¼ */
            transition: height 0.1s linear;
        }

        /* ë§ˆê°œ (Stopper) */
        .stopper {
            width: 40px;
            height: 20px;
            background: #795548;
            margin: -20px auto 0;
            border-radius: 5px 5px 0 0;
            transition: transform 0.3s;
            cursor: pointer;
            z-index: 5;
        }
        .stopper.open {
            transform: translateY(-15px) rotate(15deg);
        }

        /* ì½• (Valve) */
        .stem {
            width: 10px;
            height: 80px;
            background: rgba(200,200,200,0.3);
            border-left: 2px solid #aaa;
            border-right: 2px solid #aaa;
            margin: 0 auto;
            position: relative;
        }
        
        .valve-handle {
            width: 40px;
            height: 10px;
            background: #d32f2f;
            position: absolute;
            top: 20px;
            left: -15px;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.1s;
        }

        /* íë¥´ëŠ” ë¬¼ì¤„ê¸° */
        .stream {
            position: absolute;
            top: 250px; /* ê¹”ë•Œê¸° ë */
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            background: #2196f3;
            height: 0; /* ë™ì ìœ¼ë¡œ ë³€ê²½ */
            z-index: 1;
            opacity: 0.8;
        }

        /* ë¹„ì»¤ */
        .beaker {
            position: absolute;
            bottom: 20px;
            width: 100px;
            height: 120px;
            border: 2px solid #aaa;
            border-top: none;
            background: rgba(255,255,255,0.3);
            border-radius: 0 0 10px 10px;
            overflow: hidden;
            display: flex;
            flex-direction: column-reverse; /* ì•¡ì²´ê°€ ì•„ë˜ë¶€í„° ì°¨ì˜¤ë¦„ */
        }

        .beaker-liquid {
            width: 100%;
            height: 0%;
            background: #2196f3; /* ì´ˆê¸°ì—” ë¬¼ */
            transition: height 0.1s, background 0.5s;
        }

        .label {
            position: absolute;
            font-size: 0.8rem;
            color: #666;
            background: rgba(255,255,255,0.8);
            padding: 2px 5px;
            border-radius: 3px;
        }

    </style>
</head>
<body>

    <h1>ğŸ§ª ì‹¤í—˜ 7: ë¬¼ê³¼ ì‹ìš©ìœ  ë¶„ë¦¬í•˜ê¸°</h1>

    <div class="container">
        <div class="control-panel">
            <div class="guide-box" id="guideText">
                <strong>[1ë‹¨ê³„] ê´€ì°°í•˜ê¸°</strong><br>
                ë¶„ë³„ê¹”ë•Œê¸° ì•ˆì— ë¬¼(íŒŒë‘)ê³¼ ì‹ìš©ìœ (ë…¸ë‘)ê°€ ì¸µì„ ì´ë£¨ê³  ìˆìŠµë‹ˆë‹¤. ì–´ë–¤ ê²ƒì´ ì•„ë˜ì— ìˆë‚˜ìš”?<br>
                ì´ì œ ë¶„ë¦¬ë¥¼ ì¤€ë¹„í•´ë³´ì„¸ìš”.
            </div>
            
            <div class="status-display" id="feedbackMsg">ì¤€ë¹„ ì™„ë£Œ</div>

            <div class="controls">
                <div class="control-item">
                    <span>1. ìœ„ìª½ ë§ˆê°œ</span>
                    <button class="btn-stopper" id="btnStopper" onclick="toggleStopper()">ë§ˆê°œ ë‹«í˜ (Click)</button>
                </div>

                <div class="control-item">
                    <span>2. ë°¸ë¸Œ(ì½•) ì¡°ì ˆ</span>
                    <input type="range" id="valveSlider" min="0" max="100" value="0" oninput="updateValve()">
                </div>
                
                <div style="font-size: 0.8rem; color: #666; text-align: right;">
                    ë°¸ë¸Œ ê°œë°©: <span id="valveValue">0</span>%
                </div>
            </div>

            <div style="margin-top: 10px; font-size: 0.85rem; background: #eee; padding: 10px; border-radius: 5px;">
                <strong>ğŸ“Š í˜„ì¬ ìƒíƒœ</strong><br>
                - ë¬¼ ì”ì—¬ëŸ‰: <span id="waterVolDisplay">50</span> mL<br>
                - ì‹ìš©ìœ  ì”ì—¬ëŸ‰: <span id="oilVolDisplay">50</span> mL
            </div>

            <button class="btn-reset" onclick="resetExperiment()">ğŸ”„ ì‹¤í—˜ ë‹¤ì‹œí•˜ê¸°</button>
        </div>

        <div class="sim-area">
            <div class="stand"></div>
            <div class="stand-clamp"></div>

            <div class="funnel-container">
                <div class="stopper" id="visualStopper" onclick="toggleStopper()"></div>
                
                <div class="funnel-body">
                    <div class="liquid-oil" id="layerOil" style="height: 50%;"></div>
                    <div class="liquid-water" id="layerWater" style="height: 50%;"></div>
                    
                    <div class="label" style="top: 20px; right: 10px;">ì‹ìš©ìœ <br>(ë°€ë„ 0.9)</div>
                    <div class="label" style="bottom: 20px; right: 10px;">ë¬¼<br>(ë°€ë„ 1.0)</div>
                </div>

                <div class="stem">
                    <div class="valve-handle" id="visualValve"></div>
                </div>
            </div>

            <div class="stream" id="streamLine"></div>

            <div class="beaker">
                <div class="beaker-liquid" id="beakerLiquid"></div>
                <div class="label" style="bottom: 5px; width:100%; text-align:center;">ë¹„ì»¤</div>
            </div>
        </div>
    </div>

    <script>
        // --- ìƒíƒœ ë³€ìˆ˜ ---
        let state = {
            stopperOpen: false,
            valveOpen: 0, // 0 to 100
            waterVol: 50, // mL
            oilVol: 50,   // mL
            beakerVol: 0,
            isFailed: false,
            isFinished: false
        };

        const TOTAL_HEIGHT_PX = 140; // ê¹”ë•Œê¸° ì•¡ì²´ ì˜ì—­ í”½ì…€ ë†’ì´
        const MAX_VOL = 100; // ì´ ë¶€í”¼

        // --- DOM ìš”ì†Œ ì°¸ì¡° ---
        const ui = {
            stopperBtn: document.getElementById('btnStopper'),
            visualStopper: document.getElementById('visualStopper'),
            valveSlider: document.getElementById('valveSlider'),
            valveValue: document.getElementById('valveValue'),
            visualValve: document.getElementById('visualValve'),
            feedback: document.getElementById('feedbackMsg'),
            guide: document.getElementById('guideText'),
            layerWater: document.getElementById('layerWater'),
            layerOil: document.getElementById('layerOil'),
            beakerLiquid: document.getElementById('beakerLiquid'),
            stream: document.getElementById('streamLine'),
            waterDisplay: document.getElementById('waterVolDisplay'),
            oilDisplay: document.getElementById('oilVolDisplay')
        };

        // --- ì¡°ì‘ í•¨ìˆ˜ ---

        function toggleStopper() {
            state.stopperOpen = !state.stopperOpen;
            
            // UI ì—…ë°ì´íŠ¸
            if (state.stopperOpen) {
                ui.stopperBtn.textContent = "ë§ˆê°œ ì—´ë¦¼";
                ui.stopperBtn.classList.add('open');
                ui.visualStopper.classList.add('open');
                ui.feedback.textContent = "ë§ˆê°œê°€ ì—´ë ¸ìŠµë‹ˆë‹¤. ê³µê¸°ê°€ í†µí•©ë‹ˆë‹¤.";
                ui.feedback.style.color = "#4caf50";
            } else {
                ui.stopperBtn.textContent = "ë§ˆê°œ ë‹«í˜";
                ui.stopperBtn.classList.remove('open');
                ui.visualStopper.classList.remove('open');
                ui.feedback.textContent = "ë§ˆê°œê°€ ë‹«í˜”ìŠµë‹ˆë‹¤.";
                ui.feedback.style.color = "#333";
            }
        }

        function updateValve() {
            state.valveOpen = parseInt(ui.valveSlider.value);
            ui.valveValue.textContent = state.valveOpen;
            
            // ë°¸ë¸Œ ì‹œê°ì  íšŒì „ (90ë„ê°€ ì—´ë¦¼)
            const rotation = state.valveOpen * 0.9; 
            ui.visualValve.style.transform = `rotate(${rotation}deg)`;

            // ë§ˆê°œ ì•ˆ ì—´ê³  ë°¸ë¸Œ ì—´ì—ˆì„ ë•Œ í”¼ë“œë°±
            if (state.valveOpen > 0 && !state.stopperOpen) {
                ui.feedback.textContent = "âš ï¸ ì£¼ì˜: ë§ˆê°œë¥¼ ì—´ì§€ ì•Šìœ¼ë©´ ì•¡ì²´ê°€ ì˜ ë‚˜ì˜¤ì§€ ì•ŠìŠµë‹ˆë‹¤!";
                ui.feedback.style.color = "red";
            } else if (state.valveOpen > 0) {
                ui.feedback.textContent = "ë°¸ë¸Œê°€ ì—´ë ¸ìŠµë‹ˆë‹¤. ë¶„ë¦¬ ì¤‘...";
                ui.feedback.style.color = "#2196f3";
            }
        }

        function resetExperiment() {
            state = { stopperOpen: false, valveOpen: 0, waterVol: 50, oilVol: 50, beakerVol: 0, isFailed: false, isFinished: false };
            ui.valveSlider.value = 0;
            ui.valveSlider.disabled = false;
            toggleStopper(); // Reset UI calls
            toggleStopper(); // Double toggle to ensure false state logic runs or manual reset
            
            // Force reset visuals
            state.stopperOpen = false;
            ui.stopperBtn.classList.remove('open');
            ui.stopperBtn.textContent = "ë§ˆê°œ ë‹«í˜";
            ui.visualStopper.classList.remove('open');
            
            updateValve();
            updateVisuals();
            
            ui.beakerLiquid.style.backgroundColor = "#2196f3"; // Reset color
            ui.guide.innerHTML = "<strong>[ì‹¤í—˜ ì´ˆê¸°í™”]</strong><br>ë‹¤ì‹œ ì²˜ìŒë¶€í„° ì‹œë„í•´ë³´ì„¸ìš”.<br>1. ë§ˆê°œ ì—´ê¸° -> 2. ë°¸ë¸Œ ì¡°ì‹¬ìŠ¤ëŸ½ê²Œ ì—´ê¸°";
            ui.feedback.textContent = "ì¤€ë¹„ ì™„ë£Œ";
        }

        // --- ë¬¼ë¦¬ ì—”ì§„ ë£¨í”„ (Animation Loop) ---
        function loop() {
            if (state.valveOpen > 0 && !state.isFinished) {
                
                // íë¦„ ë¡œì§
                // ë§ˆê°œê°€ ë‹«í˜€ìˆìœ¼ë©´ íë¦„ì´ ì•„ì£¼ ë¯¸ì„¸í•˜ê±°ë‚˜ ì—†ìŒ (ì—¬ê¸°ì„œëŠ” 0ìœ¼ë¡œ ì²˜ë¦¬í•˜ì—¬ êµìœ¡ì  íš¨ê³¼ ê°•ì¡°)
                let flowFactor = state.stopperOpen ? 1 : 0; 
                
                // ë°¸ë¸Œ ì—´ë¦¼ ì •ë„ì— ë”°ë¥¸ ì†ë„ (ìµœëŒ€ 0.5 unit/frame)
                let speed = (state.valveOpen / 100) * 0.5 * flowFactor;

                if (speed > 0) {
                    // íë¥´ëŠ” ì• ë‹ˆë©”ì´ì…˜ í‘œì‹œ
                    let streamHeight = 160; // ê¹”ë•Œê¸° ëì—ì„œ ë¹„ì»¤ê¹Œì§€
                    ui.stream.style.height = `${streamHeight}px`;

                    // ì•¡ì²´ ê°ì†Œ/ì¦ê°€ ë¡œì§
                    if (state.waterVol > 0) {
                        state.waterVol -= speed;
                        state.beakerVol += speed;
                        if (state.waterVol < 0) state.waterVol = 0;
                    } else if (state.oilVol > 0) {
                        // ë¬¼ì´ ë‹¤ ë¹ ì§€ê³  ê¸°ë¦„ì´ ë‚˜ì˜¤ê¸° ì‹œì‘í•¨ (ì‹¤íŒ¨ ìƒí™©)
                        state.oilVol -= speed;
                        state.beakerVol += speed;
                        
                        if (!state.isFailed) {
                            state.isFailed = true;
                            failExperiment();
                        }
                    }

                    // ëª¨ë“  ì•¡ì²´ ì†Œì§„
                    if (state.waterVol <= 0 && state.oilVol <= 0) {
                        state.isFinished = true;
                        ui.stream.style.height = "0px";
                    }

                } else {
                    // ë°¸ë¸ŒëŠ” ì—´ë ¸ìœ¼ë‚˜ ë§ˆê°œê°€ ë‹«í˜€ ì•ˆë‚˜ì˜¤ëŠ” ìƒí™©
                     ui.stream.style.height = "0px";
                     // ì‹œê°ì  ê¿€ë ì„ íš¨ê³¼ ë“±ì„ ì¶”ê°€í•  ìˆ˜ ìˆìœ¼ë‚˜ ì—¬ê¸°ì„  í…ìŠ¤íŠ¸ ê²½ê³ ë¡œ ëŒ€ì²´
                }

            } else {
                ui.stream.style.height = "0px";
            }
            
            // ì„±ê³µ íŒì • (ë¬¼ë§Œ ë‹¤ ë¹¼ê³  ë°¸ë¸Œ ë‹«ìŒ)
            if (!state.isFinished && !state.isFailed && state.waterVol <= 0.5 && state.valveOpen === 0) {
                state.isFinished = true;
                successExperiment();
            }

            updateVisuals();
            requestAnimationFrame(loop);
        }

        function updateVisuals() {
            // ê¹”ë•Œê¸° ë‚´ë¶€ ë†’ì´ ê³„ì‚° (ë¹„ìœ¨)
            let waterH = (state.waterVol / MAX_VOL) * 100; // %
            let oilH = (state.oilVol / MAX_VOL) * 100; // %

            // ì‹¤ì œ DOM ì ìš© (ê¹”ë•Œê¸° ë‚´ë¶€ëŠ” div 2ê°œë¡œ êµ¬ì„±)
            // ì „ì²´ ë†’ì´ ì¤‘ ë¹„ìœ¨ë§Œí¼ ì°¨ì§€í•˜ë„ë¡ ì¡°ì •. 
            // ë‹¨, CSS flexë‚˜ % heightëŠ” ë¶€ëª¨ ê¸°ì¤€ì´ë¯€ë¡œ ì•½ê°„ì˜ ê³„ì‚° í•„ìš”
            // ì—¬ê¸°ì„œëŠ” ì‹¬í”Œí•˜ê²Œ ì „ì²´ 100% ì¤‘ ë¹„ìœ¨ í• ë‹¹
            let totalCurrentVol = state.waterVol + state.oilVol;
            if(totalCurrentVol === 0) totalCurrentVol = 1; // div/0 ë°©ì§€

            // ê¹”ë•Œê¸° ëª¨ì–‘ìƒ ë†’ì´ë¥¼ ë‹¨ìˆœ ë¹„ë¡€ë¡œ í•˜ë©´ ì¢€ ì´ìƒí•˜ì§€ë§Œ, êµìœ¡ìš© ë‹¨ìˆœí™”ë¥¼ ìœ„í•´ ì„ í˜• ë¹„ë¡€ ì ìš©
            ui.layerWater.style.height = `${(state.waterVol / 100) * 100}%`;
            ui.layerOil.style.height = `${(state.oilVol / 100) * 100}%`;
            ui.layerOil.style.top = '0'; // ê¸°ë¦„ì€ í•­ìƒ ìœ„
            
            // ë¹„ì»¤ ë†’ì´
            // ë¹„ì»¤ ìµœëŒ€ ìš©ëŸ‰ 100mL ê°€ì •
            let beakerH = (state.beakerVol / 100) * 100;
            if (beakerH > 95) beakerH = 95; // ë„˜ì¹¨ ë°©ì§€ ì‹œê°í™”
            ui.beakerLiquid.style.height = `${beakerH}%`;
            
            // í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            ui.waterDisplay.textContent = Math.round(state.waterVol);
            ui.oilDisplay.textContent = Math.round(state.oilVol);
        }

        function failExperiment() {
            ui.feedback.textContent = "ì•—! ë°¸ë¸Œë¥¼ ë„ˆë¬´ ëŠ¦ê²Œ ì ê°€ ì‹ìš©ìœ ê°€ ì„ì—¬ ë‚˜ì™”ìŠµë‹ˆë‹¤.";
            ui.feedback.style.color = "red";
            ui.beakerLiquid.style.backgroundColor = "#8bc34a"; // ì„ì¸ ìƒ‰ (ì—°ë‘ìƒ‰)
            ui.stream.style.backgroundColor = "#cddc39"; // ì„ì¸ ë¬¼ì¤„ê¸°
            ui.guide.innerHTML = "<strong>[ì‹¤í—˜ ì‹¤íŒ¨]</strong><br>ìˆœìˆ˜í•œ ë¬¼ ë¶„ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.<br>ê²½ê³„ë©´ì´ ì½•ì— ë‹¿ê¸° ì§ì „ì— ì ê°€ì•¼ í•©ë‹ˆë‹¤. <br>â†’ 'ì‹¤í—˜ ë‹¤ì‹œí•˜ê¸°'ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.";
        }

        function successExperiment() {
            ui.feedback.textContent = "ğŸ‰ ì„±ê³µ! ë¬¼ê³¼ ì‹ìš©ìœ ë¥¼ ì™„ë²½í•˜ê²Œ ë¶„ë¦¬í–ˆìŠµë‹ˆë‹¤!";
            ui.feedback.style.color = "#E91E63";
            ui.guide.innerHTML = "<strong>[í•™ìŠµ ì™„ë£Œ]</strong><br>í›Œë¥­í•©ë‹ˆë‹¤! ë°€ë„ ì°¨ì´ë¥¼ ì´ìš©í•´ ì•„ë˜ì¸µì˜ ë¬¼ë§Œ ë¶„ë¦¬í•´ëƒˆìŠµë‹ˆë‹¤.<br>ë°€ë„ê°€ í° ë¬¼ì§ˆ(ë¬¼)ì´ ë¨¼ì € ë‚˜ì˜¤ëŠ” ê²ƒì„ í™•ì¸í–ˆë‚˜ìš”?";
            ui.valveSlider.disabled = true; // ì¡°ì‘ ì™„ë£Œ
        }

        // ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘
        requestAnimationFrame(loop);

    </script>
</body>
</html>