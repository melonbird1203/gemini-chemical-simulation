<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ìƒ ì‹¤í—˜: í™”í•™ ê²°í•©ê³¼ ë¬¼ì§ˆì˜ ì„±ì§ˆ</title>
    <style>
        :root {
            --primary-color: #4A90E2;
            --secondary-color: #50E3C2;
            --accent-color: #F5A623;
            --text-color: #333;
            --bg-color: #f4f7f6;
            --panel-bg: #ffffff;
        }
        body {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 2rem;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .container {
            display: flex;
            flex-wrap: wrap;
            max-width: 1200px;
            margin: 20px auto;
            gap: 20px;
            padding: 0 10px;
        }
        /* Controls Section */
        .controls {
            flex: 1;
            min-width: 250px;
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .control-group {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
        }
        select, button {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            margin-bottom: 5px;
            cursor: pointer;
        }
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            transition: background 0.3s;
        }
        button:hover {
            background-color: #357ABD;
        }
        button.active {
            background-color: var(--accent-color);
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        /* Visualization Section */
        .visualizer {
            flex: 2;
            min-width: 300px;
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        canvas {
            border: 1px solid #eee;
            border-radius: 5px;
            background: #fff;
        }
        .status-lamp {
            position: absolute;
            top: 30px;
            right: 30px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #444;
            border: 2px solid #222;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
            transition: all 0.3s;
        }
        .status-lamp.on {
            background-color: #FFEB3B;
            box-shadow: 0 0 20px #FFEB3B, inset 0 0 5px rgba(255,255,255,0.8);
            border-color: #FBC02D;
        }

        /* Info & Feedback Section */
        .info-panel {
            flex: 1;
            min-width: 250px;
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .info-box {
            background: #eef2f5;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }
        .feedback {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
            border-left: 5px solid #ffeeba;
        }
        .microscope-view {
            margin-top: 10px;
            border: 2px solid var(--primary-color);
            border-radius: 50%;
            width: 150px;
            height: 150px;
            overflow: hidden;
            background: #fff;
            position: relative;
            margin-left: auto;
            margin-right: auto;
        }
        .microscope-label {
            text-align: center;
            font-size: 0.8rem;
            color: var(--primary-color);
            font-weight: bold;
        }

        /* Assessment */
        .assessment {
            width: 100%;
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        .quiz-option {
            padding: 10px;
            background: #f9f9f9;
            margin: 5px 0;
            border-radius: 5px;
            cursor: pointer;
        }
        .quiz-option:hover {
            background: #e0e0e0;
        }
        .quiz-option.correct {
            background: #d4edda;
            color: #155724;
        }
        .quiz-option.wrong {
            background: #f8d7da;
            color: #721c24;
        }

        h2, h3 { color: var(--primary-color); margin-top: 0; }
    </style>
</head>
<body>

<header>
    <h1>ğŸ§ª í™”í•™ ê°€ìƒ ì‹¤í—˜ì‹¤: ë¬¼ì§ˆì˜ ê²°í•©ê³¼ ì„±ì§ˆ</h1>
    <p>ë¬¼ì§ˆì„ ì„ íƒí•˜ê³ , ë¬¼ì— ë…¹ì—¬ë³´ê³ , ì „ê¸°ë¥¼ í˜ë ¤ë³´ë©° ê²°í•©ì˜ ë¹„ë°€ì„ ë°í˜€ë³´ì„¸ìš”!</p>
</header>

<div class="container">
    <div class="controls">
        <h3>ğŸ›ï¸ ì‹¤í—˜ ì¡°ì‘ íŒ¨ë„</h3>
        
        <div class="control-group">
            <label for="substanceSelect">1. ë¬¼ì§ˆ ì„ íƒ (ì‹œë£Œ)</label>
            <select id="substanceSelect">
                <option value="nacl">ì—¼í™”ë‚˜íŠ¸ë¥¨ (ì†Œê¸ˆ)</option>
                <option value="sugar">ì„¤íƒ• (ì‚¬íƒ•ìˆ˜ìˆ˜)</option>
                <option value="diamond">ë‹¤ì´ì•„ëª¬ë“œ</option>
                <option value="copper">êµ¬ë¦¬ ì¡°ê°</option>
            </select>
            <div id="substanceInfo" class="info-box">
                ì„ íƒëœ ë¬¼ì§ˆ: <strong>ì—¼í™”ë‚˜íŠ¸ë¥¨</strong><br>
                í™”í•™ì‹: NaCl<br>
                ìƒíƒœ: ê³ ì²´ ê²°ì •
            </div>
        </div>

        <div class="control-group">
            <label>2. ìš©ë§¤(ë¬¼) ì¶”ê°€</label>
            <button id="btnWater" onclick="toggleWater()">ğŸ’§ ë¹„ì»¤ì— ë¬¼ ë¶“ê¸°</button>
        </div>

        <div class="control-group">
            <label>3. ì „ê¸° ì „ë„ì„± ì‹¤í—˜</label>
            <button id="btnPower" onclick="togglePower()">âš¡ ì „ì› ìŠ¤ìœ„ì¹˜ ON/OFF</button>
        </div>

        <button onclick="resetLab()" style="background-color: #777; margin-top: 20px;">ğŸ”„ ì‹¤í—˜ ì´ˆê¸°í™”</button>
    </div>

    <div class="visualizer">
        <h3>ğŸ”¬ ì‹¤í—˜ ê´€ì°° ì°½</h3>
        <div class="status-lamp" id="lamp" title="ì „êµ¬"></div>
        <canvas id="labCanvas" width="400" height="300"></canvas>
        <div class="microscope-label">â–¼ ì…ì ëª¨í˜• í™•ëŒ€ (Microscope) â–¼</div>
        <canvas id="microCanvas" width="200" height="200" style="border-radius: 50%; border: 4px solid #333; box-shadow: 0 4px 8px rgba(0,0,0,0.2);"></canvas>
    </div>

    <div class="info-panel">
        <h3>ğŸ“ ë¶„ì„ ë° í”¼ë“œë°±</h3>
        <div id="observationLog" class="info-box">
            <strong>í˜„ì¬ ìƒíƒœ:</strong><br>
            - ë¬¼ì§ˆì´ ë¹„ì»¤ì— ë‹´ê²¨ ìˆìŠµë‹ˆë‹¤.<br>
            - ë¬¼ì´ ì—†ëŠ” ìƒíƒœì…ë‹ˆë‹¤.<br>
            - ì „ì›ì´ êº¼ì ¸ ìˆìŠµë‹ˆë‹¤.
        </div>
        
        <div id="conceptFeedback" class="feedback">
            ë¬¼ì§ˆì„ ì„ íƒí•˜ê³  ì‹¤í—˜ì„ ì‹œì‘í•´ë³´ì„¸ìš”. ì…ìë“¤ì˜ ì›€ì§ì„ì„ ì˜ ê´€ì°°í•´ì•¼ í•©ë‹ˆë‹¤!
        </div>

        <div class="info-box" style="margin-top: 20px;">
            <h4>ğŸ§ª í•µì‹¬ ê°œë… ë…¸íŠ¸</h4>
            <ul style="padding-left: 20px; font-size: 0.85rem;">
                <li><strong>ì´ì˜¨ ê²°í•©:</strong> ì–‘ì´ì˜¨ê³¼ ìŒì´ì˜¨ì˜ ì •ì „ê¸°ì  ì¸ë ¥ (ë¬¼ì— ì˜ ë…¹ìŒ)</li>
                <li><strong>ê³µìœ  ê²°í•©:</strong> ì „ììŒ ê³µìœ  (ëŒ€ë¶€ë¶„ ë¬¼ì— ì•ˆ ë…¹ê±°ë‚˜ ë…¹ì•„ë„ ì „ê¸°ê°€ ì•ˆ í†µí•¨)</li>
                <li><strong>ê¸ˆì† ê²°í•©:</strong> ììœ  ì „ìì˜ ë°”ë‹¤ (ê³ ì²´ì—ì„œë„ ì „ê¸° í†µí•¨)</li>
            </ul>
        </div>
    </div>
</div>

<div class="container">
    <div class="assessment">
        <h3>ğŸ“ ì´í•´ë„ í™•ì¸ í€´ì¦ˆ</h3>
        <p id="quizQuestion">Q. ìœ„ ì‹¤í—˜ì—ì„œ ê³ ì²´ ìƒíƒœì¼ ë•ŒëŠ” ì „ê¸°ê°€ í†µí•˜ì§€ ì•Šì§€ë§Œ, ë¬¼ì— ë…¹ì˜€ì„ ë•Œ ì „ê¸°ê°€ í†µí•˜ëŠ” ë¬¼ì§ˆì€ ë¬´ì—‡ì¸ê°€ìš”?</p>
        <div id="quizOptions">
            </div>
        <div id="quizResult" style="margin-top: 10px; font-weight: bold;"></div>
    </div>
</div>

<script>
    // --- Data & State ---
    const substances = {
        nacl: {
            name: "ì—¼í™”ë‚˜íŠ¸ë¥¨",
            formula: "NaCl",
            type: "ì´ì˜¨ ê²°ì •",
            desc: "ë‚˜íŠ¸ë¥¨ ì´ì˜¨(Na+)ê³¼ ì—¼í™” ì´ì˜¨(Cl-)ì´ ê°•í•˜ê²Œ ê²°í•©ë˜ì–´ ìˆìŠµë‹ˆë‹¤.",
            color: "#eeeeee",
            soluble: true,
            conductSolid: false,
            conductAq: true,
            mp: "801Â°C",
            particleType: "ionic"
        },
        sugar: {
            name: "ì„¤íƒ•",
            formula: "C12H22O11",
            type: "ë¶„ì ê²°ì •",
            desc: "ì„¤íƒ• ë¶„ìë“¤ì´ ì•½í•œ ì¸ë ¥ìœ¼ë¡œ ëª¨ì—¬ ìˆìŠµë‹ˆë‹¤. ì „í•˜ë¥¼ ë ì§€ ì•ŠìŠµë‹ˆë‹¤.",
            color: "#ffffff",
            soluble: true,
            conductSolid: false,
            conductAq: false,
            mp: "186Â°C",
            particleType: "molecular"
        },
        diamond: {
            name: "ë‹¤ì´ì•„ëª¬ë“œ",
            formula: "C",
            type: "ê³µìœ  ê²°ì •",
            desc: "íƒ„ì†Œ ì›ìë“¤ì´ ê·¸ë¬¼ì²˜ëŸ¼ ê°•í•˜ê²Œ ê²°í•©ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë§¤ìš° ë‹¨ë‹¨í•©ë‹ˆë‹¤.",
            color: "#ccf2ff",
            soluble: false,
            conductSolid: false,
            conductAq: false,
            mp: ">3500Â°C",
            particleType: "network"
        },
        copper: {
            name: "êµ¬ë¦¬",
            formula: "Cu",
            type: "ê¸ˆì† ê²°ì •",
            desc: "êµ¬ë¦¬ ì›ì ì‚¬ì´ë¥¼ ììœ  ì „ìê°€ ììœ ë¡­ê²Œ ëŒì•„ë‹¤ë‹ˆê³  ìˆìŠµë‹ˆë‹¤.",
            color: "#b87333",
            soluble: false,
            conductSolid: true,
            conductAq: false, // Insoluble
            mp: "1085Â°C",
            particleType: "metallic"
        }
    };

    let state = {
        substance: 'nacl',
        hasWater: false,
        powerOn: false
    };

    // --- DOM Elements ---
    const canvas = document.getElementById('labCanvas');
    const ctx = canvas.getContext('2d');
    const microCanvas = document.getElementById('microCanvas');
    const mCtx = microCanvas.getContext('2d');
    const lamp = document.getElementById('lamp');
    const feedbackBox = document.getElementById('conceptFeedback');
    const logBox = document.getElementById('observationLog');
    const subSelect = document.getElementById('substanceSelect');
    const subInfo = document.getElementById('substanceInfo');
    const btnWater = document.getElementById('btnWater');
    const btnPower = document.getElementById('btnPower');

    // --- Simulation Logic ---

    function init() {
        subSelect.addEventListener('change', (e) => {
            state.substance = e.target.value;
            resetLab(false); // Keep substance, reset others
            updateUI();
        });
        
        generateQuiz();
        animate();
        updateUI();
    }

    function toggleWater() {
        state.hasWater = !state.hasWater;
        btnWater.innerText = state.hasWater ? "ğŸ”¥ ë¬¼ ì¦ë°œì‹œí‚¤ê¸° (ì´ˆê¸°í™”)" : "ğŸ’§ ë¹„ì»¤ì— ë¬¼ ë¶“ê¸°";
        btnWater.className = state.hasWater ? "active" : "";
        updateUI();
    }

    function togglePower() {
        state.powerOn = !state.powerOn;
        btnPower.innerText = state.powerOn ? "âš¡ ì „ì› ë„ê¸°" : "âš¡ ì „ì› ìŠ¤ìœ„ì¹˜ ON";
        btnPower.className = state.powerOn ? "active" : "";
        updateUI();
    }

    function resetLab(fullReset = true) {
        state.hasWater = false;
        state.powerOn = false;
        if(fullReset) {
            state.substance = 'nacl';
            subSelect.value = 'nacl';
        }
        btnWater.innerText = "ğŸ’§ ë¹„ì»¤ì— ë¬¼ ë¶“ê¸°";
        btnWater.className = "";
        btnPower.innerText = "âš¡ ì „ì› ìŠ¤ìœ„ì¹˜ ON";
        btnPower.className = "";
        updateUI();
    }

    function updateUI() {
        const sub = substances[state.substance];
        
        // Update Info Box
        subInfo.innerHTML = `
            ì„ íƒëœ ë¬¼ì§ˆ: <strong>${sub.name}</strong><br>
            í™”í•™ì‹: ${sub.formula}<br>
            ê²°í•© ìœ í˜•: ${sub.type}
        `;

        // Determine Conductivity
        let isConducting = false;
        let explanation = "";

        if (state.powerOn) {
            if (!state.hasWater) {
                // Solid State
                if (sub.conductSolid) {
                    isConducting = true;
                    explanation = `${sub.name}ì€(ëŠ”) <strong>${sub.type}</strong>ì´ë¯€ë¡œ ê³ ì²´ ìƒíƒœì—ì„œë„ <strong>ììœ  ì „ì</strong>ê°€ ì´ë™í•˜ì—¬ ì „ê¸°ê°€ í†µí•©ë‹ˆë‹¤.`;
                } else {
                    explanation = `${sub.name}ì€(ëŠ”) ê³ ì²´ ìƒíƒœì—ì„œ ì…ìë“¤ì´ ê°•í•˜ê²Œ ê²°í•©ë˜ì–´ ìˆì–´ ì „í•˜ê°€ ì´ë™í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`;
                }
            } else {
                // Aqueous State
                if (sub.soluble) {
                    if (sub.conductAq) {
                        isConducting = true;
                        explanation = `${sub.name}ì´(ê°€) ë¬¼ì— ë…¹ì•„ <strong>ì´ì˜¨í™”</strong>ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì˜¨ë“¤ì´ ììœ ë¡­ê²Œ ì´ë™í•˜ë©° ì „ê¸°ë¥¼ íë¥´ê²Œ í•©ë‹ˆë‹¤.`;
                    } else {
                        explanation = `${sub.name}ì€(ëŠ”) ë¬¼ì— ë…¹ì•˜ì§€ë§Œ, ì „í•˜ë¥¼ ë¤ ì´ì˜¨ì´ ì•„ë‹Œ <strong>ë¶„ì ìƒíƒœ</strong>ë¡œ ì¡´ì¬í•˜ë¯€ë¡œ ì „ê¸°ê°€ í†µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.`;
                    }
                } else {
                    if (sub.conductSolid && sub.particleType === 'metallic') {
                        // Copper in water doesn't dissolve. Still conducts through the metal, but usually we test solution conductivity.
                        // For educational clarity: The solution itself doesn't conduct, the metal does.
                        // Let's assume electrodes are in the water. If metal touches both, it shorts. 
                        // To simplify: Show it doesn't dissolve.
                        explanation = `${sub.name}ì€(ëŠ”) ë¬¼ì— ë…¹ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ì˜¨ì´ ìƒì„±ë˜ì§€ ì•Šì•„ ìˆ˜ìš©ì•¡ì€ ì „ê¸°ë¥¼ í†µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.`;
                    } else {
                        explanation = `${sub.name}ì€(ëŠ”) ë¬¼ì— ë…¹ì§€ ì•Šì•„ ì „í•˜ì˜ ì´ë™ì´ ì—†ìŠµë‹ˆë‹¤.`;
                    }
                }
            }
        } else {
            explanation = "ì „ì› ìŠ¤ìœ„ì¹˜ë¥¼ ì¼œì„œ ì „ê¸° ì „ë„ì„±ì„ í™•ì¸í•´ë³´ì„¸ìš”.";
        }

        // Lamp State
        if (isConducting && state.powerOn) {
            lamp.classList.add('on');
        } else {
            lamp.classList.remove('on');
        }

        // Feedback Update
        feedbackBox.innerHTML = explanation;
        
        // Log Update
        let log = `<strong>í˜„ì¬ ìƒíƒœ:</strong><br>- ë¬¼ì§ˆ: ${sub.name} (${state.hasWater ? 'ìˆ˜ìš©ì•¡/ë¬¼ í¬í•¨' : 'ê³ ì²´'})<br>- ì „ì›: ${state.powerOn ? 'ON' : 'OFF'}`;
        logBox.innerHTML = log;
    }

    // --- Animation & Rendering ---
    
    let particles = [];
    // Initialize particles based on substance
    function initParticles() {
        particles = [];
        const sub = substances[state.substance];
        const count = 30; // Number of particles
        
        for(let i=0; i<count; i++) {
            particles.push({
                x: 150 + (i % 6) * 20,
                y: 200 - Math.floor(i / 6) * 20,
                vx: 0,
                vy: 0,
                charge: (sub.particleType === 'ionic') ? (i % 2 === 0 ? 1 : -1) : 0, // +1 or -1
                type: sub.particleType
            });
        }
    }
    initParticles(); // First run

    // Watch for substance change to reset particles
    let currentSubstance = state.substance;

    function draw() {
        // Clear Canvases
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        mCtx.clearRect(0, 0, microCanvas.width, microCanvas.height);

        // Reset particles if substance changed
        if (currentSubstance !== state.substance) {
            initParticles();
            currentSubstance = state.substance;
        }

        const sub = substances[state.substance];

        // 1. Draw Lab Equipment (Beaker)
        ctx.strokeStyle = "#aaa";
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(100, 50);
        ctx.lineTo(100, 250);
        ctx.lineTo(300, 250);
        ctx.lineTo(300, 50);
        ctx.stroke();

        // Electrodes
        ctx.fillStyle = "#555";
        ctx.fillRect(130, 20, 10, 200); // Left
        ctx.fillRect(260, 20, 10, 200); // Right
        
        // Wires
        ctx.beginPath();
        ctx.moveTo(135, 20); ctx.lineTo(135, 0); ctx.lineTo(350, 0);
        ctx.moveTo(265, 20); ctx.lineTo(265, 0); ctx.lineTo(350, 0); // To lamp logic abstractly
        ctx.stroke();

        // Water
        if (state.hasWater) {
            ctx.fillStyle = "rgba(100, 200, 255, 0.4)";
            ctx.fillRect(100, 100, 200, 150);
        }

        // 2. Particle Logic & Drawing (Main View + Microscope)
        
        // Background for microscope
        mCtx.fillStyle = "#f0f8ff";
        mCtx.fillRect(0,0, 200, 200);

        const subObj = substances[state.substance];
        const isDissolved = state.hasWater && subObj.soluble;

        particles.forEach((p, i) => {
            // Movement Logic
            if (isDissolved) {
                // Random movement (Brownian motion)
                p.x += (Math.random() - 0.5) * 2;
                p.y += (Math.random() - 0.5) * 2;
                
                // Bounds
                if(p.x < 110) p.x = 110; if(p.x > 290) p.x = 290;
                if(p.y < 110) p.y = 110; if(p.y > 240) p.y = 240;

                // Electrical attraction
                if (state.powerOn && subObj.conductAq) {
                    if (p.charge > 0) p.x += 0.5; // Move to cathode (simplified)
                    if (p.charge < 0) p.x -= 0.5; // Move to anode
                }
            } else {
                // Solid state logic
                // Reset to lattice positions roughly if solid
                if (state.hasWater && !subObj.soluble) {
                    // Sunk at bottom
                    p.y = Math.min(p.y + 1, 240);
                } else {
                    // Original stack
                }
            }

            // Draw on Main Canvas (Simplified dots)
            ctx.fillStyle = getParticleColor(p, subObj);
            ctx.beginPath();
            ctx.arc(p.x, p.y, 5, 0, Math.PI*2);
            ctx.fill();
        });

        // 3. Microscope View (Detailed Model)
        drawMicroscopeView(subObj, isDissolved, state.powerOn);
    }

    function getParticleColor(p, sub) {
        if (sub.particleType === 'ionic') {
            return p.charge > 0 ? '#ff6b6b' : '#4ecdc4'; // Red(+), Teal(-)
        } else if (sub.particleType === 'copper') {
            return '#b87333';
        } else if (sub.particleType === 'diamond') {
            return '#ccc';
        }
        return '#ddd';
    }

    function drawMicroscopeView(sub, isDissolved, powerOn) {
        const cx = 100;
        const cy = 100;
        mCtx.textAlign = "center";

        if (sub.particleType === 'ionic') {
            // Draw alternating + -
            if (!isDissolved) {
                // Lattice
                for(let r=0; r<3; r++) {
                    for(let c=0; c<3; c++) {
                        let color = (r+c)%2===0 ? '#ff6b6b' : '#4ecdc4';
                        let label = (r+c)%2===0 ? '+' : '-';
                        drawAtom(mCtx, 60 + c*40, 60 + r*40, color, label);
                    }
                }
                mCtx.fillStyle = "#333";
                mCtx.fillText("ë‹¨ë‹¨í•œ ê²°ì • êµ¬ì¡°", cx, 180);
            } else {
                // Floating free
                drawAtom(mCtx, 50, 50, '#ff6b6b', '+'); // Na
                drawAtom(mCtx, 150, 150, '#4ecdc4', '-'); // Cl
                drawAtom(mCtx, 140, 60, '#ff6b6b', '+');
                drawAtom(mCtx, 60, 140, '#4ecdc4', '-');
                
                // Water molecules
                mCtx.fillStyle = "rgba(0,0,255,0.1)";
                mCtx.beginPath(); mCtx.arc(100,100, 80, 0, Math.PI*2); mCtx.fill();
                
                if (powerOn) {
                     mCtx.fillStyle = "red";
                     mCtx.fillText("ì´ì˜¨ì˜ ì´ë™!", cx, 180);
                     // Arrows
                     mCtx.strokeStyle = "red";
                     mCtx.beginPath(); mCtx.moveTo(60, 50); mCtx.lineTo(80, 50); mCtx.stroke();
                } else {
                    mCtx.fillStyle = "#333";
                    mCtx.fillText("ìˆ˜í™”ëœ ì´ì˜¨", cx, 180);
                }
            }
        } else if (sub.particleType === 'metallic') {
            // Metal cores + electron sea
            for(let r=0; r<3; r++) {
                for(let c=0; c<3; c++) {
                    drawAtom(mCtx, 60 + c*40, 60 + r*40, '#b87333', '+');
                }
            }
            // Electrons
            mCtx.fillStyle = "yellow";
            const time = Date.now() * 0.005;
            for(let i=0; i<10; i++) {
                let ex = (Math.sin(time + i) * 80) + 100;
                let ey = (Math.cos(time*0.5 + i) * 60) + 100;
                mCtx.beginPath(); mCtx.arc(ex, ey, 3, 0, Math.PI*2); mCtx.fill();
            }
            mCtx.fillStyle = "#333";
            mCtx.fillText(powerOn ? "ì „ì ì´ë™ ì¤‘ (ì „ë¥˜)" : "ììœ  ì „ì ë°”ë‹¤", cx, 180);

        } else if (sub.particleType === 'molecular') {
            // Molecules intact
             if (!isDissolved) {
                drawAtom(mCtx, 80, 80, '#ddd', 'S');
                drawAtom(mCtx, 120, 80, '#ddd', 'S');
                drawAtom(mCtx, 100, 120, '#ddd', 'S');
                mCtx.fillStyle = "#333";
                mCtx.fillText("ë¶„ì ê²°ì •", cx, 180);
             } else {
                drawAtom(mCtx, 50, 60, '#ddd', 'S');
                drawAtom(mCtx, 150, 130, '#ddd', 'S');
                drawAtom(mCtx, 100, 100, '#ddd', 'S');
                mCtx.fillStyle = "#333";
                mCtx.fillText("ë…¹ì•˜ìœ¼ë‚˜ ì „í•˜ ì—†ìŒ", cx, 180);
             }
        } else if (sub.particleType === 'network') {
            // Grid
            mCtx.strokeStyle = "#555";
            mCtx.beginPath();
            mCtx.moveTo(60,60); mCtx.lineTo(140,140);
            mCtx.moveTo(140,60); mCtx.lineTo(60,140);
            mCtx.stroke();
            drawAtom(mCtx, 60, 60, '#ccf2ff', 'C');
            drawAtom(mCtx, 140, 60, '#ccf2ff', 'C');
            drawAtom(mCtx, 60, 140, '#ccf2ff', 'C');
            drawAtom(mCtx, 140, 140, '#ccf2ff', 'C');
            mCtx.fillStyle = "#333";
            mCtx.fillText("ê°•í•œ ê³µìœ  ê²°í•©", cx, 180);
        }
    }

    function drawAtom(ctx, x, y, color, text) {
        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.arc(x, y, 15, 0, Math.PI*2);
        ctx.fill();
        ctx.stroke();
        ctx.fillStyle = "#000";
        ctx.font = "12px Arial";
        ctx.fillText(text, x, y+4);
    }

    function animate() {
        draw();
        requestAnimationFrame(animate);
    }

    // --- Quiz Logic ---
    function generateQuiz() {
        const quizContainer = document.getElementById('quizOptions');
        const questions = [
            { text: "ì—¼í™”ë‚˜íŠ¸ë¥¨(NaCl)", correct: true },
            { text: "ì„¤íƒ•(C12H22O11)", correct: false },
            { text: "ë‹¤ì´ì•„ëª¬ë“œ(C)", correct: false },
            { text: "êµ¬ë¦¬(Cu)", correct: false }
        ];

        let html = "";
        questions.forEach((q, idx) => {
            html += `<div class="quiz-option" onclick="checkAnswer(this, ${q.correct})">${idx+1}. ${q.text}</div>`;
        });
        quizContainer.innerHTML = html;
    }

    function checkAnswer(el, isCorrect) {
        const resultBox = document.getElementById('quizResult');
        if (isCorrect) {
            el.className += " correct";
            resultBox.style.color = "green";
            resultBox.innerHTML = "ì •ë‹µì…ë‹ˆë‹¤! ì´ì˜¨ ê²°í•© ë¬¼ì§ˆì€ ê³ ì²´ì—ì„œëŠ” ì´ì˜¨ì´ ê³ ì •ë˜ì–´ ì „ê¸°ê°€ í†µí•˜ì§€ ì•Šì§€ë§Œ, ì•¡ì²´ë‚˜ ìˆ˜ìš©ì•¡ ìƒíƒœì—ì„œëŠ” ì´ì˜¨ì´ ììœ ë¡­ê²Œ ì›€ì§ì—¬ ì „ê¸°ê°€ í†µí•©ë‹ˆë‹¤.";
        } else {
            el.className += " wrong";
            resultBox.style.color = "red";
            resultBox.innerHTML = "ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”. í•´ë‹¹ ë¬¼ì§ˆì˜ ê²°í•© ì¢…ë¥˜ì™€ ìš©í•´ì„±ì„ ê³ ë ¤í•´ë³´ì„¸ìš”.";
        }
    }

    // Start
    init();

</script>

</body>
</html>