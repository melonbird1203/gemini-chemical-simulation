<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ìƒ í™”í•™ ì‹¤í—˜ì‹¤: íš¨ì†Œì˜ ê¸°ì§ˆ íŠ¹ì´ì„±</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #4F46E5;
            --secondary: #10B981;
            --danger: #EF4444;
            --bg: #F3F4F6;
            --panel: #FFFFFF;
        }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); margin: 0; padding: 20px; display: flex; flex-direction: column; height: 100vh; box-sizing: border-box; }
        
        header { text-align: center; margin-bottom: 20px; }
        h1 { margin: 0; color: #1F2937; font-size: 1.5rem; }
        .subtitle { color: #6B7280; font-size: 0.9rem; }

        .container { display: flex; gap: 20px; flex: 1; height: calc(100% - 80px); }
        
        /* ì™¼ìª½ ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .controls { flex: 1; background: var(--panel); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; gap: 15px; overflow-y: auto; }
        
        .control-group { border-bottom: 1px solid #E5E7EB; padding-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; color: #374151; font-size: 0.9rem; }
        select, input[type="range"] { width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #D1D5DB; margin-bottom: 5px; }
        .value-display { font-size: 0.85rem; color: var(--primary); text-align: right; font-weight: bold; }
        
        .btn-group { display: flex; gap: 10px; margin-top: auto; }
        button { flex: 1; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-start { background: var(--primary); color: white; }
        .btn-reset { background: #6B7280; color: white; }
        button:hover { opacity: 0.9; }

        /* ì¤‘ì•™ ì‹¤í—˜ í™”ë©´ */
        .stage-area { flex: 2; display: flex; flex-direction: column; gap: 20px; }
        
        .microscope-view { 
            flex: 1; background: #fff; border-radius: 12px; border: 2px solid #E5E7EB; 
            position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
        }
        
        /* ì• ë‹ˆë©”ì´ì…˜ ìš”ì†Œ ìŠ¤íƒ€ì¼ */
        .molecule { position: absolute; transition: transform 0.5s ease-out; }
        .enzyme { width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; border-radius: 50%; z-index: 2; transition: all 0.3s; }
        .substrate { width: 40px; height: 40px; border-radius: 8px; position: absolute; z-index: 1; }
        
        /* í”¼ë“œë°± ë©”ì‹œì§€ */
        .feedback-box {
            background: #EFF6FF; border-left: 4px solid var(--primary); padding: 15px; border-radius: 6px;
            font-size: 0.9rem; line-height: 1.4; color: #1E3A8A; min-height: 60px; display: flex; align-items: center;
        }

        /* ì˜¤ë¥¸ìª½ ê·¸ë˜í”„ íŒ¨ë„ */
        .data-panel { flex: 1; background: var(--panel); padding: 20px; border-radius: 12px; display: flex; flex-direction: column; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .chart-container { flex: 1; position: relative; }

        /* ë°˜ì‘í˜• */
        @media (max-width: 1024px) { .container { flex-direction: column; height: auto; } .stage-area { height: 400px; } }

    </style>
</head>
<body>

    <header>
        <h1>ğŸ”¬ í™”í•™ ê°€ìƒ ì‹¤í—˜ì‹¤: íš¨ì†Œì˜ íŠ¹ì´ì„±ê³¼ í™œìš©</h1>
        <div class="subtitle">í™”í•™â…¡ 3.ë°˜ì‘ê³¼ ì—ë„ˆì§€ - íš¨ì†Œì˜ ì‘ìš© ì›ë¦¬ íƒêµ¬</div>
    </header>

    <div class="container">
        <div class="controls">
            <h3>ğŸ›ï¸ ì‹¤í—˜ ì¡°ê±´ ì„¤ì •</h3>
            
            <div class="control-group">
                <label>íš¨ì†Œ ì„ íƒ (Enzyme)</label>
                <select id="enzymeSelect" onchange="updateVisuals()">
                    <option value="amylase">ì•„ë°€ë ˆì´ìŠ¤ (íƒ„ìˆ˜í™”ë¬¼ ë¶„í•´)</option>
                    <option value="pepsin">í©ì‹  (ë‹¨ë°±ì§ˆ ë¶„í•´ - ìœ„)</option>
                    <option value="trypsin">íŠ¸ë¦½ì‹  (ë‹¨ë°±ì§ˆ ë¶„í•´ - ì†Œì¥)</option>
                    <option value="lipase">ë¼ì´í˜ì´ìŠ¤ (ì§€ë°© ë¶„í•´)</option>
                </select>
                <div id="enzymeDesc" style="font-size: 0.8rem; color: #666; margin-top: 5px;"></div>
            </div>

            <div class="control-group">
                <label>ê¸°ì§ˆ ì„ íƒ (Substrate)</label>
                <select id="substrateSelect" onchange="updateVisuals()">
                    <option value="starch">ë…¹ë§ (íƒ„ìˆ˜í™”ë¬¼)</option>
                    <option value="protein">ë‹¨ë°±ì§ˆ</option>
                    <option value="fat">ì§€ë°©</option>
                    <option value="cellulose">ì…€ë£°ë¡œìŠ¤ (ì„¬ìœ ì§ˆ)</option>
                </select>
            </div>

            <div class="control-group">
                <label>ì˜¨ë„ (Temperature)</label>
                <input type="range" id="tempRange" min="0" max="80" value="25" oninput="updateLabels()">
                <div class="value-display"><span id="tempVal">25</span> â„ƒ</div>
            </div>

            <div class="control-group">
                <label>pH (ì‚°ì„±ë„)</label>
                <input type="range" id="phRange" min="1" max="12" step="0.5" value="7" oninput="updateLabels()">
                <div class="value-display">pH <span id="phVal">7.0</span></div>
            </div>

            <div class="btn-group">
                <button class="btn-start" onclick="startExperiment()">ì‹¤í—˜ ì‹œì‘ â–¶</button>
                <button class="btn-reset" onclick="resetExperiment()">ì´ˆê¸°í™” â†º</button>
            </div>
        </div>

        <div class="stage-area">
            <div class="microscope-view" id="labView">
                <div style="color: #9CA3AF;">ì‹¤í—˜ ì¡°ê±´ì„ ì„¤ì •í•˜ê³  'ì‹œì‘'ì„ ëˆ„ë¥´ì„¸ìš”.</div>
            </div>
            
            <div class="feedback-box">
                <span id="aiFeedback">ğŸ¤– <b>AI ì¡°êµ:</b> íš¨ì†Œì™€ ê¸°ì§ˆì„ ì„ íƒí•˜ê³  ì˜¨ë„ì™€ pHë¥¼ ì¡°ì ˆí•˜ì—¬ ìµœì ì˜ ë°˜ì‘ ì¡°ê±´ì„ ì°¾ì•„ë³´ì„¸ìš”!</span>
            </div>
        </div>

        <div class="data-panel">
            <h3>ğŸ“ˆ ë°˜ì‘ ì†ë„ ê·¸ë˜í”„</h3>
            <div class="chart-container">
                <canvas id="reactionChart"></canvas>
            </div>
            <button onclick="downloadReport()" style="margin-top: 10px; background: #4B5563; color: white;">ğŸ“„ ê²°ê³¼ PDF ì €ì¥(ì‹œë®¬ë ˆì´ì…˜)</button>
        </div>
    </div>

<script>
    // --- ë°ì´í„° ë° ë¡œì§ ---
    const enzymes = {
        amylase: { target: 'starch', optTemp: 37, optPH: 7, color: '#F59E0B', shape: '50% 50% 0% 50%', desc: "ì¹¨ê³¼ ì·Œì¥ì•¡ì— ì¡´ì¬, ë…¹ë§ ë¶„í•´" },
        pepsin: { target: 'protein', optTemp: 37, optPH: 2, color: '#EF4444', shape: '0% 50% 50% 50%', desc: "ìœ„ì•¡ì— ì¡´ì¬, ê°•í•œ ì‚°ì„±ì—ì„œ ì‘ìš©" },
        trypsin: { target: 'protein', optTemp: 37, optPH: 8, color: '#8B5CF6', shape: '50% 0% 50% 50%', desc: "ì´ìì•¡ì— ì¡´ì¬, ì•½ì—¼ê¸°ì„±ì—ì„œ ì‘ìš©" },
        lipase: { target: 'fat', optTemp: 37, optPH: 7, color: '#10B981', shape: '50% 50% 50% 0%', desc: "ì§€ë°©ì„ ì§€ë°©ì‚°ê³¼ ê¸€ë¦¬ì„¸ë¡¤ë¡œ ë¶„í•´" }
    };

    const substrates = {
        starch: { color: '#FCD34D', shape: 'border-radius: 50%' },
        protein: { color: '#F87171', shape: 'border-radius: 0%' },
        fat: { color: '#34D399', shape: 'border-radius: 30%' },
        cellulose: { color: '#9CA3AF', shape: 'border-radius: 10px' }
    };

    let chart;
    let experimentInterval;
    let time = 0;
    let productAmount = 0;
    let isRunning = false;

    // --- ì´ˆê¸°í™” ë° UI ì—…ë°ì´íŠ¸ ---
    function init() {
        updateLabels();
        updateVisuals();
        initChart();
    }

    function updateLabels() {
        document.getElementById('tempVal').innerText = document.getElementById('tempRange').value;
        document.getElementById('phVal').innerText = document.getElementById('phRange').value;
    }

    function updateVisuals() {
        const enzymeKey = document.getElementById('enzymeSelect').value;
        const enzymeInfo = enzymes[enzymeKey];
        document.getElementById('enzymeDesc').innerText = enzymeInfo.desc;
        
        if(!isRunning) {
            document.getElementById('aiFeedback').innerHTML = `ğŸ¤– <b>ì¤€ë¹„:</b> ${enzymeKey.toUpperCase()} íš¨ì†Œë¥¼ ì„ íƒí–ˆìŠµë‹ˆë‹¤. ì´ íš¨ì†ŒëŠ” ì–´ë–¤ ê¸°ì§ˆê³¼ ë°˜ì‘í• ê¹Œìš”?`;
            renderStaticVisuals();
        }
    }

    function renderStaticVisuals() {
        const stage = document.getElementById('labView');
        stage.innerHTML = ''; // Clear

        // íš¨ì†Œ ì•„ì´ì½˜ (CSSë¡œ ëª¨ì–‘ í‰ë‚´)
        const eType = document.getElementById('enzymeSelect').value;
        const sType = document.getElementById('substrateSelect').value;

        const eDiv = document.createElement('div');
        eDiv.className = 'enzyme';
        eDiv.style.backgroundColor = enzymes[eType].color;
        eDiv.style.borderRadius = enzymes[eType].shape;
        eDiv.innerText = 'E';
        eDiv.style.position = 'absolute';
        eDiv.style.left = '40%';
        eDiv.style.top = '40%';
        eDiv.style.width = '80px';
        eDiv.style.height = '80px';
        
        const sDiv = document.createElement('div');
        sDiv.className = 'substrate';
        sDiv.style.backgroundColor = substrates[sType].color;
        sDiv.style.borderRadius = substrates[sType].shape.split(':')[1];
        sDiv.innerText = 'S';
        sDiv.style.left = '55%';
        sDiv.style.top = '45%';
        sDiv.style.display = 'flex';
        sDiv.style.alignItems = 'center';
        sDiv.style.justifyContent = 'center';
        sDiv.style.color = '#fff';
        sDiv.style.fontWeight = 'bold';

        stage.appendChild(eDiv);
        stage.appendChild(sDiv);
    }

    // --- ì‹¤í—˜ ë¡œì§ ---
    function calculateActivity(eKey, sKey, temp, ph) {
        // 1. ê¸°ì§ˆ íŠ¹ì´ì„± ê²€ì‚¬ (Match Check)
        if (enzymes[eKey].target !== sKey) return 0;

        // 2. ì˜¨ë„ ê³„ì‚° (Bell curve approximation)
        // ìµœì  ì˜¨ë„ì—ì„œ Â±20ë„ ë²—ì–´ë‚˜ë©´ í™œì„± ê¸‰ê²©íˆ ê°ì†Œ. 60ë„ ì´ìƒì´ë©´ ë³€ì„±(0)
        let tempFactor = 0;
        const optT = enzymes[eKey].optTemp;
        
        if (temp > 60 && eKey !== 'polymerase') { // ëŒ€ë¶€ë¶„ì˜ íš¨ì†ŒëŠ” 60ë„ ì´ìƒ ë³€ì„±
            tempFactor = 0; 
        } else {
            const diff = Math.abs(temp - optT);
            tempFactor = Math.max(0, 1 - (diff / 25)); // 25ë„ ì°¨ì´ë‚˜ë©´ 0
        }

        // 3. pH ê³„ì‚°
        const optP = enzymes[eKey].optPH;
        const phDiff = Math.abs(ph - optP);
        let phFactor = Math.max(0, 1 - (phDiff / 2.5)); // pH 2.5 ì°¨ì´ë‚˜ë©´ 0

        return tempFactor * phFactor; // ì¢…í•© í™œì„±ë„ (0~1)
    }

    function startExperiment() {
        if (isRunning) return;
        isRunning = true;
        time = 0;
        productAmount = 0;
        chart.data.labels = [];
        chart.data.datasets[0].data = [];
        chart.update();

        const eKey = document.getElementById('enzymeSelect').value;
        const sKey = document.getElementById('substrateSelect').value;
        const temp = parseFloat(document.getElementById('tempRange').value);
        const ph = parseFloat(document.getElementById('phRange').value);

        const activity = calculateActivity(eKey, sKey, temp, ph);
        
        // í”¼ë“œë°± ìƒì„±
        generateFeedback(activity, eKey, sKey, temp, ph);
        
        // ì• ë‹ˆë©”ì´ì…˜ ë° ê·¸ë˜í”„ ë£¨í”„
        const stage = document.getElementById('labView');
        stage.innerHTML = ''; // Clear for animation
        
        experimentInterval = setInterval(() => {
            time += 1;
            // í™œì„±ë„ì— ë”°ë¼ ìƒì„±ë¬¼ ì¦ê°€ (í¬í™” ê³¡ì„  í˜•íƒœ)
            // ë°˜ì‘ ì†ë„ = k * [S] (ì—¬ê¸°ì„  ë‹¨ìˆœí™”í•˜ì—¬ í™œì„±ë„ ê¸°ë°˜ ë¡œê·¸/ë£¨íŠ¸ í•¨ìˆ˜)
            const increment = activity * (100 - productAmount) * 0.05; 
            productAmount += increment;

            // ê·¸ë˜í”„ ì—…ë°ì´íŠ¸
            chart.data.labels.push(time + 's');
            chart.data.datasets[0].data.push(productAmount);
            chart.update();

            // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ (ì…ì ìƒì„±)
            if (activity > 0.1 && Math.random() > 0.5) {
                createProductParticle(stage, enzymes[eKey].color);
            }

            // ì¢…ë£Œ ì¡°ê±´
            if (time >= 20 || productAmount >= 99) {
                clearInterval(experimentInterval);
                isRunning = false;
                document.getElementById('aiFeedback').innerHTML += " <br>âœ… <b>ì‹¤í—˜ ì¢…ë£Œ:</b> ê²°ê³¼ ê·¸ë˜í”„ë¥¼ í™•ì¸í•˜ê³  PDFë¡œ ì €ì¥í•´ ë³´ì„¸ìš”.";
            }
        }, 500);
    }

    function createProductParticle(stage, color) {
        const p = document.createElement('div');
        p.style.width = '10px';
        p.style.height = '10px';
        p.style.background = color;
        p.style.borderRadius = '50%';
        p.style.position = 'absolute';
        p.style.left = '50%';
        p.style.top = '50%';
        p.style.opacity = '0.8';
        stage.appendChild(p);

        // í™•ì‚° ì• ë‹ˆë©”ì´ì…˜
        const angle = Math.random() * Math.PI * 2;
        const velocity = 50 + Math.random() * 50;
        const tx = Math.cos(angle) * velocity;
        const ty = Math.sin(angle) * velocity;

        p.animate([
            { transform: 'translate(0,0)', opacity: 1 },
            { transform: `translate(${tx}px, ${ty}px)`, opacity: 0 }
        ], {
            duration: 1000,
            easing: 'ease-out'
        }).onfinish = () => p.remove();
    }

    function generateFeedback(activity, eKey, sKey, temp, ph) {
        let msg = "";
        
        // 1. ê¸°ì§ˆ íŠ¹ì´ì„± ì²´í¬
        if (enzymes[eKey].target !== sKey) {
            msg = `âš ï¸ <b>ë°˜ì‘ ì‹¤íŒ¨:</b> ${eKey}ëŠ” ${sKey}ì™€ ê²°í•©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ê¸°ì§ˆ íŠ¹ì´ì„± ë¶ˆì¼ì¹˜)<br>ëª¨ì–‘ì´ ë§ëŠ” ì—´ì‡ ì™€ ìë¬¼ì‡  ê´€ê³„ê°€ ì•„ë‹™ë‹ˆë‹¤.`;
        } 
        // 2. ì˜¨ë„ ì²´í¬
        else if (temp > 60) {
            msg = `ğŸ”¥ <b>ë³€ì„±ë¨:</b> ì˜¨ë„ê°€ ë„ˆë¬´ ë†’ìŠµë‹ˆë‹¤(${temp}â„ƒ). íš¨ì†Œ ë‹¨ë°±ì§ˆì˜ êµ¬ì¡°ê°€ íŒŒê´´ë˜ì–´ ê¸°ëŠ¥ì„ ìƒì‹¤í–ˆìŠµë‹ˆë‹¤.`;
        } else if (activity < 0.3) {
             msg = `ğŸ“‰ <b>í™œì„± ë‚®ìŒ:</b> í˜„ì¬ ì¡°ê±´(ì˜¨ë„ ${temp}â„ƒ, pH ${ph})ì€ íš¨ì†Œê°€ ì¼í•˜ê¸° í˜ë“  í™˜ê²½ì…ë‹ˆë‹¤. ìµœì  ì¡°ê±´ì„ ì°¾ì•„ë³´ì„¸ìš”.`;
        } else {
             msg = `âœ¨ <b>ë°˜ì‘ í™œë°œ:</b> ì¡°ê±´ì´ ì™„ë²½í•©ë‹ˆë‹¤! íš¨ì†Œì™€ ê¸°ì§ˆì´ ê²°í•©í•˜ì—¬ ë¹ ë¥´ê²Œ ìƒì„±ë¬¼ì„ ë§Œë“¤ê³  ìˆìŠµë‹ˆë‹¤.`;
        }

        document.getElementById('aiFeedback').innerHTML = `ğŸ¤– ${msg}`;
    }

    function resetExperiment() {
        clearInterval(experimentInterval);
        isRunning = false;
        time = 0;
        productAmount = 0;
        document.getElementById('labView').innerHTML = '<div style="color: #9CA3AF;">ë‹¤ì‹œ ì‹œì‘í•˜ë ¤ë©´ ì¡°ê±´ì„ ë³€ê²½í•˜ê³  ì‹œì‘ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</div>';
        chart.data.labels = [];
        chart.data.datasets[0].data = [];
        chart.update();
        updateVisuals();
    }

    function downloadReport() {
        alert("ì‹¤ì œ í•™ìŠµ í™˜ê²½ì—ì„œëŠ” í˜„ì¬ í™”ë©´ê³¼ ê·¸ë˜í”„ ë°ì´í„°ê°€ í¬í•¨ëœ PDFê°€ ìƒì„±ë©ë‹ˆë‹¤.\n\n[ê²°ê³¼ ìš”ì•½]\n- íš¨ì†Œ: " + document.getElementById('enzymeSelect').value + "\n- ìµœëŒ€ ìƒì„±ë¬¼: " + Math.round(productAmount) + "%");
    }

    // --- ì°¨íŠ¸ ì„¤ì • ---
    function initChart() {
        const ctx = document.getElementById('reactionChart').getContext('2d');
        chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'ìƒì„±ë¬¼ ì–‘ (%)',
                    data: [],
                    borderColor: '#4F46E5',
                    backgroundColor: 'rgba(79, 70, 229, 0.2)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: true, max: 100, title: { display: true, text: 'ë°˜ì‘ ì§„í–‰ë¥ ' } },
                    x: { title: { display: true, text: 'ì‹œê°„ (ì´ˆ)' } }
                },
                animation: false
            }
        });
    }

    // ì´ˆê¸° ì‹¤í–‰
    init();

</script>
</body>
</html>