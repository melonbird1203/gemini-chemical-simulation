<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1ì°¨ ë°˜ì‘ ì†ë„ì™€ ë°˜ê°ê¸° ì‹œë®¬ë ˆì´ì…˜</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --bg-color: #f4f7f6;
            --panel-bg: #ffffff;
        }
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
        }
        header {
            grid-column: 1 / -1;
            background: var(--primary-color);
            color: white;
            padding: 20px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        header h1 { margin: 0; font-size: 1.5rem; }
        
        /* ì œì–´ íŒ¨ë„ ìŠ¤íƒ€ì¼ */
        .control-panel {
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .input-group {
            margin-bottom: 20px;
        }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="range"] { width: 100%; }
        .value-display { font-size: 0.9rem; color: var(--accent-color); font-weight: bold; }
        
        button {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }
        .btn-start { background-color: var(--accent-color); color: white; }
        .btn-start:hover { background-color: #2980b9; }
        .btn-reset { background-color: #e74c3c; color: white; }
        .btn-pdf { background-color: #27ae60; color: white; margin-top: 20px;}

        /* ê²°ê³¼ í™”ë©´ ìŠ¤íƒ€ì¼ */
        .display-area {
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .chart-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .chart-container {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            height: 250px;
        }
        .info-panel {
            background: #eaf2f8;
            padding: 15px;
            border-radius: 8px;
            border-left: 5px solid var(--accent-color);
            margin-bottom: 20px;
        }
        
        /* í€´ì¦ˆ ì„¹ì…˜ */
        .quiz-section {
            grid-column: 1 / -1;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .quiz-item { margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .feedback { font-weight: bold; margin-top: 5px; display: none; }
        .correct { color: green; }
        .incorrect { color: red; }

    </style>
</head>
<body>

<div class="container" id="capture-area">
    <header>
        <div>
            <h1>âš—ï¸ 1ì°¨ ë°˜ì‘ ì†ë„ì™€ ë°˜ê°ê¸° Lab</h1>
            <small>ê³ ë“±í•™êµ í™”í•™ II > í™”í•™ ë°˜ì‘ ì†ë„ì™€ ì´‰ë§¤</small>
        </div>
        <div>
            <span style="font-size: 0.9em;">ìƒíƒœ: <span id="status-text">ì¤€ë¹„</span></span>
        </div>
    </header>

    <aside class="control-panel">
        <h3>ğŸ§ª ì‹¤í—˜ ì¡°ê±´ ì„¤ì •</h3>
        
        <div class="input-group">
            <label>ì´ˆê¸° ë†ë„ $[A]_0$ (M)</label>
            <input type="range" id="initConc" min="0.1" max="2.0" step="0.1" value="1.0">
            <div class="value-display" id="val-initConc">1.0 M</div>
        </div>

        <div class="input-group">
            <label>ë°˜ì‘ ì†ë„ ìƒìˆ˜ $k$ (/s)</label>
            <input type="range" id="rateK" min="0.01" max="0.5" step="0.01" value="0.1">
            <div class="value-display" id="val-rateK">0.1 /s</div>
        </div>

        <div class="info-panel">
            <h4>ğŸ“Š ì´ë¡ ì  ë°˜ê°ê¸° ì˜ˆì¸¡</h4>
            <p>$t_{1/2} = \frac{0.693}{k}$</p>
            <p>ì˜ˆìƒ ë°˜ê°ê¸°: <strong id="calc-halflife">6.93</strong> ì´ˆ</p>
        </div>

        <button class="btn-start" onclick="toggleSimulation()">â–¶ ì‹¤í—˜ ì‹œì‘/ì¼ì‹œì •ì§€</button>
        <button class="btn-reset" onclick="resetSimulation()">â†º ì´ˆê¸°í™”</button>
        <button class="btn-pdf" onclick="exportPDF()">ğŸ“„ ê²°ê³¼ ë¦¬í¬íŠ¸ ì €ì¥ (PDF)</button>
    </aside>

    <main class="display-area">
        <div class="info-panel" id="ai-feedback">
            <strong>ğŸ¤– AI Lab Partner:</strong><br>
            ì´ˆê¸° ë†ë„ì™€ ì†ë„ ìƒìˆ˜ë¥¼ ì„¤ì •í•˜ê³  ì‹¤í—˜ì„ ì‹œì‘í•´ë³´ì„¸ìš”.<br>
            ê·¸ë˜í”„ê°€ ê·¸ë ¤ì§€ë©´ ë°˜ê°ê¸°ì˜ ê·œì¹™ì„±ì„ ì°¾ì•„ë³´ì„¸ìš”.
        </div>

        <div class="chart-grid">
            <div class="chart-container">
                <canvas id="chartConc"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="chartLn"></canvas>
            </div>
        </div>
        
        <div class="chart-container" style="height: 200px;">
            <canvas id="chartRate"></canvas>
        </div>
    </main>

    <section class="quiz-section">
        <h3>ğŸ“ ê°œë… í™•ì¸ í€´ì¦ˆ</h3>
        
        <div class="quiz-item">
            <p><strong>Q1.</strong> ìœ„ ì‹¤í—˜ì—ì„œ $\ln[A]$ì™€ ì‹œê°„ $t$ì˜ ê·¸ë˜í”„ ëª¨ì–‘ì€ ì–´ë– í•œê°€ìš”?</p>
            <select id="q1-select">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="curve">ê³¡ì„  (ì§€ìˆ˜ ê°ì†Œ)</option>
                <option value="linear">ì§ì„  (ê¸°ìš¸ê¸° ìŒìˆ˜)</option>
                <option value="parabola">í¬ë¬¼ì„ </option>
            </select>
            <button onclick="checkAnswer('q1', 'linear')">í™•ì¸</button>
            <div id="q1-feedback" class="feedback"></div>
        </div>

        <div class="quiz-item">
            <p><strong>Q2.</strong> 1ì°¨ ë°˜ì‘ì—ì„œ ì´ˆê¸° ë†ë„ $[A]_0$ë¥¼ 2ë°°ë¡œ ëŠ˜ë¦¬ë©´ ë°˜ê°ê¸°($t_{1/2}$)ëŠ” ì–´ë–»ê²Œ ë˜ë‚˜ìš”?</p>
            <select id="q2-select">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="double">2ë°°ë¡œ ëŠ˜ì–´ë‚œë‹¤</option>
                <option value="half">ì ˆë°˜ìœ¼ë¡œ ì¤„ì–´ë“ ë‹¤</option>
                <option value="constant">ë³€í•˜ì§€ ì•ŠëŠ”ë‹¤</option>
            </select>
            <button onclick="checkAnswer('q2', 'constant')">í™•ì¸</button>
            <div id="q2-feedback" class="feedback"></div>
        </div>
    </section>
</div>

<script>
    // ë³€ìˆ˜ ì´ˆê¸°í™”
    let initialConc = 1.0;
    let k = 0.1;
    let time = 0;
    let isRunning = false;
    let timerInterval;
    const maxTime = 100; // ìµœëŒ€ 100ì´ˆê¹Œì§€ ì‹œë®¬ë ˆì´ì…˜

    // DOM ìš”ì†Œ ì°¸ì¡°
    const sliderConc = document.getElementById('initConc');
    const sliderK = document.getElementById('rateK');
    const displayConc = document.getElementById('val-initConc');
    const displayK = document.getElementById('val-rateK');
    const displayHalfLife = document.getElementById('calc-halflife');
    const feedbackBox = document.getElementById('ai-feedback');

    // Chart.js ì¸ìŠ¤í„´ìŠ¤
    let chartConc, chartLn, chartRate;

    // ì´ˆê¸°í™” í•¨ìˆ˜
    function init() {
        initCharts();
        updateValues();
        
        sliderConc.addEventListener('input', updateValues);
        sliderK.addEventListener('input', updateValues);
    }

    function updateValues() {
        initialConc = parseFloat(sliderConc.value);
        k = parseFloat(sliderK.value);
        
        displayConc.innerText = initialConc.toFixed(1) + " M";
        displayK.innerText = k.toFixed(2) + " /s";
        
        // ë°˜ê°ê¸° ê³„ì‚° (0.693 / k)
        const tHalf = 0.6931 / k;
        displayHalfLife.innerText = tHalf.toFixed(2);

        if (!isRunning && time === 0) {
            feedbackBox.innerHTML = `<strong>ğŸ¤– AI Lab Partner:</strong><br>ì„¤ì •ëœ kê°’(${k})ì— ë”°ë¥´ë©´ ë°˜ê°ê¸°ëŠ” ì•½ <strong>${tHalf.toFixed(2)}ì´ˆ</strong>ì…ë‹ˆë‹¤. ì‹¤í—˜ìœ¼ë¡œ í™•ì¸í•´ë³¼ê¹Œìš”?`;
        }
    }

    // ì°¨íŠ¸ ì´ˆê¸°í™” ì„¤ì •
    function initCharts() {
        const commonOptions = {
            responsive: true,
            maintainAspectRatio: false,
            animation: false,
            elements: { point: { radius: 0 } } // ì  ìˆ¨ê¸°ê¸° (ì„±ëŠ¥ ìµœì í™”)
        };

        // 1. [A] vs t
        const ctx1 = document.getElementById('chartConc').getContext('2d');
        chartConc = new Chart(ctx1, {
            type: 'line',
            data: { labels: [], datasets: [{ label: '[A] (M)', data: [], borderColor: '#3498db', borderWidth: 2, fill: false }] },
            options: { ...commonOptions, plugins: { title: { display: true, text: 'ë†ë„ [A] vs ì‹œê°„ (t)' } }, scales: { x: { title: { display: true, text: 'ì‹œê°„ (s)' } }, y: { title: { display: true, text: 'ë†ë„ (M)' }, min: 0 } } }
        });

        // 2. ln[A] vs t
        const ctx2 = document.getElementById('chartLn').getContext('2d');
        chartLn = new Chart(ctx2, {
            type: 'line',
            data: { labels: [], datasets: [{ label: 'ln[A]', data: [], borderColor: '#e74c3c', borderWidth: 2, fill: false }] },
            options: { ...commonOptions, plugins: { title: { display: true, text: 'ìì—°ë¡œê·¸ ln[A] vs ì‹œê°„ (t)' } }, scales: { x: { title: { display: true, text: 'ì‹œê°„ (s)' } }, y: { title: { display: true, text: 'ln[A]' } } } }
        });

        // 3. v vs [A]
        const ctx3 = document.getElementById('chartRate').getContext('2d');
        chartRate = new Chart(ctx3, {
            type: 'scatter', // ì†ë„ vs ë†ë„ëŠ” ì‚°ì ë„ í˜•íƒœê°€ ì í•©
            data: { datasets: [{ label: 'ë°˜ì‘ ì†ë„ (M/s)', data: [], backgroundColor: '#27ae60' }] },
            options: { ...commonOptions, plugins: { title: { display: true, text: 'ë°˜ì‘ ì†ë„ (v) vs ë†ë„ [A]' } }, scales: { x: { title: { display: true, text: 'ë†ë„ [A] (M)' }, min: 0 }, y: { title: { display: true, text: 'ì†ë„ (M/s)' }, min: 0 } } }
        });
    }

    // ì‹œë®¬ë ˆì´ì…˜ ë¡œì§
    function toggleSimulation() {
        if (isRunning) {
            clearInterval(timerInterval);
            isRunning = false;
            document.getElementById('status-text').innerText = "ì¼ì‹œì •ì§€";
        } else {
            isRunning = true;
            document.getElementById('status-text').innerText = "ì‹¤í—˜ ì¤‘...";
            
            // ì…ë ¥ ë¹„í™œì„±í™”
            sliderConc.disabled = true;
            sliderK.disabled = true;

            timerInterval = setInterval(() => {
                time += 0.5; // 0.5ì´ˆ ë‹¨ìœ„ ì¦ê°€
                
                // 1ì°¨ ë°˜ì‘ì‹ ê³„ì‚°: [A] = [A]0 * e^(-kt)
                const currentConc = initialConc * Math.exp(-k * time);
                const lnConc = Math.log(currentConc);
                const rate = k * currentConc; // v = k[A]

                // ë°ì´í„° ì—…ë°ì´íŠ¸
                chartConc.data.labels.push(time);
                chartConc.data.datasets[0].data.push(currentConc);

                chartLn.data.labels.push(time);
                chartLn.data.datasets[0].data.push(lnConc);

                // ì†ë„ vs ë†ë„ (x: ë†ë„, y: ì†ë„)
                chartRate.data.datasets[0].data.push({ x: currentConc, y: rate });

                // ì°¨íŠ¸ ê°±ì‹ 
                chartConc.update();
                chartLn.update();
                chartRate.update();

                // í”¼ë“œë°± ì—…ë°ì´íŠ¸ (ë°˜ê°ê¸° ë„ë‹¬ ì‹œ)
                const ratio = currentConc / initialConc;
                if (ratio <= 0.5 && ratio > 0.48) {
                    feedbackBox.innerHTML = `<strong>ğŸ” ê´€ì°° í¬ì¸íŠ¸:</strong><br>í˜„ì¬ ë†ë„ê°€ ì´ˆê¸° ë†ë„ì˜ ì•½ 50%ì…ë‹ˆë‹¤.<br>ê²½ê³¼ ì‹œê°„(${time}s)ì´ ì´ë¡ ì  ë°˜ê°ê¸°ì™€ ë¹„ìŠ·í•œê°€ìš”?`;
                }

                if (time >= maxTime || currentConc < 0.01) {
                    toggleSimulation(); // ì¢…ë£Œ
                    document.getElementById('status-text').innerText = "ì‹¤í—˜ ì™„ë£Œ";
                    feedbackBox.innerHTML += `<br><br><strong>âœ… ì‹¤í—˜ ì™„ë£Œ:</strong> ln[A] ê·¸ë˜í”„ê°€ ì§ì„ ì¸ê°€ìš”? ê·¸ë ‡ë‹¤ë©´ ì´ ë°˜ì‘ì€ 1ì°¨ ë°˜ì‘ì…ë‹ˆë‹¤.`;
                }

            }, 100); // 100ms ë§ˆë‹¤ ì—…ë°ì´íŠ¸ (ë¹ ë¥¸ ì‹œë®¬ë ˆì´ì…˜)
        }
    }

    function resetSimulation() {
        clearInterval(timerInterval);
        isRunning = false;
        time = 0;
        document.getElementById('status-text').innerText = "ì¤€ë¹„";
        sliderConc.disabled = false;
        sliderK.disabled = false;
        
        // ì°¨íŠ¸ ë°ì´í„° ì´ˆê¸°í™”
        chartConc.data.labels = [];
        chartConc.data.datasets[0].data = [];
        chartLn.data.labels = [];
        chartLn.data.datasets[0].data = [];
        chartRate.data.datasets[0].data = [];
        
        chartConc.update();
        chartLn.update();
        chartRate.update();
        
        updateValues();
    }

    // í€´ì¦ˆ í™•ì¸ ë¡œì§
    function checkAnswer(questionId, correctAnswer) {
        const select = document.getElementById(questionId + '-select');
        const feedback = document.getElementById(questionId + '-feedback');
        
        if (select.value === correctAnswer) {
            feedback.innerText = "ì •ë‹µì…ë‹ˆë‹¤! ì •í™•í•˜ê²Œ ì´í•´í•˜ì…¨ë„¤ìš”.";
            feedback.className = "feedback correct";
        } else {
            feedback.innerText = "ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”. ê·¸ë˜í”„ë‚˜ ê³µì‹ì„ ë‹¤ì‹œ í™•ì¸í•´ë³¼ê¹Œìš”?";
            feedback.className = "feedback incorrect";
        }
        feedback.style.display = 'block';
    }

    // PDF ë‚´ë³´ë‚´ê¸° (jsPDF ì‚¬ìš©)
    function exportPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        html2canvas(document.querySelector("#capture-area")).then(canvas => {
            const imgData = canvas.toDataURL('image/png');
            const imgProps = doc.getImageProperties(imgData);
            const pdfWidth = doc.internal.pageSize.getWidth();
            const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
            
            doc.text("ì‹¤í—˜ ê²°ê³¼ ë¦¬í¬íŠ¸: 1ì°¨ ë°˜ì‘ ì†ë„", 10, 10);
            doc.addImage(imgData, 'PNG', 0, 20, pdfWidth, pdfHeight);
            doc.save("chemistry_lab_report.pdf");
        });
    }

    // ì´ˆê¸° ì‹¤í–‰
    init();
</script>

</body>
</html>