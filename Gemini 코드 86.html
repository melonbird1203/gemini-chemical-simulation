<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íƒ„ì†Œ í™”í•©ë¬¼ 3D ê°€ìƒ ì¡°ë¦½ ì‹¤í—˜ì‹¤</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #f5f6fa;
            --text-color: #2c3e50;
            --accent-color: #e74c3c;
        }

        body {
            font-family: 'Pretendard', 'Malgun Gothic', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
            color: var(--text-color);
            background-color: #f0f2f5;
            overflow: hidden;
        }

        /* ì™¼ìª½ ì‚¬ì´ë“œë°”: ì»¨íŠ¸ë¡¤ ë° ì •ë³´ */
        #sidebar {
            width: 350px;
            background: white;
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            z-index: 10;
        }

        h1 {
            font-size: 1.2rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
        }

        .control-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
        }

        select, button {
            width: 100%;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #ddd;
            font-size: 1rem;
            cursor: pointer;
            margin-bottom: 10px;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            transition: background 0.3s;
        }

        button:hover {
            background-color: #357abd;
        }

        button.secondary {
            background-color: #95a5a6;
        }

        /* ì •ë³´ íŒ¨ë„ */
        #info-panel {
            background: var(--secondary-color);
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .info-item {
            margin-bottom: 10px;
        }
        
        .info-label {
            font-weight: bold;
            font-size: 0.9rem;
            color: #555;
        }

        .molecule-formula {
            font-family: 'Times New Roman', serif;
            font-weight: bold;
            font-size: 1.2rem;
        }

        /* ë©”ì¸ ì˜ì—­: 3D ìº”ë²„ìŠ¤ */
        #canvas-container {
            flex-grow: 1;
            position: relative;
            background: linear-gradient(to bottom, #1e272e, #353b48);
        }

        #overlay-msg {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            pointer-events: none;
            font-size: 0.9rem;
        }

        /* ë²”ë¡€ */
        #legend {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 8px;
            font-size: 0.8rem;
        }
        .legend-item { display: flex; align-items: center; margin: 4px 0; }
        .dot { width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; display: inline-block; }
        .bg-c { background: #333; }
        .bg-h { background: #fff; border: 1px solid #ccc; }
        .bg-o { background: #e74c3c; }

        /* í€´ì¦ˆ ëª¨ë‹¬ */
        #quiz-modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            width: 400px;
            max-width: 90%;
            text-align: center;
        }
        .quiz-result {
            margin-top: 15px;
            font-weight: bold;
        }
        .correct { color: green; }
        .wrong { color: red; }

    </style>
</head>
<body>

    <div id="sidebar">
        <h1>âš—ï¸ íƒ„ì†Œ í™”í•©ë¬¼ ì‹¤í—˜ì‹¤</h1>
        
        <div class="control-group">
            <label for="molecule-select">ì‹¤í—˜í•  ë¶„ì ì„ íƒ</label>
            <select id="molecule-select">
                <option value="methane">ë©”í…Œì¸ (Methane)</option>
                <option value="ethane">ì—í…Œì¸ (Ethane)</option>
                <option value="ethene">ì—í… (Ethene)</option>
                <option value="ethanol">ì—íƒ„ì˜¬ (Ethanol)</option>
                <option value="acetic_acid">ì•„ì„¸íŠ¸ì‚° (Acetic Acid)</option>
            </select>
        </div>

        <div id="info-panel">
            <div class="info-item">
                <div class="info-label">í™”í•™ì‹</div>
                <div id="display-formula" class="molecule-formula">CHâ‚„</div>
            </div>
            <div class="info-item">
                <div class="info-label">êµ¬ì¡°ì  íŠ¹ì§•</div>
                <div id="display-structure">ì •ì‚¬ë©´ì²´ êµ¬ì¡° (109.5Â°)</div>
            </div>
            <div class="info-item">
                <div class="info-label">ì‹¤ìƒí™œ í™œìš©</div>
                <div id="display-usage">ë„ì‹œê°€ìŠ¤(LNG)ì˜ ì£¼ì„±ë¶„</div>
            </div>
        </div>

        <div style="margin-top: auto;">
            <button onclick="checkUnderstanding()">ğŸ“ ì´í•´ë„ ì ê²€ í€´ì¦ˆ</button>
            <button class="secondary" onclick="resetView()">ğŸ”„ í™”ë©´ ì´ˆê¸°í™”</button>
        </div>
    </div>

    <div id="canvas-container">
        <div id="overlay-msg">ë§ˆìš°ìŠ¤ ì™¼ìª½: íšŒì „ / ì˜¤ë¥¸ìª½: ì´ë™ / íœ : í™•ëŒ€Â·ì¶•ì†Œ</div>
        <div id="legend">
            <div class="legend-item"><span class="dot bg-c"></span>íƒ„ì†Œ (C)</div>
            <div class="legend-item"><span class="dot bg-h"></span>ìˆ˜ì†Œ (H)</div>
            <div class="legend-item"><span class="dot bg-o"></span>ì‚°ì†Œ (O)</div>
        </div>
    </div>

    <div id="quiz-modal">
        <div class="modal-content">
            <h3 id="quiz-question">ë¬¸ì œ</h3>
            <div id="quiz-options"></div>
            <div id="quiz-feedback" class="quiz-result"></div>
            <button onclick="closeQuiz()" style="margin-top:20px;">ë‹«ê¸°</button>
        </div>
    </div>

    <script>
        // --- ë°ì´í„°ë² ì´ìŠ¤: ë¶„ì ì •ë³´ ---
        const molecules = {
            methane: {
                name: "ë©”í…Œì¸",
                formula: "CHâ‚„",
                structure: "ì •ì‚¬ë©´ì²´ êµ¬ì¡° (ê²°í•©ê° ì•½ 109.5Â°)",
                usage: "ê°€ì •ìš© ë„ì‹œê°€ìŠ¤(LNG) ì—°ë£Œ, ë²„ìŠ¤ ì—°ë£Œ",
                atoms: [
                    { elem: 'C', x: 0, y: 0, z: 0 },
                    { elem: 'H', x: 1.2, y: 1.2, z: 1.2 },
                    { elem: 'H', x: -1.2, y: -1.2, z: 1.2 },
                    { elem: 'H', x: -1.2, y: 1.2, z: -1.2 },
                    { elem: 'H', x: 1.2, y: -1.2, z: -1.2 }
                ],
                bonds: [[0,1], [0,2], [0,3], [0,4]],
                quiz: {
                    q: "ë©”í…Œì¸(CHâ‚„) ë¶„ìì˜ ì…ì²´ êµ¬ì¡° ëª¨ì–‘ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                    options: ["ì •ì‚¬ë©´ì²´", "í‰ë©´ ì‚¼ê°í˜•", "ì§ì„ í˜•", "ìœ¡ê°í˜•"],
                    answer: 0
                }
            },
            ethane: {
                name: "ì—í…Œì¸",
                formula: "Câ‚‚Hâ‚†",
                structure: "ë‘ ê°œì˜ ì‚¬ë©´ì²´ê°€ ì—°ê²°ëœ ì…ì²´ êµ¬ì¡°",
                usage: "ëƒ‰ë§¤, ì„ìœ  í™”í•™ ê³µì—…ì˜ ì›ë£Œ",
                atoms: [
                    { elem: 'C', x: -0.8, y: 0, z: 0 },
                    { elem: 'C', x: 0.8, y: 0, z: 0 },
                    { elem: 'H', x: -1.2, y: 1.0, z: 0.8 },
                    { elem: 'H', x: -1.2, y: -1.0, z: 0.8 },
                    { elem: 'H', x: -1.8, y: 0, z: -1.0 },
                    { elem: 'H', x: 1.2, y: 1.0, z: -0.8 },
                    { elem: 'H', x: 1.2, y: -1.0, z: -0.8 },
                    { elem: 'H', x: 1.8, y: 0, z: 1.0 }
                ],
                bonds: [[0,1], [0,2], [0,3], [0,4], [1,5], [1,6], [1,7]],
                quiz: {
                    q: "ì—í…Œì¸(Câ‚‚Hâ‚†)ì˜ íƒ„ì†Œ ê°„ ê²°í•© ë°©ì‹ì€?",
                    options: ["ì´ì¤‘ ê²°í•©", "ì‚¼ì¤‘ ê²°í•©", "ë‹¨ì¼ ê²°í•©", "ì´ì˜¨ ê²°í•©"],
                    answer: 2
                }
            },
            ethene: {
                name: "ì—í…",
                formula: "Câ‚‚Hâ‚„",
                structure: "í‰ë©´ ì‚¼ê°í˜• êµ¬ì¡° (ê²°í•©ê° ì•½ 120Â°)",
                usage: "í”Œë¼ìŠ¤í‹±(í´ë¦¬ì—í‹¸ë Œ) ì›ë£Œ, ê³¼ì¼ ìˆ™ì„± í˜¸ë¥´ëª¬",
                atoms: [
                    { elem: 'C', x: -0.7, y: 0, z: 0 },
                    { elem: 'C', x: 0.7, y: 0, z: 0 },
                    { elem: 'H', x: -1.4, y: 1.0, z: 0 },
                    { elem: 'H', x: -1.4, y: -1.0, z: 0 },
                    { elem: 'H', x: 1.4, y: 1.0, z: 0 },
                    { elem: 'H', x: 1.4, y: -1.0, z: 0 }
                ],
                bonds: [[0,1, 'double'], [0,2], [0,3], [1,4], [1,5]],
                quiz: {
                    q: "ì—í…ì€ ëª¨ë“  ì›ìê°€ ê°™ì€ í‰ë©´ì— ì¡´ì¬í•©ë‹ˆê¹Œ?",
                    options: ["ì˜ˆ (í‰ë©´ êµ¬ì¡°)", "ì•„ë‹ˆì˜¤ (ì…ì²´ êµ¬ì¡°)", "ì•Œ ìˆ˜ ì—†ë‹¤", "ì˜¨ë„ì— ë”°ë¼ ë‹¤ë¥´ë‹¤"],
                    answer: 0
                }
            },
            ethanol: {
                name: "ì—íƒ„ì˜¬",
                formula: "Câ‚‚Hâ‚…OH",
                structure: "ì‚¬ë©´ì²´ì™€ êµ½ì€í˜•ì´ ê²°í•©ëœ í˜•íƒœ",
                usage: "ì†Œë…ì œ, ì•Œì½”ì˜¬ ìŒë£Œ, ì—°ë£Œ",
                atoms: [
                    { elem: 'C', x: -1.0, y: 0, z: 0 },
                    { elem: 'C', x: 0.5, y: 0, z: 0 },
                    { elem: 'O', x: 1.5, y: 0.8, z: 0 }, // Oxygen
                    { elem: 'H', x: 2.2, y: 0.4, z: 0.5 }, // H attached to O
                    { elem: 'H', x: -1.4, y: 0.9, z: 0.5 },
                    { elem: 'H', x: -1.4, y: -0.9, z: 0.5 },
                    { elem: 'H', x: -1.4, y: 0, z: -1.0 },
                    { elem: 'H', x: 0.8, y: -0.5, z: 0.9 },
                    { elem: 'H', x: 0.8, y: -0.5, z: -0.9 }
                ],
                bonds: [[0,1], [1,2], [2,3], [0,4], [0,5], [0,6], [1,7], [1,8]],
                quiz: {
                    q: "ì—íƒ„ì˜¬ì´ ë¬¼ì— ì˜ ë…¹ëŠ” ì´ìœ ì™€ ê´€ë ¨ëœ êµ¬ì¡°ì  íŠ¹ì§•ì€?",
                    options: ["-OH (í•˜ì´ë“œë¡ì‹œê¸°)ê°€ ìˆë‹¤", "íƒ„ì†Œê°€ 2ê°œë‹¤", "ì´ì¤‘ ê²°í•©ì´ ìˆë‹¤", "ì§ì„ í˜•ì´ë‹¤"],
                    answer: 0
                }
            },
            acetic_acid: {
                name: "ì•„ì„¸íŠ¸ì‚°",
                formula: "CHâ‚ƒCOOH",
                structure: "ì¹´ë³µì‹¤ê¸°(-COOH)ë¥¼ í¬í•¨í•œ êµ¬ì¡°",
                usage: "ì‹ì´ˆì˜ ì‹ ë§› ì„±ë¶„, ì˜ì•½í’ˆ ì›ë£Œ",
                atoms: [
                    { elem: 'C', x: -1.0, y: 0, z: 0 },
                    { elem: 'C', x: 0.5, y: 0, z: 0 },
                    { elem: 'O', x: 1.0, y: 1.2, z: 0 }, // Double bonded O
                    { elem: 'O', x: 1.2, y: -0.8, z: 0 }, // Single bonded O
                    { elem: 'H', x: 2.0, y: -0.5, z: 0 }, // H on O
                    { elem: 'H', x: -1.4, y: 0.9, z: 0 },
                    { elem: 'H', x: -1.4, y: -0.5, z: 0.9 },
                    { elem: 'H', x: -1.4, y: -0.5, z: -0.9 }
                ],
                bonds: [[0,1], [1,2, 'double'], [1,3], [3,4], [0,5], [0,6], [0,7]],
                quiz: {
                    q: "ì•„ì„¸íŠ¸ì‚°ì˜ ë¶„ìì‹ì€?",
                    options: ["CHâ‚„", "Câ‚‚Hâ‚…OH", "CHâ‚ƒCOOH", "Câ‚†Hâ‚†"],
                    answer: 2
                }
            }
        };

        // --- Three.js ì´ˆê¸°í™” ---
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(45, container.offsetWidth / container.offsetHeight, 0.1, 100);
        camera.position.set(3, 3, 5);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(container.offsetWidth, container.offsetHeight);
        container.appendChild(renderer.domElement);

        // ì¡°ëª…
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
        dirLight.position.set(5, 10, 7);
        scene.add(dirLight);

        // ì»¨íŠ¸ë¡¤
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;

        // --- ë¶„ì ë Œë”ë§ í•¨ìˆ˜ ---
        const atomColors = { 'C': 0x333333, 'H': 0xffffff, 'O': 0xe74c3c };
        const atomSizes = { 'C': 0.4, 'H': 0.25, 'O': 0.35 };

        let currentMoleculeGroup = new THREE.Group();
        scene.add(currentMoleculeGroup);

        function drawMolecule(key) {
            // ê¸°ì¡´ ëª¨ë¸ ì‚­ì œ
            scene.remove(currentMoleculeGroup);
            currentMoleculeGroup = new THREE.Group();
            
            const data = molecules[key];
            
            // ì •ë³´ íŒ¨ë„ ì—…ë°ì´íŠ¸
            document.getElementById('display-formula').innerText = data.formula;
            document.getElementById('display-structure').innerText = data.structure;
            document.getElementById('display-usage').innerText = data.usage;

            // ì›ì ìƒì„±
            data.atoms.forEach(atom => {
                const geometry = new THREE.SphereGeometry(atomSizes[atom.elem], 32, 32);
                const material = new THREE.MeshPhongMaterial({ color: atomColors[atom.elem], shininess: 100 });
                const mesh = new THREE.Mesh(geometry, material);
                mesh.position.set(atom.x, atom.y, atom.z);
                currentMoleculeGroup.add(mesh);
            });

            // ê²°í•© ìƒì„±
            data.bonds.forEach(bond => {
                const atom1 = data.atoms[bond[0]];
                const atom2 = data.atoms[bond[1]];
                const start = new THREE.Vector3(atom1.x, atom1.y, atom1.z);
                const end = new THREE.Vector3(atom2.x, atom2.y, atom2.z);
                
                const type = bond[2] || 'single';
                
                if (type === 'double') {
                    // ì´ì¤‘ ê²°í•©: ë‘ ê°œì˜ ì–‡ì€ ì‹¤ë¦°ë”
                    createCylinder(start, end, 0.08, -0.1);
                    createCylinder(start, end, 0.08, 0.1);
                } else {
                    // ë‹¨ì¼ ê²°í•©
                    createCylinder(start, end, 0.1, 0);
                }
            });

            scene.add(currentMoleculeGroup);
        }

        function createCylinder(start, end, radius, offset) {
            const distance = start.distanceTo(end);
            const geometry = new THREE.CylinderGeometry(radius, radius, distance, 12);
            const material = new THREE.MeshPhongMaterial({ color: 0xcccccc });
            const cylinder = new THREE.Mesh(geometry, material);
            
            // ìœ„ì¹˜ ë° íšŒì „ ì¡°ì •
            const mid = new THREE.Vector3().addVectors(start, end).multiplyScalar(0.5);
            cylinder.position.copy(mid);
            if(offset !== 0) cylinder.position.x += offset; // ë‹¨ìˆœí™”ëœ ì˜¤í”„ì…‹
            
            cylinder.lookAt(end);
            cylinder.rotateX(Math.PI / 2);
            currentMoleculeGroup.add(cylinder);
        }

        // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
        document.getElementById('molecule-select').addEventListener('change', (e) => {
            drawMolecule(e.target.value);
        });

        function resetView() {
            controls.reset();
            camera.position.set(3, 3, 5);
        }

        // ì´ˆê¸° ì‹¤í–‰
        drawMolecule('methane');

        // ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();

        // ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ëŒ€ì‘
        window.addEventListener('resize', () => {
            camera.aspect = container.offsetWidth / container.offsetHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.offsetWidth, container.offsetHeight);
        });

        // --- í€´ì¦ˆ ë¡œì§ ---
        let currentQuizAnswer = 0;

        function checkUnderstanding() {
            const key = document.getElementById('molecule-select').value;
            const quizData = molecules[key].quiz;
            
            const modal = document.getElementById('quiz-modal');
            const qTitle = document.getElementById('quiz-question');
            const qOptions = document.getElementById('quiz-options');
            const qFeedback = document.getElementById('quiz-feedback');

            qTitle.innerText = quizData.q;
            qOptions.innerHTML = '';
            qFeedback.innerText = '';
            currentQuizAnswer = quizData.answer;

            quizData.options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.innerText = opt;
                btn.onclick = () => {
                    if(index === currentQuizAnswer) {
                        qFeedback.innerText = "ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤! ì •í™•í•˜ê²Œ ì´í•´í•˜ì…¨ë„¤ìš”.";
                        qFeedback.className = "quiz-result correct";
                    } else {
                        qFeedback.innerText = "ğŸ˜… ì•„ì‰½ë„¤ìš”. ë‹¤ì‹œ ìƒê°í•´ë³´ê±°ë‚˜ ëª¨ë¸ì„ ë‹¤ì‹œ ê´€ì°°í•´ë³´ì„¸ìš”.";
                        qFeedback.className = "quiz-result wrong";
                    }
                };
                qOptions.appendChild(btn);
            });

            modal.style.display = 'flex';
        }

        function closeQuiz() {
            document.getElementById('quiz-modal').style.display = 'none';
        }
    </script>
</body>
</html>