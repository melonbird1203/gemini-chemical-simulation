<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì–¼ìŒì˜ ìƒíƒœ ë³€í™” ì‹¤í—˜</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; background: #f0f4f8; text-align: center; padding: 20px; }
        .container { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; max-width: 1000px; margin: 0 auto; }
        .panel { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        canvas { border: 1px solid #ddd; background: #fff; border-radius: 5px; }
        .controls { margin-top: 20px; display: flex; justify-content: center; gap: 10px; align-items: center; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; background: #4a90e2; color: white; border: none; border-radius: 5px; transition: 0.3s; }
        button:hover { background: #357abd; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        select { padding: 10px; font-size: 16px; border-radius: 5px; }
        .status-box { font-weight: bold; color: #333; margin-bottom: 10px; }
        .molecule-view { position: relative; width: 300px; height: 300px; background: #eef; border-radius: 50%; overflow: hidden; border: 4px solid #ccd; margin: 0 auto; }
    </style>
</head>
<body>

    <h2>ğŸŒ¡ï¸ ì–¼ìŒ ê°€ì—´ ê°€ìƒ ì‹¤í—˜</h2>
    
    <div class="container">
        <div class="panel" style="width: 320px;">
            <div class="status-box">í˜„ì¬ ì˜¨ë„: <span id="tempDisplay">-10.0</span>Â°C</div>
            <div class="status-box">ìƒíƒœ: <span id="stateDisplay" style="color:blue">ê³ ì²´ (ì–¼ìŒ)</span></div>
            
            <div class="molecule-view">
                <canvas id="particleCanvas" width="300" height="300"></canvas>
            </div>
            
            <div class="controls">
                <select id="iceAmount">
                    <option value="1">ì–¼ìŒ ì–‘: ì ìŒ (100g)</option>
                    <option value="2" selected>ì–¼ìŒ ì–‘: ë³´í†µ (200g)</option>
                    <option value="3">ì–¼ìŒ ì–‘: ë§ìŒ (300g)</option>
                </select>
            </div>
            <div class="controls">
                <button id="btnStart" onclick="startExperiment()">ğŸ”¥ ê°€ì—´ ì‹œì‘</button>
                <button id="btnReset" onclick="resetExperiment()" disabled>ğŸ”„ ë‹¤ì‹œ í•˜ê¸°</button>
            </div>
        </div>

        <div class="panel">
            <div class="status-box">ì‹œê°„-ì˜¨ë„ ê·¸ë˜í”„</div>
            <canvas id="graphCanvas" width="400" height="350"></canvas>
            <p id="feedback" style="margin-top:10px; font-size: 14px; color: #d32f2f; min-height: 20px;"></p>
        </div>
    </div>

    <script>
        const particleCanvas = document.getElementById('particleCanvas');
        const pCtx = particleCanvas.getContext('2d');
        const graphCanvas = document.getElementById('graphCanvas');
        const gCtx = graphCanvas.getContext('2d');
        
        let animationId;
        let time = 0;
        let temp = -10;
        let isRunning = false;
        let phase = 'solid'; // solid, melting, liquid
        let particles = [];
        let dataPoints = [];
        let iceMassMultiplier = 1;
        let meltingProgress = 0; // 0 to 100

        // ì´ˆê¸° ì…ì ìƒì„±
        function initParticles() {
            particles = [];
            for(let i=0; i<40; i++) {
                particles.push({
                    x: Math.random() * 300,
                    y: Math.random() * 300,
                    vx: 0, vy: 0,
                    baseX: (i % 6) * 40 + 50, // ê²©ì ìœ„ì¹˜ (ê³ ì²´ìš©)
                    baseY: Math.floor(i / 6) * 40 + 50
                });
            }
        }

        // ê·¸ë˜í”„ ì´ˆê¸°í™”
        function drawGraphGrid() {
            gCtx.clearRect(0, 0, 400, 350);
            gCtx.beginPath();
            gCtx.strokeStyle = '#eee';
            for(let i=0; i<=400; i+=40) { gCtx.moveTo(i,0); gCtx.lineTo(i,350); } // xì¶• ê²©ì
            for(let i=0; i<=350; i+=35) { gCtx.moveTo(0,i); gCtx.lineTo(400,i); } // yì¶• ê²©ì
            gCtx.stroke();
            
            // ì¶• ê·¸ë¦¬ê¸°
            gCtx.beginPath();
            gCtx.strokeStyle = '#333';
            gCtx.moveTo(40, 0); gCtx.lineTo(40, 310); // Yì¶•
            gCtx.moveTo(40, 310); gCtx.lineTo(400, 310); // Xì¶•
            gCtx.stroke();
            
            // ë¼ë²¨
            gCtx.font = "12px Arial";
            gCtx.fillStyle = "#333";
            gCtx.fillText("ì‹œê°„", 360, 330);
            gCtx.fillText("ì˜¨ë„(Â°C)", 10, 20);
            gCtx.fillText("0Â°C", 15, 250); // 0ë„ ê¸°ì¤€ì„  (Y=250)
            
            // 0ë„ ê°€ì´ë“œë¼ì¸
            gCtx.beginPath();
            gCtx.setLineDash([5, 5]);
            gCtx.strokeStyle = '#aaa';
            gCtx.moveTo(40, 250); gCtx.lineTo(400, 250);
            gCtx.stroke();
            gCtx.setLineDash([]);
        }

        function updatePhysics() {
            if (!isRunning) return;
            
            time += 0.5; // ì‹œê°„ íë¦„
            
            // ìƒíƒœ ë³€í™” ë¡œì§
            if (phase === 'solid') {
                temp += 0.2; 
                if (temp >= 0) {
                    temp = 0;
                    phase = 'melting';
                    document.getElementById('feedback').innerText = "ğŸ’¡ ì–´ë¼? ê³„ì† ê°€ì—´í•˜ëŠ”ë° ì˜¨ë„ê°€ ì˜¤ë¥´ì§€ ì•Šì•„ìš”!";
                }
            } else if (phase === 'melting') {
                meltingProgress += (0.5 / iceMassMultiplier);
                if (meltingProgress >= 100) {
                    phase = 'liquid';
                    document.getElementById('feedback').innerText = "ğŸŒŠ ì´ì œ ì–¼ìŒì´ ë‹¤ ë…¹ì•„ì„œ ë¬¼ì´ ë˜ì—ˆì–´ìš”. ì˜¨ë„ê°€ ë‹¤ì‹œ ì˜¬ë¼ê°‘ë‹ˆë‹¤.";
                }
            } else if (phase === 'liquid') {
                temp += 0.3;
                if (temp > 20) isRunning = false; // ì¢…ë£Œ
            }

            // ë°ì´í„° ê¸°ë¡
            dataPoints.push({t: time, T: temp});
            
            // UI ì—…ë°ì´íŠ¸
            document.getElementById('tempDisplay').innerText = temp.toFixed(1);
            let stateText = phase === 'solid' ? "ê³ ì²´ (ì–¼ìŒ)" : (phase === 'melting' ? "ìƒíƒœ ë³€í™” ì¤‘ (ì–¼ìŒ+ë¬¼)" : "ì•¡ì²´ (ë¬¼)");
            let stateColor = phase === 'solid' ? "blue" : (phase === 'melting' ? "purple" : "red");
            document.getElementById('stateDisplay').innerText = stateText;
            document.getElementById('stateDisplay').style.color = stateColor;
        }

        function drawParticles() {
            pCtx.clearRect(0, 0, 300, 300);
            
            particles.forEach(p => {
                pCtx.beginPath();
                pCtx.arc(p.x, p.y, 8, 0, Math.PI * 2);
                pCtx.fillStyle = "#4a90e2";
                pCtx.fill();
                
                // ì…ì ì›€ì§ì„ ë¡œì§
                if (phase === 'solid') {
                    // ì œìë¦¬ ì§„ë™
                    p.x = p.baseX + (Math.random() - 0.5) * 2;
                    p.y = p.baseY + (Math.random() - 0.5) * 2;
                } else if (phase === 'melting') {
                    // ì¼ë¶€ëŠ” ììœ ë¡­ê³  ì¼ë¶€ëŠ” ê³ ì • (ì„ì„)
                    if (Math.random() * 100 < meltingProgress) {
                        p.x += (Math.random() - 0.5) * 4;
                        p.y += (Math.random() - 0.5) * 4;
                    } else {
                        p.x = p.baseX + (Math.random() - 0.5) * 3;
                        p.y = p.baseY + (Math.random() - 0.5) * 3;
                    }
                } else {
                    // í™œë°œí•œ ì›€ì§ì„ (ì•¡ì²´)
                    p.x += (Math.random() - 0.5) * 8;
                    p.y += (Math.random() - 0.5) * 8;
                }
                
                // ë²½ íŠ€ê¸°ê¸° (ì•¡ì²´ì¼ ë•Œë§Œ ìœ íš¨í•˜ê²Œ ë³´ì´ë„ë¡)
                if(p.x < 0) p.x = 300; if(p.x > 300) p.x = 0;
                if(p.y < 0) p.y = 300; if(p.y > 300) p.y = 0;
            });
        }

        function drawGraphLine() {
            if (dataPoints.length < 2) return;
            gCtx.beginPath();
            gCtx.strokeStyle = '#e74c3c';
            gCtx.lineWidth = 2;
            
            // ë§¤í•‘: ì‹œê°„ 0~400 -> x 40~400, ì˜¨ë„ -10~20 -> y 310~190 (ëŒ€ëµ)
            // 0ë„ = y 250
            dataPoints.forEach((pt, index) => {
                let gx = 40 + pt.t * 2;
                let gy = 250 - (pt.T * 6); 
                if (index === 0) gCtx.moveTo(gx, gy);
                else gCtx.lineTo(gx, gy);
            });
            gCtx.stroke();
        }

        function loop() {
            updatePhysics();
            drawParticles();
            drawGraphGrid();
            drawGraphLine();
            
            if (isRunning) {
                animationId = requestAnimationFrame(loop);
            } else {
                 document.getElementById('btnStart').disabled = true;
                 document.getElementById('btnReset').disabled = false;
            }
        }

        function startExperiment() {
            const amount = document.getElementById('iceAmount').value;
            iceMassMultiplier = parseInt(amount);
            isRunning = true;
            document.getElementById('btnStart').disabled = true;
            document.getElementById('iceAmount').disabled = true;
            loop();
        }

        function resetExperiment() {
            isRunning = false;
            cancelAnimationFrame(animationId);
            time = 0;
            temp = -10;
            phase = 'solid';
            meltingProgress = 0;
            dataPoints = [];
            document.getElementById('feedback').innerText = "";
            document.getElementById('btnStart').disabled = false;
            document.getElementById('btnReset').disabled = true;
            document.getElementById('iceAmount').disabled = false;
            document.getElementById('tempDisplay').innerText = "-10.0";
            document.getElementById('stateDisplay').innerText = "ê³ ì²´ (ì–¼ìŒ)";
            initParticles();
            drawGraphGrid();
            drawParticles();
        }

        // ì´ˆê¸° ì‹¤í–‰
        initParticles();
        drawGraphGrid();
        drawParticles();

    </script>
</body>
</html>