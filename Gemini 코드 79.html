<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê°€ìƒ ì‹¤í—˜: ì—´ì„ í¡ìˆ˜í•˜ëŠ” ë°˜ì‘</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; background-color: #f0f4f8; color: #333; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        h1 { color: #2c3e50; }
        .container { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; max-width: 1000px; width: 100%; }
        .lab-bench { background: #fff; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); flex: 2; min-width: 300px; text-align: center; position: relative; }
        .controls { background: #eef2f5; padding: 20px; border-radius: 15px; flex: 1; min-width: 250px; display: flex; flex-direction: column; gap: 15px; }
        .graph-area { background: #fff; border: 1px solid #ddd; border-radius: 10px; margin-top: 10px; }
        
        /* Experiment Visuals */
        #visual-canvas { border-bottom: 5px solid #8d6e63; /* Wooden block */ background: #e0f7fa; border-radius: 5px; cursor: pointer; }
        .btn { padding: 10px 20px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-start { background-color: #3498db; color: white; }
        .btn-start:hover { background-color: #2980b9; }
        .btn-reset { background-color: #e74c3c; color: white; }
        
        label { font-weight: bold; display: block; margin-bottom: 5px; }
        input[type="range"] { width: 100%; }
        .value-display { font-size: 0.9em; color: #666; text-align: right; }
        
        .status-box { margin-top: 20px; padding: 15px; background: #fff3cd; border: 1px solid #ffeeba; border-radius: 5px; }
        .particle-view { border: 1px solid #ccc; background: #222; border-radius: 50%; width: 100px; height: 100px; margin: 10px auto; overflow: hidden; position: relative; }
        .particle { position: absolute; background: cyan; border-radius: 50%; width: 6px; height: 6px; }

        /* Ice effect overlay */
        #ice-overlay { position: absolute; bottom: 5px; left: 50%; transform: translateX(-50%); width: 120px; height: 10px; background: rgba(255, 255, 255, 0.8); border-radius: 5px; opacity: 0; transition: opacity 1s; box-shadow: 0 0 10px white; }
    </style>
</head>
<body>

    <h1>â„ï¸ ê°€ìƒ ì‹¤í—˜ì‹¤: ë¬¼ì„ ì–¼ë¦¬ëŠ” í™”í•™ ë°˜ì‘</h1>

    <div class="container">
        <div class="lab-bench">
            <h3>ì‹¤í—˜ ì¥ì¹˜ ê´€ì°°</h3>
            <canvas id="visual-canvas" width="300" height="300"></canvas>
            <div id="ice-overlay"></div> <div style="margin-top: 10px;">
                <strong>í˜„ì¬ ì˜¨ë„: </strong> <span id="temp-display" style="color: red; font-size: 1.5em;">25.0</span> Â°C
            </div>
            
            <div class="particle-view" id="particle-container">
                </div>
            <p style="font-size: 0.8em; color: #888;">â–² í”Œë¼ìŠ¤í¬ ë‚´ë¶€ ì…ì ìš´ë™ í™•ëŒ€</p>
        </div>

        <div class="controls">
            <h3>ğŸ”¬ ì‹¤í—˜ ì¡°ê±´ ì„¤ì •</h3>
            
            <div>
                <label>ìˆ˜ì‚°í™” ë°”ë¥¨ ì§ˆëŸ‰ (g)</label>
                <input type="range" id="mass-a" min="5" max="30" value="10">
                <div class="value-display"><span id="val-a">10</span> g</div>
            </div>

            <div>
                <label>ì—¼í™” ì•”ëª¨ëŠ„ ì§ˆëŸ‰ (g)</label>
                <input type="range" id="mass-b" min="5" max="30" value="10">
                <div class="value-display"><span id="val-b">10</span> g</div>
            </div>

            <button class="btn btn-start" onclick="startExperiment()">âš—ï¸ ë°˜ì‘ ì‹œì‘ (ì„ê¸°)</button>
            <button class="btn btn-reset" onclick="resetExperiment()">ğŸ”„ ì´ˆê¸°í™”</button>

            <div class="status-box" id="feedback">
                ì¤€ë¹„ë¨: ì‹œì•½ì˜ ì–‘ì„ ì¡°ì ˆí•˜ê³  'ë°˜ì‘ ì‹œì‘'ì„ ëˆ„ë¥´ì„¸ìš”.
            </div>
        </div>
    </div>

    <div class="container">
        <div class="lab-bench" style="text-align: left;">
            <h3>ğŸ“Š ì‹œê°„ - ì˜¨ë„ ë³€í™” ê·¸ë˜í”„</h3>
            <canvas id="graph-canvas" width="600" height="200" class="graph-area"></canvas>
        </div>
    </div>

<script>
    // ë³€ìˆ˜ ì„¤ì •
    const canvas = document.getElementById('visual-canvas');
    const ctx = canvas.getContext('2d');
    const graphCanvas = document.getElementById('graph-canvas');
    const graphCtx = graphCanvas.getContext('2d');
    
    let temp = 25.0;
    let targetTemp = 25.0;
    let isRunning = false;
    let time = 0;
    let particles = [];
    const particleCount = 15;
    let history = []; // ê·¸ë˜í”„ìš© ë°ì´í„°

    // ì´ˆê¸°í™”
    function init() {
        // ì…ì ìƒì„±
        const pContainer = document.getElementById('particle-container');
        pContainer.innerHTML = '';
        particles = [];
        for(let i=0; i<particleCount; i++) {
            let p = document.createElement('div');
            p.className = 'particle';
            p.style.left = Math.random() * 90 + 'px';
            p.style.top = Math.random() * 90 + 'px';
            pContainer.appendChild(p);
            particles.push({el: p, x: Math.random()*90, y: Math.random()*90, vx: Math.random()-0.5, vy: Math.random()-0.5});
        }

        drawFlask();
        drawGraphFrame();
        updateDisplay();
    }

    // ìŠ¬ë¼ì´ë” ì´ë²¤íŠ¸
    document.getElementById('mass-a').addEventListener('input', (e) => document.getElementById('val-a').innerText = e.target.value);
    document.getElementById('mass-b').addEventListener('input', (e) => document.getElementById('val-b').innerText = e.target.value);

    // ì‹¤í—˜ ì‹œì‘ ë¡œì§
    function startExperiment() {
        if (isRunning) return;
        
        const massA = parseFloat(document.getElementById('mass-a').value);
        const massB = parseFloat(document.getElementById('mass-b').value);
        
        // ê°„ë‹¨í•œ í™”í•™ ë°˜ì‘ ì‹œë®¬ë ˆì´ì…˜ ë¡œì§
        // ìµœì  ë¹„ìœ¨ ê·¼ì²˜ì¼ ë•Œ ì˜¨ë„ê°€ ê°€ì¥ ë§ì´ ë–¨ì–´ì§ (ëŒ€ëµ 1:1 ~ 2:1 ê°€ì •)
        // ì´ ì§ˆëŸ‰ì´ ë§ì„ìˆ˜ë¡ ë°˜ì‘ì—´ ìš©ëŸ‰ì´ ì»¤ì§€ì§€ë§Œ, ì—¬ê¸°ì„  ë‹¨ìˆœí™”í•˜ì—¬ ì˜¨ë„ í•˜ê°•í­ ê³„ì‚°
        
        let dropFactor = (massA + massB) * 1.5; 
        // ë¹„ìœ¨ íŒ¨ë„í‹°: ë¹„ìœ¨ì´ ì•ˆ ë§ìœ¼ë©´ íš¨ìœ¨ ê°ì†Œ
        let ratio = massA / massB;
        let efficiency = 1 - Math.abs(ratio - 2) * 0.3; // 2:1 ë¹„ìœ¨ì´ ìµœì ì´ë¼ê³  ê°€ì •
        if (efficiency < 0.2) efficiency = 0.2;

        let tempDrop = dropFactor * efficiency;
        targetTemp = 25.0 - tempDrop;
        if(targetTemp < -25) targetTemp = -25; // ìµœì € ì˜¨ë„ ì œí•œ

        isRunning = true;
        document.getElementById('feedback').innerHTML = "â³ <strong>ë°˜ì‘ ì¤‘...</strong><br>í”Œë¼ìŠ¤í¬ ë‚´ë¶€ì—ì„œ ì—´ì„ í¡ìˆ˜í•˜ê³  ìˆìŠµë‹ˆë‹¤.<br>ì˜¨ë„ê³„ì™€ ì…ìì˜ ì›€ì§ì„ì„ ê´€ì°°í•˜ì„¸ìš”!";
        
        animate();
    }

    function resetExperiment() {
        isRunning = false;
        temp = 25.0;
        time = 0;
        history = [];
        document.getElementById('ice-overlay').style.opacity = 0;
        document.getElementById('feedback').innerText = "ì¤€ë¹„ë¨: ì‹œì•½ì˜ ì–‘ì„ ì¡°ì ˆí•˜ê³  'ë°˜ì‘ ì‹œì‘'ì„ ëˆ„ë¥´ì„¸ìš”.";
        drawGraphFrame();
        updateDisplay();
    }

    // ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„
    function animate() {
        if (!isRunning) return;

        // ì˜¨ë„ ë³€í™” (ì„œì„œíˆ ëª©í‘œ ì˜¨ë„ê¹Œì§€ ì´ë™)
        if (Math.abs(temp - targetTemp) > 0.1) {
            temp += (targetTemp - temp) * 0.05;
        } else {
            // ë°˜ì‘ ì¢…ë£Œ íŒë‹¨
            isRunning = false;
            analyzeResult();
        }

        time += 0.5;
        history.push({t: time, T: temp});
        
        updateDisplay();
        drawFlask();
        drawGraph();
        updateParticles();
        
        if (isRunning) requestAnimationFrame(animate);
    }

    function updateDisplay() {
        document.getElementById('temp-display').innerText = temp.toFixed(1);
        
        // ì–¼ìŒ íš¨ê³¼ (0ë„ ì´í•˜ì¼ ë•Œ)
        if (temp <= 0) {
            document.getElementById('ice-overlay').style.opacity = Math.min(1, (0 - temp) / 10);
        } else {
            document.getElementById('ice-overlay').style.opacity = 0;
        }
    }

    function updateParticles() {
        // ì˜¨ë„ê°€ ë‚®ì„ìˆ˜ë¡ ì†ë„ ê°ì†Œ (ìš´ë™ ì—ë„ˆì§€ ê°ì†Œ ì‹œê°í™”)
        // ì ˆëŒ€ì˜¨ë„(K) ëŠë‚Œìœ¼ë¡œ ì†ë„ ê³„ìˆ˜ ì¡°ì •
        let speedFactor = (temp + 50) / 100; // -20ë„ë©´ 0.3, 25ë„ë©´ 0.75
        if (speedFactor < 0.1) speedFactor = 0.1;

        particles.forEach(p => {
            p.x += p.vx * speedFactor * 5;
            p.y += p.vy * speedFactor * 5;

            // ë²½ íŠ•ê¸°ê¸°
            if(p.x < 0 || p.x > 90) p.vx *= -1;
            if(p.y < 0 || p.y > 90) p.vy *= -1;

            p.el.style.left = p.x + 'px';
            p.el.style.top = p.y + 'px';
        });
    }

    // ìº”ë²„ìŠ¤ ê·¸ë¦¬ê¸° (í”Œë¼ìŠ¤í¬)
    function drawFlask() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // í”Œë¼ìŠ¤í¬ ë³¸ì²´
        ctx.fillStyle = "rgba(200, 240, 255, 0.6)";
        ctx.beginPath();
        ctx.moveTo(120, 100);
        ctx.lineTo(180, 100);
        ctx.lineTo(220, 250);
        ctx.quadraticCurveTo(150, 270, 80, 250);
        ctx.lineTo(120, 100);
        ctx.fill();
        ctx.stroke();

        // ë‚´ë¶€ ì•¡ì²´ (ë°˜ì‘ë¬¼)
        ctx.fillStyle = "#eee";
        ctx.beginPath();
        ctx.moveTo(100, 250); // ìˆ˜ìœ„
        ctx.lineTo(200, 250);
        ctx.lineTo(210, 220);
        ctx.lineTo(90, 220);
        ctx.fill();

        // ì˜¨ë„ê³„
        ctx.fillStyle = "#ddd";
        ctx.fillRect(145, 50, 10, 200);
        
        // ì˜¨ë„ê³„ ëˆˆê¸ˆ (ë¹¨ê°„ ì•¡ì²´)
        let liquidHeight = (temp + 30) * 2; // ë†’ì´ ë§¤í•‘
        ctx.fillStyle = "red";
        ctx.fillRect(147, 240 - liquidHeight, 6, liquidHeight);
    }

    function drawGraphFrame() {
        graphCtx.clearRect(0, 0, graphCanvas.width, graphCanvas.height);
        graphCtx.strokeStyle = "#888";
        graphCtx.beginPath();
        graphCtx.moveTo(50, 10);
        graphCtx.lineTo(50, 180); // Yì¶•
        graphCtx.lineTo(580, 180); // Xì¶•
        graphCtx.stroke();
        
        graphCtx.fillStyle = "#333";
        graphCtx.fillText("ì˜¨ë„ (Â°C)", 10, 20);
        graphCtx.fillText("ì‹œê°„", 550, 195);
        
        // 0ë„ ê¸°ì¤€ì„ 
        let zeroY = 180 - ((0 + 30) * 2.5); // Yì¶• ìŠ¤ì¼€ì¼ë§
        graphCtx.strokeStyle = "#aaa";
        graphCtx.setLineDash([5, 5]);
        graphCtx.beginPath();
        graphCtx.moveTo(50, zeroY);
        graphCtx.lineTo(580, zeroY);
        graphCtx.stroke();
        graphCtx.setLineDash([]);
        graphCtx.fillText("0Â°C (ì–´ëŠ”ì )", 55, zeroY - 5);
    }

    function drawGraph() {
        drawGraphFrame();
        graphCtx.strokeStyle = "blue";
        graphCtx.lineWidth = 2;
        graphCtx.beginPath();
        
        history.forEach((point, index) => {
            let x = 50 + point.t * 3;
            let y = 180 - ((point.T + 30) * 2.5); // -30ë„ ~ +40ë„ ë²”ìœ„ í‘œí˜„ ê°€ì •
            if (index === 0) graphCtx.moveTo(x, y);
            else graphCtx.lineTo(x, y);
        });
        graphCtx.stroke();
    }

    function analyzeResult() {
        let msg = "";
        if (temp <= 0) {
            msg = "â„ï¸ <strong>ì„±ê³µ! ë¬¼ì´ ì–¼ì—ˆìŠµë‹ˆë‹¤.</strong><br>í”Œë¼ìŠ¤í¬ ë°”ë‹¥ì˜ ë¬¼ì´ ì–¼ì–´ ë‚˜ë¬´íŒì´ ë¶™ì—ˆìŠµë‹ˆë‹¤.<br>ì´ ë°˜ì‘ì€ ì£¼ë³€ì˜ ì—´ì„ ê°•ë ¥í•˜ê²Œ í¡ìˆ˜í•©ë‹ˆë‹¤.";
        } else {
            msg = "ğŸ“‰ <strong>ì˜¨ë„ê°€ ë‚´ë ¤ê°”ìŠµë‹ˆë‹¤.</strong><br>í•˜ì§€ë§Œ ë¬¼ì„ ì–¼ë¦¬ê¸°ì—ëŠ” ì‹œì•½ì˜ ì–‘ì´ë‚˜ ë¹„ìœ¨ì´ ë¶€ì¡±í–ˆêµ°ìš”.<br>ì‹œì•½ì˜ ì–‘ì„ ëŠ˜ë ¤ ë‹¤ì‹œ ë„ì „í•´ë³´ì„¸ìš”!";
        }
        document.getElementById('feedback').innerHTML = msg;
    }

    // ìµœì´ˆ ì‹¤í–‰
    init();
</script>

</body>
</html>