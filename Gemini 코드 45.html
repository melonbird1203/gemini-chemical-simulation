<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ìƒ ì‹¤í—˜ì‹¤: ë¬¼ì§ˆì˜ íŠ¹ì„± - ë°€ë„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
        
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f0f9ff; }
        
        /* ì‹¤í—˜ ë„êµ¬ ìŠ¤íƒ€ì¼ */
        .cylinder-container {
            width: 80px;
            height: 250px;
            border-left: 2px solid #333;
            border-right: 2px solid #333;
            border-bottom: 2px solid #333;
            border-radius: 0 0 10px 10px;
            position: relative;
            background: rgba(255, 255, 255, 0.8);
            margin: 0 auto;
        }
        .water {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #3b82f6; /* Blue-500 */
            opacity: 0.7;
            transition: height 1s ease-in-out;
            border-radius: 0 0 8px 8px;
        }
        .object-in-water {
            width: 40px;
            height: 40px;
            background-color: #555;
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 4px;
            display: none;
            transition: bottom 0.5s ease;
        }
        .scale-display {
            font-family: 'Courier New', monospace;
            background: #e0f2fe;
            border: 2px inset #cbd5e1;
            color: #0f172a;
        }
        
        /* ëˆˆê¸ˆ í‘œì‹œ */
        .tick {
            position: absolute;
            right: 0;
            width: 10px;
            border-top: 1px solid #333;
        }
        .tick.major { width: 15px; border-top: 2px solid #333; }
        .tick-label {
            position: absolute;
            right: 20px;
            font-size: 10px;
            transform: translateY(-50%);
        }

        /* ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0px); }
        }
        .teacher-bubble {
            animation: float 3s ease-in-out infinite;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen text-slate-800">

    <header class="bg-indigo-600 text-white p-4 shadow-lg">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold">ğŸ§ª ê°€ìƒ ì‹¤í—˜ì‹¤: ë°€ë„ íƒêµ¬</h1>
                <p class="text-sm opacity-90">ì¤‘í•™êµ 2í•™ë…„ 6ë‹¨ì› - ë¬¼ì§ˆì˜ íŠ¹ì„±</p>
            </div>
            <div class="text-xs bg-indigo-800 px-3 py-1 rounded-full">
                ì•ˆì „ ì œì¼: ê°€ìƒ ì‹¤í—˜ì´ë¼ ì•ˆì „í•´ìš”!
            </div>
        </div>
    </header>

    <main class="flex-grow max-w-4xl mx-auto w-full p-4 flex flex-col md:flex-row gap-6">
        
        <section class="w-full md:w-1/3 bg-white rounded-xl shadow-md p-6 flex flex-col gap-4">
            <h2 class="text-lg font-bold border-b pb-2 text-indigo-700">âš™ï¸ ì‹¤í—˜ ì„¤ì •</h2>
            
            <div class="flex gap-1 mb-2">
                <button onclick="setStage(1)" id="btn-stage-1" class="flex-1 text-xs py-1 bg-indigo-500 text-white rounded">1. ë¬¼</button>
                <button onclick="setStage(2)" id="btn-stage-2" class="flex-1 text-xs py-1 bg-gray-200 rounded hover:bg-gray-300">2. ì² </button>
                <button onclick="setStage(3)" id="btn-stage-3" class="flex-1 text-xs py-1 bg-gray-200 rounded hover:bg-gray-300">3. ë™ì „</button>
            </div>

            <div id="controls-area">
                </div>

            <div class="mt-auto bg-yellow-50 p-3 rounded-lg border border-yellow-200 text-sm">
                <div class="font-bold flex items-center gap-2 mb-1">
                    <span>ğŸ‘©â€ğŸ« ì„ ìƒë‹˜ì˜ íŒ</span>
                </div>
                <p id="teacher-msg">ì‹¤í—˜ ë‹¨ê³„ë¥¼ ì„ íƒí•˜ì—¬ ì‹œì‘í•´ë³´ì„¸ìš”!</p>
            </div>
        </section>

        <section class="w-full md:w-2/3 flex flex-col gap-4">
            
            <div class="bg-white rounded-xl shadow-md p-6 relative min-h-[300px] flex items-end justify-center gap-8">
                
                <div class="text-center relative">
                    <div class="cylinder-container" id="cylinder">
                        <div class="water" id="water-level" style="height: 0%;"></div>
                        <div class="object-in-water" id="submerged-object"></div>
                        </div>
                    <p class="mt-2 font-semibold">ëˆˆê¸ˆ ì‹¤ë¦°ë”</p>
                    <div class="absolute top-10 -right-24 bg-white border px-2 py-1 rounded shadow text-xs">
                        ë¶€í”¼: <span id="volume-readout" class="font-bold text-blue-600">0.0</span> mL
                    </div>
                </div>

                <div class="text-center">
                    <div class="w-32 h-16 bg-gray-200 rounded-lg flex items-center justify-center border-b-4 border-gray-300 relative">
                        <div id="scale-plate" class="absolute -top-2 w-24 h-2 bg-gray-400 rounded"></div>
                        <div class="scale-display text-2xl font-bold px-2 py-1 rounded w-28 text-right">
                            <span id="mass-readout">0.0</span> g
                        </div>
                    </div>
                    <p class="mt-2 font-semibold">ì „ì ì €ìš¸</p>
                </div>
            </div>

            <div class="bg-indigo-50 rounded-xl shadow-inner p-5 border border-indigo-100">
                <h3 class="font-bold text-lg mb-3">ğŸ“ ì‹¤í—˜ ê²°ê³¼ ê¸°ë¡</h3>
                <div class="grid grid-cols-3 gap-4 text-center">
                    <div class="bg-white p-2 rounded shadow-sm">
                        <p class="text-xs text-gray-500">ì§ˆëŸ‰ (m)</p>
                        <p class="text-xl font-bold" id="result-mass">0</p>
                        <p class="text-xs">g</p>
                    </div>
                    <div class="bg-white p-2 rounded shadow-sm">
                        <p class="text-xs text-gray-500">ë¶€í”¼ (V)</p>
                        <p class="text-xl font-bold" id="result-volume">0</p>
                        <p class="text-xs">mL</p>
                    </div>
                    <div class="bg-indigo-100 p-2 rounded shadow-sm border border-indigo-300">
                        <p class="text-xs text-indigo-700">ë°€ë„ ($$\rho$$)</p>
                        <p class="text-xl font-bold text-indigo-800" id="result-density">-</p>
                        <p class="text-xs">g/mL</p>
                    </div>
                </div>
                <div class="mt-4 text-center">
                    <p class="text-sm">ë°€ë„ ê³µì‹: $$ \text{ë°€ë„} = \frac{\text{ì§ˆëŸ‰}}{\text{ë¶€í”¼}} $$</p>
                </div>
                <div id="feedback-area" class="mt-3 text-center text-sm font-bold text-emerald-600 hidden">
                    </div>
            </div>

        </section>
    </main>

    <script>
        // --- ì „ì—­ ë³€ìˆ˜ ---
        let currentStage = 1;
        let currentMass = 0;
        let currentVolume = 0;
        let baseWaterVolume = 0;
        
        // ìƒìˆ˜
        const WATER_DENSITY = 1.0;
        const IRON_DENSITY = 7.87;
        const REAL_COIN_DENSITY = 8.96; // êµ¬ë¦¬ í•©ê¸ˆ ì˜ˆì‹œ
        const FAKE_COIN_DENSITY = 2.70; // ì•Œë£¨ë¯¸ëŠ„ ê°€ì§œ ë™ì „

        // --- ì´ˆê¸°í™” ---
        window.onload = () => {
            createTicks();
            setStage(1);
        };

        function createTicks() {
            const cylinder = document.getElementById('cylinder');
            for(let i=0; i<=100; i+=10) {
                const tick = document.createElement('div');
                tick.className = i % 20 === 0 ? 'tick major' : 'tick';
                tick.style.bottom = (i * 2) + 'px'; // 2px per mL scaling
                cylinder.appendChild(tick);

                if (i % 20 === 0 && i > 0) {
                    const label = document.createElement('div');
                    label.className = 'tick-label';
                    label.innerText = i;
                    label.style.bottom = (i * 2) + 'px';
                    cylinder.appendChild(label);
                }
            }
        }

        // --- ìŠ¤í…Œì´ì§€ ê´€ë¦¬ ---
        function setStage(stage) {
            currentStage = stage;
            resetExperiment();
            
            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            [1, 2, 3].forEach(i => {
                const btn = document.getElementById(`btn-stage-${i}`);
                if(i === stage) {
                    btn.classList.remove('bg-gray-200', 'text-black');
                    btn.classList.add('bg-indigo-500', 'text-white');
                } else {
                    btn.classList.add('bg-gray-200', 'text-black');
                    btn.classList.remove('bg-indigo-500', 'text-white');
                }
            });

            renderControls(stage);
        }

        function resetExperiment() {
            currentMass = 0;
            currentVolume = 0;
            baseWaterVolume = 0;
            updateVisuals(0, 0);
            document.getElementById('feedback-area').classList.add('hidden');
            document.getElementById('submerged-object').style.display = 'none';
        }

        // --- ì»¨íŠ¸ë¡¤ UI ë Œë”ë§ ---
        function renderControls(stage) {
            const container = document.getElementById('controls-area');
            const teacherMsg = document.getElementById('teacher-msg');
            container.innerHTML = '';

            if (stage === 1) { // ë¬¼ ì‹¤í—˜
                teacherMsg.innerText = "ë¬¼ì€ ì–‘ì´ ë‹¬ë¼ì ¸ë„ ë°€ë„ê°€ ì¼ì •í• ê¹Œìš”? ë¬¼ì˜ ì–‘ì„ ì¡°ì ˆí•´ì„œ í™•ì¸í•´ë´…ì‹œë‹¤.";
                container.innerHTML = `
                    <label class="block text-sm font-medium mb-1">ë¬¼ì˜ ì–‘ ì„ íƒ</label>
                    <select id="water-select" onchange="runWaterExperiment(this.value)" class="w-full p-2 border rounded mb-4">
                        <option value="0">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="10">10 mL</option>
                        <option value="20">20 mL</option>
                        <option value="40">40 mL</option>
                        <option value="50">50 mL</option>
                    </select>
                    <p class="text-xs text-gray-500">* ë¹„ì»¤ì˜ ë¬´ê²ŒëŠ” ì˜ì  ì¡°ì ˆëœ ìƒíƒœì…ë‹ˆë‹¤.</p>
                `;
            } else if (stage === 2) { // ì²  ì‹¤í—˜
                teacherMsg.innerText = "ê³ ì²´ì¸ ì²  ì¡°ê°ì˜ ë°€ë„ë¥¼ êµ¬í•´ë´…ì‹œë‹¤. ë¬¼ì´ ë‹´ê¸´ ì‹¤ë¦°ë”ì— ì² ì„ ë„£ì–´ ë¶€í”¼ ë³€í™”ë¥¼ ê´€ì°°í•˜ì„¸ìš”!";
                container.innerHTML = `
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-1">1. ì‹¤ë¦°ë”ì— ë¬¼ ì±„ìš°ê¸°</label>
                        <button onclick="fillBaseWater()" class="w-full bg-blue-100 text-blue-700 py-1 rounded hover:bg-blue-200">ë¬¼ 30mL ì±„ìš°ê¸°</button>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">2. ì²  ì¡°ê° ì§ˆëŸ‰ ì„ íƒ</label>
                        <input type="range" min="10" max="100" step="10" value="10" id="iron-slider" 
                            oninput="updateIronPreview(this.value)" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        <div class="flex justify-between text-xs mt-1">
                            <span>10g</span>
                            <span id="iron-val-display" class="font-bold text-indigo-600">10g</span>
                            <span>100g</span>
                        </div>
                        <button onclick="runIronExperiment()" class="w-full mt-2 bg-indigo-600 text-white py-2 rounded shadow hover:bg-indigo-700">ì‹¤í—˜ ì‹œì‘ (ì²  ì¡°ê° ë„£ê¸°)</button>
                    </div>
                `;
            } else if (stage === 3) { // ë™ì „ (ì‘ìš©)
                teacherMsg.innerText = "ê²‰ë³´ê¸°ê°€ ë˜‘ê°™ì€ ë‘ ë™ì „ì´ ìˆìŠµë‹ˆë‹¤. ë°€ë„ë¥¼ ì¸¡ì •í•´ì„œ ì§„ì§œ ë³´ë¬¼ ë™ì „ì„ ì°¾ì•„ë³´ì„¸ìš”!";
                container.innerHTML = `
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-1">ì‹¤ë¦°ë” ì¤€ë¹„</label>
                        <button onclick="fillBaseWater()" class="w-full bg-blue-100 text-blue-700 py-1 rounded hover:bg-blue-200">ë¬¼ 50mL ì±„ìš°ê¸°</button>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="runCoinExperiment('A')" class="p-3 border-2 border-yellow-400 rounded bg-yellow-50 hover:bg-yellow-100">
                            <span class="block text-xl">ğŸª™</span> ë™ì „ A
                        </button>
                        <button onclick="runCoinExperiment('B')" class="p-3 border-2 border-yellow-400 rounded bg-yellow-50 hover:bg-yellow-100">
                            <span class="block text-xl">ğŸª™</span> ë™ì „ B
                        </button>
                    </div>
                    <div id="coin-quiz" class="mt-4 hidden">
                        <p class="text-sm font-bold mb-2">ì–´ëŠ ê²ƒì´ ì§„ì§œ ê¸ˆí™”(ë°€ë„ ì•½ 8.96)ì¼ê¹Œìš”?</p>
                        <div class="flex gap-2">
                            <button onclick="checkCoinAnswer('A')" class="flex-1 bg-white border border-gray-300 py-1 rounded hover:bg-gray-50">Aê°€ ì§„ì§œ</button>
                            <button onclick="checkCoinAnswer('B')" class="flex-1 bg-white border border-gray-300 py-1 rounded hover:bg-gray-50">Bê°€ ì§„ì§œ</button>
                        </div>
                    </div>
                `;
            }
        }

        function updateIronPreview(val) {
            document.getElementById('iron-val-display').innerText = val + 'g';
        }

        // --- ì‹¤í—˜ ë¡œì§ ---

        // 1. ë¬¼ ì‹¤í—˜
        function runWaterExperiment(volumeStr) {
            const volume = parseFloat(volumeStr);
            if (volume === 0) { resetExperiment(); return; }
            
            // ë¬¼ì˜ ë°€ë„ëŠ” 1ì´ë¯€ë¡œ ì§ˆëŸ‰ = ë¶€í”¼
            currentVolume = volume;
            currentMass = volume * WATER_DENSITY; 
            
            updateVisuals(currentMass, currentVolume);
            calculateAndShowDensity();
            
            showFeedback(`ë¬¼ì˜ ì–‘ì´ ${volume}mLì¼ ë•Œ ì§ˆëŸ‰ë„ ${currentMass}gì´ë„¤ìš”. ë°€ë„ëŠ” ì–¼ë§ˆì¸ê°€ìš”?`);
        }

        // 2. ì²  ì‹¤í—˜ ì¤€ë¹„
        function fillBaseWater() {
            baseWaterVolume = currentStage === 2 ? 30 : 50;
            currentVolume = baseWaterVolume;
            currentMass = 0; // ë¬¼ ì§ˆëŸ‰ì€ ì €ìš¸ì—ì„œ ì˜ì  ì¡ì•˜ë‹¤ê³  ê°€ì • (ì²  ì‹¤í—˜ì„ ìœ„í•´)
            
            updateVisuals(0, baseWaterVolume);
            document.getElementById('submerged-object').style.display = 'none';
            document.getElementById('volume-readout').innerText = baseWaterVolume.toFixed(1);
            showFeedback("ë¬¼ì´ ì±„ì›Œì¡ŒìŠµë‹ˆë‹¤. ì´ì œ ë¬¼ì²´ë¥¼ ë„£ì–´ë³´ì„¸ìš”.");
        }

        // 2. ì²  ì‹¤í—˜ ì‹¤í–‰
        function runIronExperiment() {
            if(baseWaterVolume === 0) {
                alert("ë¨¼ì € ë¬¼ì„ ì±„ì›Œì£¼ì„¸ìš”!");
                return;
            }
            
            const mass = parseFloat(document.getElementById('iron-slider').value);
            // ì² ì˜ ë¶€í”¼ = ì§ˆëŸ‰ / ë°€ë„
            const objectVolume = mass / IRON_DENSITY;
            
            currentMass = mass;
            currentVolume = baseWaterVolume + objectVolume;
            
            // ì‹œê°í™”
            document.getElementById('submerged-object').style.display = 'block';
            document.getElementById('submerged-object').style.backgroundColor = '#555'; // Iron color
            
            updateVisuals(currentMass, currentVolume);
            calculateAndShowDensity(objectVolume); // ë°€ë„ ê³„ì‚° ì‹œì—ëŠ” ë¬¼ì²´ì˜ ë¶€í”¼ë§Œ ì‚¬ìš©
            
            showFeedback(`ëŠ˜ì–´ë‚œ ë¶€í”¼ëŠ” ${(objectVolume).toFixed(1)}mL ì…ë‹ˆë‹¤. ë°€ë„ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.`);
        }

        // 3. ë™ì „ ì‹¤í—˜
        let currentCoinType = '';
        function runCoinExperiment(type) {
             if(baseWaterVolume === 0) {
                alert("ë¨¼ì € ë¬¼ì„ ì±„ì›Œì£¼ì„¸ìš”!");
                return;
            }
            currentCoinType = type;
            const mass = 45; // ë™ì „ ì§ˆëŸ‰ ê³ ì •
            
            // AëŠ” ì§„ì§œ(8.96), BëŠ” ê°€ì§œ(2.7) ë¼ê³  ê°€ì •
            const density = type === 'A' ? REAL_COIN_DENSITY : FAKE_COIN_DENSITY;
            const objectVolume = mass / density;
            
            currentMass = mass;
            currentVolume = baseWaterVolume + objectVolume;

            document.getElementById('submerged-object').style.display = 'block';
            document.getElementById('submerged-object').style.backgroundColor = '#fbbf24'; // Gold color

            updateVisuals(currentMass, currentVolume);
            calculateAndShowDensity(objectVolume);
            
            document.getElementById('coin-quiz').classList.remove('hidden');
            showFeedback(`ë™ì „ ${type}ë¥¼ ë„£ì—ˆìŠµë‹ˆë‹¤. ë°€ë„ê°’ì„ í™•ì¸í•˜ê³  ì§„ìœ„ë¥¼ íŒë³„í•˜ì„¸ìš”.`);
        }

        function checkCoinAnswer(answer) {
            if (answer === 'A') {
                alert("ì •ë‹µì…ë‹ˆë‹¤! ë™ì „ Aì˜ ë°€ë„ëŠ” ì•½ 8.96ìœ¼ë¡œ ì§„ì§œ ê¸ˆí™”ì™€ ê°™ìŠµë‹ˆë‹¤.");
            } else {
                alert("í‹€ë ¸ìŠµë‹ˆë‹¤. ë™ì „ Bì˜ ë°€ë„ëŠ” ì•½ 2.7ë¡œ ì•Œë£¨ë¯¸ëŠ„ìœ¼ë¡œ ë§Œë“  ê°€ì§œì…ë‹ˆë‹¤.");
            }
        }

        // --- ê³µí†µ ê¸°ëŠ¥ ---
        function updateVisuals(mass, volume) {
            // ìˆ˜ìœ„ ì¡°ì ˆ (100mL = 200px)
            const heightPx = volume * 2; 
            document.getElementById('water-level').style.height = heightPx + 'px';
            
            // ìˆ˜ì¹˜ í‘œì‹œ
            document.getElementById('mass-readout').innerText = mass.toFixed(1);
            document.getElementById('volume-readout').innerText = volume.toFixed(1);

            // ê²°ê³¼ì°½ ì—…ë°ì´íŠ¸ (ë¶€í”¼ëŠ” ì¦ê°€ëŸ‰ ê³„ì‚°ì´ í•„ìš”í•  ìˆ˜ ìˆìŒ)
            document.getElementById('result-mass').innerText = mass.toFixed(1);
            document.getElementById('result-volume').innerText = volume.toFixed(1);
        }

        function calculateAndShowDensity(specificObjectVolume = null) {
            // ìˆœìˆ˜ ë¬¼ ì‹¤í—˜: ì „ì²´ ë¶€í”¼ ì‚¬ìš©
            // ê³ ì²´ ì‹¤í—˜: (ë‚˜ì¤‘ ë¶€í”¼ - ì²˜ìŒ ë¶€í”¼) ì‚¬ìš©í•´ì•¼ í•¨
            
            let calcVolume = currentVolume;
            if (specificObjectVolume !== null) {
                calcVolume = specificObjectVolume;
                document.getElementById('result-volume').innerText = calcVolume.toFixed(1); // ê²°ê³¼ì°½ì—” ë¬¼ì²´ ë¶€í”¼ë§Œ í‘œì‹œ
            }

            if (calcVolume > 0) {
                const density = currentMass / calcVolume;
                document.getElementById('result-density').innerText = density.toFixed(2);
            } else {
                document.getElementById('result-density').innerText = "-";
            }
        }

        function showFeedback(msg) {
            const el = document.getElementById('feedback-area');
            el.innerText = msg;
            el.classList.remove('hidden');
        }

    </script>
</body>
</html>