<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ìƒ ì‹¤í—˜ì‹¤: ë¶„ìì˜ ê·¹ì„±ê³¼ ì „í•˜ ë¶„í¬</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #f5f6fa;
            --accent-red: #ff6b6b;
            --accent-blue: #48dbfb;
            --text-color: #2f3640;
            --border-radius: 12px;
        }

        body {
            font-family: 'Pretendard', 'Malgun Gothic', sans-serif;
            background-color: #ececec;
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            max-width: 1000px;
            width: 100%;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            overflow: hidden;
            display: grid;
            grid-template-columns: 300px 1fr;
            grid-template-rows: auto 1fr auto;
        }

        header {
            grid-column: 1 / -1;
            background: var(--primary-color);
            color: white;
            padding: 20px;
            text-align: center;
        }

        header h1 { margin: 0; font-size: 1.5rem; }
        header p { margin: 5px 0 0; opacity: 0.9; font-size: 0.9rem; }

        /* Controls Sidebar */
        .sidebar {
            background: var(--secondary-color);
            padding: 20px;
            border-right: 1px solid #ddd;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .control-group {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .control-group h3 { margin-top: 0; font-size: 1rem; color: #555; border-bottom: 2px solid #eee; padding-bottom: 5px;}

        label { display: block; margin-bottom: 8px; font-size: 0.9rem; cursor: pointer; }
        
        select, button {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 1rem;
            margin-bottom: 5px;
        }

        button.primary {
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }
        button.primary:hover { background-color: #357abd; }

        .slider-container { margin-top: 10px; }
        .slider-label { display: flex; justify-content: space-between; font-size: 0.8rem; color: #666; }
        input[type="range"] { width: 100%; }

        /* Main Simulation Area */
        .main-stage {
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        canvas {
            background: white;
            border: 1px solid #eee;
            border-radius: 8px;
            cursor: crosshair;
        }

        /* Info & Feedback */
        .info-panel {
            margin-top: 20px;
            width: 100%;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 5px solid var(--primary-color);
        }

        .legend {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            font-size: 0.85rem;
            justify-content: center;
        }
        .dot { width: 12px; height: 12px; display: inline-block; border-radius: 50%; margin-right: 5px; }

        /* Quiz Section */
        .quiz-section {
            grid-column: 1 / -1;
            padding: 20px;
            background: #fff;
            border-top: 1px solid #eee;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        .data-table th, .data-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        .data-table th { background-color: #f1f1f1; }

        /* Helpers */
        .hidden { display: none; }
        .badge {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            color: white;
        }
        .badge.polar { background-color: var(--accent-red); }
        .badge.nonpolar { background-color: #2ecc71; }

    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ğŸ§ª í™”í•™ ê²°í•© ê°€ìƒ ì‹¤í—˜ì‹¤</h1>
        <p>ì „ê¸° ìŒì„±ë„ ì°¨ì´ì— ë”°ë¥¸ ë¶„ìì˜ ê·¹ì„±ê³¼ ìŒê·¹ì ëª¨ë©˜íŠ¸ íƒêµ¬ (í™”í•™â…  3-4-02)</p>
    </header>

    <aside class="sidebar">
        <div class="control-group">
            <h3>1. ë¶„ì ì„ íƒ</h3>
            <select id="moleculeSelect">
                <option value="H2">ìˆ˜ì†Œ (Hâ‚‚)</option>
                <option value="HF" selected>í”Œë£¨ì˜¤ë¦°í™” ìˆ˜ì†Œ (HF)</option>
                <option value="HCl">ì—¼í™” ìˆ˜ì†Œ (HCl)</option>
                <option value="Cl2">ì—¼ì†Œ (Clâ‚‚)</option>
                <option value="CO2">ì´ì‚°í™” íƒ„ì†Œ (COâ‚‚)</option>
                <option value="NH3">ì•”ëª¨ë‹ˆì•„ (NHâ‚ƒ)</option>
            </select>
            <p style="font-size: 0.8rem; color:#666; margin-top:5px;">
                * ë¶„ìë¥¼ ì„ íƒí•˜ë©´ êµ¬ì„± ì›ìê°€ ìë™ìœ¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤.
            </p>
        </div>

        <div class="control-group">
            <h3>2. ë³´ê¸° ì„¤ì •</h3>
            <label><input type="checkbox" id="showBonds" checked> í™”í•™ ê²°í•©ì„  í‘œì‹œ</label>
            <label><input type="checkbox" id="showElectrons" checked> ì „ì êµ¬ë¦„ (ì „í•˜ ë¶„í¬) í‘œì‹œ</label>
            <label><input type="checkbox" id="showDipole"> ìŒê·¹ì ëª¨ë©˜íŠ¸ (í™”ì‚´í‘œ) í‘œì‹œ</label>
            <label><input type="checkbox" id="showValues"> ì „ê¸° ìŒì„±ë„ ìˆ˜ì¹˜ í‘œì‹œ</label>
        </div>

        <div class="control-group">
            <h3>3. íƒêµ¬ í™œë™</h3>
            <p style="font-size:0.9rem;">ì´ ë¶„ìëŠ” ê·¹ì„±ì¼ê¹Œìš”?</p>
            <div style="display:flex; gap:5px;">
                <button id="btnGuessPolar" class="primary" style="background:#ff6b6b;">ê·¹ì„±</button>
                <button id="btnGuessNonPolar" class="primary" style="background:#2ecc71;">ë¬´ê·¹ì„±</button>
            </div>
            <div id="quizFeedback" style="margin-top:10px; font-size:0.9rem; font-weight:bold;"></div>
        </div>
    </aside>

    <main class="main-stage">
        <canvas id="simCanvas" width="600" height="400"></canvas>
        
        <div class="legend">
            <span><span class="dot" style="background:rgba(255, 0, 0, 0.6)"></span>ë¶€ë¶„ ìŒì „í•˜ (Î´â»)</span>
            <span><span class="dot" style="background:rgba(0, 0, 255, 0.6)"></span>ë¶€ë¶„ ì–‘ì „í•˜ (Î´âº)</span>
            <span><span class="dot" style="background:rgba(0, 255, 0, 0.3)"></span>ì¤‘ì„±/ë¬´ê·¹ì„±</span>
        </div>

        <div class="info-panel" id="infoPanel">
            <strong>ğŸ’¡ ì‹¤í—˜ ë¶„ì„ AI:</strong>
            <p id="aiFeedback">ë¶„ìë¥¼ ì„ íƒí•˜ì—¬ ì‹¤í—˜ì„ ì‹œì‘í•´ë³´ì„¸ìš”.</p>
        </div>
    </main>

    <section class="quiz-section">
        <h3>ğŸ“Š ì‹¤í—˜ ê²°ê³¼ ê¸°ë¡ (ìë™ ìƒì„±)</h3>
        <table class="data-table">
            <thead>
                <tr>
                    <th>ë¶„ìì‹</th>
                    <th>êµ¬ì„± ì›ì†Œ (ì „ê¸°ìŒì„±ë„)</th>
                    <th>ì „ê¸°ìŒì„±ë„ ì°¨ì´</th>
                    <th>ë¶„ì êµ¬ì¡°</th>
                    <th>ìµœì¢… ê·¹ì„± ì—¬ë¶€</th>
                </tr>
            </thead>
            <tbody id="resultTableBody">
                </tbody>
        </table>
        <div style="margin-top: 10px; text-align: right;">
            <button onclick="clearTable()" style="width: auto; padding: 5px 15px;">ê¸°ë¡ ì´ˆê¸°í™”</button>
        </div>
    </section>
</div>

<script>
/**
 * ê³¼í•™ ì‹œë®¬ë ˆì´ì…˜ ë¡œì§
 * - ë°ì´í„° ì •ì˜: ê° ì›ì†Œì˜ ì „ê¸°ìŒì„±ë„ ë° ë¶„ì êµ¬ì¡° ì •ë³´
 * - ë Œë”ë§: Canvasì— ì›ì, ê²°í•©, ì „ìêµ¬ë¦„(Gradient), ë²¡í„° ê·¸ë¦¬ê¸°
 * - ìƒí˜¸ì‘ìš©: ì‚¬ìš©ì ì…ë ¥ì— ë”°ë¥¸ ìƒíƒœ ë³€í™” ë° í”¼ë“œë°±
 */

// 1. ë°ì´í„°ë² ì´ìŠ¤
const ATOMS = {
    'H': { en: 2.1, color: '#ffffff', radius: 25, labelColor: 'black' },
    'C': { en: 2.5, color: '#909090', radius: 30, labelColor: 'white' },
    'N': { en: 3.0, color: '#3050F8', radius: 32, labelColor: 'white' },
    'O': { en: 3.5, color: '#FF0D0D', radius: 32, labelColor: 'white' },
    'F': { en: 4.0, color: '#90E050', radius: 28, labelColor: 'black' },
    'Cl': { en: 3.0, color: '#1FF01F', radius: 35, labelColor: 'black' }
};

const MOLECULES = {
    'H2': { 
        formula: 'Hâ‚‚', type: 'diatomic', atoms: ['H', 'H'], 
        geometry: 'ì§ì„ í˜•', desc: 'ë™ì¼í•œ ì›ìê°€ ê²°í•©í•˜ì—¬ ì „ê¸°ìŒì„±ë„ ì°¨ì´ê°€ 0ì…ë‹ˆë‹¤.' 
    },
    'HF': { 
        formula: 'HF', type: 'diatomic', atoms: ['H', 'F'], 
        geometry: 'ì§ì„ í˜•', desc: 'Fì˜ ì „ê¸°ìŒì„±ë„ê°€ ë§¤ìš° ì»¤ì„œ ì „ììŒì´ Fìª½ìœ¼ë¡œ ê°•í•˜ê²Œ ì¹˜ìš°ì¹©ë‹ˆë‹¤.' 
    },
    'HCl': { 
        formula: 'HCl', type: 'diatomic', atoms: ['H', 'Cl'], 
        geometry: 'ì§ì„ í˜•', desc: 'Clì´ Hë³´ë‹¤ ì „ê¸°ìŒì„±ë„ê°€ ì»¤ì„œ ì•½í•œ ê·¹ì„±ì„ ë±ë‹ˆë‹¤.' 
    },
    'Cl2': { 
        formula: 'Clâ‚‚', type: 'diatomic', atoms: ['Cl', 'Cl'], 
        geometry: 'ì§ì„ í˜•', desc: 'ë™ì¼í•œ ì›ì ê²°í•©ì´ë¯€ë¡œ ë¬´ê·¹ì„±ì…ë‹ˆë‹¤.' 
    },
    'CO2': { 
        formula: 'COâ‚‚', type: 'linear_tri', atoms: ['O', 'C', 'O'], 
        geometry: 'ì§ì„ í˜• (ëŒ€ì¹­)', desc: 'C=O ê²°í•© ìì²´ëŠ” ê·¹ì„±ì´ì§€ë§Œ, ëŒ€ì¹­ êµ¬ì¡°ë¡œ ì¸í•´ ì„œë¡œ ìƒì‡„ë˜ì–´ ë¬´ê·¹ì„± ë¶„ìì…ë‹ˆë‹¤.' 
    },
    'NH3': { 
        formula: 'NHâ‚ƒ', type: 'pyramidal', atoms: ['N', 'H', 'H', 'H'], 
        geometry: 'ì‚¼ê°ë¿”í˜•', desc: 'ë¹„ëŒ€ì¹­ êµ¬ì¡°ì´ë©° Nìª½ìœ¼ë¡œ ì „ìê°€ ì ë ¤ ì „ì²´ì ìœ¼ë¡œ í° ê·¹ì„±ì„ ë±ë‹ˆë‹¤.' 
    }
};

// ìƒíƒœ ë³€ìˆ˜
let currentMoleculeKey = 'HF';
let recordedMolecules = [];

// DOM ìš”ì†Œ
const canvas = document.getElementById('simCanvas');
const ctx = canvas.getContext('2d');
const selectEl = document.getElementById('moleculeSelect');
const feedbackEl = document.getElementById('aiFeedback');
const quizFeedbackEl = document.getElementById('quizFeedback');
const tableBody = document.getElementById('resultTableBody');

// ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
selectEl.addEventListener('change', (e) => {
    currentMoleculeKey = e.target.value;
    quizFeedbackEl.textContent = ''; // í€´ì¦ˆ ì´ˆê¸°í™”
    quizFeedbackEl.className = '';
    draw();
    updateInfo();
});

['showBonds', 'showElectrons', 'showDipole', 'showValues'].forEach(id => {
    document.getElementById(id).addEventListener('change', draw);
});

document.getElementById('btnGuessPolar').addEventListener('click', () => checkAnswer(true));
document.getElementById('btnGuessNonPolar').addEventListener('click', () => checkAnswer(false));

// 2. í•µì‹¬ ë¡œì§: ê·¸ë¦¬ê¸° í•¨ìˆ˜
function draw() {
    // ìº”ë²„ìŠ¤ ì´ˆê¸°í™”
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    const molData = MOLECULES[currentMoleculeKey];
    const type = molData.type;
    const atomKeys = molData.atoms;
    
    // ë¶„ì ë°°ì¹˜ ì¢Œí‘œ ê³„ì‚°
    let positions = [];
    const cx = canvas.width / 2;
    const cy = canvas.height / 2;
    const dist = 100; // ì›ì ê°„ ê±°ë¦¬

    if (type === 'diatomic') {
        positions = [
            { x: cx - 60, y: cy, key: atomKeys[0] },
            { x: cx + 60, y: cy, key: atomKeys[1] }
        ];
    } else if (type === 'linear_tri') { // CO2
        positions = [
            { x: cx - 100, y: cy, key: atomKeys[0] }, // O
            { x: cx, y: cy, key: atomKeys[1] },       // C
            { x: cx + 100, y: cy, key: atomKeys[2] }  // O
        ];
    } else if (type === 'pyramidal') { // NH3 (2D íˆ¬ì˜: ë©”ë¥´ì„¸ë°ìŠ¤ ë²¤ì¸  ë¡œê³  í˜•íƒœ)
        positions = [
            { x: cx, y: cy - 20, key: atomKeys[0] }, // N (ì¤‘ì‹¬)
            { x: cx, y: cy - 90, key: atomKeys[1] }, // H (ìœ„ - ì‚¬ì‹¤ ì…ì²´ì ìœ¼ë¡  ë’¤/ì•„ë˜ì§€ë§Œ 2D í‘œí˜„ìƒ ìœ„ë¡œ ê·¸ë¦¼) -> ì‹œê°ì  ìˆ˜ì •ì„ ìœ„í•´ ì•„ë˜ë¡œ ë°°ì¹˜
            { x: cx - 80, y: cy + 60, key: atomKeys[2] }, // H
            { x: cx + 80, y: cy + 60, key: atomKeys[3] }  // H
        ];
        // NH3ì˜ ì‚¼ê°ë¿” í˜•íƒœë¥¼ 2Dì—ì„œ ì§ê´€ì ìœ¼ë¡œ ë³´ì—¬ì£¼ê¸° ìœ„í•´ ì¢Œí‘œ ì¬ì¡°ì •
        positions = [
            { x: cx, y: cy - 40, key: atomKeys[0] }, // N
            { x: cx, y: cy + 60, key: atomKeys[1] }, // H
            { x: cx - 70, y: cy + 30, key: atomKeys[2] }, // H
            { x: cx + 70, y: cy + 30, key: atomKeys[3] }  // H
        ];
    }

    // ê²°í•© ê·¸ë¦¬ê¸°
    if (document.getElementById('showBonds').checked) {
        ctx.beginPath();
        ctx.strokeStyle = '#555';
        ctx.lineWidth = 8;
        // ì¤‘ì‹¬ ì›ìì™€ ì£¼ë³€ ì›ì ì—°ê²°
        const centerIdx = (type === 'diatomic') ? -1 : 0; // ì´ì›ì ë¶„ìëŠ” ì¤‘ì‹¬ ì—†ìŒ(ì„œë¡œ ì—°ê²°)
        
        if (type === 'diatomic') {
            ctx.moveTo(positions[0].x, positions[0].y);
            ctx.lineTo(positions[1].x, positions[1].y);
        } else if (type === 'linear_tri') {
            // C -> O, C -> O
            ctx.moveTo(positions[1].x, positions[1].y);
            ctx.lineTo(positions[0].x, positions[0].y);
            ctx.moveTo(positions[1].x, positions[1].y);
            ctx.lineTo(positions[2].x, positions[2].y);
        } else if (type === 'pyramidal') {
            // N -> H, H, H
            for(let i=1; i<positions.length; i++) {
                ctx.moveTo(positions[0].x, positions[0].y);
                ctx.lineTo(positions[i].x, positions[i].y);
            }
        }
        ctx.stroke();
    }

    // ì „ì êµ¬ë¦„ (ì „í•˜ ë¶„í¬) ê·¸ë¦¬ê¸°
    if (document.getElementById('showElectrons').checked) {
        positions.forEach(pos => {
            const atom = ATOMS[pos.key];
            // ì£¼ë³€ ì›ìë“¤ê³¼ì˜ ì „ê¸°ìŒì„±ë„ ì°¨ì´ ê³„ì‚°í•˜ì—¬ ì „í•˜ ê²°ì •
            let netCharge = 0;
            
            // ê°„ë‹¨í•œ ì „í•˜ ê·¼ì‚¬ ê³„ì‚° ì•Œê³ ë¦¬ì¦˜
            if(type === 'diatomic') {
                const other = positions.find(p => p !== pos);
                netCharge = ATOMS[pos.key].en - ATOMS[other.key].en;
            } else {
                // ì¤‘ì‹¬ ì›ìì™€ì˜ ê´€ê³„
                if (type === 'linear_tri') {
                    const center = positions[1]; // C
                    if (pos === center) {
                        netCharge = (ATOMS[pos.key].en - ATOMS[positions[0].key].en) + (ATOMS[pos.key].en - ATOMS[positions[2].key].en);
                    } else {
                        netCharge = ATOMS[pos.key].en - ATOMS[center.key].en;
                    }
                } else if (type === 'pyramidal') {
                    const center = positions[0]; // N
                    if (pos === center) {
                        positions.slice(1).forEach(h => {
                             netCharge += (ATOMS[center.key].en - ATOMS[h.key].en);
                        });
                    } else {
                        netCharge = ATOMS[pos.key].en - ATOMS[center.key].en;
                    }
                }
            }

            drawElectronCloud(pos.x, pos.y, atom.radius + 30, netCharge);
        });
    }

    // ì›ì ê·¸ë¦¬ê¸°
    positions.forEach(pos => {
        const atom = ATOMS[pos.key];
        drawAtom(pos.x, pos.y, atom, pos.key);
    });

    // ìŒê·¹ì ëª¨ë©˜íŠ¸ í™”ì‚´í‘œ ê·¸ë¦¬ê¸°
    if (document.getElementById('showDipole').checked) {
        drawDipoleVectors(type, positions);
    }
}

// ì›ì ê·¸ë¦¬ê¸° í—¬í¼
function drawAtom(x, y, atomData, label) {
    ctx.beginPath();
    ctx.arc(x, y, atomData.radius, 0, Math.PI * 2);
    ctx.fillStyle = atomData.color;
    ctx.fill();
    ctx.strokeStyle = '#333';
    ctx.lineWidth = 2;
    ctx.stroke();

    ctx.fillStyle = atomData.labelColor;
    ctx.font = 'bold 16px Arial';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(label, x, y);

    if (document.getElementById('showValues').checked) {
        ctx.fillStyle = '#000';
        ctx.font = '12px Arial';
        ctx.fillText(atomData.en, x, y + atomData.radius + 15);
    }
}

// ì „ì êµ¬ë¦„ ê·¸ë¦¬ê¸° (Gradient)
function drawElectronCloud(x, y, radius, chargeVal) {
    // chargeVal > 0 : ì „ê¸°ìŒì„±ë„ í¼ (ë¶€ë¶„ ìŒì „í•˜, ë¶‰ì€ìƒ‰)
    // chargeVal < 0 : ì „ê¸°ìŒì„±ë„ ì‘ìŒ (ë¶€ë¶„ ì–‘ì „í•˜, í‘¸ë¥¸ìƒ‰)
    
    const grad = ctx.createRadialGradient(x, y, radius * 0.2, x, y, radius);
    
    if (Math.abs(chargeVal) < 0.1) {
        grad.addColorStop(0, 'rgba(0, 255, 0, 0.3)'); // ì¤‘ì„± (ì´ˆë¡)
        grad.addColorStop(1, 'rgba(0, 255, 0, 0)');
    } else if (chargeVal > 0) {
        const intensity = Math.min(Math.abs(chargeVal) * 0.4, 0.8);
        grad.addColorStop(0, `rgba(255, 0, 0, ${intensity})`); // ìŒì „í•˜ (ë¹¨ê°•)
        grad.addColorStop(1, 'rgba(255, 0, 0, 0)');
    } else {
        const intensity = Math.min(Math.abs(chargeVal) * 0.4, 0.8);
        grad.addColorStop(0, `rgba(0, 0, 255, ${intensity})`); // ì–‘ì „í•˜ (íŒŒë‘)
        grad.addColorStop(1, 'rgba(0, 0, 255, 0)');
    }

    ctx.beginPath();
    ctx.arc(x, y, radius, 0, Math.PI * 2);
    ctx.fillStyle = grad;
    ctx.fill();
}

// ë²¡í„° ê·¸ë¦¬ê¸° ë¡œì§
function drawDipoleVectors(type, positions) {
    // ìŒê·¹ì ëª¨ë©˜íŠ¸: ì–‘ì „í•˜(+) -> ìŒì „í•˜(-) ë°©í–¥ìœ¼ë¡œ í™”ì‚´í‘œ
    // í™”í•™ì—ì„œëŠ” ë³´í†µ +ê°€ ìˆëŠ” ìª½ì— ì‹­ì í‘œì‹œë¥¼ í•˜ê³ , -ìª½ìœ¼ë¡œ í™”ì‚´í‘œ ë¨¸ë¦¬ë¥¼ ë‘ 
    
    // ì´ì›ì ë¶„ì
    if (type === 'diatomic') {
        const p1 = positions[0];
        const p2 = positions[1];
        const en1 = ATOMS[p1.key].en;
        const en2 = ATOMS[p2.key].en;
        
        if (Math.abs(en1 - en2) > 0.1) {
            if (en1 < en2) drawArrow(p1.x, p1.y - 50, p2.x, p2.y - 50, 'black'); // 1 -> 2
            else drawArrow(p2.x, p2.y - 50, p1.x, p1.y - 50, 'black'); // 2 -> 1
        }
    } 
    // CO2 (ìƒì‡„)
    else if (type === 'linear_tri') {
        // C(pos[1]) -> O(pos[0]), C -> O(pos[2])
        // C(2.5) < O(3.5)
        const c = positions[1];
        const o1 = positions[0];
        const o2 = positions[2];
        
        drawArrow(c.x - 20, c.y - 60, o1.x, o1.y - 60, 'gray');
        drawArrow(c.x + 20, c.y - 60, o2.x, o2.y - 60, 'gray');
        
        ctx.fillStyle = 'red';
        ctx.font = 'bold 20px Arial';
        ctx.fillText("X (ìƒì‡„)", c.x, c.y - 80);
    }
    // NH3 (í•©ì„±)
    else if (type === 'pyramidal') {
        // H(2.1) -> N(3.0)
        // ì „ì²´ì ìœ¼ë¡œ ìœ„ìª½ì„ í–¥í•˜ëŠ” í° ë²¡í„°
        const n = positions[0];
        drawArrow(n.x, n.y + 100, n.x, n.y - 80, 'purple', true);
        ctx.fillStyle = 'purple';
        ctx.fillText("ì „ì²´ ìŒê·¹ì ëª¨ë©˜íŠ¸", n.x + 80, n.y - 60);
    }
}

function drawArrow(fromX, fromY, toX, toY, color, isBig = false) {
    const headlen = isBig ? 15 : 10;
    const dx = toX - fromX;
    const dy = toY - fromY;
    const angle = Math.atan2(dy, dx);
    
    ctx.beginPath();
    ctx.moveTo(fromX, fromY);
    ctx.lineTo(toX, toY);
    ctx.strokeStyle = color;
    ctx.lineWidth = isBig ? 4 : 2;
    ctx.stroke();

    // Arrow Head
    ctx.beginPath();
    ctx.moveTo(toX, toY);
    ctx.lineTo(toX - headlen * Math.cos(angle - Math.PI / 6), toY - headlen * Math.sin(angle - Math.PI / 6));
    ctx.lineTo(toX - headlen * Math.cos(angle + Math.PI / 6), toY - headlen * Math.sin(angle + Math.PI / 6));
    ctx.fillStyle = color;
    ctx.fill();

    // Plus tail (dipole symbol)
    const tailLen = 8;
    ctx.beginPath();
    ctx.moveTo(fromX + tailLen * Math.sin(angle), fromY - tailLen * Math.cos(angle));
    ctx.lineTo(fromX - tailLen * Math.sin(angle), fromY + tailLen * Math.cos(angle));
    ctx.stroke();
}

// 3. ë¡œì§: ì •ë³´ ì—…ë°ì´íŠ¸ ë° í€´ì¦ˆ
function updateInfo() {
    const molData = MOLECULES[currentMoleculeKey];
    feedbackEl.innerHTML = `
        ì„ íƒëœ ë¶„ì: <strong>${molData.formula}</strong> (${molData.geometry})<br>
        <br>
        ${molData.desc}
    `;
}

function checkAnswer(userGuessIsPolar) {
    const molData = MOLECULES[currentMoleculeKey];
    let isActuallyPolar = false;
    
    // ê°„ë‹¨í•œ ê·¹ì„± íŒë‹¨ ë¡œì§
    if (molData.type === 'diatomic') {
        const en1 = ATOMS[molData.atoms[0]].en;
        const en2 = ATOMS[molData.atoms[1]].en;
        if (Math.abs(en1 - en2) > 0) isActuallyPolar = true;
    } else if (molData.key === 'CO2') {
        isActuallyPolar = false;
    } else { // NH3
        isActuallyPolar = true;
    }
    
    // CO2 ë“± ì˜ˆì™¸ ì²˜ë¦¬ (í•˜ë“œì½”ë”©ëœ ë°ì´í„° ê¸°ë°˜)
    if (currentMoleculeKey === 'Cl2' || currentMoleculeKey === 'H2' || currentMoleculeKey === 'CO2') isActuallyPolar = false;
    else isActuallyPolar = true;

    const isCorrect = (userGuessIsPolar === isActuallyPolar);
    
    if (isCorrect) {
        quizFeedbackEl.style.color = 'green';
        quizFeedbackEl.textContent = "ğŸ™†â€â™‚ï¸ ì •ë‹µì…ë‹ˆë‹¤! ì •í™•í•˜ê²Œ ë¶„ì„í•˜ì…¨ë„¤ìš”.";
        addResultToTable(molData, isActuallyPolar);
    } else {
        quizFeedbackEl.style.color = 'red';
        quizFeedbackEl.textContent = `ğŸ™…â€â™‚ï¸ ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”. ${isActuallyPolar ? 'ë¹„ëŒ€ì¹­ êµ¬ì¡° ë˜ëŠ” ì „ê¸°ìŒì„±ë„ ì°¨ì´ë¡œ ì¸í•´ ê·¹ì„±ì…ë‹ˆë‹¤.' : 'ì „ê¸°ìŒì„±ë„ ì°¨ì´ê°€ ì—†ê±°ë‚˜ êµ¬ì¡°ì  ëŒ€ì¹­ìœ¼ë¡œ ìƒì‡„ë˜ì–´ ë¬´ê·¹ì„±ì…ë‹ˆë‹¤.'}`;
    }
}

function addResultToTable(molData, isPolar) {
    // ì¤‘ë³µ ì²´í¬
    if (recordedMolecules.includes(molData.formula)) return;
    recordedMolecules.push(molData.formula);

    const row = document.createElement('tr');
    
    // EN ì°¨ì´ ê³„ì‚° ë¬¸ìì—´
    let enDiffStr = "";
    if (molData.type === 'diatomic') {
        const diff = Math.abs(ATOMS[molData.atoms[0]].en - ATOMS[molData.atoms[1]].en).toFixed(1);
        enDiffStr = diff;
    } else {
        enDiffStr = "-"; // ë‹¤ì›ì ë¶„ìëŠ” ë‹¨ìˆœíˆ ì°¨ì´ë§Œìœ¼ë¡œ ì„¤ëª… ë¶ˆê°€
    }

    const atomsStr = molData.atoms.map(k => `${k}(${ATOMS[k].en})`).join(', ');

    row.innerHTML = `
        <td><strong>${molData.formula}</strong></td>
        <td>${atomsStr}</td>
        <td>${enDiffStr}</td>
        <td>${molData.geometry}</td>
        <td><span class="badge ${isPolar ? 'polar' : 'nonpolar'}">${isPolar ? 'ê·¹ì„± ë¶„ì' : 'ë¬´ê·¹ì„± ë¶„ì'}</span></td>
    `;
    tableBody.appendChild(row);
}

function clearTable() {
    tableBody.innerHTML = '';
    recordedMolecules = [];
}

// ì´ˆê¸° ì‹¤í–‰
draw();
updateInfo();

</script>
</body>
</html>