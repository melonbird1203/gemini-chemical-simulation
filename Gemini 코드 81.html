<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ìƒ ì‹¤í—˜: ë°œì—´/í¡ì—´ ë°˜ì‘ ì¥ì¹˜ ì„¤ê³„</title>
    <style>
        :root { --primary: #4A90E2; --success: #2ECC71; --danger: #E74C3C; --bg: #F5F7FA; }
        body { font-family: 'Malgun Gothic', sans-serif; background: var(--bg); margin: 0; padding: 20px; color: #333; }
        
        .container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 300px 1fr 300px; gap: 20px; }
        
        /* íŒ¨ë„ ìŠ¤íƒ€ì¼ */
        .panel { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h2 { font-size: 1.2rem; margin-top: 0; color: #2c3e50; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        
        /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .control-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; font-size: 0.9rem; }
        select, input[type="range"] { width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ddd; }
        button { width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; margin-bottom: 10px; }
        .btn-start { background: var(--primary); color: white; }
        .btn-start:hover { background: #357ABD; }
        .btn-reset { background: #95a5a6; color: white; }
        
        /* ë©”ì¸ ì‹¤í—˜ ì˜ì—­ */
        .lab-area { display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; min-height: 400px; }
        .beaker-container { position: relative; width: 200px; height: 250px; border: 4px solid #aaa; border-radius: 0 0 20px 20px; border-top: none; background: rgba(255,255,255,0.5); overflow: hidden; transition: border-color 0.5s; }
        .liquid { position: absolute; bottom: 0; width: 100%; height: 0%; background: #aaddff; transition: height 1s, background-color 1s; opacity: 0.8; }
        .particles { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        
        /* ë‹¨ì—´ì¬ ì‹œê°í™” */
        .insulation-layer { position: absolute; top: -10px; left: -10px; right: -10px; bottom: -10px; border: 10px solid transparent; border-radius: 0 0 30px 30px; pointer-events: none; opacity: 0.5; }
        
        /* ì˜¨ë„ê³„ ë° ê·¸ë˜í”„ */
        .thermometer-box { position: absolute; right: 20px; top: 20px; background: white; padding: 10px; border-radius: 8px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .temp-display { font-size: 2rem; font-weight: bold; color: var(--primary); }
        canvas { width: 100%; height: 200px; background: #fff; border: 1px solid #eee; margin-top: 10px; }

        /* ê²°ê³¼ ë° í”¼ë“œë°± */
        .feedback-box { background: #e8f4fd; padding: 15px; border-radius: 8px; margin-top: 15px; font-size: 0.9rem; line-height: 1.5; }
        .particle-legend { font-size: 0.8rem; color: #666; margin-top: 10px; text-align: center; }

        /* ë°˜ì‘í˜• */
        @media (max-width: 900px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <header style="text-align: center; margin-bottom: 20px;">
        <h1>ğŸ§ª í™”í•™ ë°˜ì‘ ì—ë„ˆì§€ ì„¤ê³„ ì‹¤í—˜ì‹¤</h1>
        <p>ë°˜ì‘ë¬¼ê³¼ ì¡°ê±´ì„ ì¡°ì‘í•˜ì—¬ ì›í•˜ëŠ” ì˜¨ë„ ë³€í™” ì¥ì¹˜ë¥¼ ì„¤ê³„í•´ë³´ì„¸ìš”.</p>
    </header>

    <div class="container">
        <div class="panel">
            <h2>âš™ï¸ ì¥ì¹˜ ì„¤ê³„ ì„¤ì •</h2>
            
            <div class="control-group">
                <label>1. ë°˜ì‘ ë¬¼ì§ˆ ì„ íƒ</label>
                <select id="reactant">
                    <option value="none">ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="CaO">ì‚°í™” ì¹¼ìŠ˜ (ë°œì—´ ë°˜ì‘)</option>
                    <option value="NH4Cl">ì—¼í™” ì•”ëª¨ëŠ„ (í¡ì—´ ë°˜ì‘)</option>
                </select>
            </div>

            <div class="control-group">
                <label>2. ë¬¼ì˜ ì–‘ (mL)</label>
                <input type="range" id="waterAmount" min="50" max="200" value="100" step="10" oninput="updateLabel('waterLabel', this.value + ' mL')">
                <span id="waterLabel" style="float: right; font-size: 0.9rem; color: #666;">100 mL</span>
            </div>

            <div class="control-group">
                <label>3. ìš©ê¸° ë‹¨ì—´ ë“±ê¸‰</label>
                <select id="insulation">
                    <option value="1">ë‚®ìŒ (ì¢…ì´ì»µ)</option>
                    <option value="2">ë³´í†µ (í”Œë¼ìŠ¤í‹± ì»µ)</option>
                    <option value="3">ë†’ìŒ (íŠ¹ìˆ˜ ë³´ì˜¨ ìš©ê¸°)</option>
                </select>
            </div>

            <button class="btn-start" onclick="startSimulation()">âš—ï¸ ì‹¤í—˜ ì‹œì‘</button>
            <button class="btn-reset" onclick="resetSimulation()">ğŸ”„ ì¥ì¹˜ ì´ˆê¸°í™”</button>
        </div>

        <div class="panel lab-area">
            <h2>ğŸ‘ï¸ ì‹¤í—˜ ê´€ì°°</h2>
            <div style="position: relative;">
                <div class="beaker-container" id="beaker">
                    <div class="liquid" id="liquid"></div>
                    <canvas id="particleCanvas" width="200" height="250" class="particles"></canvas>
                </div>
                <div id="insulationVisual" class="insulation-layer"></div>
            </div>
            
            <div class="thermometer-box">
                <div>í˜„ì¬ ì˜¨ë„</div>
                <div id="tempDisplay" class="temp-display">25.0Â°C</div>
            </div>
            
            <div class="particle-legend">
                ğŸ”´ ë¹¨ê°„ìƒ‰ ì…ì: í™œë°œí•œ ì—´ìš´ë™ (ê³ ì˜¨)<br>
                ğŸ”µ íŒŒë€ìƒ‰ ì…ì: ë‘”í•´ì§„ ì—´ìš´ë™ (ì €ì˜¨)
            </div>
        </div>

        <div class="panel">
            <h2>ğŸ“Š ë°ì´í„° ë° ë¶„ì„</h2>
            <canvas id="graphCanvas"></canvas>
            
            <div id="feedback" class="feedback-box" style="display: none;">
                <strong>ğŸ’¡ ì‹¤í—˜ ê²°ê³¼ ë¶„ì„</strong>
                <p id="feedbackText"></p>
            </div>
            
            <div style="margin-top: 20px;">
                <label>ğŸ“ í•™ìŠµ í€´ì¦ˆ</label>
                <div id="quizArea" style="font-size: 0.9rem; color: #555;">
                    ì‹¤í—˜ì„ ë¨¼ì € ì§„í–‰í•´ì£¼ì„¸ìš”.
                </div>
            </div>
        </div>
    </div>

    <script>
        let animationId;
        let currentTime = 0;
        let currentTemp = 25;
        let targetTemp = 25;
        let isRunning = false;
        
        // ìƒìˆ˜
        const ROOM_TEMP = 25;
        const SPECIFIC_HEAT_WATER = 4.18; // J/gÂ°C
        
        // ì…ì ì• ë‹ˆë©”ì´ì…˜ ë³€ìˆ˜
        const canvas = document.getElementById('particleCanvas');
        const ctx = canvas.getContext('2d');
        let particles = [];

        // ê·¸ë˜í”„ ë³€ìˆ˜
        const graphCanvas = document.getElementById('graphCanvas');
        const gCtx = graphCanvas.getContext('2d');
        let dataPoints = [];

        function initParticles(count) {
            particles = [];
            for(let i=0; i<count; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    vx: (Math.random() - 0.5) * 2,
                    vy: (Math.random() - 0.5) * 2,
                    size: Math.random() * 3 + 2
                });
            }
        }

        function updateLabel(id, value) {
            document.getElementById(id).innerText = value;
        }

        function resetSimulation() {
            cancelAnimationFrame(animationId);
            isRunning = false;
            currentTime = 0;
            currentTemp = ROOM_TEMP;
            dataPoints = [];
            
            document.getElementById('tempDisplay').innerText = "25.0Â°C";
            document.getElementById('tempDisplay').style.color = "#4A90E2";
            document.getElementById('liquid').style.height = "0%";
            document.getElementById('liquid').style.backgroundColor = "#aaddff";
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('insulationVisual').style.borderColor = "transparent";
            document.getElementById('quizArea').innerText = "ì‹¤í—˜ì„ ë¨¼ì € ì§„í–‰í•´ì£¼ì„¸ìš”.";
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            gCtx.clearRect(0, 0, graphCanvas.width, graphCanvas.height);
        }

        function startSimulation() {
            if (isRunning) return;
            
            const reactant = document.getElementById('reactant').value;
            const waterAmount = parseInt(document.getElementById('waterAmount').value);
            const insulation = parseInt(document.getElementById('insulation').value);

            if (reactant === 'none') {
                alert("ë°˜ì‘ ë¬¼ì§ˆì„ ì„ íƒí•´ì£¼ì„¸ìš”!");
                return;
            }

            isRunning = true;
            dataPoints = [];
            
            // ì‹œê°ì  ì„¤ì •
            document.getElementById('liquid').style.height = (waterAmount / 200 * 90) + "%"; // ìµœëŒ€ 90% ë†’ì´
            
            // ë‹¨ì—´ì¬ ì‹œê°í™”
            const insColor = insulation === 1 ? '#eee' : (insulation === 2 ? '#ddd' : '#aaa');
            const insThickness = insulation * 5;
            const insVisual = document.getElementById('insulationVisual');
            insVisual.style.border = `${insThickness}px solid ${insColor}`;

            // ëª©í‘œ ì˜¨ë„ ê³„ì‚° (ê°„ì´ ëª¨ë¸)
            // Q = cmÎ”t => Î”t = Q / cm
            // ê°€ì •: ë°˜ì‘ë¬¼ ì–‘ì€ ì¼ì •í•˜ë‹¤ê³  ê°€ì • (ë¹„êµë¥¼ ìœ„í•´ ë‹¨ìˆœí™”)
            let energy = 0; 
            if (reactant === 'CaO') energy = 15000; // ë°œì—´ (J)
            if (reactant === 'NH4Cl') energy = -8000; // í¡ì—´ (J)

            const mass = waterAmount; // ë¬¼ì˜ ë°€ë„ 1g/mL
            const deltaT = energy / (SPECIFIC_HEAT_WATER * mass);
            targetTemp = ROOM_TEMP + deltaT;

            // ì…ì ìƒì„±
            initParticles(30);
            
            animate();
        }

        function animate() {
            if (!isRunning) return;

            // ì‹œê°„ ê²½ê³¼ì— ë”°ë¥¸ ì˜¨ë„ ë³€í™” (ì§€ìˆ˜ì  ì ‘ê·¼)
            // ë°˜ì‘ ì´ˆê¸°ì—ëŠ” ëª©í‘œ ì˜¨ë„ê¹Œì§€ ë¹ ë¥´ê²Œ ë³€í•˜ê³ , ì´í›„ ë‹¨ì—´ ìˆ˜ì¤€ì— ë”°ë¼ ì‹ê±°ë‚˜ ë°ì›Œì§(ìƒì˜¨ ë³µê·€)
            
            // 1. ë°˜ì‘ ì§„í–‰ (ëª©í‘œ ì˜¨ë„ ë„ë‹¬)
            if (currentTime < 50) {
                currentTemp += (targetTemp - currentTemp) * 0.1;
            } 
            // 2. ì—´ í‰í˜• (ìƒì˜¨ìœ¼ë¡œ ë³µê·€ - ë‹¨ì—´ íš¨ê³¼ ë°˜ì˜)
            else {
                const insulationFactor = document.getElementById('insulation').value * 0.005; // ë†’ì„ìˆ˜ë¡ ì²œì²œíˆ ë³€í•¨
                // ë‹¨ì—´ì¬ê°€ ì¢‹ì„ìˆ˜ë¡(ê°’ì´ í´ìˆ˜ë¡) ìƒì˜¨ìœ¼ë¡œ ëŒì•„ê°€ëŠ” ì†ë„ê°€ ëŠë ¤ì§
                const coolingRate = 0.05 / (parseInt(document.getElementById('insulation').value)); 
                currentTemp += (ROOM_TEMP - currentTemp) * coolingRate;
            }

            currentTime++;
            dataPoints.push(currentTemp);

            // í™”ë©´ ì—…ë°ì´íŠ¸
            updateDisplay();
            drawParticles();
            drawGraph();

            if (currentTime < 200) {
                animationId = requestAnimationFrame(animate);
            } else {
                isRunning = false;
                showResult();
            }
        }

        function updateDisplay() {
            const tempDisp = document.getElementById('tempDisplay');
            tempDisp.innerText = currentTemp.toFixed(1) + "Â°C";
            
            // ìƒ‰ìƒ ë³€í™” (ê³ ì˜¨: ë¹¨ê°•, ì €ì˜¨: íŒŒë‘)
            const liquid = document.getElementById('liquid');
            if (currentTemp > 25) {
                const intensity = Math.min((currentTemp - 25) / 30, 1);
                liquid.style.backgroundColor = `rgba(255, ${200 - intensity*200}, ${200 - intensity*200}, 0.8)`;
                tempDisp.style.color = "#E74C3C";
            } else {
                const intensity = Math.min((25 - currentTemp) / 15, 1);
                liquid.style.backgroundColor = `rgba(${200 - intensity*100}, ${200 - intensity*100}, 255, 0.8)`;
                tempDisp.style.color = "#4A90E2";
            }
        }

        function drawParticles() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ì˜¨ë„ì— ë”°ë¥¸ ì…ì ì†ë„ ì¡°ì ˆ
            const speedFactor = (currentTemp + 273) / 300; // ì ˆëŒ€ì˜¨ë„ ë¹„ë¡€ ëŠë‚Œ
            
            ctx.fillStyle = currentTemp > 25 ? "rgba(231, 76, 60, 0.8)" : "rgba(52, 152, 219, 0.8)";

            particles.forEach(p => {
                p.x += p.vx * speedFactor;
                p.y += p.vy * speedFactor;

                // ë²½ íŠ•ê¸°ê¸°
                if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
                if (p.y < 0 || p.y > canvas.height) p.vy *= -1;

                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function drawGraph() {
            gCtx.fillStyle = "#fff";
            gCtx.fillRect(0, 0, graphCanvas.width, graphCanvas.height);
            
            gCtx.strokeStyle = "#333";
            gCtx.lineWidth = 2;
            gCtx.beginPath();
            
            // ê·¸ë˜í”„ ìŠ¤ì¼€ì¼ë§
            const maxTemp = 80;
            const minTemp = 0;
            const widthStep = graphCanvas.width / 200;

            for (let i = 0; i < dataPoints.length; i++) {
                const x = i * widthStep;
                // Yì¶• ë’¤ì§‘í˜ ë³´ì • ë° ìŠ¤ì¼€ì¼ë§
                const y = graphCanvas.height - ((dataPoints[i] - minTemp) / (maxTemp - minTemp) * graphCanvas.height);
                
                if (i === 0) gCtx.moveTo(x, y);
                else gCtx.lineTo(x, y);
            }
            gCtx.stroke();
            
            // ê¸°ì¤€ì„  (25ë„)
            gCtx.strokeStyle = "#aaa";
            gCtx.setLineDash([5, 5]);
            gCtx.beginPath();
            const y25 = graphCanvas.height - ((25 - minTemp) / (maxTemp - minTemp) * graphCanvas.height);
            gCtx.moveTo(0, y25);
            gCtx.lineTo(graphCanvas.width, y25);
            gCtx.stroke();
            gCtx.setLineDash([]);
        }

        function showResult() {
            const reactant = document.getElementById('reactant').value;
            const insulation = parseInt(document.getElementById('insulation').value);
            const feedbackBox = document.getElementById('feedback');
            const feedbackText = document.getElementById('feedbackText');
            const quizArea = document.getElementById('quizArea');

            feedbackBox.style.display = "block";
            
            let resultType = reactant === 'CaO' ? "ë°œì—´ ë°˜ì‘" : "í¡ì—´ ë°˜ì‘";
            let efficiency = insulation === 3 ? "ë§¤ìš° ìš°ìˆ˜í•©ë‹ˆë‹¤!" : (insulation === 1 ? "ì—´ ì†ì‹¤ì´ í½ë‹ˆë‹¤." : "ë³´í†µ ìˆ˜ì¤€ì…ë‹ˆë‹¤.");
            
            let message = `ì´ ì¥ì¹˜ëŠ” <b>${resultType}</b>ì„ í™œìš©í–ˆìŠµë‹ˆë‹¤. <br>`;
            if (reactant === 'CaO') {
                message += `ì‚°í™”ì¹¼ìŠ˜ì´ ë¬¼ê³¼ ë°˜ì‘í•˜ì—¬ ì—´ ì—ë„ˆì§€ë¥¼ <b>ë°©ì¶œ</b>í–ˆê¸° ë•Œë¬¸ì— ìˆ˜ì˜¨ì´ ìƒìŠ¹í–ˆìŠµë‹ˆë‹¤.<br>`;
                message += `ì„ íƒí•œ ë‹¨ì—´ì¬ì˜ íš¨ìœ¨ì€ <b>${efficiency}</b>. `;
                if(insulation < 3) message += `ë” ì˜¤ë«ë™ì•ˆ ë”°ëœ»í•˜ê²Œ ìœ ì§€í•˜ë ¤ë©´ ë‹¨ì—´ ì„±ëŠ¥ì´ ë†’ì€ ìš©ê¸°ë¡œ ë°”ê¿”ë³´ì„¸ìš”.`;
            } else {
                message += `ì—¼í™”ì•”ëª¨ëŠ„ì´ ë¬¼ê³¼ ë°˜ì‘í•˜ë©° ì£¼ë³€ì˜ ì—´ì„ <b>í¡ìˆ˜</b>í–ˆê¸° ë•Œë¬¸ì— ìˆ˜ì˜¨ì´ í•˜ê°•í–ˆìŠµë‹ˆë‹¤.<br>`;
                message += `ì´ ì›ë¦¬ëŠ” <b>ëƒ‰ê° íŒ©(Instant Ice Pack)</b>ì— ì‚¬ìš©ë©ë‹ˆë‹¤.`;
            }
            
            feedbackText.innerHTML = message;

            // í€´ì¦ˆ ìƒì„±
            let quiz = "";
            if (reactant === 'CaO') {
                quiz = `<b>Q. ë§Œì•½ ë¬¼ì˜ ì–‘ì„ ì§€ê¸ˆë³´ë‹¤ ì¤„ì¸ë‹¤ë©´, ìµœê³  ì˜¨ë„ëŠ” ì–´ë–»ê²Œ ë³€í• ê¹Œìš”?</b><br>
                <button onclick="alert('ì •ë‹µì…ë‹ˆë‹¤! ë¬¼ì˜ ì–‘ì´ ì ìœ¼ë©´ ê°™ì€ ì—´ì—ë„ˆì§€ë¡œ ë” ë†’ì€ ì˜¨ë„ê¹Œì§€ ì˜¬ë¼ê°‘ë‹ˆë‹¤.')" style="width:auto; margin-top:5px;">ë” ë†’ì•„ì§„ë‹¤</button>
                <button onclick="alert('ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”. ë°ì›Œì•¼ í•  ë¬¼ì´ ì ì–´ì§€ë©´?')" style="width:auto; margin-top:5px;">ë” ë‚®ì•„ì§„ë‹¤</button>`;
            } else {
                quiz = `<b>Q. ì´ ì¥ì¹˜ì—ì„œ ì—ë„ˆì§€ëŠ” ì–´ë””ì„œ ì–´ë””ë¡œ ì´ë™í–ˆì„ê¹Œìš”?</b><br>
                <button onclick="alert('ì •ë‹µì…ë‹ˆë‹¤! ë¬¼(ì£¼ìœ„)ì´ ê°€ì§„ ì—´ì—ë„ˆì§€ê°€ ë°˜ì‘ë¬¼(ê³„)ë¡œ ì´ë™í•˜ì—¬ ë¬¼ì´ ì°¨ê°€ì›Œì¡ŒìŠµë‹ˆë‹¤.')" style="width:auto; margin-top:5px;">ë¬¼ â†’ ë°˜ì‘ë¬¼</button>
                <button onclick="alert('ë°˜ëŒ€ì…ë‹ˆë‹¤. ì—ë„ˆì§€ê°€ ë°©ì¶œë˜ì—ˆë‹¤ë©´ ë¬¼ì´ ëœ¨ê±°ì›Œì¡Œì„ ê²ƒì…ë‹ˆë‹¤.')" style="width:auto; margin-top:5px;">ë°˜ì‘ë¬¼ â†’ ë¬¼</button>`;
            }
            quizArea.innerHTML = quiz;
        }
    </script>
</body>
</html>