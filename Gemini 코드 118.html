<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í™”í•™â…¡ ê°€ìƒì‹¤í—˜: ì™¸ë¶€ ì••ë ¥ê³¼ ë“ëŠ”ì </title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #f5a623;
            --bg-color: #f8f9fa;
            --text-color: #333;
            --danger-color: #e74c3c;
        }
        body {
            font-family: 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        header {
            text-align: center;
            margin-bottom: 20px;
            max-width: 800px;
        }
        h1 { margin: 0 0 10px 0; color: #2c3e50; }
        .subtitle { color: #666; font-size: 0.95em; }
        
        .main-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            max-width: 1200px;
            width: 100%;
        }

        /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .panel {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .controls {
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        label { font-weight: bold; font-size: 0.9em; }
        input[type="range"] { width: 100%; cursor: pointer; }
        .value-display { font-size: 1.1em; color: var(--primary-color); font-weight: bold; float: right; }
        
        .btn-group { display: flex; gap: 10px; margin-top: 10px; }
        button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
        }
        .btn-heat { background-color: #e74c3c; color: white; }
        .btn-cool { background-color: #3498db; color: white; }
        .btn-reset { background-color: #95a5a6; color: white; }
        button:hover { opacity: 0.9; transform: translateY(-1px); }

        /* ì‹œë®¬ë ˆì´ì…˜ ìº”ë²„ìŠ¤ */
        .simulation-view {
            position: relative;
            width: 400px;
            height: 400px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: #fff;
            overflow: hidden;
        }
        #simCanvas { width: 100%; height: 100%; }
        
        .pressure-indicator {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255,255,255,0.9);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.85em;
            pointer-events: none;
        }

        /* ê·¸ë˜í”„ ë° ë°ì´í„° */
        .data-panel {
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
        }
        .chart-container {
            position: relative;
            height: 250px;
            width: 100%;
        }
        .status-box {
            margin-top: 15px;
            padding: 15px;
            background: #ecf0f1;
            border-radius: 8px;
            border-left: 5px solid #bdc3c7;
        }
        .status-box.boiling {
            background: #ffeaa7;
            border-left-color: #f1c40f;
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.8; } 100% { opacity: 1; } }

        /* êµìœ¡ì  ì„¤ëª… */
        .edu-note {
            margin-top: 20px;
            padding: 15px;
            background-color: #e8f4fc;
            border-radius: 8px;
            font-size: 0.9em;
            line-height: 1.5;
            max-width: 800px;
        }
        .concept-tag {
            display: inline-block;
            background: #34495e;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8em;
            margin-right: 5px;
        }

        /* í€´ì¦ˆ ì„¹ì…˜ */
        .quiz-section {
            margin-top: 20px;
            width: 100%;
            padding: 15px;
            background: #fff;
            border: 2px solid var(--secondary-color);
            border-radius: 8px;
            display: none; /* ì¡°ê±´ë¶€ í‘œì‹œ */
        }
    </style>
</head>
<body>

    <header>
        <h1>ğŸ”¬ ê°€ìƒ ì‹¤í—˜: ì••ë ¥ê³¼ ë“ëŠ”ì </h1>
        <div class="subtitle">ê³ ë“±í•™êµ í™”í•™â…¡ > ë¬¼ì§ˆì˜ ì„¸ ê°€ì§€ ìƒíƒœ > ì¦ê¸°ì••ê³¼ ë“ëŠ”ì </div>
    </header>

    <div class="main-container">
        <div class="panel controls">
            <h3>ğŸ›ï¸ ì‹¤í—˜ ì¡°ê±´ ì„¤ì •</h3>
            
            <div class="control-group">
                <label>ì™¸ë¶€ ì••ë ¥ ($P_{ext}$)<span id="pressureVal" class="value-display">1.00 atm</span></label>
                <input type="range" id="pressureSlider" min="0.1" max="2.0" step="0.05" value="1.0">
                <small style="color:#7f8c8d;">í”¼ìŠ¤í†¤ì„ ëˆŒëŸ¬ ì••ë ¥ì„ ë³€í™”ì‹œí‚µë‹ˆë‹¤.</small>
            </div>

            <div class="control-group">
                <label>ë¬¼ì˜ ì˜¨ë„ ($T$)<span id="tempVal" class="value-display">25 Â°C</span></label>
                <div class="btn-group">
                    <button class="btn-cool" onmousedown="startCool()" onmouseup="stopChange()" onmouseleave="stopChange()">â„ï¸ ëƒ‰ê°</button>
                    <button class="btn-heat" onmousedown="startHeat()" onmouseup="stopChange()" onmouseleave="stopChange()">ğŸ”¥ ê°€ì—´</button>
                </div>
                <progress id="tempProgress" value="25" max="150" style="width:100%; margin-top:5px;"></progress>
            </div>
            
            <button class="btn-reset" onclick="resetExperiment()">ğŸ”„ ì‹¤í—˜ ì´ˆê¸°í™”</button>

            <div class="edu-note">
                <strong>ğŸ’¡ ì‹¤í—˜ ê°€ì´ë“œ:</strong><br>
                1. <strong>ê°€ì—´ ë²„íŠ¼</strong>ì„ ëˆŒëŸ¬ ì˜¨ë„ë¥¼ ë†’ì—¬ë³´ì„¸ìš”. ì…ìë“¤ì˜ ì›€ì§ì„ì´ ì–´ë–»ê²Œ ë³€í•˜ë‚˜ìš”?<br>
                2. <strong>ì™¸ë¶€ ì••ë ¥ ìŠ¬ë¼ì´ë”</strong>ë¥¼ ì›€ì§ì—¬ë³´ì„¸ìš”. ë“ëŠ”ì ì´ ì–´ë–»ê²Œ ë³€í•˜ëŠ”ì§€ ê·¸ë˜í”„ë¡œ í™•ì¸í•˜ì„¸ìš”.<br>
                3. ë¬¼ì´ ë“ê¸° ì‹œì‘í•  ë•Œ <strong>ì¦ê¸°ì••</strong>ê³¼ <strong>ì™¸ë¶€ ì••ë ¥</strong>ì˜ ê°’ì„ ë¹„êµí•´ë³´ì„¸ìš”.
            </div>
        </div>

        <div class="simulation-view">
            <canvas id="simCanvas"></canvas>
            <div class="pressure-indicator">
                <span class="concept-tag">ìƒíƒœ</span> <span id="stateText">ì•¡ì²´ (Liquid)</span>
            </div>
        </div>

        <div class="panel data-panel">
            <h3>ğŸ“Š ì‹¤ì‹œê°„ ë°ì´í„° ë¶„ì„</h3>
            <div class="chart-container">
                <canvas id="vaporChart"></canvas>
            </div>
            
            <div id="statusBox" class="status-box">
                <div><strong>í˜„ì¬ ì¦ê¸°ì•• ($P_{vap}$):</strong> <span id="vaporPressureVal">0.03</span> atm</div>
                <div><strong>í˜„ì¬ ì™¸ë¶€ ì••ë ¥ ($P_{ext}$):</strong> <span id="currentExtPressure">1.00</span> atm</div>
                <hr>
                <div id="boilingStatus" style="font-size:1.1em; font-weight:bold; color:#7f8c8d;">
                    ì•„ì§ ë“ì§€ ì•ŠìŠµë‹ˆë‹¤.
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. ë¬¼ë¦¬ ì—”ì§„ ë° ë³€ìˆ˜ ì„¤ì • ---
        let state = {
            temperature: 25, // Celsius
            externalPressure: 1.0, // atm
            particles: [],
            bubbles: [],
            isBoiling: false,
            vaporPressure: 0.03
        };

        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        let animationId;
        let tempChangeInterval;

        // ìº”ë²„ìŠ¤ í¬ê¸° ì¡°ì •
        canvas.width = 400;
        canvas.height = 400;

        // ë¬¼ì˜ ì¦ê¸°ì•• ê³„ì‚° (Antoine Equation for Water approximation)
        // log10(P_mmHg) = 8.07131 - 1730.63 / (233.426 + T)
        function calculateVaporPressure(tempC) {
            const P_mmHg = Math.pow(10, 8.07131 - 1730.63 / (233.426 + tempC));
            return P_mmHg / 760; // Convert to atm
        }

        // ì…ì í´ë˜ìŠ¤ (ë¬¼ ë¶„ì)
        class Particle {
            constructor() {
                this.reset();
            }

            reset() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * (canvas.height * 0.4) + (canvas.height * 0.6); // í•˜ë‹¨ 40%ì— ìœ„ì¹˜
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = (Math.random() - 0.5) * 2;
                this.radius = 3;
                this.state = 'liquid'; // liquid or gas
            }

            update(temp) {
                // ì˜¨ë„ê°€ ë†’ì„ìˆ˜ë¡ ì†ë„ ì¦ê°€ (KE = 3/2 kT)
                const speedFactor = (temp + 273) / 300; 
                
                // ì•¡ì²´ ìƒíƒœ ì›€ì§ì„
                if (this.state === 'liquid') {
                    this.x += this.vx * speedFactor;
                    this.y += this.vy * speedFactor;

                    // ë²½ ì¶©ëŒ
                    if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
                    if (this.y > canvas.height) this.vy *= -1;
                    
                    // ìˆ˜ë©´ ê²½ê³„ (Piston ì•„ë˜)
                    const pistonY = getPistonHeight();
                    const surfaceY = canvas.height * 0.6; // ê¸°ë³¸ ìˆ˜ë©´ ë†’ì´

                    // ì¦ë°œ í™•ë¥ : ì˜¨ë„ì— ë¹„ë¡€, ì••ë ¥ì— ë°˜ë¹„ë¡€ (ë‹¨ìˆœí™” ëª¨ë¸)
                    // ì‹¤ì œ ë¬¼ë¦¬ì™€ ë‹¤ë¥´ì§€ë§Œ ì‹œê°ì  íš¨ê³¼ë¥¼ ìœ„í•œ í™•ë¥ 
                    if (this.y < surfaceY && this.vy < 0) {
                        if (Math.random() < (state.vaporPressure / state.externalPressure) * 0.05) {
                            this.state = 'gas';
                        } else {
                            this.y = surfaceY;
                            this.vy *= -1;
                        }
                    }
                } 
                // ê¸°ì²´ ìƒíƒœ ì›€ì§ì„
                else {
                    this.x += this.vx * speedFactor * 3; // ê¸°ì²´ëŠ” ë” ë¹ ë¦„
                    this.y += this.vy * speedFactor * 3;

                    const pistonY = getPistonHeight();

                    if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
                    if (this.y < pistonY) { // í”¼ìŠ¤í†¤ ì¶©ëŒ
                        this.y = pistonY;
                        this.vy *= -1;
                    }
                    if (this.y > canvas.height) { // ë‹¤ì‹œ ì•¡ì²´ë¡œ ì‘ì¶•
                        this.state = 'liquid';
                        this.y = canvas.height * 0.6;
                    }
                }
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = this.state === 'liquid' ? 'rgba(52, 152, 219, 0.8)' : 'rgba(231, 76, 60, 0.6)';
                ctx.fill();
            }
        }

        // ê¸°í¬ í´ë˜ìŠ¤ (ë“ìŒ ì‹œê°í™”)
        class Bubble {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = canvas.height;
                this.radius = 1;
                this.speed = 2 + Math.random() * 2;
            }

            update() {
                this.y -= this.speed;
                this.radius += 0.1; // ì˜¬ë¼ê°ˆìˆ˜ë¡ ì»¤ì§ (ì••ë ¥ ê°ì†Œ íš¨ê³¼ ì‹œê°í™”)
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.lineWidth = 1;
                ctx.stroke();
            }
        }

        // ì´ˆê¸°í™”
        for(let i=0; i<150; i++) state.particles.push(new Particle());

        function getPistonHeight() {
            // ì••ë ¥ì´ ë†’ì„ìˆ˜ë¡ í”¼ìŠ¤í†¤ì´ ë‚´ë ¤ì˜´ (1.0 atm ê¸°ì¤€)
            // 0.1 atm -> top, 2.0 atm -> low
            const minH = 50; 
            const maxH = canvas.height * 0.5;
            // ë§µí•‘: 0.1 -> 50, 2.0 -> maxH
            return 50 + (state.externalPressure - 0.1) / 1.9 * 150; 
        }

        // --- 2. ë Œë”ë§ ë£¨í”„ ---
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // í”¼ìŠ¤í†¤ ê·¸ë¦¬ê¸°
            const pistonY = getPistonHeight();
            ctx.fillStyle = '#95a5a6';
            ctx.fillRect(0, pistonY - 20, canvas.width, 20); // í”¼ìŠ¤í†¤ í—¤ë“œ
            ctx.fillStyle = 'rgba(189, 195, 199, 0.3)'; 
            ctx.fillRect(0, pistonY, canvas.width, canvas.height - pistonY); // ë‚´ë¶€ ê³µê°„ ë°°ê²½

            // ë¬¼ ì˜ì—­ ê·¸ë¦¬ê¸°
            ctx.fillStyle = 'rgba(52, 152, 219, 0.2)';
            ctx.fillRect(0, canvas.height * 0.6, canvas.width, canvas.height * 0.4);

            // ì…ì ì—…ë°ì´íŠ¸ ë° ê·¸ë¦¬ê¸°
            state.particles.forEach(p => {
                p.update(state.temperature);
                p.draw();
            });

            // ë“ìŒ ìƒíƒœ ì²˜ë¦¬ (ê¸°í¬)
            if (state.isBoiling) {
                if (Math.random() < 0.3) state.bubbles.push(new Bubble()); // ê¸°í¬ ìƒì„±
            }
            
            // ê¸°í¬ ì—…ë°ì´íŠ¸
            for (let i = state.bubbles.length - 1; i >= 0; i--) {
                let b = state.bubbles[i];
                b.update();
                b.draw();
                if (b.y < canvas.height * 0.6) { // ìˆ˜ë©´ ë„ë‹¬ ì‹œ í„°ì§
                    state.bubbles.splice(i, 1);
                }
            }

            requestAnimationFrame(animate);
        }
        animationId = requestAnimationFrame(animate);

        // --- 3. ë¡œì§ ë° UI ì—…ë°ì´íŠ¸ ---
        function updatePhysics() {
            // ì¦ê¸°ì•• ê³„ì‚°
            state.vaporPressure = calculateVaporPressure(state.temperature);
            
            // ë“ìŒ íŒì •: ì¦ê¸°ì•• >= ì™¸ë¶€ì••ë ¥
            // ì˜¤ì°¨ í—ˆìš© ë²”ìœ„ë¥¼ ì•„ì£¼ ì¡°ê¸ˆ ë‘¡ë‹ˆë‹¤.
            state.isBoiling = state.vaporPressure >= state.externalPressure;

            updateUI();
            updateChart();
        }

        function updateUI() {
            document.getElementById('tempVal').innerText = state.temperature.toFixed(1) + " Â°C";
            document.getElementById('tempProgress').value = state.temperature;
            document.getElementById('vaporPressureVal').innerText = state.vaporPressure.toFixed(3);
            document.getElementById('currentExtPressure').innerText = state.externalPressure.toFixed(2);
            
            const statusBox = document.getElementById('statusBox');
            const statusText = document.getElementById('boilingStatus');
            const stateText = document.getElementById('stateText');

            if (state.isBoiling) {
                statusBox.classList.add('boiling');
                statusText.innerText = "ğŸ”¥ ë“ê³  ìˆìŠµë‹ˆë‹¤! (ë™ì  í‰í˜• íŒŒê´´)";
                statusText.style.color = "#d35400";
                stateText.innerText = "ê¸°ì²´ ìƒì„± ì¤‘ (Boiling)";
            } else {
                statusBox.classList.remove('boiling');
                statusText.innerText = "ì•„ì§ ë“ì§€ ì•ŠìŠµë‹ˆë‹¤. (ì¦ë°œë§Œ ì¼ì–´ë‚¨)";
                statusText.style.color = "#7f8c8d";
                stateText.innerText = "ì•¡ì²´ (Liquid)";
            }
        }

        // --- 4. ì°¨íŠ¸ ì„¤ì • (Chart.js) ---
        const ctxChart = document.getElementById('vaporChart').getContext('2d');
        
        // ë°ì´í„° í¬ì¸íŠ¸ ìƒì„± (1ë„~150ë„)
        const labels = [];
        const vaporData = [];
        for(let t=1; t<=150; t+=2) {
            labels.push(t);
            vaporData.push(calculateVaporPressure(t));
        }

        const chart = new Chart(ctxChart, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'ë¬¼ì˜ ì¦ê¸°ì•• ê³¡ì„ ',
                    data: vaporData,
                    borderColor: '#3498db',
                    borderWidth: 2,
                    fill: false,
                    pointRadius: 0
                }, {
                    label: 'í˜„ì¬ ìƒíƒœ',
                    data: [{x: state.temperature, y: state.externalPressure}], // ì´ˆê¸°ê°’, updateì—ì„œ ë®ì–´ì”€
                    backgroundColor: '#e74c3c',
                    borderColor: '#e74c3c',
                    pointRadius: 6,
                    pointHoverRadius: 8,
                    type: 'scatter',
                    showLine: false
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { 
                        type: 'linear', 
                        position: 'bottom',
                        title: { display: true, text: 'ì˜¨ë„ (Â°C)' },
                        min: 0, max: 150
                    },
                    y: {
                        title: { display: true, text: 'ì••ë ¥ (atm)' },
                        min: 0, max: 2.2
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `(${context.raw.x.toFixed(1)}Â°C, ${context.raw.y.toFixed(2)}atm)`;
                            }
                        }
                    },
                    annotation: {
                        // Chart.js annotation pluginì´ ì—†ìœ¼ë¯€ë¡œ ìƒëµí•˜ì§€ë§Œ, 
                        // ì‹¤ì œ ê°œë°œ ì‹œ 1atm ë¼ì¸ì„ ê·¸ë ¤ì£¼ëŠ” ê²ƒì´ ì¢‹ìŒ
                    }
                }
            }
        });

        function updateChart() {
            // í˜„ì¬ ìƒíƒœ ì  ì—…ë°ì´íŠ¸
            chart.data.datasets[1].data = [{x: state.temperature, y: state.externalPressure}];
            chart.update('none'); // ì• ë‹ˆë©”ì´ì…˜ ì—†ì´ ì—…ë°ì´íŠ¸í•˜ì—¬ ì„±ëŠ¥ í™•ë³´
        }

        // --- 5. ì‚¬ìš©ì ì…ë ¥ í•¸ë“¤ë§ ---
        document.getElementById('pressureSlider').addEventListener('input', (e) => {
            state.externalPressure = parseFloat(e.target.value);
            document.getElementById('pressureVal').innerText = state.externalPressure.toFixed(2) + " atm";
            updatePhysics();
        });

        function startHeat() {
            if(tempChangeInterval) clearInterval(tempChangeInterval);
            tempChangeInterval = setInterval(() => {
                if(state.temperature < 150) {
                    state.temperature += 0.5;
                    updatePhysics();
                }
            }, 50);
        }

        function startCool() {
            if(tempChangeInterval) clearInterval(tempChangeInterval);
            tempChangeInterval = setInterval(() => {
                if(state.temperature > 1) {
                    state.temperature -= 0.5;
                    updatePhysics();
                }
            }, 50);
        }

        function stopChange() {
            clearInterval(tempChangeInterval);
        }

        function resetExperiment() {
            state.temperature = 25;
            state.externalPressure = 1.0;
            document.getElementById('pressureSlider').value = 1.0;
            document.getElementById('pressureVal').innerText = "1.00 atm";
            updatePhysics();
        }

        // ì´ˆê¸° ì‹¤í–‰
        updatePhysics();

    </script>
</body>
</html>