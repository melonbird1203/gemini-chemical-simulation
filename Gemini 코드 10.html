<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê¸°ì²´ ì…ì ìš´ë™ ê°€ìƒ ì‹¤í—˜</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; text-align: center; background-color: #f0f4f8; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        canvas { background-color: #eef; border: 2px solid #333; border-radius: 5px; margin-top: 10px; }
        .controls { margin: 20px 0; padding: 15px; background: #e0e7ff; border-radius: 10px; }
        .slider-label { font-weight: bold; font-size: 1.2em; color: #2c3e50; }
        .info-panel { display: flex; justify-content: space-around; margin-top: 15px; font-weight: bold; }
        .mode-btn { padding: 10px 20px; background: #4a90e2; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        .mode-btn.active { background: #2c3e50; }
        .piston { width: 600px; height: 10px; background: #555; margin: 0 auto; transition: margin-top 0.5s; }
        .feedback { margin-top: 10px; color: #d32f2f; font-weight: bold; height: 20px; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ§ª ê¸°ì²´ ì…ì ìš´ë™ê³¼ ìƒ¤ë¥¼ì˜ ë²•ì¹™</h2>
    
    <div class="controls">
        <label class="slider-label">ì˜¨ë„ ì¡°ì ˆ: <span id="tempDisplay">25</span>Â°C</label><br>
        <input type="range" id="tempSlider" min="-196" max="100" value="25" style="width: 80%">
        <br><br>
        <button class="mode-btn active" onclick="setMode('fixed')">ğŸ”’ ë¶€í”¼ ê³ ì • (ì••ë ¥ ê´€ì°°)</button>
        <button class="mode-btn" onclick="setMode('flexible')">ğŸˆ ììœ  íŒ½ì°½ (ìƒ¤ë¥¼ì˜ ë²•ì¹™)</button>
    </div>

    <div class="feedback" id="feedbackMsg">ì‹¤í—˜ì„ ì‹œì‘í•´ë´…ì‹œë‹¤!</div>
    
    <canvas id="simCanvas" width="600" height="400"></canvas>

    <div class="info-panel">
        <span>í‰ê·  ìš´ë™ ì†ë„: <span id="speedDisplay">0</span> m/s (ìƒëŒ€ê°’)</span>
        <span>ë¶€í”¼(ë†’ì´): <span id="volDisplay">400</span> px</span>
    </div>
</div>

<script>
    const canvas = document.getElementById('simCanvas');
    const ctx = canvas.getContext('2d');
    
    let temperature = 25; // ì„­ì”¨
    let mode = 'fixed'; // fixed or flexible
    let particles = [];
    const numParticles = 40;
    let pistonHeight = 400; // ìº”ë²„ìŠ¤ ë†’ì´ì™€ ë™ì¼
    
    // ì…ì í´ë˜ìŠ¤
    class Particle {
        constructor() {
            this.x = Math.random() * canvas.width;
            this.y = Math.random() * pistonHeight;
            this.vx = (Math.random() - 0.5) * 2;
            this.vy = (Math.random() - 0.5) * 2;
            this.radius = 6;
            this.color = '#ff6b6b';
        }

        update(speedFactor) {
            // ì˜¨ë„ì— ë”°ë¥¸ ì†ë„ ë³´ì •
            this.x += this.vx * speedFactor;
            this.y += this.vy * speedFactor;

            // ë²½ ì¶©ëŒ (ì¢Œìš°)
            if (this.x < this.radius || this.x > canvas.width - this.radius) this.vx *= -1;

            // ë²½ ì¶©ëŒ (ìƒí•˜ - í”¼ìŠ¤í†¤ ë†’ì´ ê³ ë ¤)
            if (this.y < this.radius) this.vy *= -1; // ì²œì¥(í˜¹ì€ í”¼ìŠ¤í†¤)ì€ ë³„ë„ ê³„ì‚° í•„ìš”í•˜ì§€ë§Œ ë‹¨ìˆœí™”
            if (this.y > pistonHeight - this.radius) { // ë°”ë‹¥
                this.y = pistonHeight - this.radius;
                this.vy *= -1;
            }
            // í”¼ìŠ¤í†¤(ìƒë‹¨) ì¶©ëŒ
            if (mode === 'flexible') {
                if (this.y < canvas.height - pistonHeight + this.radius) {
                    this.vy *= -1; 
                }
            } else {
                if (this.y < this.radius) this.vy *= -1;
            }
        }

        draw(speedFactor) {
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
            ctx.fillStyle = this.color;
            ctx.fill();
            ctx.closePath();

            // ìš´ë™ ë°©í–¥ í™”ì‚´í‘œ (ì†ë„ì— ë¹„ë¡€)
            ctx.beginPath();
            ctx.moveTo(this.x, this.y);
            ctx.lineTo(this.x + this.vx * speedFactor * 8, this.y + this.vy * speedFactor * 8);
            ctx.strokeStyle = "rgba(0,0,0,0.5)";
            ctx.lineWidth = 2;
            ctx.stroke();
        }
    }

    // ì´ˆê¸°í™”
    function init() {
        for(let i=0; i<numParticles; i++) {
            particles.push(new Particle());
        }
        animate();
    }

    // ëª¨ë“œ ì„¤ì •
    function setMode(newMode) {
        mode = newMode;
        document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        updateSimulation();
    }

    // ì‹œë®¬ë ˆì´ì…˜ ì—…ë°ì´íŠ¸
    function updateSimulation() {
        const slider = document.getElementById('tempSlider');
        temperature = parseInt(slider.value);
        document.getElementById('tempDisplay').innerText = temperature;

        // ì ˆëŒ€ì˜¨ë„(K)ì— ë¹„ë¡€í•˜ëŠ” ì†ë„ ê³„ìˆ˜ ê³„ì‚° (ê°„ëµí™”)
        // ì„­ì”¨ -196ë„(77K) ~ 100ë„(373K)
        const kelvin = temperature + 273;
        const speedFactor = Math.sqrt(kelvin) * 0.15; // ìš´ë™ì—ë„ˆì§€ëŠ” v^2ì— ë¹„ë¡€í•˜ë¯€ë¡œ vëŠ” sqrt(T)

        // í”¼ë“œë°± ë©”ì‹œì§€
        const feedback = document.getElementById('feedbackMsg');
        if (temperature < -100) feedback.innerText = "ì…ìë“¤ì´ ì¶”ì›Œì„œ ë‘”í•´ì¡Œë„¤ìš”! í™”ì‚´í‘œê°€ ì§§ì•„ì¡Œì£ ?";
        else if (temperature > 50) feedback.innerText = "ì…ìë“¤ì´ ì—ë„ˆì§€ë¥¼ ì–»ì–´ ë§¤ìš° ë¹ ë¦…ë‹ˆë‹¤! ì¡°ì‹¬í•˜ì„¸ìš”!";
        else feedback.innerText = "í‰ì˜¨í•œ ìƒíƒœì…ë‹ˆë‹¤.";

        // ìƒ¤ë¥¼ì˜ ë²•ì¹™ (ë¶€í”¼ ë³€í™”) êµ¬í˜„
        if (mode === 'flexible') {
            // ë¶€í”¼ëŠ” ì ˆëŒ€ì˜¨ë„ì— ë¹„ë¡€ V âˆ T
            // ê¸°ì¤€ 25ë„(298K)ì¼ ë•Œ 300pxì´ë¼ê³  ê°€ì •
            let targetHeight = (kelvin / 298) * 300; 
            if (targetHeight > 400) targetHeight = 400; // ìµœëŒ€ì¹˜ ì œí•œ
            if (targetHeight < 100) targetHeight = 100; // ìµœì†Œì¹˜ ì œí•œ
            
            // ì‹œê°ì ìœ¼ë¡œ ë°”ë‹¥ë¶€í„° ì°¨ì˜¤ë¥´ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ í”¼ìŠ¤í†¤ì´ ì›€ì§ì´ëŠ” ê°œë…
            // í¸ì˜ìƒ ìº”ë²„ìŠ¤ ì „ì²´ë¥¼ ì‚¬ìš©í•˜ë˜ ë°”ë‹¥ ê²½ê³„ë¥¼ ì¡°ì ˆ
            // ì—¬ê¸°ì„œëŠ” ê°„ë‹¨íˆ 'í™œë™ ì˜ì—­'ì„ ì œí•œ
             pistonHeight = targetHeight;
        } else {
            pistonHeight = 400; // ê³ ì • ë¶€í”¼
        }

        document.getElementById('speedDisplay').innerText = (speedFactor * 10).toFixed(1);
        document.getElementById('volDisplay').innerText = parseInt(pistonHeight);

        return speedFactor;
    }

    function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        const speedFactor = updateSimulation();

        // í”¼ìŠ¤í†¤ ê·¸ë¦¬ê¸° (flexible ëª¨ë“œì¼ ë•Œë§Œ)
        if (mode === 'flexible') {
            ctx.fillStyle = "#ddd";
            ctx.fillRect(0, 0, canvas.width, canvas.height - pistonHeight);
            ctx.fillStyle = "#333"; // í”¼ìŠ¤í†¤ í—¤ë“œ
            ctx.fillRect(0, canvas.height - pistonHeight, canvas.width, 5);
        }

        // ì…ì ê·¸ë¦¬ê¸°
        particles.forEach(p => {
            // Flexible ëª¨ë“œì¼ ë•Œ ì…ìê°€ í”¼ìŠ¤í†¤ ë°–ìœ¼ë¡œ ë‚˜ê°”ë‹¤ë©´ ê°•ì œë¡œ ì•ˆìœ¼ë¡œ ì´ë™
            if (mode === 'flexible' && p.y < canvas.height - pistonHeight) {
                p.y = canvas.height - pistonHeight + 10;
            }
            
            p.update(speedFactor);
            p.draw(speedFactor);
        });

        requestAnimationFrame(animate);
    }

    init();
</script>

</body>
</html>