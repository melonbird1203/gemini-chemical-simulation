<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê°€ìƒ ì‹¤í—˜: ì••ë ¥ê³¼ ê¸°ì²´ì˜ ë¶€í”¼ (ë³´ì¼ ë²•ì¹™)</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; background-color: #f0f4f8; color: #333; margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #2c3e50; }
        .experiment-layout { display: flex; flex-wrap: wrap; gap: 20px; justify-content: space-between; }
        .control-panel { flex: 1; min-width: 300px; background: #e8f4fd; padding: 15px; border-radius: 10px; }
        .visual-panel { flex: 2; min-width: 400px; text-align: center; }
        .canvas-container { position: relative; border: 2px solid #bdc3c7; background: #fff; margin-bottom: 10px; border-radius: 5px; overflow: hidden;}
        canvas { display: block; margin: 0 auto; }
        
        /* UI Elements */
        input[type=range] { width: 100%; cursor: pointer; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; font-size: 0.9em; }
        th { background-color: #3498db; color: white; }
        .btn { background: #27ae60; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 1em; margin-top: 10px; width: 100%; }
        .btn:hover { background: #219150; }
        
        /* Feedback Box */
        .feedback { margin-top: 15px; padding: 10px; background: #fff3cd; border-left: 5px solid #ffc107; border-radius: 3px; font-size: 0.9em; }
        
        .piston { position: absolute; top: 0; right: 0; height: 100%; background: rgba(52, 73, 94, 0.2); border-left: 5px solid #2c3e50; transition: width 0.1s; pointer-events: none; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ”¬ ì••ë ¥ì— ë”°ë¥¸ ê¸°ì²´ ë¶€í”¼ ë³€í™” (ë³´ì¼ ë²•ì¹™)</h1>
    
    <div class="experiment-layout">
        <div class="control-panel">
            <h3>âš™ï¸ ì‹¤í—˜ ì¡°ì‘</h3>
            <label for="pressureRange"><strong>ì™¸ë¶€ ì••ë ¥ (P) ì¡°ì ˆ:</strong> <span id="pressureVal">1.0</span> atm</label>
            <input type="range" id="pressureRange" min="0.5" max="3.0" step="0.1" value="1.0">
            
            <p><strong>ğŸŒ¡ï¸ ì˜¨ë„:</strong> ì¼ì • (25Â°C)</p>
            
            <h3>ğŸ“Š ì‹¤ì‹œê°„ ë°ì´í„°</h3>
            <table>
                <thead>
                    <tr>
                        <th>ì••ë ¥ (P)</th>
                        <th>ë¶€í”¼ (V)</th>
                        <th>ì…ì ì¶©ëŒ/ì´ˆ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td id="dataP">1.0 atm</td>
                        <td id="dataV">10.0 L</td>
                        <td id="dataC">ì¸¡ì • ì¤‘...</td>
                    </tr>
                </tbody>
            </table>
            
            <div class="feedback" id="feedbackText">
                ğŸ’¡ ì••ë ¥ì„ ë³€í™”ì‹œì¼œ ë³´ì„¸ìš”. ê¸°ì²´ ì…ìë“¤ì´ ì–´ë–»ê²Œ ì›€ì§ì´ëŠ”ì§€ ê´€ì°°í•´ ë´…ì‹œë‹¤.
            </div>

            <button class="btn" onclick="saveReport()">ğŸ“„ ì‹¤í—˜ ê²°ê³¼ ë¦¬í¬íŠ¸ ì €ì¥ (PDF)</button>
        </div>

        <div class="visual-panel">
            <h3>ğŸ§ª ì…ì ëª¨í˜• ì‹œë®¬ë ˆì´ì…˜</h3>
            <div class="canvas-container" style="height: 250px;">
                <canvas id="particleCanvas" width="500" height="250"></canvas>
                <div id="pistonVisual" class="piston" style="width: 0px;"></div>
            </div>
            
            <h3>ğŸ“ˆ P-V ê·¸ë˜í”„ (ë³´ì¼ ë²•ì¹™)</h3>
            <div class="canvas-container" style="height: 200px;">
                <canvas id="graphCanvas" width="500" height="200"></canvas>
            </div>
        </div>
    </div>
</div>

<script>
    // --- ì„¤ì • ë³€ìˆ˜ ---
    const pressureInput = document.getElementById('pressureRange');
    const pressureDisplay = document.getElementById('pressureVal');
    const dataP = document.getElementById('dataP');
    const dataV = document.getElementById('dataV');
    const dataC = document.getElementById('dataC');
    const feedbackText = document.getElementById('feedbackText');
    const pistonVisual = document.getElementById('pistonVisual');

    // Canvas ì„¤ì •
    const pCanvas = document.getElementById('particleCanvas');
    const pCtx = pCanvas.getContext('2d');
    const gCanvas = document.getElementById('graphCanvas');
    const gCtx = gCanvas.getContext('2d');

    // ì‹¤í—˜ ìƒìˆ˜ (PV = k)
    const K_CONST = 10.0; // P=1ì¼ ë•Œ V=10
    let currentP = 1.0;
    let currentV = 10.0;
    
    // ì…ì ì„¤ì •
    const particles = [];
    const particleCount = 40;
    const particleSpeed = 3; // ì˜¨ë„ê°€ ì¼ì •í•˜ë¯€ë¡œ ì†ë ¥ë„ ì¼ì •

    class Particle {
        constructor() {
            this.x = Math.random() * (pCanvas.width - 50); // ì´ˆê¸° ì˜ì—­ ì œí•œ
            this.y = Math.random() * pCanvas.height;
            this.vx = (Math.random() - 0.5) * particleSpeed * 2;
            this.vy = (Math.random() - 0.5) * particleSpeed * 2;
            this.radius = 4;
        }

        update(limitX) {
            this.x += this.vx;
            this.y += this.vy;

            // ë²½ ì¶©ëŒ (ì™¼ìª½, ìœ„, ì•„ë˜)
            if (this.x - this.radius < 0) { this.x = this.radius; this.vx *= -1; }
            if (this.y - this.radius < 0) { this.y = this.radius; this.vy *= -1; }
            if (this.y + this.radius > pCanvas.height) { this.y = pCanvas.height - this.radius; this.vy *= -1; }
            
            // í”¼ìŠ¤í†¤(ì˜¤ë¥¸ìª½ ë²½) ì¶©ëŒ
            if (this.x + this.radius > limitX) { 
                this.x = limitX - this.radius; 
                this.vx *= -1;
                return true; // ì¶©ëŒ ë°œìƒ
            }
            return false;
        }

        draw() {
            pCtx.beginPath();
            pCtx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
            pCtx.fillStyle = '#e74c3c';
            pCtx.fill();
            pCtx.closePath();
        }
    }

    // ì…ì ì´ˆê¸°í™”
    for(let i=0; i<particleCount; i++) particles.push(new Particle());

    // --- ë©”ì¸ ë£¨í”„ ---
    let collisionCount = 0;
    let lastTime = Date.now();
    let frameCount = 0;

    function animate() {
        // ê°’ ì—…ë°ì´íŠ¸
        currentP = parseFloat(pressureInput.value);
        currentV = K_CONST / currentP;
        
        // UI ì—…ë°ì´íŠ¸
        pressureDisplay.innerText = currentP.toFixed(1);
        dataP.innerText = currentP.toFixed(1) + " atm";
        dataV.innerText = currentV.toFixed(1) + " L";
        
        // í”¼ìŠ¤í†¤ ìœ„ì¹˜ ê³„ì‚° (Vê°€ 20Lì¼ ë•Œ 100% í­ì´ë¼ ê°€ì •)
        // í™”ë©´ widthê°€ 500px. V=10 -> 250px ì‚¬ìš©. V=20 -> 500px.
        // V_display = currentV * 25 (ìŠ¤ì¼€ì¼ë§)
        const activeWidth = currentV * 35; 
        const pistonX = Math.min(activeWidth, pCanvas.width);
        
        // í”¼ìŠ¤í†¤ ì‹œê°ì  í‘œí˜„ (íšŒìƒ‰ ì˜ì—­ì´ í”¼ìŠ¤í†¤ ë°–)
        pistonVisual.style.width = (pCanvas.width - pistonX) + "px";

        // ì…ì ê·¸ë¦¬ê¸°
        pCtx.clearRect(0, 0, pCanvas.width, pCanvas.height);
        
        // í™œì„± ì˜ì—­ í‘œì‹œ
        pCtx.fillStyle = "#ecf0f1";
        pCtx.fillRect(0, 0, pistonX, pCanvas.height);

        let collisions = 0;
        particles.forEach(p => {
            if(p.update(pistonX)) collisions++;
            p.draw();
        });

        collisionCount += collisions;
        frameCount++;

        // 0.5ì´ˆë§ˆë‹¤ ì¶©ëŒ íšŸìˆ˜ ì—…ë°ì´íŠ¸ (í‰ê· í™”)
        if (frameCount % 30 === 0) {
            // ë³´ì •ëœ ì¶©ëŒ íšŸìˆ˜ í‘œì‹œ
            let collisionsPerSec = Math.floor(collisionCount * 2); // ë‹¨ìˆœ ì‹œê°í™”ìš© ìˆ˜ì¹˜
            dataC.innerText = collisionsPerSec + " íšŒ";
            
            // ìë™ í”¼ë“œë°± ë¡œì§
            updateFeedback(currentP, collisionsPerSec);
            collisionCount = 0;
        }

        drawGraph();
        requestAnimationFrame(animate);
    }

    // --- ê·¸ë˜í”„ ê·¸ë¦¬ê¸° ---
    function drawGraph() {
        gCtx.clearRect(0, 0, gCanvas.width, gCanvas.height);
        
        // ì¶• ê·¸ë¦¬ê¸°
        gCtx.beginPath();
        gCtx.strokeStyle = "#333";
        gCtx.moveTo(40, 10);
        gCtx.lineTo(40, 180); // Yì¶• (P)
        gCtx.lineTo(480, 180); // Xì¶• (V)
        gCtx.stroke();
        
        // ë¼ë²¨
        gCtx.fillStyle = "#333";
        gCtx.fillText("P (ì••ë ¥)", 10, 20);
        gCtx.fillText("V (ë¶€í”¼)", 450, 195);

        // ë³´ì¼ ë²•ì¹™ ê³¡ì„  ê·¸ë¦¬ê¸° (PV = 10)
        gCtx.beginPath();
        gCtx.strokeStyle = "#3498db";
        gCtx.lineWidth = 2;
        
        for (let v = 2; v <= 20; v += 0.5) {
            let p = K_CONST / v;
            // ì¢Œí‘œ ë³€í™˜: V(0~20) -> X(40~480), P(0~4) -> Y(180~10)
            let x = 40 + (v * 20); 
            let y = 180 - (p * 40);
            
            if (v === 2) gCtx.moveTo(x, y);
            else gCtx.lineTo(x, y);
        }
        gCtx.stroke();

        // í˜„ì¬ ìœ„ì¹˜ ì  ì°ê¸°
        let curX = 40 + (currentV * 20);
        let curY = 180 - (currentP * 40);
        
        gCtx.beginPath();
        gCtx.fillStyle = "#e74c3c";
        gCtx.arc(curX, curY, 6, 0, Math.PI * 2);
        gCtx.fill();
    }

    function updateFeedback(p, c) {
        if (p > 1.5) {
            feedbackText.innerHTML = "ğŸ’¡ <strong>ì••ë ¥ì´ ë†’ë„¤ìš”!</strong> ê³µê°„ì´ ì¢ì•„ì§€ë‹ˆ ì…ìë“¤ì´ ë²½ì— ë” ìì£¼ ë¶€ë”ªíˆëŠ” ê²Œ ë³´ì´ë‚˜ìš”?";
        } else if (p < 0.8) {
            feedbackText.innerHTML = "ğŸ’¡ <strong>ì••ë ¥ì´ ë‚®ì•„ì¡Œì–´ìš”.</strong> ê³µê°„ì´ ë„“ì–´ì§€ë‹ˆ ì…ìë“¤ì´ í›¨ì”¬ ì—¬ìœ ë¡­ê²Œ ì›€ì§ì´ë„¤ìš”.";
        } else {
            feedbackText.innerHTML = "âœ… <strong>ê¸°ì¤€ ìƒíƒœì…ë‹ˆë‹¤.</strong> ì••ë ¥ì„ ì²œì²œíˆ ë³€í™”ì‹œí‚¤ë©° ê·¸ë˜í”„ì˜ ë¶‰ì€ ì ì„ ë”°ë¼ê°€ ë³´ì„¸ìš”.";
        }
    }

    function saveReport() {
        alert("ğŸ“¸ ì°°ì¹µ! í˜„ì¬ ì‹¤í—˜ ê²°ê³¼ê°€ PDFë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.\n\n[ì €ì¥ ë‚´ìš©]\n- ì••ë ¥: " + currentP + " atm\n- ë¶€í”¼: " + currentV.toFixed(2) + " L\n- ê²°ê³¼: ì••ë ¥ê³¼ ë¶€í”¼ëŠ” ë°˜ë¹„ë¡€í•©ë‹ˆë‹¤.");
    }

    animate();
</script>

</body>
</html>