<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í˜¸ìˆ˜ ì†ì˜ ë³´ë¬¼ êµ¬í•˜ê¸° - ìƒ¤ë¥¼ì˜ ë²•ì¹™ ì‹œë®¬ë ˆì´ì…˜</title>
    <style>
        :root {
            --primary: #4A90E2;
            --danger: #E74C3C;
            --success: #2ECC71;
            --text: #2C3E50;
            --bg: #ECF0F1;
        }
        body {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 { margin-bottom: 10px; color: var(--primary); }
        .container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 1200px;
            width: 100%;
        }
        .canvas-wrapper {
            background: white;
            padding: 10px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: relative;
        }
        canvas { border-radius: 8px; border: 1px solid #ddd; }
        .controls {
            flex: 1;
            min-width: 300px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .panel {
            border: 1px solid #eee;
            padding: 15px;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        .panel h3 { margin-top: 0; font-size: 1.1rem; border-bottom: 2px solid var(--primary); padding-bottom: 5px; display: inline-block;}
        button {
            padding: 12px;
            font-size: 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: 0.2s;
            font-weight: bold;
        }
        #btn-start { background-color: var(--primary); color: white; }
        #btn-start:hover { background-color: #357ABD; }
        #btn-reset { background-color: var(--danger); color: white; }
        #btn-reset:hover { background-color: #C0392B; }
        
        .status-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 0.9rem;
        }
        .status-item { background: #fff; padding: 8px; border-radius: 4px; border: 1px solid #ddd; text-align: center;}
        .status-value { font-weight: bold; color: var(--primary); font-size: 1.1rem;}

        .alert-box {
            background-color: #FFF3CD;
            border: 1px solid #FFEEBA;
            color: #856404;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.9rem;
            display: none;
            animation: fadeIn 0.5s;
        }
        .misconception-box {
            background-color: #D4EDDA;
            border: 1px solid #C3E6CB;
            color: #155724;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.9rem;
            display: none;
            margin-top: 10px;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* Tooltip style for molecular view */
        .molecular-view {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.9);
            border: 1px solid #ccc;
            padding: 5px;
            border-radius: 5px;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>

    <h1>ğŸ•¯ï¸ í˜¸ìˆ˜ ì†ì˜ ë³´ë¬¼ êµ¬í•˜ê¸° (ê¸°ì²´ì˜ ì˜¨ë„ì™€ ë¶€í”¼)</h1>
    <p style="text-align: center; max-width: 800px; color: #666;">
        ì–‘ì´ˆì— ë¶ˆì„ ë¶™ì´ê³  ì»µì„ ë®ì–´ë³´ì„¸ìš”. ë¬¼ì´ ì˜¬ë¼ì˜¤ëŠ” í˜„ìƒì„ <strong>ê¸°ì²´ì˜ ì˜¨ë„ ë³€í™”</strong>ì™€ <strong>ë¶„ì ìš´ë™</strong>ìœ¼ë¡œ ê´€ì°°í•´ë´…ì‹œë‹¤.
    </p>

    <div class="container">
        <div class="canvas-wrapper">
            <canvas id="simCanvas" width="600" height="400"></canvas>
            <div class="molecular-view">
                <strong>ë¶„ì ë‹ë³´ê¸° ğŸ”</strong>
                <canvas id="molCanvas" width="100" height="100"></canvas>
            </div>
        </div>

        <div class="controls">
            <div class="panel">
                <h3>ğŸ•¹ï¸ ì‹¤í—˜ ì¡°ì‘</h3>
                <p style="font-size: 0.9rem; margin-bottom: 10px;">ìˆœì„œëŒ€ë¡œ ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”.</p>
                <div style="display: flex; gap: 10px;">
                    <button id="btn-start" onclick="startExperiment()">1. ë¶ˆ ë¶™ì´ê¸° & ì»µ ë®ê¸°</button>
                    <button id="btn-reset" onclick="resetExperiment()">ì´ˆê¸°í™”</button>
                </div>
            </div>

            <div class="panel">
                <h3>ğŸ“Š ì‹¤ì‹œê°„ ë°ì´í„°</h3>
                <div class="status-display">
                    <div class="status-item">ì»µ ë‚´ë¶€ ì˜¨ë„<br><span id="val-temp" class="status-value">25</span> Â°C</div>
                    <div class="status-item">ì»µ ë‚´ë¶€ ì••ë ¥<br><span id="val-pressure" class="status-value">1.00</span> atm</div>
                    <div class="status-item">ë¬¼ ë†’ì´<br><span id="val-water" class="status-value">0</span> mm</div>
                    <div class="status-item">ë¶„ì ì†ë„<br><span id="val-speed" class="status-value">ë³´í†µ</span></div>
                </div>
            </div>

            <div id="alert-msg" class="alert-box">
                ğŸ”¥ ì»µ ì•ˆì˜ ê³µê¸°ê°€ ê°€ì—´ë˜ê³  ìˆìŠµë‹ˆë‹¤. ë¶„ìë“¤ì´ ë§¤ìš° ë¹ ë¥´ê²Œ ì›€ì§ì´ë©° ì»µ ë°–ìœ¼ë¡œ ë‚˜ê°€ë ¤ í•©ë‹ˆë‹¤!
            </div>

            <div id="result-msg" class="misconception-box">
                <strong>ğŸ’¡ ê²°ê³¼ ë¶„ì„</strong><br>
                ë¶ˆì´ êº¼ì§€ì ê³µê¸°ê°€ ì‹ìœ¼ë©´ì„œ <strong>ë¶€í”¼ê°€ ìˆ˜ì¶•</strong>í–ˆìŠµë‹ˆë‹¤. <br>
                ë‚´ë¶€ ì••ë ¥ì´ ë‚®ì•„ì ¸ ëŒ€ê¸°ì••ì´ ë¬¼ì„ ì•ˆìœ¼ë¡œ ë°€ì–´ ë„£ì€ ê²ƒì…ë‹ˆë‹¤!<br>
                (ì‚°ì†Œ ì†Œëª¨ë³´ë‹¤ ì˜¨ë„ ë³€í™”ì˜ ì˜í–¥ì´ í›¨ì”¬ í½ë‹ˆë‹¤.)
            </div>
        </div>
    </div>
    
    <div class="container">
         <div class="canvas-wrapper" style="width: 100%;">
            <canvas id="graphCanvas" width="900" height="200"></canvas>
         </div>
    </div>

<script>
/**
 * ê³¼í•™ ê°€ìƒì‹¤í—˜ì‹¤ ì—”ì§„ (Virtual Lab Engine)
 * - ìƒíƒœ ê´€ë¦¬ ë° ë¬¼ë¦¬ ì‹œë®¬ë ˆì´ì…˜ ë¡œì§
 */

const canvas = document.getElementById('simCanvas');
const ctx = canvas.getContext('2d');
const molCanvas = document.getElementById('molCanvas');
const molCtx = molCanvas.getContext('2d');
const graphCanvas = document.getElementById('graphCanvas');
const graphCtx = graphCanvas.getContext('2d');

// ìƒíƒœ ë³€ìˆ˜
let state = 'INIT'; // INIT, HEATING, COVERING, COOLING, FINISHED
let time = 0;
let temperature = 25; // ì„­ì”¨
let pressure = 1.0; // atm
let waterLevel = 0; // í”½ì…€ ë‹¨ìœ„
let maxWaterLevel = 80;
let candleY = 300;
let cupY = 100;
let flameSize = 0;
let molecules = [];
let dataPoints = []; // ê·¸ë˜í”„ìš© ë°ì´í„°

// ìƒìˆ˜
const ROOM_TEMP = 25;
const MAX_TEMP = 150; // ê°€ì—´ ì‹œ ìµœëŒ€ ì˜¨ë„

// ì´ˆê¸°í™”
function init() {
    state = 'INIT';
    time = 0;
    temperature = ROOM_TEMP;
    pressure = 1.0;
    waterLevel = 0;
    cupY = 50; // ì»µì´ ê³µì¤‘ì— ë–  ìˆìŒ
    flameSize = 0;
    molecules = [];
    dataPoints = [];
    
    // ë¶„ì ìƒì„±
    for(let i=0; i<15; i++) {
        molecules.push({
            x: Math.random() * 100,
            y: Math.random() * 100,
            vx: (Math.random() - 0.5) * 2,
            vy: (Math.random() - 0.5) * 2
        });
    }

    document.getElementById('btn-start').disabled = false;
    document.getElementById('btn-start').innerText = "1. ë¶ˆ ë¶™ì´ê¸° & ì»µ ë®ê¸°";
    document.getElementById('alert-msg').style.display = 'none';
    document.getElementById('result-msg').style.display = 'none';
    
    updateUI();
    draw();
}

function startExperiment() {
    if(state !== 'INIT') return;
    state = 'HEATING';
    document.getElementById('btn-start').disabled = true;
    document.getElementById('btn-start').innerText = "ì‹¤í—˜ ì§„í–‰ ì¤‘...";
    document.getElementById('alert-msg').style.display = 'block';
    document.getElementById('alert-msg').innerHTML = "ğŸ”¥ <strong>ê°€ì—´ ì¤‘:</strong> ì´›ë¶ˆ ì—´ê¸°ì— ì˜í•´ ê¸°ì²´ ë¶„ì ìš´ë™ì´ ë¹¨ë¼ì§€ê³  ë¶€í”¼ê°€ íŒ½ì°½í•©ë‹ˆë‹¤.";
    
    // ì‹œë‚˜ë¦¬ì˜¤ ì‹œí€€ìŠ¤ ì‹œì‘
    setTimeout(() => {
        state = 'COVERING'; // ì»µ ë‚´ë ¤ì˜´
        
        setTimeout(() => {
            state = 'COOLING'; // ë¶ˆ êº¼ì§, ì‹ê¸° ì‹œì‘
            document.getElementById('alert-msg').className = "alert-box"; // ìŠ¤íƒ€ì¼ ë¦¬ì…‹
            document.getElementById('alert-msg').style.backgroundColor = "#D1ECF1";
            document.getElementById('alert-msg').style.color = "#0C5460";
            document.getElementById('alert-msg').style.borderColor = "#BEE5EB";
            document.getElementById('alert-msg').innerHTML = "â„ï¸ <strong>ëƒ‰ê° ì¤‘:</strong> ë¶ˆì´ êº¼ì§€ê³  ê³µê¸°ê°€ ì‹ìŠµë‹ˆë‹¤. ë¶€í”¼ê°€ ì¤„ì–´ë“¤ë©° ë¬¼ì´ ë¹¨ë ¤ ë“¤ì–´ì˜µë‹ˆë‹¤.";
            
            setTimeout(() => {
                state = 'FINISHED';
                document.getElementById('result-msg').style.display = 'block';
                document.getElementById('alert-msg').style.display = 'none';
                document.getElementById('btn-start').innerText = "ì‹¤í—˜ ì™„ë£Œ";
            }, 5000);
        }, 3000); // ì»µ ë®íˆê³  3ì´ˆ ë’¤ ë¶ˆ êº¼ì§
    }, 2000); // 2ì´ˆê°„ ê°€ì—´ í›„ ì»µ ë®ê¸° ì‹œì‘
}

function resetExperiment() {
    init();
}

// ë¬¼ë¦¬ ì—”ì§„ ì—…ë°ì´íŠ¸
function update() {
    if (state === 'HEATING') {
        flameSize = Math.min(flameSize + 1, 15);
        if(temperature < MAX_TEMP) temperature += 2;
        // ì••ë ¥ì€ ê°œë°©ëœ ìƒíƒœë¼ 1.0 ìœ ì§€ (ìƒ¤ë¥¼ë²•ì¹™ V íŒ½ì°½ êµ¬ê°„)
        pressure = 1.0; 
    } else if (state === 'COVERING') {
        if (cupY < 250) cupY += 5; // ì»µ ë‚´ë ¤ì˜´
        if(temperature < MAX_TEMP + 20) temperature += 1; // ê°‡íŒ ì—´ë¡œ ì•½ê°„ ìƒìŠ¹
    } else if (state === 'COOLING') {
        flameSize = Math.max(flameSize - 1, 0);
        
        // í•µì‹¬ ë¬¼ë¦¬ ë¡œì§: ì˜¨ë„ê°€ ë‚´ë ¤ê°€ë©´ ì••ë ¥ì´ ê°ì†Œ -> ë¬¼ì´ ì˜¬ë¼ì˜´
        if (temperature > ROOM_TEMP) {
            temperature -= 0.8; // ì²œì²œíˆ ì‹ìŒ
        }
        
        // P/T = constant (Vê°€ ë³€í•˜ì§€ë§Œ ë¬¼ì´ ì±„ì›Œì§€ë©° ë³´ìƒ)
        // ì‹œê°ì  íš¨ê³¼ë¥¼ ìœ„í•´ ë‹¨ìˆœí™”: ì˜¨ë„ê°€ ë‚®ì•„ì§ˆìˆ˜ë¡ ë¬¼ì´ ì˜¬ë¼ì˜´
        let tempFactor = (MAX_TEMP - temperature) / (MAX_TEMP - ROOM_TEMP); // 0 to 1
        let targetWater = maxWaterLevel * tempFactor;
        
        if (waterLevel < targetWater) waterLevel += 0.5;
        
        // ì••ë ¥ ì‹œê°í™” (1ë³´ë‹¤ ë‚®ì•„ì§)
        pressure = 1.0 - (0.2 * tempFactor);
    }

    // ë°ì´í„° ê¸°ë¡ (ê·¸ë˜í”„ìš©)
    if(state !== 'INIT' && state !== 'FINISHED') {
        if(time % 10 === 0) { // í”„ë ˆì„ ë‹¤ìš´ìƒ˜í”Œë§
            dataPoints.push({t: dataPoints.length, temp: temperature, water: waterLevel});
        }
    }
    
    updateMolecules();
    time++;
    updateUI();
}

function updateMolecules() {
    // ì˜¨ë„ì— ë”°ë¥¸ ì†ë„ ì¡°ì ˆ
    let speedFactor = temperature / 30; 
    molecules.forEach(m => {
        m.x += m.vx * speedFactor;
        m.y += m.vy * speedFactor;

        // ë²½ íŠ•ê¸°ê¸°
        if(m.x < 0 || m.x > 100) m.vx *= -1;
        if(m.y < 0 || m.y > 100) m.vy *= -1;
    });
}

function updateUI() {
    document.getElementById('val-temp').innerText = Math.round(temperature);
    document.getElementById('val-pressure').innerText = pressure.toFixed(2);
    document.getElementById('val-water').innerText = Math.round(waterLevel);
    
    let speedText = "ë³´í†µ";
    if(temperature > 100) speedText = "ë§¤ìš° ë¹ ë¦„ âš¡";
    else if(temperature > 50) speedText = "ë¹ ë¦„ ğŸ’¨";
    else speedText = "ëŠë¦¼ â˜ï¸";
    document.getElementById('val-speed').innerText = speedText;
}

// ë Œë”ë§
function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // 1. ë°°ê²½ (í…Œì´ë¸”)
    ctx.fillStyle = '#D6EAF8';
    ctx.fillRect(0, 350, canvas.width, 50);

    // 2. ì ‘ì‹œ
    ctx.fillStyle = '#BDC3C7';
    ctx.beginPath();
    ctx.ellipse(300, 340, 150, 30, 0, 0, Math.PI * 2);
    ctx.fill();
    ctx.stroke();

    // 3. ì ‘ì‹œ ë¬¼ (ê¸°ë³¸)
    ctx.fillStyle = 'rgba(52, 152, 219, 0.5)';
    ctx.beginPath();
    ctx.ellipse(300, 340, 140, 25, 0, 0, Math.PI * 2);
    ctx.fill();

    // 4. ë™ì „ (ë³´ë¬¼)
    ctx.fillStyle = '#F1C40F';
    ctx.beginPath();
    ctx.ellipse(250, 345, 15, 8, 0, 0, Math.PI * 2);
    ctx.fill();
    ctx.strokeStyle = '#D4AC0D';
    ctx.stroke();

    // 5. ì–‘ì´ˆ
    ctx.fillStyle = '#F5B041'; // ëª¸í†µ
    ctx.fillRect(290, 300, 20, 40);
    // ì‹¬ì§€
    ctx.strokeStyle = '#333';
    ctx.beginPath();
    ctx.moveTo(300, 300);
    ctx.lineTo(300, 290);
    ctx.stroke();

    // 6. ë¶ˆê½ƒ
    if (flameSize > 0) {
        ctx.fillStyle = `rgba(231, 76, 60, ${0.7 + Math.random()*0.3})`;
        ctx.beginPath();
        ctx.arc(300, 290, flameSize, 0, Math.PI * 2);
        ctx.fill();
        // ë‚´ë¶€ ë…¸ë€ìƒ‰
        ctx.fillStyle = 'rgba(241, 196, 15, 0.8)';
        ctx.beginPath();
        ctx.arc(300, 290, flameSize * 0.6, 0, Math.PI * 2);
        ctx.fill();
    }

    // 7. ìœ ë¦¬ì»µ
    // ì»µ ìœ„ì¹˜: cupY (ë‚´ë ¤ì˜´)
    // ì»µ ë¬¼ ë†’ì´: waterLevel (ë°”ë‹¥ì—ì„œ ìœ„ë¡œ)
    
    // ì»µ ë‚´ë¶€ ë¬¼ (ìƒìŠ¹ë¶„)
    if (waterLevel > 0) {
        ctx.fillStyle = 'rgba(52, 152, 219, 0.7)';
        ctx.fillRect(260, 340 - waterLevel, 80, waterLevel);
    }

    // ì»µ ì™¸ê³½
    ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
    ctx.lineWidth = 4;
    ctx.fillStyle = 'rgba(236, 240, 241, 0.3)';
    
    ctx.beginPath();
    // ì»µ ë°”ë‹¥(ìœ„ìª½)
    ctx.moveTo(260, cupY);
    ctx.lineTo(340, cupY);
    // ì»µ ì˜†ë©´
    ctx.lineTo(340, 345); // ì ‘ì‹œ ë°”ë‹¥ ê·¼ì²˜ê¹Œì§€
    ctx.lineTo(260, 345);
    ctx.lineTo(260, cupY);
    ctx.stroke();
    ctx.fill();
    ctx.lineWidth = 1;

    // ê¸°í¬ íš¨ê³¼ (ê°€ì—´ ì‹œ)
    if (state === 'HEATING' || (state === 'COVERING' && flameSize > 0)) {
        if(Math.random() > 0.8) {
            ctx.fillStyle = 'rgba(255,255,255,0.6)';
            ctx.beginPath();
            ctx.arc(345, 340, 3, 0, Math.PI*2); // ì»µ ë°–ìœ¼ë¡œ ë¹ ì ¸ë‚˜ê°€ëŠ” ê³µê¸°
            ctx.fill();
        }
    }

    // ë¶„ì ë‹ë³´ê¸° ë Œë”ë§
    drawMolecules();
    
    // ê·¸ë˜í”„ ë Œë”ë§
    drawGraph();

    requestAnimationFrame(update);
    requestAnimationFrame(draw);
}

function drawMolecules() {
    molCtx.clearRect(0, 0, 100, 100);
    molCtx.fillStyle = '#fff';
    molCtx.fillRect(0,0,100,100);
    
    // ë°°ê²½ ì˜¨ë„ ìƒ‰ìƒ
    let hue = 240 - (temperature / MAX_TEMP * 240); // íŒŒë‘ -> ë¹¨ê°•
    molCtx.fillStyle = `hsla(${hue}, 70%, 90%, 0.5)`;
    molCtx.fillRect(0,0,100,100);

    molCtx.fillStyle = '#2C3E50';
    molecules.forEach(m => {
        molCtx.beginPath();
        molCtx.arc(m.x, m.y, 3, 0, Math.PI*2);
        molCtx.fill();
    });
}

function drawGraph() {
    graphCtx.clearRect(0, 0, 900, 200);
    
    // ì¶• ê·¸ë¦¬ê¸°
    graphCtx.strokeStyle = '#888';
    graphCtx.beginPath();
    graphCtx.moveTo(50, 10);
    graphCtx.lineTo(50, 180); // Yì¶•
    graphCtx.lineTo(880, 180); // Xì¶•
    graphCtx.stroke();
    
    // ë¼ë²¨
    graphCtx.fillStyle = '#666';
    graphCtx.fillText("ì‹œê°„", 850, 195);
    graphCtx.fillStyle = '#E74C3C';
    graphCtx.fillText("ì˜¨ë„(Â°C)", 10, 20);
    graphCtx.fillStyle = '#3498DB';
    graphCtx.fillText("ë¬¼ ë†’ì´", 10, 40);

    if (dataPoints.length < 2) return;

    // ì˜¨ë„ ê·¸ë˜í”„ (ë¹¨ê°•)
    graphCtx.strokeStyle = '#E74C3C';
    graphCtx.lineWidth = 2;
    graphCtx.beginPath();
    graphCtx.moveTo(50, 180 - dataPoints[0].temp);
    for(let i=1; i<dataPoints.length; i++) {
        let x = 50 + (i * 2);
        if (x > 880) break;
        graphCtx.lineTo(x, 180 - dataPoints[i].temp);
    }
    graphCtx.stroke();

    // ë¬¼ ë†’ì´ ê·¸ë˜í”„ (íŒŒë‘)
    graphCtx.strokeStyle = '#3498DB';
    graphCtx.beginPath();
    graphCtx.moveTo(50, 180 - dataPoints[0].water);
    for(let i=1; i<dataPoints.length; i++) {
        let x = 50 + (i * 2);
        if (x > 880) break;
        graphCtx.lineTo(x, 180 - dataPoints[i].water);
    }
    graphCtx.stroke();
}

// ì‹œì‘
init();

</script>
</body>
</html>