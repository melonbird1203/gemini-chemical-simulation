<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ìƒ ì‹¤í—˜ì‹¤: ì¤‘í™” ì ì •</title>
    <style>
        :root {
            --primary: #4A90E2;
            --success: #2ECC71;
            --danger: #E74C3C;
            --warning: #F1C40F;
            --glass: rgba(255, 255, 255, 0.8);
            --liquid-hcl: #E0F7FA;
            --liquid-naoh: #E3F2FD;
            --pink: rgba(255, 105, 180, 0.6);
            --dark-pink: rgba(255, 20, 147, 0.9);
        }

        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #f0f4f8;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        header {
            background: var(--primary);
            color: white;
            width: 100%;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            max-width: 1200px;
            width: 100%;
            padding: 20px;
            gap: 20px;
            justify-content: center;
        }

        /* ì‹¤í—˜ëŒ€ ì˜ì—­ */
        .lab-bench {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 400px;
            height: 500px;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            user-select: none;
        }

        /* ê¸°êµ¬ ìŠ¤íƒ€ì¼ */
        .stand {
            width: 10px;
            height: 450px;
            background: #555;
            position: absolute;
            left: 50%;
            bottom: 20px;
            transform: translateX(-80px);
        }

        .clamp {
            width: 40px;
            height: 10px;
            background: #555;
            position: absolute;
            left: 50%;
            top: 100px;
            transform: translateX(-75px);
        }

        .burette {
            width: 20px;
            height: 250px;
            border: 2px solid #ccc;
            border-top: none;
            background: var(--glass);
            position: absolute;
            left: 50%;
            top: 50px;
            transform: translateX(-40px);
            border-radius: 0 0 5px 5px;
            overflow: hidden;
        }

        .burette::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 8px;
            width: 4px;
            height: 10px;
            background: #ccc;
        }

        .burette-liquid {
            width: 100%;
            background: var(--liquid-naoh);
            position: absolute;
            bottom: 0;
            transition: height 0.2s;
        }

        .flask {
            width: 100px;
            height: 120px;
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            justify-content: center;
            align-items: flex-end;
        }

        .flask-shape {
            width: 100%;
            height: 100%;
            background: var(--glass);
            border: 2px solid #ccc;
            clip-path: polygon(20% 0, 80% 0, 100% 100%, 0% 100%);
            position: relative;
            overflow: hidden;
        }

        .flask-liquid {
            width: 100%;
            height: 40px; /* ì´ˆê¸° ë†’ì´ */
            background: var(--liquid-hcl);
            position: absolute;
            bottom: 0;
            transition: background-color 0.5s ease;
        }

        .drop {
            width: 6px;
            height: 6px;
            background: var(--liquid-naoh);
            border-radius: 50%;
            position: absolute;
            left: 50%;
            top: 300px;
            transform: translateX(-40px);
            opacity: 0;
        }

        @keyframes dropFall {
            0% { top: 300px; opacity: 1; }
            100% { top: 380px; opacity: 0; }
        }

        /* ì œì–´ íŒ¨ë„ */
        .controls {
            flex: 1;
            min-width: 300px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        h2 { border-bottom: 2px solid var(--primary); padding-bottom: 10px; color: #333; }
        
        .status-panel {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .data-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 0.95rem;
        }

        .btn-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        button {
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
        }

        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: #357ABD; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-warning { background: var(--warning); color: #333; }
        
        button:disabled { background: #ccc; cursor: not-allowed; }

        .slider-container {
            margin: 20px 0;
        }

        input[type="range"] { width: 100%; }

        .calc-section {
            border-top: 2px dashed #ccc;
            padding-top: 20px;
            display: none;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .input-group input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .feedback-box {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
            text-align: center;
            min-height: 40px;
        }

        .tooltip {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .lab-bench { width: 100%; height: 400px; }
            .container { padding: 10px; }
        }
    </style>
</head>
<body>

<header>
    <h1>ğŸ§ª ê°€ìƒ í™”í•™ ì‹¤í—˜ì‹¤: ì¤‘í™” ì ì •</h1>
    <p>í‘œì¤€ ìš©ì•¡(NaOH)ì„ ì‚¬ìš©í•˜ì—¬ ë¯¸ì§€ ì—¼ì‚°(HCl)ì˜ ë†ë„ë¥¼ êµ¬í•´ë³´ì„¸ìš”.</p>
</header>

<div class="container">
    <div class="lab-bench">
        <div class="stand"></div>
        <div class="clamp"></div>
        
        <div class="burette">
            <div class="burette-liquid" id="buretteLiquid" style="height: 100%;"></div>
        </div>
        <div class="drop" id="dropAnimation"></div>

        <div class="flask">
            <div class="flask-shape">
                <div class="flask-liquid" id="flaskLiquid"></div>
            </div>
        </div>
    </div>

    <div class="controls">
        <div class="status-panel">
            <h3>ğŸ“Š ì‹¤í—˜ ë°ì´í„°</h3>
            <div class="data-row"><span>í‘œì¤€ ìš©ì•¡ (NaOH) ë†ë„:</span> <strong>0.1 M</strong></div>
            <div class="data-row"><span>ì—¼ì‚° (HCl) ë¶€í”¼:</span> <strong>20 mL</strong></div>
            <div class="data-row"><span>í˜„ì¬ íˆ¬ì…ëœ NaOH ë¶€í”¼:</span> <strong id="volDisplay">0.0</strong> mL</div>
            <div class="data-row"><span>í˜„ì¬ í”Œë¼ìŠ¤í¬ ìƒ‰ìƒ:</span> <span id="colorStatus">ë¬´ìƒ‰</span></div>
        </div>

        <div id="step1-setup">
            <h3>STEP 1: ì‹¤í—˜ ì¤€ë¹„</h3>
            <p>ì‹¤í—˜ ê¸°êµ¬ë¥¼ ì„¸íŒ…í•˜ê³  ì§€ì‹œì•½ì„ ë„£ìŠµë‹ˆë‹¤.</p>
            <button class="btn-warning" style="width: 100%" onclick="setupExperiment()">ğŸ§ª í˜ë†€í”„íƒˆë ˆì¸ ì§€ì‹œì•½ ë„£ê¸°</button>
        </div>

        <div id="step2-titration" style="display: none;">
            <h3>STEP 2: ì ì • ìˆ˜í–‰</h3>
            <p>ë·°ë › ì½•ì„ ì¡°ì ˆí•˜ì—¬ NaOHë¥¼ ë–¨ì–´ëœ¨ë¦¬ì„¸ìš”. <br><small>ğŸ’¡ ë¶‰ì€ìƒ‰ì´ ë‚˜íƒ€ë‚˜ ì‚¬ë¼ì§€ì§€ ì•Šì„ ë•Œ ë©ˆì¶”ì„¸ìš”.</small></p>
            
            <div class="btn-group">
                <button class="btn-primary" onclick="addBase(1)">1 mL ë„£ê¸°</button>
                <button class="btn-primary" onclick="addBase(0.5)">0.5 mL ë„£ê¸°</button>
                <button class="btn-primary" onclick="addBase(0.1)">0.1 mL ë„£ê¸°</button>
                <button class="btn-primary" onclick="addBase(0.05)">í•œ ë°©ìš¸ (0.05mL)</button>
            </div>
            
            <button class="btn-success" style="width: 100%" onclick="finishTitration()">âœ… ì‹¤í—˜ ì¢…ë£Œ ë° ê³„ì‚°í•˜ê¸°</button>
        </div>

        <div id="step3-calc" class="calc-section">
            <h3>STEP 3: ê²°ê³¼ ê³„ì‚°</h3>
            <p>ì¤‘í™”ì ê¹Œì§€ ë“¤ì–´ê°„ NaOH ë¶€í”¼: <strong id="finalVol"></strong> mL</p>
            <p>ê³µì‹: $1 \times M_{HCl} \times 20 = 1 \times 0.1 \times V_{NaOH}$</p>
            <div class="input-group">
                <input type="number" id="userAnswer" placeholder="HCl ë†ë„ ì…ë ¥ (ì†Œìˆ˜ì  ë‘˜ì§¸ìë¦¬)">
                <button class="btn-primary" onclick="checkAnswer()">ì •ë‹µ í™•ì¸</button>
            </div>
            <div id="feedback" class="feedback-box"></div>
            <button class="btn-danger" style="width: 100%; margin-top: 10px;" onclick="resetExperiment()">ğŸ”„ ë‹¤ì‹œ ì‹¤í—˜í•˜ê¸°</button>
        </div>
    </div>
</div>

<script>
    // ì‹¤í—˜ ë³€ìˆ˜
    const naohConc = 0.1; // M
    const hclVol = 20; // mL
    let hclConc = 0; // ëœë¤ ìƒì„±
    let currentNaohVol = 0;
    let targetVol = 0; // ì¤‘í™”ì  ë¶€í”¼
    let isIndicatorAdded = false;

    // ì´ˆê¸°í™” í•¨ìˆ˜
    function init() {
        // ëœë¤ ë†ë„ ìƒì„± (0.05 ~ 0.15 M ì‚¬ì´)
        hclConc = (Math.random() * (0.15 - 0.05) + 0.05).toFixed(3);
        // ì´ë¡ ì  ì¤‘í™”ì  ê³„ì‚° (M1V1 = M2V2) -> 1 * ? * 20 = 1 * 0.1 * V2
        // V2 = (hclConc * 20) / 0.1
        targetVol = (hclConc * hclVol) / naohConc;
        
        currentNaohVol = 0;
        isIndicatorAdded = false;
        
        // UI ì´ˆê¸°í™”
        document.getElementById('volDisplay').innerText = "0.0";
        document.getElementById('colorStatus').innerText = "ë¬´ìƒ‰";
        document.getElementById('colorStatus').style.color = "black";
        document.getElementById('flaskLiquid').style.backgroundColor = "#E0F7FA";
        document.getElementById('buretteLiquid').style.height = "100%";
        
        document.getElementById('step1-setup').style.display = "block";
        document.getElementById('step2-titration').style.display = "none";
        document.getElementById('step3-calc').style.display = "none";
        document.getElementById('feedback').innerText = "";
        document.getElementById('userAnswer').value = "";
        
        console.log(`[Developer Log] Target NaOH Volume: ${targetVol.toFixed(2)} mL, HCl Conc: ${hclConc} M`);
    }

    // Step 1: ì¤€ë¹„
    function setupExperiment() {
        isIndicatorAdded = true;
        alert("í˜ë†€í”„íƒˆë ˆì¸ ì§€ì‹œì•½ì„ 2~3ë°©ìš¸ ë„£ì—ˆìŠµë‹ˆë‹¤.\ní˜„ì¬ ìš©ì•¡ì€ ì‚°ì„±ì´ë¯€ë¡œ ë¬´ìƒ‰ì…ë‹ˆë‹¤.");
        document.getElementById('step1-setup').style.display = "none";
        document.getElementById('step2-titration').style.display = "block";
    }

    // Step 2: ì ì •
    function addBase(amount) {
        if (!isIndicatorAdded) return;

        currentNaohVol += amount;
        
        // ì‹œê°ì  ì—…ë°ì´íŠ¸ (ìˆ˜ì¹˜)
        document.getElementById('volDisplay').innerText = currentNaohVol.toFixed(2);
        
        // ë·°ë › ìˆ˜ìœ„ ì¡°ì ˆ (ë‹¨ìˆœ ì‹œê°í™”ìš© ë¹„ìœ¨)
        let buretteHeight = 100 - (currentNaohVol * 2); 
        if(buretteHeight < 0) buretteHeight = 0;
        document.getElementById('buretteLiquid').style.height = `${buretteHeight}%`;

        // ë¬¼ë°©ìš¸ ì• ë‹ˆë©”ì´ì…˜
        const drop = document.getElementById('dropAnimation');
        drop.style.animation = 'none';
        drop.offsetHeight; /* trigger reflow */
        drop.style.animation = 'dropFall 0.5s linear';

        // ìƒ‰ìƒ ë³€í™” ë¡œì§
        updateColor();
    }

    function updateColor() {
        const liquid = document.getElementById('flaskLiquid');
        const status = document.getElementById('colorStatus');
        
        // ì¤‘í™”ì  ê·¼ì²˜ íŒë³„
        const diff = currentNaohVol - targetVol;

        if (diff < -0.5) {
            // ì‚°ì„±: ë¬´ìƒ‰
            liquid.style.backgroundColor = "#E0F7FA";
            status.innerText = "ë¬´ìƒ‰ (ì‚°ì„±)";
            status.style.color = "black";
        } else if (diff >= -0.5 && diff < 0) {
            // ì¤‘í™”ì  ì§ì „ (ì•„ì£¼ í¬ë¯¸í•œ ë°˜ì‘ ì‹œë®¬ë ˆì´ì…˜)
            liquid.style.backgroundColor = "rgba(255, 240, 245, 0.8)";
            status.innerText = "ë¬´ìƒ‰ (ê³§ ë³€í•¨)";
        } else if (diff >= 0 && diff < 0.5) {
            // ì¤‘í™”ì  ë„ë‹¬ (ì—°í•œ ë¶„í™ìƒ‰) - Best Result
            liquid.style.backgroundColor = "rgba(255, 182, 193, 0.6)";
            status.innerText = "ì—°í•œ ë¶„í™ìƒ‰ (ì¤‘í™”ì )";
            status.style.color = "#E91E63";
        } else {
            // ê³¼ì ì • (ì§„í•œ ë¶‰ì€ìƒ‰)
            liquid.style.backgroundColor = "rgba(255, 20, 147, 0.8)";
            status.innerText = "ì§„í•œ ë¶‰ì€ìƒ‰ (ì—¼ê¸°ì„±/ê³¼ì ì •)";
            status.style.color = "#C2185B";
        }
    }

    // Step 3: ì¢…ë£Œ ë° ê³„ì‚°
    function finishTitration() {
        document.getElementById('step2-titration').style.display = "none";
        document.getElementById('step3-calc').style.display = "block";
        document.getElementById('finalVol').innerText = currentNaohVol.toFixed(2);
    }

    // ì •ë‹µ í™•ì¸
    function checkAnswer() {
        const userVal = parseFloat(document.getElementById('userAnswer').value);
        const feedback = document.getElementById('feedback');
        
        // ì‹¤ì œ ì •ë‹µ
        // M_HCl = (M_NaOH * V_NaOH) / V_HCl
        // ì—¬ê¸°ì„œ V_NaOHëŠ” í•™ìƒì´ 'ë©ˆì¶˜ ì‹œì 'ì˜ ë¶€í”¼ë¥¼ ì‚¬ìš©í•´ì•¼ ë…¼ë¦¬ì ìœ¼ë¡œ ë§ìŒ (ì‹¤í—˜ ì˜¤ì°¨ ë°˜ì˜)
        // í•˜ì§€ë§Œ êµìœ¡ì ìœ¼ë¡œëŠ” 'ì´ë¡ ì  ì •ë‹µ'ê³¼ 'ì‹¤í—˜ê°’'ì„ ë¹„êµí•´ì£¼ëŠ” ê²ƒì´ ì¢‹ìŒ.
        
        // ì‹œë‚˜ë¦¬ì˜¤: í•™ìƒì´ ë©ˆì¶˜ ì§€ì  ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°í–ˆëŠ”ì§€ í™•ì¸
        const calculatedFromExperiment = (naohConc * currentNaohVol) / hclVol;
        
        if (isNaN(userVal)) {
            feedback.innerText = "ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!";
            feedback.style.color = "red";
            return;
        }

        const errorMargin = 0.01;
        
        if (Math.abs(userVal - calculatedFromExperiment) <= errorMargin) {
            // ê³„ì‚°ì´ ì •í™•í•¨
            // ê·¸ëŸ°ë° ì‹¤í—˜ ìì²´ê°€ ì˜ ë˜ì—ˆëŠ”ê°€? (ìƒ‰ê¹” ì²´í¬)
            const diff = currentNaohVol - targetVol;
            
            if (diff >= 0 && diff < 0.5) {
                 feedback.innerHTML = "ğŸ‰ í›Œë¥­í•©ë‹ˆë‹¤! <br>ì‹¤í—˜ ì¡°ì‘ë„ ì™„ë²½í•˜ê³  ê³„ì‚°ë„ ì •í™•í•©ë‹ˆë‹¤.";
                 feedback.style.color = "green";
            } else if (diff >= 0.5) {
                 feedback.innerHTML = "âš ï¸ ê³„ì‚°ì€ ë§ì•˜ì§€ë§Œ, ì‹¤í—˜ì´ ê³¼ì ì •ë˜ì—ˆìŠµë‹ˆë‹¤.<br>(ë„ˆë¬´ ì§„í•œ ë¶‰ì€ìƒ‰ì…ë‹ˆë‹¤. NaOHë¥¼ ì¡°ê¸ˆ ëœ ë„£ì—ˆì–´ì•¼ í•´ìš”.)";
                 feedback.style.color = "#E67E22";
            } else {
                 feedback.innerHTML = "âš ï¸ ê³„ì‚°ì€ ë§ì•˜ì§€ë§Œ, ì¤‘í™”ì ì— ë„ë‹¬í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.<br>(ì•„ì§ ë¬´ìƒ‰ì…ë‹ˆë‹¤. NaOHë¥¼ ë” ë„£ì–´ì•¼ í•´ìš”.)";
                 feedback.style.color = "#E67E22";
            }
        } else {
            feedback.innerHTML = `âŒ ê³„ì‚°ì´ í‹€ë ¸ìŠµë‹ˆë‹¤.<br>ì‹: (1 Ã— M Ã— 20) = (1 Ã— 0.1 Ã— ${currentNaohVol.toFixed(2)})<br>ì •ë‹µì€ ì•½ ${calculatedFromExperiment.toFixed(3)} M ì…ë‹ˆë‹¤.`;
            feedback.style.color = "red";
        }
    }

    function resetExperiment() {
        init();
    }

    // ì‹œì‘
    init();
</script>

</body>
</html>