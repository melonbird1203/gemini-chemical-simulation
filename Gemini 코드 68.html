<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¬¼ë¦¬ ë³€í™” vs í™”í•™ ë³€í™” ê°€ìƒ ì‹¤í—˜ì‹¤</title>
    <style>
        :root {
            --primary: #4A90E2;
            --success: #2ECC71;
            --warning: #F1C40F;
            --danger: #E74C3C;
            --bg: #F4F6F7;
            --card-bg: #FFFFFF;
        }
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            max-width: 800px;
            width: 100%;
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            font-size: 1.5rem;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }
        .lab-bench {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        .screen-area {
            width: 100%;
            height: 300px;
            background: #ecf0f1;
            border-radius: 10px;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 2px solid #bdc3c7;
            overflow: hidden;
        }
        canvas {
            background: white;
            border-radius: 8px;
        }
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            font-size: 1rem;
        }
        button:hover { transform: translateY(-2px); }
        .btn-select { background: var(--primary); color: white; }
        .btn-check { background: var(--warning); color: #333; }
        .btn-answer { width: 150px; padding: 15px; font-size: 1.1rem; }
        .btn-phys { background: #3498db; color: white; }
        .btn-chem { background: #9b59b6; color: white; }
        
        .feedback-panel {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-left: 5px solid #bdc3c7;
            border-radius: 5px;
            display: none;
        }
        .status-bar {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        .molecule-legend {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            font-size: 0.8rem;
        }
        .dot { width: 10px; height: 10px; display: inline-block; border-radius: 50%; margin-right: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ”¬ ê°€ìƒ ì‹¤í—˜ì‹¤: ë¬¼ì§ˆì˜ ë³€í™” íƒêµ¬</h1>
    
    <div class="status-bar">
        <span>í˜„ì¬ ì‹¤í—˜: <b id="current-exp-name">ì‹¤í—˜ì„ ì„ íƒí•˜ì„¸ìš”</b></span>
        <span>ì„±ì·¨ë„: <span id="score">0</span> / 5</span>
    </div>

    <div class="lab-bench">
        <div class="controls">
            <button class="btn-select" onclick="loadExperiment('ice')">ğŸ§Š ì–¼ìŒ ë…¹ì´ê¸°</button>
            <button class="btn-select" onclick="loadExperiment('can')">ğŸ¥« ì°Œê·¸ëŸ¬ì§„ ìº”</button>
            <button class="btn-select" onclick="loadExperiment('sugar')">ğŸ”¥ ì„¤íƒ• ê°€ì—´í•˜ê¸°</button>
            <button class="btn-select" onclick="loadExperiment('rust')">ğŸ”© ëª»ì— ë…¹ ìƒê¹€</button>
            <button class="btn-select" onclick="loadExperiment('popcorn')">ğŸ¿ íŒì½˜ íŠ€ê¸°ê¸°</button>
        </div>

        <div class="screen-area" id="screen">
            <canvas id="particleCanvas" width="500" height="280"></canvas>
            <div id="start-msg" style="position:absolute; color:#7f8c8d;">ìœ„ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹¤í—˜ì„ ì‹œì‘í•˜ì„¸ìš”.</div>
        </div>

        <div class="molecule-legend" id="legend" style="visibility: hidden;">
            <span><span class="dot" style="background:skyblue;"></span>ë¬¼ ì…ì</span>
            <span><span class="dot" style="background:gray;"></span>ì²  ì…ì</span>
            <span><span class="dot" style="background:red;"></span>ì‚°ì†Œ ì…ì</span>
        </div>

        <p style="text-align:center; font-weight:bold;">ì´ ë³€í™”ëŠ” ì–´ë–¤ ë³€í™”ì¼ê¹Œìš”?</p>

        <div class="controls">
            <button class="btn-answer btn-phys" onclick="checkAnswer('physical')">ë¬¼ë¦¬ ë³€í™”</button>
            <button class="btn-answer btn-chem" onclick="checkAnswer('chemical')">í™”í•™ ë³€í™”</button>
        </div>

        <div class="feedback-panel" id="feedback">
            <h3 id="fb-title">ê²°ê³¼</h3>
            <p id="fb-desc">ì„¤ëª…</p>
            <p id="fb-particle"><b>ì…ì ê´€ì :</b> <span></span></p>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('particleCanvas');
    const ctx = canvas.getContext('2d');
    const feedback = document.getElementById('feedback');
    const legend = document.getElementById('legend');
    
    let currentExp = null;
    let particles = [];
    let animationId;
    let score = 0;
    let isChanged = false; // ë³€í™”ê°€ ì¼ì–´ë‚œ í›„ ìƒíƒœì¸ì§€

    // ì‹¤í—˜ ë°ì´í„°ë² ì´ìŠ¤
    const experiments = {
        ice: {
            name: "ì–¼ìŒ ë…¹ì´ê¸° (ìƒíƒœ ë³€í™”)",
            type: "physical",
            desc: "ì–¼ìŒì´ ë…¹ì•„ ë¬¼ì´ ë˜ì—ˆìŠµë‹ˆë‹¤. ëª¨ì–‘ê³¼ ìƒíƒœëŠ” ë³€í–ˆì§€ë§Œ, ë¬¼ì´ë¼ëŠ” ì„±ì§ˆì€ ë³€í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.",
            particleText: "ë¬¼ ë¶„ìì˜ ë°°ì—´ë§Œ ë¹½ë¹½í•œ ìƒíƒœì—ì„œ ëŠìŠ¨í•œ ìƒíƒœë¡œ ë³€í–ˆìŠµë‹ˆë‹¤. (ë¶„ì ìì²´ëŠ” ê·¸ëŒ€ë¡œ)",
            colors: ['skyblue'],
            setup: 'solid', // solid, gas, mix
            changeAction: 'melt'
        },
        can: {
            name: "ì•Œë£¨ë¯¸ëŠ„ ìº” ì°Œê·¸ëŸ¬ëœ¨ë¦¬ê¸°",
            type: "physical",
            desc: "ìº”ì˜ ëª¨ì–‘ì€ ì°Œê·¸ëŸ¬ì¡Œì§€ë§Œ, ì—¬ì „íˆ ì•Œë£¨ë¯¸ëŠ„ì…ë‹ˆë‹¤. ì„±ì§ˆì€ ë³€í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.",
            particleText: "ì•Œë£¨ë¯¸ëŠ„ ì…ìë“¤ì˜ ìœ„ì¹˜ë§Œ ì´ë™í–ˆì„ ë¿, ì…ì ë°°ì—´ êµ¬ì¡°ë‚˜ ì¢…ë¥˜ëŠ” ë³€í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.",
            colors: ['gray'],
            setup: 'solid-block',
            changeAction: 'distort'
        },
        sugar: {
            name: "ì„¤íƒ• ê°€ì—´í•˜ê¸° (ê°ˆìƒ‰ìœ¼ë¡œ ë³€í•¨)",
            type: "chemical",
            desc: "ì„¤íƒ•ì´ íƒ€ë©´ì„œ ê²€ì€ìƒ‰ ìˆ¯ê³¼ ë¬¼ë¡œ ë¶„í•´ë˜ì—ˆìŠµë‹ˆë‹¤. ì „í˜€ ë‹¤ë¥¸ ìƒˆë¡œìš´ ë¬¼ì§ˆì´ ë˜ì—ˆìŠµë‹ˆë‹¤.",
            particleText: "ì„¤íƒ• ë¶„ìê°€ ìª¼ê°œì ¸ì„œ íƒ„ì†Œ(ê²€ì •)ì™€ ë¬¼(íŒŒë‘)ì´ë¼ëŠ” ìƒˆë¡œìš´ ë¶„ìë¡œ ë³€í–ˆìŠµë‹ˆë‹¤.",
            colors: ['white'], // ì´ˆê¸°
            setup: 'pile',
            changeAction: 'burn'
        },
        rust: {
            name: "ì²  ëª»ì— ë…¹ì´ ìŠ¬ë‹¤",
            type: "chemical",
            desc: "ì€ìƒ‰ ì² ì´ ë¶‰ì€ìƒ‰ ë…¹(ì‚°í™”ì² )ìœ¼ë¡œ ë³€í–ˆìŠµë‹ˆë‹¤. ìì„ì— ë¶™ì§€ ì•ŠëŠ” ìƒˆë¡œìš´ ì„±ì§ˆì„ ê°€ì§‘ë‹ˆë‹¤.",
            particleText: "ì²  ì…ìì™€ ì‚°ì†Œ ì…ìê°€ ê²°í•©í•˜ì—¬ 'ì‚°í™”ì² 'ì´ë¼ëŠ” ìƒˆë¡œìš´ ì…ìê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.",
            colors: ['gray', 'red'],
            setup: 'scattered',
            changeAction: 'combine'
        },
        popcorn: {
            name: "íŒì½˜ íŠ€ê¸°ê¸°",
            type: "physical", // ë…¼ë€ì˜ ì—¬ì§€ê°€ ìˆìœ¼ë‚˜ ì¤‘ë“±ê³¼ì •ì—ì„œëŠ” ë‚´ë¶€ ìˆ˜ë¶„ ê¸°í™”ë¡œ ì¸í•œ ë¬¼ë¦¬ì  í­ë°œ+í™”í•™ì  ë³€í™” í˜¼ì¬ì´ë‚˜, ë³´í†µ 'ëª¨ì–‘ë³€í™”/ìƒíƒœë³€í™”' ê°•ì¡° ì‹œ ë¬¼ë¦¬, 'ìµëŠ” ê²ƒ' ê°•ì¡° ì‹œ í™”í•™. ì—¬ê¸°ì„œëŠ” ì˜¥ìˆ˜ìˆ˜ ì•Œê°±ì´ ë‚´ë¶€ ìˆ˜ì¦ê¸° íŒ½ì°½ì— ì˜í•œ ë¬¼ë¦¬ë³€í™” ê°•ì¡°(ë‹¨ìˆœí™”) í˜¹ì€ ìš”ë¦¬ë¡œ ë´ì„œ í™”í•™. *êµê³¼ì„œì ìœ¼ë¡œëŠ” ì˜¥ìˆ˜ìˆ˜->íŒì½˜ì€ ì„±ì§ˆ ë³€í™”(ë§›,ì‹ê°)ë¡œ í™”í•™ë³€í™”ë¡œ ë¶„ë¥˜í•˜ê¸°ë„ í•¨. ì—¬ê¸°ì„œëŠ” í™•ì‹¤í•œ 'í™”í•™'ìœ¼ë¡œ ì„¤ì • (ì „ë¶„ êµ¬ì¡° ë³€í™”)*
            // ìˆ˜ì •: ì¤‘ë“± êµê³¼ì„œì—ì„œ íŒì½˜ì€ ì• ë§¤í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ëª…í™•í•œ ì˜ˆì‹œì¸ 'ë‹¬ê±€ ìµíˆê¸°'ì™€ ìœ ì‚¬í•˜ê²Œ í™”í•™ìœ¼ë¡œ ì²˜ë¦¬í•˜ê±°ë‚˜, ë‹¨ìˆœ íŒ½ì°½ì´ë©´ ë¬¼ë¦¬. 
            // ì•ˆì „í•˜ê²Œ 'ì–‘ì´ˆ ì—°ì†Œ'ë‚˜ 'ë‹¬ê±€ ì‚¶ê¸°'ê°€ ë‚«ì§€ë§Œ, ì¬ë¯¸ë¥¼ ìœ„í•´ íŒì½˜ì„ 'í™”í•™(ì„±ì§ˆë³€í™”)'ë¡œ ì„¤ì •.
            type: "chemical",
            desc: "ì˜¥ìˆ˜ìˆ˜ê°€ ì—´ì„ ë°›ì•„ ë§›ê³¼ ìƒ‰, ì‹ê°ì´ ë³€í–ˆìŠµë‹ˆë‹¤. (ì „ë¶„ì˜ í˜¸í™” - í™”í•™ì  ì„±ì§ˆ ë³€í™”)",
            particleText: "ì—´ì— ì˜í•´ ë‚´ë¶€ ë¶„ì êµ¬ì¡°ê°€ ë³€í•˜ì—¬ ìƒˆë¡œìš´ ì„±ì§ˆì„ ë ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.",
            colors: ['orange'],
            setup: 'seed',
            changeAction: 'explode'
        }
    };

    function loadExperiment(key) {
        currentExp = experiments[key];
        document.getElementById('current-exp-name').textContent = currentExp.name;
        document.getElementById('start-msg').style.display = 'none';
        feedback.style.display = 'none';
        legend.style.visibility = 'visible';
        
        isChanged = false;
        initParticles(currentExp);
        loop();
        
        // 1.5ì´ˆ í›„ ë³€í™” ì• ë‹ˆë©”ì´ì…˜ íŠ¸ë¦¬ê±°
        setTimeout(() => {
            isChanged = true;
            triggerChange(currentExp);
        }, 1500);
    }

    function initParticles(exp) {
        particles = [];
        const count = 30;
        
        if (exp.setup === 'solid') {
            // ê³ ì²´ ë°°ì—´ (ê·œì¹™ì )
            for(let i=0; i<5; i++) {
                for(let j=0; j<6; j++) {
                    particles.push({
                        x: 180 + j * 25, y: 100 + i * 25,
                        vx: 0, vy: 0,
                        color: exp.colors[0],
                        r: 10, type: 'original'
                    });
                }
            }
        } else if (exp.setup === 'scattered') {
            // ì‚°ë§Œí•˜ê²Œ í¼ì§ (ì² ê³¼ ì‚°ì†Œ)
            for(let i=0; i<15; i++) { // ì² 
                particles.push({ x: Math.random()*400+50, y: Math.random()*200+40, vx: Math.random()-0.5, vy: Math.random()-0.5, color: 'gray', r: 10, type: 'Fe' });
            }
            for(let i=0; i<15; i++) { // ì‚°ì†Œ
                particles.push({ x: Math.random()*400+50, y: Math.random()*200+40, vx: Math.random()*2-1, vy: Math.random()*2-1, color: 'red', r: 6, type: 'O2' });
            }
        } else if (exp.setup === 'pile') {
             for(let i=0; i<30; i++) {
                particles.push({ x: 250 + (Math.random()-0.5)*60, y: 200 + (Math.random()-0.5)*40, vx: 0, vy: 0, color: 'white', r: 8, type: 'sugar' });
            }
        } else {
             // ê¸°ë³¸
             for(let i=0; i<20; i++) {
                particles.push({ x: 250, y: 140, vx: (Math.random()-0.5)*2, vy: (Math.random()-0.5)*2, color: exp.colors[0], r: 10, type: 'base' });
            }
        }
    }

    function triggerChange(exp) {
        if (exp.changeAction === 'melt') {
            // ííŠ¸ëŸ¬ì§€ë©° ì›€ì§ì„
            particles.forEach(p => {
                p.vx = (Math.random() - 0.5) * 2;
                p.vy = (Math.random() - 0.5) * 2; // ì•„ë˜ë¡œ íë¥´ëŠ” ëŠë‚Œ ëŒ€ì‹  ììœ  ìš´ë™ (ì•¡ì²´)
            });
        } else if (exp.changeAction === 'distort') {
            // ì „ì²´ ë©ì–´ë¦¬ê°€ ì°Œê·¸ëŸ¬ì§
            particles.forEach(p => {
                if(p.x > 250) p.x -= 20;
                else p.x += 20;
                p.y += (Math.random()*10);
            });
        } else if (exp.changeAction === 'combine') {
            // ê²°í•© (í™”í•™)
            // ê°„ë‹¨í•œ ì‹œê°í™”ë¥¼ ìœ„í•´ ìƒ‰ì„ ë°”ê¾¸ê±°ë‚˜ ë¶™ì„
            particles.forEach(p => {
                p.vx *= 0.1; p.vy *= 0.1; // ëŠë ¤ì§
                if(p.type === 'Fe') p.color = '#8B4513'; // ë…¹ìŠ¨ìƒ‰
                if(p.type === 'O2') p.r = 0; // ì‚°ì†Œ ì‚¬ë¼ì§(ê²°í•©ëœê²ƒìœ¼ë¡œ ê°„ì£¼)
            });
        } else if (exp.changeAction === 'burn') {
            // ë¶„í•´ (í™”í•™)
            particles.forEach((p, index) => {
                p.vx = (Math.random() - 0.5) * 4;
                p.vy = (Math.random() - 0.5) * 4;
                if (index % 2 === 0) p.color = 'black'; // íƒ„ì†Œ
                else p.color = 'blue'; // ë¬¼(ìˆ˜ì¦ê¸°)
            });
        }
    }

    function loop() {
        ctx.clearRect(0,0, canvas.width, canvas.height);
        
        particles.forEach(p => {
            // ì›€ì§ì„
            if(isChanged && (currentExp.changeAction === 'melt' || currentExp.changeAction === 'burn' || currentExp.setup === 'scattered')) {
                p.x += p.vx;
                p.y += p.vy;
                
                // ë²½ íŠ•ê¸°ê¸°
                if(p.x < 10 || p.x > canvas.width-10) p.vx *= -1;
                if(p.y < 10 || p.y > canvas.height-10) p.vy *= -1;
            }

            // ê·¸ë¦¬ê¸°
            if(p.r > 0) {
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
                ctx.fillStyle = p.color;
                ctx.fill();
                ctx.strokeStyle = '#333';
                ctx.stroke();
            }
        });

        animationId = requestAnimationFrame(loop);
    }

    function checkAnswer(userChoice) {
        if(!currentExp) {
            alert("ë¨¼ì € ì‹¤í—˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”!");
            return;
        }

        const isCorrect = userChoice === currentExp.type;
        const resultTitle = document.getElementById('fb-title');
        const resultDesc = document.getElementById('fb-desc');
        const resultParticle = document.querySelector('#fb-particle span');
        const card = document.getElementById('feedback');

        card.style.display = 'block';
        
        if(isCorrect) {
            resultTitle.textContent = "âœ… ì •ë‹µì…ë‹ˆë‹¤!";
            resultTitle.style.color = "var(--success)";
            score = Math.min(score + 1, 5);
        } else {
            resultTitle.textContent = "âŒ ë‹¤ì‹œ ìƒê°í•´ë³¼ê¹Œìš”?";
            resultTitle.style.color = "var(--danger)";
        }

        document.getElementById('score').textContent = score;
        resultDesc.textContent = currentExp.desc;
        resultParticle.textContent = currentExp.particleText;
    }
</script>

</body>
</html>