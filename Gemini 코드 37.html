<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ì˜¨ í˜•ì„± ê°€ìƒ ì‹¤í—˜ì‹¤</title>
    <style>
        :root { --primary: #4a90e2; --bg: #f5f7fa; --text: #333; }
        body { font-family: 'Malgun Gothic', sans-serif; background: var(--bg); color: var(--text); display: flex; flex-direction: column; align-items: center; margin: 0; padding: 20px; }
        
        .container { max-width: 800px; width: 100%; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: var(--primary); }
        
        /* Control Panel */
        .controls { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        button { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; transition: 0.2s; }
        .btn-elem { background: #e0e0e0; }
        .btn-elem.active { background: var(--primary); color: white; font-weight: bold; }
        .btn-action { background: #ff7675; color: white; font-weight: bold; }
        .btn-add { background: #55efc4; color: #2d3436; font-weight: bold; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Visualization Area */
        .experiment-area { display: flex; flex-direction: column; align-items: center; position: relative; height: 400px; justify-content: center; background: #fafafa; border: 2px dashed #ccc; border-radius: 10px; margin-bottom: 20px; overflow: hidden; }
        
        /* Atom Structure */
        .nucleus { width: 50px; height: 50px; background: #d63031; border-radius: 50%; display: flex; justify-content: center; align-items: center; color: white; font-weight: bold; z-index: 10; position: absolute; box-shadow: 0 0 10px rgba(214, 48, 49, 0.5); }
        .shell { border: 2px solid #b2bec3; border-radius: 50%; position: absolute; pointer-events: none; }
        .electron { width: 12px; height: 12px; background: #0984e3; border-radius: 50%; position: absolute; transition: all 0.5s ease; box-shadow: 0 0 5px #0984e3; }
        
        /* Info Panel */
        .info-panel { display: flex; justify-content: space-around; background: #dfe6e9; padding: 15px; border-radius: 10px; margin-bottom: 15px; }
        .stat-box { text-align: center; }
        .stat-value { font-size: 1.5rem; font-weight: bold; }
        
        /* Feedback Area */
        .feedback { text-align: center; padding: 15px; background: #ffeaa7; border-radius: 8px; font-weight: bold; min-height: 50px; display: flex; align-items: center; justify-content: center; }
        
        /* Formula Display */
        .formula-display { text-align: center; font-size: 2rem; margin-top: 10px; min-height: 3rem; }
    </style>
</head>
<body>

<div class="container">
    <h1âš›ï¸ ì´ì˜¨ ë§Œë“¤ê¸° ì‹¤í—˜ì‹¤</h1>
    <p style="text-align: center;">ì›ìë¥¼ ì„ íƒí•˜ê³  ì „ìë¥¼ ìƒê±°ë‚˜ ì–»ê²Œ í•˜ì—¬ ì•ˆì •í•œ ì´ì˜¨ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”.</p>

    <div class="controls">
        <button class="btn-elem" onclick="initExperiment('Na')">ë‚˜íŠ¸ë¥¨ (Na)</button>
        <button class="btn-elem" onclick="initExperiment('Mg')">ë§ˆê·¸ë„¤ìŠ˜ (Mg)</button>
        <button class="btn-elem" onclick="initExperiment('Cl')">ì—¼ì†Œ (Cl)</button>
        <button class="btn-elem" onclick="initExperiment('O')">ì‚°ì†Œ (O)</button>
    </div>

    <div class="info-panel">
        <div class="stat-box">
            <div>ì–‘ì„±ì ìˆ˜ (+)</div>
            <div id="proton-count" class="stat-value">11</div>
        </div>
        <div class="stat-box">
            <div>ì „ì ìˆ˜ (-)</div>
            <div id="electron-count" class="stat-value">11</div>
        </div>
        <div class="stat-box">
            <div>í˜„ì¬ ì „í•˜</div>
            <div id="net-charge" class="stat-value">0</div>
        </div>
    </div>

    <div class="experiment-area" id="atom-canvas">
        </div>

    <div class="controls">
        <button class="btn-action" id="btn-remove" onclick="modifyElectron(-1)">ì „ì ìƒê¸° (-)</button>
        <button class="btn-add" id="btn-add" onclick="modifyElectron(1)">ì „ì ì–»ê¸° (+)</button>
    </div>

    <div class="formula-display" id="formula-result">Na</div>
    <div class="feedback" id="feedback-msg">ë‚˜íŠ¸ë¥¨ ì›ìë¥¼ ì„ íƒí–ˆìŠµë‹ˆë‹¤. ì „ìë¥¼ ìƒì–´ì•¼ í• ê¹Œìš”, ì–»ì–´ì•¼ í• ê¹Œìš”?</div>
</div>

<script>
    // Element Data Configuration
    const elements = {
        'Na': { protons: 11, electrons: [2, 8, 1], symbol: 'Na', targetCharge: 1, name: 'ë‚˜íŠ¸ë¥¨' },
        'Mg': { protons: 12, electrons: [2, 8, 2], symbol: 'Mg', targetCharge: 2, name: 'ë§ˆê·¸ë„¤ìŠ˜' },
        'Cl': { protons: 17, electrons: [2, 8, 7], symbol: 'Cl', targetCharge: -1, name: 'ì—¼ì†Œ' },
        'O':  { protons: 8,  electrons: [2, 6],    symbol: 'O',  targetCharge: -2, name: 'ì‚°ì†Œ' }
    };

    let currentElem = null;
    let currentElectrons = 0;
    let baseProtons = 0;

    function initExperiment(symbol) {
        currentElem = elements[symbol];
        baseProtons = currentElem.protons;
        
        // Count total initial electrons
        currentElectrons = currentElem.electrons.reduce((a, b) => a + b, 0);

        // UI Reset
        document.querySelectorAll('.btn-elem').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        
        updateDisplay();
        renderAtom();
        
        let hint = "";
        const valence = currentElem.electrons[currentElem.electrons.length - 1];
        if(valence < 4) {
            hint = `ê°€ì¥ ë°”ê¹¥ìª½ ê»ì§ˆì— ì „ìê°€ <strong>${valence}ê°œ</strong> ìˆìŠµë‹ˆë‹¤. 8ê°œë¥¼ ì±„ìš°ëŠ” ê²ƒë³´ë‹¤ <strong>${valence}ê°œë¥¼ ë²„ë¦¬ëŠ” ê²ƒ</strong>ì´ ë” ì‰½ìŠµë‹ˆë‹¤.`;
        } else {
            hint = `ê°€ì¥ ë°”ê¹¥ìª½ ê»ì§ˆì— ì „ìê°€ <strong>${valence}ê°œ</strong> ìˆìŠµë‹ˆë‹¤. <strong>${8 - valence}ê°œë¥¼ ì–»ì–´ì„œ</strong> 8ê°œë¥¼ ì±„ìš°ëŠ” ê²ƒì´ ë” ì‰½ìŠµë‹ˆë‹¤.`;
        }

        document.getElementById('feedback-msg').innerHTML = `${currentElem.name} ì›ìì…ë‹ˆë‹¤. <br>${hint}`;
        document.getElementById('formula-result').innerHTML = symbol;
    }

    function modifyElectron(change) {
        if (!currentElem) return;

        currentElectrons += change;
        updateDisplay();
        renderAtom();
        checkStatus();
    }

    function checkStatus() {
        const netCharge = baseProtons - currentElectrons;
        let msg = "";
        let formula = currentElem.symbol;

        // Formula Logic
        if (netCharge > 0) {
            formula += `<sup>${netCharge === 1 ? '+' : netCharge + '+'}</sup>`;
        } else if (netCharge < 0) {
            formula += `<sup>${Math.abs(netCharge) === 1 ? '-' : Math.abs(netCharge) + '-'}</sup>`;
        }

        document.getElementById('formula-result').innerHTML = formula;

        // Feedback Logic
        if (netCharge === currentElem.targetCharge) {
            msg = `ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤! ì•ˆì •í•œ <strong>${currentElem.name} ì´ì˜¨(${formula})</strong>ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.`;
            document.getElementById('feedback-msg').style.background = "#55efc4";
        } else if (netCharge === 0) {
            msg = "ì¤‘ì„± ì›ì ìƒíƒœì…ë‹ˆë‹¤. ì „ìë¥¼ ì´ë™ì‹œì¼œ ë³´ì„¸ìš”.";
            document.getElementById('feedback-msg').style.background = "#ffeaa7";
        } else {
            // Wrong direction or count hint
            const diff = currentElem.targetCharge - netCharge;
            if (currentElem.targetCharge > 0 && change < 0) { // Should lose but gained
                 msg = "âš ï¸ ê¸ˆì† ì›ì†ŒëŠ” ì „ìë¥¼ ìƒì–´ì•¼ ì•ˆì •í•´ì§‘ë‹ˆë‹¤.";
            } else if (currentElem.targetCharge < 0 && change > 0) { // Should gain but lost
                 msg = "âš ï¸ ë¹„ê¸ˆì† ì›ì†ŒëŠ” ì „ìë¥¼ ì–»ì–´ì•¼ ì•ˆì •í•´ì§‘ë‹ˆë‹¤.";
            } else {
                 msg = "ì•„ì§ ë¶ˆì•ˆì •í•œ ìƒíƒœì…ë‹ˆë‹¤. ì „ìì˜ ê°œìˆ˜ë¥¼ ë‹¤ì‹œ ì¡°ì ˆí•´ë³´ì„¸ìš”.";
            }
            document.getElementById('feedback-msg').style.background = "#ff7675";
        }
        document.getElementById('feedback-msg').innerHTML = msg;
    }

    function updateDisplay() {
        document.getElementById('proton-count').innerText = baseProtons;
        document.getElementById('electron-count').innerText = currentElectrons;
        
        const net = baseProtons - currentElectrons;
        const sign = net > 0 ? '+' : (net < 0 ? '-' : '');
        document.getElementById('net-charge').innerText = net === 0 ? '0' : sign + Math.abs(net);
    }

    function renderAtom() {
        const container = document.getElementById('atom-canvas');
        container.innerHTML = '';

        // Nucleus
        const nucleus = document.createElement('div');
        nucleus.className = 'nucleus';
        nucleus.innerText = `+${baseProtons}`;
        container.appendChild(nucleus);

        // Distribute electrons into shells (Simple logic: 2, 8, 8...)
        let remaining = currentElectrons;
        const capacities = [2, 8, 8, 18];
        let shellIndex = 0;

        while (remaining > 0 && shellIndex < capacities.length) {
            const count = Math.min(remaining, capacities[shellIndex]);
            const radius = 60 + (shellIndex * 40);
            
            // Draw Shell Ring
            const ring = document.createElement('div');
            ring.className = 'shell';
            ring.style.width = `${radius * 2}px`;
            ring.style.height = `${radius * 2}px`;
            container.appendChild(ring);

            // Draw Electrons
            for (let i = 0; i < count; i++) {
                const angle = (i / count) * 2 * Math.PI - Math.PI / 2;
                const e = document.createElement('div');
                e.className = 'electron';
                // Position calculation
                const x = radius * Math.cos(angle);
                const y = radius * Math.sin(angle);
                
                // Centering adjustment
                e.style.left = `calc(50% + ${x}px - 6px)`;
                e.style.top = `calc(50% + ${y}px - 6px)`;
                
                // Highlight valence electrons specifically?
                if (remaining <= capacities[shellIndex]) {
                    e.style.background = '#fdcb6e'; // Gold for valence
                }
                container.appendChild(e);
            }

            remaining -= count;
            shellIndex++;
        }
    }

    // Initialize with Sodium
    initExperiment('Na');
</script>

</body>
</html>