<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìœ íš¨ ì¶©ëŒ ê°€ìƒ ì‹¤í—˜ì‹¤</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --success-color: #2ecc71;
            --fail-color: #e74c3c;
            --bg-color: #f5f7fa;
            --panel-bg: #ffffff;
        }

        body {
            font-family: 'Pretendard', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #333;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            width: 100%;
            padding: 1rem 0;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        h1 { margin: 0; font-size: 1.5rem; }
        p { margin: 0.5rem 0 0; opacity: 0.9; font-size: 0.9rem; }

        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            padding: 20px;
            max-width: 1000px;
            width: 100%;
            justify-content: center;
        }

        .canvas-wrapper {
            position: relative;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-radius: 10px;
            overflow: hidden;
            background: white;
        }

        canvas {
            background: radial-gradient(circle, #ffffff 0%, #eef2f3 100%);
            display: block;
        }

        .controls {
            flex: 1;
            min-width: 300px;
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .control-group {
            margin-bottom: 10px;
        }

        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #555;
        }

        input[type="range"] {
            width: 100%;
            cursor: pointer;
        }

        .value-display {
            float: right;
            color: var(--primary-color);
            font-weight: bold;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.2s;
            font-weight: bold;
        }

        button:hover { background-color: #357abd; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }

        .stats-panel {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #eee;
            margin-top: 10px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        #feedback-box {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
            font-weight: bold;
            min-height: 20px;
            background-color: #eee;
            color: #777;
        }

        .legend {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 10px;
            font-size: 0.8rem;
        }
        .dot { width: 10px; height: 10px; display: inline-block; border-radius: 50%; margin-right: 5px; }
    </style>
</head>
<body>

<header>
    <h1>ğŸ§ª ë°˜ì‘ ì¶©ëŒ ì‹œë®¬ë ˆì´ì…˜</h1>
    <p>NO(ì¼ì‚°í™”ì§ˆì†Œ) + Oâ‚ƒ(ì˜¤ì¡´) â†’ NOâ‚‚(ì´ì‚°í™”ì§ˆì†Œ) + Oâ‚‚(ì‚°ì†Œ)</p>
</header>

<div class="container">
    <div class="canvas-wrapper">
        <canvas id="simCanvas" width="500" height="350"></canvas>
        <div id="feedback-box">ì‹¤í—˜ ì¡°ê±´ì„ ì„¤ì •í•˜ê³  'ì‹¤í—˜ ì‹œì‘'ì„ ëˆ„ë¥´ì„¸ìš”.</div>
    </div>

    <div class="controls">
        <h3>ğŸ›ï¸ ì‹¤í—˜ ì œì–´íŒ</h3>
        
        <div class="control-group">
            <label>ì…ì ì†ë„ (ì—ë„ˆì§€) <span id="speedVal" class="value-display">50</span></label>
            <input type="range" id="speedSlider" min="10" max="100" value="50">
            <small style="color:#888;">ì†ë„ê°€ ë¹ ë¥¼ìˆ˜ë¡ ì—ë„ˆì§€ê°€ í½ë‹ˆë‹¤.</small>
        </div>

        <div class="control-group">
            <label>ì¶©ëŒ ê°ë„ (ë°°í–¥) <span id="angleVal" class="value-display">0Â°</span></label>
            <input type="range" id="angleSlider" min="-180" max="180" value="0">
            <small style="color:#888;">0ë„ê°€ ì™„ë²½í•œ ì •ë©´ ì¶©ëŒì…ë‹ˆë‹¤.</small>
        </div>

        <div class="stats-panel">
            <div class="stat-item"><span>ì´ ì‹œë„:</span> <strong id="totalCount">0</strong></div>
            <div class="stat-item"><span>ë°˜ì‘ ì„±ê³µ:</span> <strong id="successCount" style="color:var(--success-color)">0</strong></div>
            <div class="stat-item"><span>ì„±ê³µë¥ :</span> <strong id="successRate">0%</strong></div>
        </div>

        <button id="startBtn">â–¶ ì‹¤í—˜ ì‹œì‘</button>
        <button id="resetBtn" style="background-color: #95a5a6;">â†º ì´ˆê¸°í™”</button>

        <div class="legend">
            <div><span class="dot" style="background:blue"></span>N</div>
            <div><span class="dot" style="background:red"></span>O</div>
        </div>
    </div>
</div>

<script>
    // --- ì„¤ì • ë³€ìˆ˜ ---
    const canvas = document.getElementById('simCanvas');
    const ctx = canvas.getContext('2d');
    
    // DOM ìš”ì†Œ
    const speedSlider = document.getElementById('speedSlider');
    const angleSlider = document.getElementById('angleSlider');
    const speedVal = document.getElementById('speedVal');
    const angleVal = document.getElementById('angleVal');
    const startBtn = document.getElementById('startBtn');
    const resetBtn = document.getElementById('resetBtn');
    const feedbackBox = document.getElementById('feedback-box');
    
    // í†µê³„ ë³€ìˆ˜
    let totalAttempts = 0;
    let successAttempts = 0;
    
    // ì‹œë®¬ë ˆì´ì…˜ ìƒíƒœ
    let isRunning = false;
    let animationId;
    let reactionOccurred = false;
    
    // ë°˜ì‘ ì„ê³„ê°’ (ì •ë‹µ ì¡°ê±´)
    const ACTIVATION_ENERGY_SPEED = 70; // ìµœì†Œ ì†ë„ 70 ì´ìƒì´ì–´ì•¼ ë°˜ì‘
    const ACCEPTABLE_ANGLE_RANGE = 30;  // -30 ~ +30ë„ ì‚¬ì´ì—¬ì•¼ ë°˜ì‘

    // ì…ì ê°ì²´ ì •ì˜
    const p1 = { x: 50, y: 175, radius: 25, label: "NO", color: "#3498db", type: "reactant", vx: 0 };
    const p2 = { x: 450, y: 175, radius: 25, label: "Oâ‚ƒ", color: "#e74c3c", type: "reactant", vx: 0 };

    // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
    speedSlider.addEventListener('input', (e) => speedVal.textContent = e.target.value);
    angleSlider.addEventListener('input', (e) => {
        angleVal.textContent = e.target.value + "Â°";
        drawStaticScene(); // ê°ë„ ë³€ê²½ ì‹œê°í™”
    });

    startBtn.addEventListener('click', startSimulation);
    resetBtn.addEventListener('click', resetStats);

    // --- í•µì‹¬ ë¡œì§ ---

    function resetPositions() {
        p1.x = 50;
        p1.y = 175;
        p2.x = 450;
        p2.y = 175;
        
        p1.label = "NO";
        p2.label = "Oâ‚ƒ";
        p1.color = "#3498db"; // Blue
        p2.color = "#e74c3c"; // Red
        
        reactionOccurred = false;
        feedbackBox.style.background = "#eee";
        feedbackBox.style.color = "#777";
        feedbackBox.textContent = "ì‹¤í—˜ ì¤‘...";
    }

    function drawParticle(p, angle = 0, isRightSide = false) {
        ctx.save();
        ctx.translate(p.x, p.y);
        
        // ê°ë„ ì‹œê°í™” (NO ë¶„ìë§Œ íšŒì „ì‹œí‚´)
        if (!isRightSide && !reactionOccurred) {
            ctx.rotate(angle * Math.PI / 180);
        }

        // ë¶„ì ê·¸ë¦¬ê¸° (ë‹¨ìˆœí™”ëœ ëª¨ë¸)
        ctx.beginPath();
        ctx.arc(0, 0, p.radius, 0, Math.PI * 2);
        ctx.fillStyle = p.color;
        ctx.fill();
        ctx.strokeStyle = "#fff";
        ctx.lineWidth = 2;
        ctx.stroke();
        ctx.closePath();

        // í…ìŠ¤íŠ¸ ë¼ë²¨ (íšŒì „í•˜ì§€ ì•Šë„ë¡ ì—­íšŒì „)
        if (!isRightSide && !reactionOccurred) {
            ctx.rotate(-angle * Math.PI / 180);
        }
        
        ctx.fillStyle = "white";
        ctx.font = "bold 14px Arial";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(p.label, 0, 0);

        // ë°©í–¥ í™”ì‚´í‘œ (ë°˜ì‘ ì „)
        if (!reactionOccurred && isRunning) {
             ctx.beginPath();
             ctx.moveTo(isRightSide ? -30 : 30, 0);
             ctx.lineTo(isRightSide ? -40 : 40, 0);
             ctx.strokeStyle = "#333";
             ctx.lineWidth = 2;
             ctx.stroke();
        }

        ctx.restore();
    }

    function drawStaticScene() {
        if (isRunning) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // ì´ˆê¸° ìœ„ì¹˜ ê·¸ë¦¬ê¸°
        resetPositions();
        
        // ì™¼ìª½ ë¶„ì(NO)ëŠ” ê°ë„ì— ë”°ë¼ íšŒì „ëœ ìƒíƒœë¡œ ëŒ€ê¸°
        drawParticle(p1, parseInt(angleSlider.value), false);
        drawParticle(p2, 0, true);
        
        // ì¤‘ì•™ì„  (ì¶©ëŒ ì§€ì  ì˜ˆìƒ)
        ctx.setLineDash([5, 5]);
        ctx.beginPath();
        ctx.moveTo(250, 50);
        ctx.lineTo(250, 300);
        ctx.strokeStyle = "#ddd";
        ctx.stroke();
        ctx.setLineDash([]);
    }

    function startSimulation() {
        if (isRunning) return;
        resetPositions();
        isRunning = true;
        startBtn.disabled = true;
        
        const speed = parseInt(speedSlider.value);
        const angle = parseInt(angleSlider.value);
        
        // ì• ë‹ˆë©”ì´ì…˜ ì†ë„ ë³´ì • (ë„ˆë¬´ ëŠë¦¬ê±°ë‚˜ ë¹ ë¥´ì§€ ì•Šê²Œ)
        const moveSpeed = (speed / 10) + 1; 

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // ì´ë™ ë¡œì§
            if (!reactionOccurred) {
                // ì¶©ëŒ ì „ ì ‘ê·¼
                if (p1.x + p1.radius < p2.x - p2.radius) {
                    p1.x += moveSpeed;
                    p2.x -= moveSpeed;
                } else {
                    // ì¶©ëŒ ê°ì§€!
                    checkReaction(speed, angle);
                }
            } else {
                // ë°˜ì‘ ë˜ëŠ” íŠ•ê¹€ í›„ ì´ë™
                p1.x -= moveSpeed;
                p2.x += moveSpeed;
            }
            
            // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ ì¢…ë£Œ
            if (p1.x < -50 || p1.x > 550) {
                endSimulation();
                return;
            }

            drawParticle(p1, angle, false);
            drawParticle(p2, 0, true); // O3ëŠ” ê³ ì • ê°ë„ ê°€ì •

            animationId = requestAnimationFrame(animate);
        }
        animate();
    }

    function checkReaction(speed, angle) {
        // ë°˜ì‘ ì¡°ê±´ íŒë‹¨
        const isEnergeticEnough = speed >= ACTIVATION_ENERGY_SPEED;
        const isOrientedCorrectly = Math.abs(angle) <= ACCEPTABLE_ANGLE_RANGE;

        reactionOccurred = true; // ì´ì œ ë’¤ë¡œ ì´ë™ ì‹œì‘

        if (isEnergeticEnough && isOrientedCorrectly) {
            // [ë°˜ì‘ ì„±ê³µ]
            successAttempts++;
            
            // ì…ì ë³€í™” (ìƒì„±ë¬¼ë¡œ ë³€ì‹ )
            p1.label = "NOâ‚‚";
            p1.color = "#9b59b6"; // Purple (New Product)
            p2.label = "Oâ‚‚";
            p2.color = "#2ecc71"; // Green (New Product)
            
            // í”¼ë“œë°±
            feedbackBox.style.background = "#d4edda";
            feedbackBox.style.color = "#155724";
            feedbackBox.innerHTML = "ğŸ‰ <b>ë°˜ì‘ ì„±ê³µ!</b> (ìœ íš¨ ì¶©ëŒ ë°œìƒ)<br>ì¶©ë¶„í•œ ì—ë„ˆì§€ì™€ ì˜¬ë°”ë¥¸ ê°ë„ì…ë‹ˆë‹¤.";
        } else {
            // [ë°˜ì‘ ì‹¤íŒ¨]
            let reason = "";
            if (!isEnergeticEnough) reason += "ì—ë„ˆì§€ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤ (ì†ë„ UP í•„ìš”). ";
            if (!isOrientedCorrectly) reason += "ì¶©ëŒ ê°ë„ê°€ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤. ";
            
            feedbackBox.style.background = "#f8d7da";
            feedbackBox.style.color = "#721c24";
            feedbackBox.innerHTML = `ğŸ’¨ <b>ë°˜ì‘ ì‹¤íŒ¨!</b><br>${reason}`;
        }
    }

    function endSimulation() {
        isRunning = false;
        startBtn.disabled = false;
        cancelAnimationFrame(animationId);
        
        // í†µê³„ ì—…ë°ì´íŠ¸
        totalAttempts++;
        document.getElementById('totalCount').textContent = totalAttempts;
        document.getElementById('successCount').textContent = successAttempts;
        const rate = Math.round((successAttempts / totalAttempts) * 100);
        document.getElementById('successRate').textContent = rate + "%";
    }

    function resetStats() {
        totalAttempts = 0;
        successAttempts = 0;
        document.getElementById('totalCount').textContent = 0;
        document.getElementById('successCount').textContent = 0;
        document.getElementById('successRate').textContent = "0%";
        drawStaticScene();
        feedbackBox.textContent = "í†µê³„ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.";
        feedbackBox.style.background = "#eee";
        feedbackBox.style.color = "#777";
    }

    // ì´ˆê¸° í™”ë©´ ê·¸ë¦¬ê¸°
    drawStaticScene();

</script>

</body>
</html>